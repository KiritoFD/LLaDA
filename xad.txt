高等教育网络空间安全规划教材
计算机网络
筵
第Q版安全教程
梁亚声汪永益刘京菊汪生王永杰编著(0
I 提供电子淉件
6 晌肮团丽现
。机械工业出版社
CHINA MACHINE PRESS
“十三五”国家重点出版物出版规划项目
高等教育网络空间安全规划教材
计算机网络安全教程
第4 版
梁亚声汪永益刘京菊汪生王永杰编著
。
机械工业出版社
本书系统地介绍了计算机网络安全的体系结构、基础理论、技术原理和
实现方法．主要内容包括计算机网络的物理安全、信息加密与PKI、防火墙
技术、入侵检测技术、操作系统与数据库安全技术、网络安全检测与评估技
术、计算机病毒与恶意代码防范技术、数据备份技术、无线网络安全、云计
算安全及网络安全解决方案。本书涵盖了计算机网络安全的技术和管理，在
内容安排上将理论知识和工程技术应用有机结合，井介绍了许多计算机网络
安全技术的典型应用方案。
本书可作为高等院校计算机、网络工程和信息安全等专业的教材，也可
作为网络工程技术人员、网络管理人员和信息安全管理人员的技术参考书。
本书配有授课电子课件， 需要的教师可登录www.cmpedu.com 免费注
册，审核通过后下载， 或联系编辑索取（微信： 13146070618, 电话： 010-
88379739) 。
图书在版编目(CIP) 数据
计算机网络安全教程／梁亚声等编著．一4 版．一北京：机械工业出版
社， 2024.1
“十三五”国家重点出版物出版规划项目高等教育网络空间安全规划教材
ISBN 978-7-111-74279-1
I ．研… II . ©梁… m. ＠计算机网络一网络安全一高等学校一教
材W. @IP393.08
中国国家版本馆CIP 数据核字(2023) 第226165 号
机械工业出版社（北京市百万庄大街22 号邮政编码100037)
策划编辑：郝建伟责任编辑：郝建伟
责任校对：杨霞陈越责任印制：任维东
河北鑫兆源印刷有限公司印刷
2024 年1 月第4 版·第1 次印刷
184mmX260mm ．立印张• S74 千字
标准书号： ISBN978一7-lll一74279-1
定价： 79.90 元
电话服务网络服务
客服电话： 010-88361066 机工官网： www.cmpbook.com
OI0-88379833 机工官博： weibo.com/cmpl952
010-68326294 金书网： www.golden-book.com
封底无防伪标均为盗版机工教育服务网： www.cmpedu.com
高等教育网络空问安全规划教材
编委会成员名单
名誉主任沈昌祥中国工程院院士
主任李建华上海交通大学
副主任（以姓氏拼音为序）
崔勇清华大学
王军中国信息安全测评中心
吴礼发南京邮电大学
郑崇辉国家保密教育培训基地
朱建明中央财经大学
委员（以姓氏拼音为序）
陈波南京师范大学
贾铁军上海电机学院
李剑北京邮电大学
梁亚声31003 部队
刘海波哈尔滨工程大学
牛少彰北京邮电大学
潘柱廷永信至诚科技股份有限公司
彭彰教育部教育管理信息中心
沈苏彬南京邮电大学
王相林杭州电子科技大学
王孝忠公安部国家专业技术人员继续教育基地
王秀利中央财经大学
伍军上海交通大学
杨呡复旦大学
俞承杭浙江传媒学院
张蕾北京建筑大学
秘书长胡毓坚机械工业出版社
m
前
言
随着计算机网络的广泛应用，人类面临着信息安全的巨大挑战。如何保证个人、企业及
国家的机密信息不被黑客和间谍窃取，如何保证计算机网络不间断地工作，是国家和企业信息
化建设必须考虑的重要问题。然而，计算机网络安全问题错综复杂，涉及面非常广，有技术因
素，也有管理因素；有自然因素，也有人为因素；有外部的安全威胁，还有内部的安全隐患。
本书紧密结合计算机网络安全技术的最新发展，不断更新内容，在操作系统、无线网络
和云计算等方面，对《计算机网络安全教程》（第3 版）进行了调整、补充和完善。
本书共12 章，第1 章主要介绍计算机网络的相关概念和安全体系结构。第2 章主要介绍
计算机网络的物理安全，从计算机机房、通信线路、设备和电源等方面介绍计算机网络物理层
的安全技术。第3 章主要介绍信息加密与PK.I, 包括密码学基础、加密体制、古典密码／单钥
加密／双钥加密／同态加密等加密算法、信息加密技术应用、数字签名技术和身份认证技术，以
及公开密钥基础设施(PK.I) 。第4 章主要介绍防火墙技术，包括防火墙体系结构、包过滤、应
用代理、状态检测、NAT 等，以及防火墙的应用和个人防火墙。第5 章主要介绍入侵检测技
术，包括入侵检测的基本原理、系统结构、系统分类、技术实现、分布式入侵检测、入侵检测系
统的标准、入侵防护系统和入侵检测系统的应用。第6 章主要介绍操作系统和数据库安全技术，
包括访问控制技术、操作系统的安全技术、UNIX/Linux/Windows 7 系统安全技术、数据库安全
机制及安全技术。第7 章主要介绍网络安全检测与评估技术，包括网络安全漏洞的分类和检测技
术、网络安全评估标准和方法，以及网络安全评估系统。第8 章主要介绍计算机病毒与恶意代
码防范技术，包括计算机病毒的工作原理和分类、计算机病毒的检测和防范技术， 以及恶意代
码的防范技术。第9 章主要介绍数据备份技术，包括磁盘备份、双机备份、网络备份、数据备
份方案、数据备份与灾难恢复策略，以及备份软件。第10 章主要介绍无线网络的安全技术，
包括Wi-Fi 和无线局域网安全、移动终端安全、无线安全技术及应用。第11 章主要介绍云计
算安全，包括云安全威胁和安全需求、云计算安全架构和云计算安全技术。第12 章主要介绍
网络安全解决方案，包括网络安全体系结构，以及企业和单机用户网络安全解决方案。
本书具有以下特点。
l) 在内容安排上具有全面性和系统性，从计算机网络安全的体系结构、软硬件安全、安
全设计和管理等方面，系统地介绍了计算机网络安全的基础理论、技术原理和实现方法，使读
者对计算机网络安全有一个系统、全面的了解。
2) 在介绍技术时注重理论性和实用性，对于每种网络安全技术，首先介绍技术的理论基
础和原理，再通过具体的实例介绍安全技术的应用和操作方法。
3) 在章节编排上具有独立性和完整性，虽然本书涉及的内容十分广泛，但通过合理安排章
节，使各章节内容相对独立，在实施教学时可结合教学对象和实际情况，进行适当的选取和编排。
本书由梁亚声编写第1 章并统稿，汪永益编写第4 、8 、9 章，刘京菊编写第2 、7 、12
章，汪生编写第3 、5、6 章，王永杰编写第10、11 章。
由千作者水平有限，书中难免存在不妥之处，敬请广大读者批评指正。
编者
IV
目
录
前言
第1 章绪论… ………..……… ……… …......……·1
I.I 计算机网络面临的主要威胁…...... ...1
1.1.1 计算机网络实体面临的威胁.............1
1.1.2 计算机网络系统面临的威胁…..........1
1.1.3 恶意程序的威胁.. .….... ......……….....z
1.1.4 计算机网络威胁的潜在对手和
动机......………….... ......… . .... ..……… 3
1.2 计算机网络的不安全因素……………·4
1.2.1 不安全的主要因素……………………… 4
1.2.2 不安全的主要原因……………………… 6
1.3 计算机网络安全的概念…………….....7
1.3.1 计算机网络安全的定义………………··8
1.3.2 计算机网络安全的目标………………··8
1.3.3 计算机网络安全的层次...…………··· 10
1.3.4 计算机网络安全所涉及的内容……·· 10
1.4 计算机网络安全体系结构……….... 11
1.4.1 网络安全模型…………………………·11
1.4.2 OSI 安全体系结构………….. ……….. 11
1.4.3 P2DR 模型..…… ….....………………·· 14
1.4.4 网络安全技术………..……........…···· 16
1.5 计算机网络安全管理………………..; 18
1.5.1 网络安全管理的法律法规....……….. 18
1.5.2 计算机网络安全评价标准…........... . 18
1.6 计算机网络安全技术发展趋势..…· 18
1.6.1 网络安全威胁发展趋势……………… 19
1.6.2 网络安全主要实用技术的发展…….. 19
1.7 小结..... . .. . .. .... ......... . . . .. ... ................. zo
1.8 习题..... .... .. . .. ...... . ... . .. . ... . .. ..... . .. .. ... .. 21
第2 章物理安全...……·……………….. ...…··22
2.1 机房安全...… … ………… .. .....…....…... 22
2.2 通信线路安全……....…… .. ...…....… ·· 29
2.3 设备安全………… ………… …… …….. .. . 30
2.3.1 硬件设备的维护和管理... …… ……… 30
2.3.2 电磁兼容和电磁辐射的防护…....…·30
2.3.3 信息存储媒体的安全管理...............32
2.4 电源系统安全……………….........…… 32
2.5 小结.........…·…............…·….............35
2.6 习题· … …….............… .........…….... ....35
第3 章信息加密与PKI······………………… 36
3.1 密码学概述……………..……………… ··36
3.1.1 密码学的发展…………………………··36
3.1.2 密码学基本概念…………….....……· · 38
3.1.3 密码体制分类... .……....... .......…·--··38
3.2 加密算法…………..………………………41
3.2.1 古典密码算法…………………………··41
3.2.2 单钥加密算法…………….............…·42
3.2.3 双钥加密算法…………………………··49
3.2.4 同态加密算法...… ….. .. .. .. .... ..:...,.... 51
3.3 信息加密技术应用…………....……… 52
3.3.1 链路加密…………..…………………… 52
3.3,.2 结点加密·…·……... ....…..........……·53
3.3.3 端到端加密…………….........………..53
3.3.4 同态加密应用……. ..... .. .. .. .. .. . ....…··54
3.3.5 其他应用…………. .. ....... ......... . .. .. ..55
3.4 认证技术……………....…....................56
3.4.1 认证技术分层模型·………...………… 56
3.4.2 认证体制要求与模型.............…......56
3.4.3 数字签名技术.........……………······ ··57
3.4.4 身份认证技术.. .... .. ....... .. . .... ....... . ..57
3.4.5 消息认证技术………………......... .....59
3.4.6 数字签名与消息认证…………·········· 61
3.5 公开密钥基础设施(PKI)...........61
3.5.1 PK.I 的基本概念................ .... . ……..61
3.5.2 PK.I 认证技术的组成......................63
3.5.3 PK.I 的特点... .......... . ...... ................69
3.6 常用加密软件介绍.........................70
3.6.I pop..............…·…......................... 70
3.6.2 GnuPG·······....................……………72
v
计算机网络安全教程第4 版
3.7 小结.....…………········……........…….... 75
3.8 习题…......……………………......….......76
第4 章防火墙技术..………………....……....77
4.1 概述.............. ...................………....... 77
4.1.1 防火墙的概念…..……………………… 77
4.1.2 防火墙的功能………………………… ·· 78
4.1.3 防火墙的局限性…………….......…… 79
4.2 防火墙体系结构……..………………… 80
4.2.1 双重宿主主机体系结构..…….......... go
4.2.2 屏蔽主机体系结构……………………·80
4.2.3 屏蔽子网体系结构……....…………… 81
4.2.4 防火墙体系结构的组合形式…..…… 83
4.3 常用防火墙技术………………………··84
4.3.1 包过滤技术..…………………………… 84
4.3.2 代理服务技术…………………………·· 89
4.3.3 状态检测技术………… ……………….. 93
4.3.4 NAT 技术………………………………·95
4.4 防火墙的安全防护技术……………... 96
4.4.1 防止防火墙标识被获取……·……….. 96
4.4.2 防止穿透防火墙进行扫描:.............. 98
4.4.3 克服分组过滤的脆弱点……………· 100
4.4.4 克服应用代理的脆弱点……………· 101
4.5 防火墙应用示例…………… ………… 102
4.5.1 TG-470C 防火墙系统组成……… … 102
4.5.2 WebUI 方式配置示例…………….... 103
4.6 个人防火墙..……………………… ...... 108
4.6.1 个人防火墙概述…………………….. 108
4.6.2 个人防火墙的主要功能…………"··108
4.6.3 个人防火墙的特点…………………·· 109
4.6.4 主流个人防火墙简介………………·· 109
4.7 防火墙发展动态和趋势………….... 115
4.8 小结……………………..………...……… 117
4.9 习题..………...…………..……..……….. 117
第5 章入侵检测技术·…·……..…………… 119
5.1 入侵检测概述...………....,....…….... 119
5.1.1 入侵检测原理………….........…..... 120
5.1.2 系统结构··…………………………..... 121
5.1.3 系统分类……………………………··· 122
5.2 入侵检测的技术实现………………· 124
5.2.1 入侵检测分析模型.....……………… 124
VI
5.2.2 误用检测……………....………........ 125
5.2.3 异常检测……………………………… 128
5.2.4 其他检测技术………………………..,132
5.3 分布式入侵检测..……………………·134
5.3.1 分布式入侵检测的优势.........……·135
5.3.2 分布式入侵检测的技术难点………·136
5.3.3 分布式入侵检测的实现....…......... 136
5.4 入侵检测系统的标准………………·· 138
5.4.1mTF/IDWG…….......……......……··138
5.4.2 CIDF…………………….....……....... 141
5.5 入侵防护系统……………..........…... 142
5.5.1 概念和工作原理……............…….. 143
5.5.2 使用的关键技术……·············……·143
5.5.3 IPS 系统分类·………..................... 144
5.6 Snort 使用示例……………..........…··144
5.6.1 Snort 简介……………………………··144
5.6.2 Snort 的体系结构.………………·145
5.6.3 Snort 的安装与使用…………………·147
5.6.4 Snort 的安全防护……………………·150
5.7 小结·………………........................…·150
5.8 习题…………………………….......……·151
第6 章操作系统与数据库安全技术……·152
6.1 访问控制技术…………………………·152
6.1.1 认证、审计与访问控制………… …·152
6.1.2 传统访问控制技术…………………··154
6.1.3 新型访问控制技术..…........... ……· 156
6.1.4 访问控制的实现技术..…..........…·· 158
6.1.5 安全访问规则（授权）的管理…… 161
6.2 操作系统安全技术…………………·· 161
6.2.1 操作系统安全准则………………….. 161
6.2.2 操作系统安全防护的一般方法...... 163
6.2.3 操作系统资源防护技术................ 164
6.2.4 操作系统的安全模型……………..... 166
6.3 UNIX/Linux 系统安全技术·……… 169
6.3.1 UNIX/Linwc 安全基础……………--·169
6.3.2 UNIX/Linwc 安全机制........…...... . 170
6.3.3 UNIX/Linwc 安全措施………....…·· 171
6.4 Windows 7 系统安全技术…......... 173
6.4.1 Windows 7 安全基础……………..... 174
6.4.2 Windows 7 安全机制·………………· 175
目
录
6.4.3 Windows 7 安全措施……….....…... 179
6.5 数据库安全概述....………....………· 184
6.5.l 数据库安全的基本概念..………….. 184
6.5.2 数据库管理系统简介…….......……· 185
6.5.3 数据库系统的缺陷与威胁...……···· 186
6.6 数据库安全机制……………………… 186
6.6.1 数据库安全的层次分布………….... 186
6.6.2 安全DBMS 体系结构……………… 187
6.6.3 数据库安全机制分类·…....………… 189
6.6.4 Oracle 的安全机制………………..... 193
6.7 数据库安全技术...………….....…… · 195
6.8 小结………………………………….....… 196
6.9 习题.....…....... ………·……………….... 196
第7 章网络安全检测与评估技术..……· 198
7.1 网络安全漏洞...……………….......... 198
7.1.1 网络安全漏洞的威胁……………….. 198
7.1.2 网络安全漏洞的分类……....…...... 199
7.2 网络安全检测技术……………········201
7.2.1 端口扫描技术………………….........201
7立2 操作系统探测技术……………········202
7.2.3 安全漏洞探测技术…………...........202
7.3 网络安全评估标准……………········204
7.3.1 网络安全评估标准的发展
历程………………………………….... 204
7.3.2 TCSEC、ITSEC 和CC 的
基本构成………………………………·206
7.4 网络安全评估方法……………….....210
7.4.1 基千通用评估方法(CEM) 的
网络安全评估模型…………………··210
7.4.2 基于指标分析的网络安全综合
评估模型………………………………·213
7.4.3 基千模糊评价的网络安全状况
评估模型………………………………·218
7.5 网络安全检测评估系统简介……··220
7.5.1 Nessus........…..................………··220
7.5.2 AppScan ·…·……......参.....…·….......228
7.6 小结...……… ..……..…·…............... .. .234
7.7 习题..….....….. …... ....….. .... . .... .... ....234
第8 章计算机病毒与恶意代码防范
技术.....….. .…………..........….....… 236
8.1 计算机病毒概述….......………........236
8.1.1 计算机病毒的定义....………………· 236
8.1.2 计算机病毒简史……………………..237
8.1.3 计算机病毒的特征……….....……… 238
8.1.4 计算机病毒的危害·……·…………..:239
8.2 计算机病毒的工作原理和
分类………..……...………………………·241
8.2.1 计算机病毒的工作原理……··········241
8.2.2 计算机病毒的分类……………........245
8.2.3 病毒实例分析………………………···248
8.3 计算机病毒的检测与防范.......…··252
8.3.1 计算机病毒的检测….......…………·252
8.3.2 计算机病毒的防范…………………··255
8.3.3 计算机病毒的发展方向和趋势······257
8.4 恶意代码…………………..................259
8.4.1 恶意代码概述……………………......259
8.4.2 恶意代码的特征与分类…....……···259
8.4.3 恶意代码的关键技术…………….....260
8.4.4 网络蠕虫……………………············262
8.4.5 Rootkit 技术…………............…·····263
8.4.6 恶意代码的防范……..........……····265
8.5 小结………………………………...........266
8.6 习题………………………………………..267
第9 章数据备份技术………………………··268
9.1 数据备份概述…………………….......268
9.1.1 数据失效的主要原因……..............268
9.1.2 备份及其相关概念......……………··270
9.1.3 备份的误区….........………………···271
9.1.4 选择理想的备份介质·………...…··-- 271
9.1.5 备份技术和备份方法……………·····272
9.2 数据备份方案.......…………….........273
9.2.1 磁盘备份....... ......……………….....273
9.2.2 双机备份………………….......….....280
9.2.3 网络备份..…....... .. .............…......283
9.3 数据备份与灾难恢复策略………···285
9.3.1 数据备份策略.................………… · 286
9.3.2 灾难恢复策略....:.....……………….. 288
9.4 备份软件简介................…………...288
9.4.1 Ghost 软件基本信息……......……… 289
9.4.2 分区备份·……·……………………… ·289
VII
计算机网络安全教程笫4 版
9.4.3 从镜像文件还原分区..…...………...291
9.4.4 硬盘的备份及还原… …………..…..,292
9.4.5 Ghost 使用方案............…...…… ··· 292
9.5 小结... . ....... .. . . .. ... .. ..... .. ................. . 293
9.6 习题.... ........ …............ .......…….......293
第10 章无线网络安全……… ……………...294
10.1 无线网络安全的特点…………….. 294
10.1.1 无线网络概述·…………........…… ·294
10.1.2 无线网络的特点… …......…………·294
10.1.3 无线网络面临的安全威胁…..._..... 295
10.2 Wi-Fi 和无线局域网安全…… …..296
10.2.1 Wi-Fi 和无线局域网概述… …... ...296
10.2.2 无线局域网安全机制……………...297
10.3 移动终端安全…………… …………..298
10.3.1 iOS 安全……………………………..298
10.3.2 Android 安全……………………..... 301
10.4 无线安全技术及应用…………….. 305
10.4.1 常用无线网络安全技术…………··305
10.42 无线网络安全技术应用…………··306
10.5 小结……………………………………… 307
10.6 习题…………… ………………………… 307
第11 章云计算安全………………………… 308
11.1 云计算面临的安全挑战…………· 308
11.1.1 云计算概述…… …………………....308
11.1.2 云安全概述…………... ……………·308
11.1.3 云安全威胁…………………………·310
11.1.4 云安全需求…………….....………..310
11.2 云计算安全架构·….....……………·311
11.2.1 基于可信根的安全架构.. … ……...311
11.2.2 基于隔离的安全架构……………… 312
VIII
11.2.3 安全即服务的安全架构..………·… 313
11.3 云计算安全技术….....………… …··315
11.3.1 云计算安全服务体系……………… 315
11.3.2 云计算安全技术的种类…………… 316
11.4 小结....................... ......…........ .....319
11.5 习题.. ....... ..... . . .. . .... . .... .... ... . .... .....319
第12 章网络安全解决方案………………·320
12.1 网络安全体系结构……………·······320
12.1.1 网络信息安全的基本问题………··320
12.1.2 网络安全设计的基本原则·…… …·322
12.2 网络安全解决方案概述……… …..323
12.2.1 网络安全解决方案的基本概念… ..… 323
12.2.2 网络安全解决方案的层次划分········324
12.2.3 网络安全解决方案的框架………··325
12.3 网络安全解决方案设计…………··326
12.3.1 网络系统状况…………….. .....…… 326
12.3.2 安全需求分析………………………· 327
12.3.3 网络安全解决方案设计实例……··330
12.4 单机用户网络安全解决方案…… 332
12.4.1 单机用户面临的安全威胁………·· 332
12.4.2 单机用户网络安全解决方案…·····332
12.4.3 移动终端上网安全解决方案……··334
12.5 内部网络安全管理制度…………..334
12.6 小结..........……..................…........336
12.7 习题…………·………….....…………… 336
附录………………………………….....….....….....337
附录A 彩虹系列……………….........…..337
附录B 安全风险分析一览表… ………·338
参考文献… …………………...........…………….. 343
l已
第
在信息化时代，互联网在全球范围掀起一场影响人类所有层面的深刻变革，实现了基千
企业内部网(Intranet) 、企业外部网(Extranet) 、全球互联网(Internet) 的世界范围内的信息
共享和业务处理。随着政府上网、企业上网、教育上网、家庭上网等的普及，计算机网络在经
济、军事和文教等诸多领域得到广泛应用。
计算机网络在为人们提供便利、带来效益的同时，也使人类面临着信息安全的巨大挑
战。计算机网络存储、传输和处理着政府宏观调控决策、商业经济、银行资金转账、股票证
券、能源资源、国防和科研等大量关系国计民生的重要信息，许多重要信息直接关系到国家的
安全。如何保护个人、企业和国家的机密信息不受黑客和间谍的入侵，如何保证网络系统安全
地、不间断地工作，是国家和单位信息化建设必须考虑的重要问题。
有关计算机安全技术的研究始于20 世纪60 年代。当时，计算机系统的脆弱性已日益为
美国政府和一些私营机构所认识。但是，由于当时计算机的速度和性能还比较落后，使用的范
围也不广，再加上美国政府把它当作敏感问题而施加控制。因此，有关计算机安全的研究一直
局限在比较小的范围内。
进入20 世纪80 年代后，计算机的性能得到了成百上千倍的提高，应用的范围也在不断
扩大，计算机几乎遍及世界各个角落。并且，人们利用通信网络把孤立的单机系统连接起来相
互通信和共享资源，随之而来的计算机网络的安全问题日益严峻，成为信息技术中最重要的问
题之一。
1.1 计算机网络面临的主要威胁
计算机网络是颇具诱惑力的攻击目标，无论是个人、企业，还是政府机构，只要使用计
算机网络，都会感受到网络安全问题带来的威胁。无论是局域网还是广域网，都存在着自然和
人为等诸多脆弱性与潜在威胁。
1.1.1 计算机网络实体面临的威胁
实体是指计算机网络中的关键设备，包括各类计算机（服务器、工作站等）、网络和通信
设备（路由器、交换机、集线器、调制解调器和加密机等）、存放数据的媒体（磁带、磁盘和
光盘等）、传输线路、供配电系统，以及防雷系统和抗电磁干扰系统等。这些设备不管哪一个
环节出现问题，都会影响网络的正常运行，甚至给整个网络带来灾难性的后果。
1.1.2 计算机网络系统面临的威胁
1986一1989 年，原西德黑客团伙“汉诺威集团”试图进入美国军事计算机网络刺探机
密，这一事件于1989 年3 月2 日在德国电视上曝光。1990 年1 月15 日又发生了AT&T
“一·一五”大瘫痪事件。从而使美国意识到黑客对计算机网络系统的严重威胁， 1990 年在
1
计算机网络安全教程笫4 版
美国全国范围内掀起了一场“扫黑大行动”。2014 年4 月爆出了Heartbleed （心脏出血）漏
洞，涉及各大网银、门户网站等，该漏洞可被用千窃取服务器敏感信息，实时抓取用户的账号
和密码。在漏洞被公开后到系统被修复前这段时间内，该漏洞已经被利用，有些网站用户信息
或许已经被黑客非法获取。2014 年12 月，索尼影业公司被黑客攻击，摄制计划、明星隐私及未
发表的剧本等敏感数据都被黑客窃取，并逐步公布在网络上，索尼影业损失高达1 亿美元。
计算机网络系统的安全威胁主要表现在主机可能会受到非法入侵者的攻击，网络中的敏
感数据有可能泄露或被修改，从内部网向公共网传送的信息可能被他人窃听或篡改等。表1-1
所示为典型的网络安全威胁。
表1一1 典型的网络安全威胁
威胁描述
窃听网络中传输的敏感信息被窃听
重传攻击者事先获得部分或全部信息，以后将此信息发送给接收者
伪造攻击者将伪造的信息发送给接收者
篡改攻击者对合法用户之间的通信信息进行修改、删除或插入后，再发送给接收者
非授权访问
通过假冒、身份攻击或系统漏洞等手段，获取系统访问权，从而使非法用户进入网络系统读
取、删除、修改或插入信息等
拒绝服务攻击攻击者通过某种方法使系统响应减慢甚至瘫痪，阻止合法用户获得服务
行为否认通信实体否认已经发生的行为
旁路控制攻击者发掘系统的缺陷或安全脆弱性
电磁／射频截获攻击者从电子或机电设备所发出的无线射频或其他电磁辐射中提取信息
APT (Advanced Persistent 利用先进的攻击手段对特定目标进行长期持续性网络攻击的攻击形式。
Threat ，高级持续性威胁） APT 在发动攻击之前对攻击对象的业务流程和目标系统进行精确的收集，挖掘被攻击对象授信
攻击系统和应用程序的漏洞， 利用Oday 漏洞进行攻击
人员疏忽授权的人为了利益或由于粗心将信息泄露给未授权人
1.1.3 恶意程序的威胁
以计算机病毒、网络蠕虫、间谍软件和木马程序等为代表的恶意程序时刻都威胁着计算
机网络的安全。
1988 年11 月发生了互联网络蠕虫(Wonn) 事件，也称莫里斯蠕虫案。22 岁的罗伯特泰
潘莫里斯是美国康奈尔大学计算机系研究生，其父鲍勃莫里斯是美国国家安全局的首席安全
专家。罗伯特从小喜爱计算机，非常熟悉UNIX 系统。在恶作剧心态的操纵下，罗伯特利用
UNIX 系统中SendJnail 、Finger 和FTP 的安全漏洞，编写了一个蛭虫病毒程序。11 月2 日
晚，罗伯特将病毒程序安放在与ARPANET （国际互联网Internet 的前身）联网的麻省理工学
院的网络上。由千病毒程序中一个参数设置错误，该病毒迅速在与ARPANET 联网的几乎所
有计算机中扩散，并被疯狂复制，大量侵蚀计算机资源，使得美国成千上万台计算机一夜之间
陷入瘫痪。
1999 年4 月26 日， CIH 病毒爆发，俄罗斯10 多万台计算机瘫痪，韩国24 万多台计算机
受影响，马来西亚12 个股票交易所受到侵害。
2
第1 章绪论
计算机病毒可以严重破坏程序和数据，使网络的效率和作用大大降低，使许多功能无法
正常使用，导致计算机系统的瘫痪。据统计，计算机病毒所造成的损失占网络经济损失的
76%，仅“爱虫”发作在全球所造成的损失就高达96 亿美元。虽然至今尚未出现灾难性的后
果，但各种各样的计算机病毒层出不穷，并活跃在各个角落。
1.1.4 计算机网络威胁的潜在对手和动机
对网络进行攻击的潜在对手有怀有恶意的，也有非恶意的。网络威胁的潜在对手举例如
表1-2 所示。
表1-2 潜在的对手举例
对手描述
国家国家经营，组织精良，井得到很好的财政资助，收集别国的机密或关键信息
黑客寻找网络系统的脆弱性及其缺陷，进而攻击网络
恐怖分子／计算机恐
各种恐怖分子或极端势力的个人或团体，以强迫、恐吓政府或杜会以满足其需要为目的
怖分子
有组织的计算机郎雇有组织和财政资助的协同犯罪
恶意
攻击其他犯罪成员犯罪群体的其他部分，通常由少量成员构成，或是单独行动的个人
国际新闻社
收集和发布消息（有时是非法的），井将其服务出售给出版社和娱乐媒体的组织．其行为包
括在任何指定时间收集关千任何人和事的情报
工业竞争
在竞争市场中营运的国内或外国公司，它们经常以商业间谍的形式，从竞争对手或外国政府
那里非法收集情报
不满的雇员具有访问系统的条件，能够对系统实施内部威胁
非恶意粗心或未受良好训
缺乏训练，或者粗心大意导致信息系统损坏
攻击练的工作人员
对计算机网络进行恶意破坏的目的多种多样，主要是获取商业、军事或个人情报，影响
计算机系统正常运行。
通常，从事这些行为的人被称为黑客。黑客的范围很广，从没有经验的职员、大学生或
新手到具有高技术能力的人员。大多数黑客以他们的技术为荣，寻求简单方法获得对系统的访
问权（而非破坏）。
黑客刺探特定目标的通常动机如下。
·获取机密或敏感数据的访问权。
·跟踪或监视目标系统的运行（跟踪分析）。
·扰乱目标系统的正常运行。
·窃取钱物或服务。
·免费使用资源（如计算机资源或用网络）。
·向安全机制进行技术挑战。
从信息系统方面看，这些动机具有以下3 个基本目标。
·访问信息。
·修改或破坏信息或系统。
·使系统拒绝服务。
3
计算机网络安全教程第4 版
在攻击信息处理系统时，面临着一定风险，这些风险包括以下几个。
·暴露其攻击能力。
·打草惊蛇，使对手有所防范，从而增加未来进一步成功攻击的难度。
·遭受惩罚（如罚款或入狱等）。
·危及生命安全。
1.2 计算机网络的不安全因素
一般来说，计算机网络本身的脆弱性和通信设施脆弱性共同构成了计算机网络的潜在威
胁。一方面，计算机网络的硬件和通信设施极易受到自然环境的影响（如温度、湿度、灰尘度
和电磁场等），以及自然灾害（如洪水、地震等）和人为（故意破坏和非故意破坏）的物理破
坏；另一方面，计算机网络的软件资源和数据信息易受到非法的窃取、复制、篡改和毁坏；再
有，计算机网络硬件的自然损耗和自然失效，以及软件的逻辑错误，同样会影响系统的正常工
作，造成计算机网络系统内信息的损坏、丢失和安全事故。
1.2.1 不安全的主要因素
对计算机网络安全构成威胁的因素很多，综合起来包括以下三个方面。
·偶发因素：如电源故障、设备的机能失常、软件开发过程中留下的漏洞或逻辑错
误等。
·自然灾害：各种自然灾害（如地震、风暴、泥石流和建筑物破坏等）对计算机系统构
成严重的威胁。此外，火灾、水灾和空气污染也对计算机网络构成严重威胁。
·人为因素：不法之徒利用计算机网络或潜入计算机房，篡改系统数据、窃用系统资
源、非法获取机密数据和信息、破坏硬件设备或编制计算机病毒等。此外，管理不
好、规章制度不健全、有章不循、安全管理水平低、人员素质差、操作失误，以及渎
职行为等都会对计算机网络造成威胁。
人为因素对计算机网络的破坏也称为人对计算机网络的攻击，可分为下列几个方面。
1. 被动攻击
这类攻击主要是监视公共媒体（如无线电、卫星、微波和公共交换网）上传送的信息，
典型的被动攻击如表1-3 所示。抵抗这类攻击的对策主要包括：使用虚拟专用网VPN、加密
被保护网络，以及使用加保护的分布式网络。
表1-3 典型被动攻击举例
攻击
监视明文
解密通信数据
描述
监视网络，获取未加密的信息
通过密码分析，破解网络中传输的加密数据
口令嗅探
通信鱼分析
使用协议分析工具，捕获用于各类系统访问的口令
不对加密数据进行解密，而是通过对外部通信模式的观察获取关键俏息．例如，通信模式的改变可以
暗示紧急行动
2. 主动攻击
主动攻击主要是避开或突破安全防护、引入恶意代码（如计算机病毒），以及破坏数据和
4
第1 章绪论
系统的完整性，典型的主动攻击如表1 -4 所示。抵抗这类攻击的对策主要包括：增强内部网络
的保护（如防火墙和边界护卫）、采用基千身份认证的访问控制、远程访问保护、质量安全管
理、自动病毒检测、审计和入侵检测等技术。
表1-4 典型主动攻击举例
攻击描述
修改传输中的数据
截获井修改网络中传输的数据，例如修改电子交易数据，从而改变交易的数层或者将交易转移到
别的账户
蜇放将旧的消息重新反复发送，造成网络效率降低
会话拦截未授权使用一个已经建立的会话
伪装成授权的用户或服
这类攻击者将自己伪装成他人，从而未授权访问资源和信息． 一般过程是，先利用嗅探或其他手
段获得用户／管理员信息，然后作为一个授权用户登录。这类攻击也包括用千获取敏感数据的欺骗服
务器务器，通过与未产生怀疑的用户建立信任服务关系来实施攻击
利用系统软件的漏洞
攻击者探求以系统权限运行的软件中存在的脆弱性． 几乎每天都能发现软件和硬件平台中新的脆
弱性
利用主机或网络信任攻击者通过操纵文件，使虚拟／远方主机提供服务，从而获得信任。典型的攻击有rhost 和rlogin
利用恶意代码
攻击者通过系统的脆弱性进入用户系统，井向系统内植入恶意代码；或者是， 将恶意代码植入看
起来无害的供下载的软件或电子邮件中，从而使用户去执行恶意代码
利用协议或基础设施的
攻击者利用协议中的缺陷来欺骗用户或重定向通信量。这类攻击包括：哄骗域名服务器以进行未
系统缺陷
授权远程登录，使用ICMP 炸弹使某个机器离线，源路由伪装成倌任主机源， TCP 序列号猜测获得
访问权，为截获合法连接而进行TCP 组合等
拒绝服务
攻击者有很多实施拒绝服务的攻击方法，包括：有效地将一个路由器从网络中脱离的ICMP 炸
弹，在网络中扩散垃圾包，以及向邮件中心发送垃圾邮件等
3. 邻近攻击
邻近攻击是指未授权者可物理上接近网络、系统或设备，从而可以修改、收集信息，或
使系统拒绝访问，典型的邻近攻击如表I-5 所示。接近网络可以是秘密进入或公开，也可以是
两者都有。
攻击
修改数据或收集信息
系统千涉
物理破坏
4. 内部人员攻击
表1-s 典型邻近攻击举例
描述
攻击者获取系统管理权，从而修改或窃取信息，如1P 地址、登录的用户名和口令等
攻击者获取系统访问权，从而干涉系统的正常运行
该攻击获取系统物理设备访问权，从而对设备进行物理破坏
内部工作人员具有对系统的直接访问权，可轻易地对系统实施攻击。内部人员攻击分为
恶意和非恶意（不小心或无知行为）两种。非恶意行为也会导致安全事件，因此，非恶意破坏
也被认为是一种攻击，典型的内部人员攻击如表1-6 所示。
l) 内部人员的恶意攻击：根据美国联邦调查局的评估， 80％的攻击和入侵来自内部。内
部人员知道系统的布局、有价值的数据在何处，以及系统所采用的安全防范措施。而且，内部
人员的攻击通常是最难以检测和防范的。
2) 内部人员的非恶意攻击：这类攻击并非故意破坏信息或信息处理系统， 而是由千无意
的行为对系统产生了破坏，这些破坏一般是由于缺乏知识或不小心所致。
典型对策包括：加强安全意识和技术培训，对系统的关键数据和服务采取特殊的访问控
5
计算机网络安全教程第4 版
制机制，采用审计、入侵检测等技术。
表1-6 典型内部人员攻击举例
攻击描述
修改数据或安全机制
内部人员直接使用网络，具有系统的访问权． 因此，内部人员攻击者比较容易实施未授权操
作或破坏数据
恶意檀自连接网络
对涉密网络具有物理访问能力的人员，擅自将机密网络与密级较低的网络或公共网络连接，
违背涉密网络的安全策略和保密规定
攻击
隐通道隐通道是未授权的通信路径，用于从本地网向远程站点传输盗取的信息
物理损坏或破坏对系统具有物理访问权限的工作人员对系统故意破坏或损坏
非恶意
修改数据由千缺乏知识或粗心大意，修改或破坏数据或系统信息
攻击物理损坏或破坏由于渎职或违反操作规程， 对系统的物理设备造成意外损坏或破坏
5．分发攻击
分发攻击是指在软件和硬件开发出来后与安装之前，当它从一个地方送到另一个地方
时，攻击者恶意地修改软件或硬件，典型的分发攻击如表1-7 所示。可以通过受控分发，以及
由最终用户检验软件签名和访问控制来消除分发攻击威胁。
表1-7 典型分发攻击举例
攻击
在设备生产时修改软、硬件
在产品分发时修改软、硬件
描述
当软件和硬件在生产线上时，通过修改软、硬件配置来实施这类攻击
在产品分发期内修改软、硬件配置（如安装窃听设备）
1上2 不安全的主要原因
计算机网络系统安全的脆弱性是伴随计算机网络一同产生的，换句话说，安全脆弱是计
算机网络与生俱来的致命弱点。在网络建设中，网络特性决定了不可能无条件、无限制地提高
其安全性能。既要使网络方便快捷，又要保证网络安全，这是一个非常棘手的“两难选择“,
而网络安全只能在“两难选择“所允许的范围内寻找平衡点。因此，可以说任何一个计算机网
络都不是绝对安全的。
L 互联网具有不安全性
最初，互联网用于科研和学术目的，它的技术基础存在不安全性。互联网是对全世界所
有国家开放的网络，任何团体或个人都可以在网上方便地传送和获取各种各样的信息，具有开
放性、国际性和自由性，这就对安全提出了更高的要求，主要表现在以下三个方面。
·开放性的网络：导致网络的技术全开放，使得网络所面临的破坏和攻击来自多方面。
可能来自物理传输线路的攻击，也可能来自对网络通信协议的攻击，以及对软件和硬
件实施的攻击。
·国际性的网络：意味着网络的攻击不仅来自本地网络的用户，而且可以来自互联网上
的任何一台计算机，也就是说，网络安全面临的是国际化的挑战。
·自由性的网络：意味着网络最初对用户的使用并没有提供任何技术约束，用户可以自
由地访问网络，自由地使用和发布各种类型的信息。
另外，互联网使用的TCP/IP （传输控制协议／网际协议），以及FTP （文件传输协议）、
6
第1 章绪论
E-mail （电子邮件）、RPC （远程程序通信规则）和NFS （网络文件系统）等都包含许多不安
全的因素，存在许多安全漏洞。
2. 操作系统存在的安全问题
操作系统软件自身的不安全性，以及系统设计时的疏忽或考虑不周而留下的“破绽”,
都给危害网络安全的人留下了许多”后门”。
操作系统体系结构造成的安全隐患是计算机系统不安全的根本原因之一。操作系统的程
序是可以动态连接的，如1/0 的驱动程序和系统服务，这些程序和服务可以通过“打补丁”的
方式进行动态连接。许多UNIX 操作系统的版本升级和开发都是采用打补丁的方式进行的。
这种动态连接的方法容易被黑客利用，而且还是计算机病毒产生的好环境。另外，操作系统的
一些功能也带来不安全因素，例如，支持在网络上传输可以执行的文件映像，以及网络加载程
序的功能等。
操作系统不安全的另一个原因在于它可以创建进程，支持进程的远程创建与激活，支持
被创建的进程继承创建进程的权利，这些机制提供了在远端服务器上安装间谍软件的条件。若
将间谍软件以打补丁的方式“打”在一个合法的用户上，尤其“打”在一个特权用户上，黑客
或间谍软件就可以使系统进程与作业的监视程序都监测不到它的存在。
操作系统的无口令入口及隐蔽通道（原是为系统开发人员提供的便捷入口），也都成为黑
客入侵的通道。
3. 数据的安全问题
在网络中，数据存放在数据库中，供不同的用户共享。然而，数据库存在着许多不安全
性，例如，授权用户超出了访问权限进行数据的更改活动；非法用户绕过安全内核，窃取信息
资源等。对千数据库的安全而言，要保证数据的安全可靠和正确有效，即确保数据的安全性、
完整性和并发控制。数据的安全性就是防止数据库被故意破坏和非法存取；数据的完整性是防
止数据库中存在不符合语义的数据，以及防止由千错误信息的输入、输出而造成无效操作和错
误结果；并发控制就是在多个用户程序并行地存取数据库时，保证数据库的一致性。
4. 传输线路的安全问题
尽管在光缆、同轴电缆、微波和卫星通信中窃听其中指定一路的信息是很困难的，但是
从安全的角度来说，没有绝对安全的通信线路。
5．网络应用存在的安全问题
伴随着互联网更加开放，用户开展的业务也更加丰富多彩，终端智能被普遍使用，数据
中心和各种云的建设应用，网络的安全问题也出现了新的形式及特点，应用安全问题已经成为
移动互联网网络推广的主要问题。
6．网络安全管理问题
网络系统缺少安全管理人员，缺少安全管理的技术规范，缺少定期的安全测试与检查，
缺少安全监控，是网络最大的安全问题之一。
1.3 计算机网络安全的概念
计算机网络安全是一门涉及计算机科学、网络技术、通信技术、密码技术、信息安全技
术、应用数学、数论和信息论等多种学科的综合性学科。
7
计算机网络安全教程笫4 版
1.3.1 计算机网络安全的定义
计算机网络安全是指利用管理控制和技术措施，保证在一个网络环境里，信息数据的机
密性、完整性及可使用性受到保护。要做到这一点，必须保证网络的系统软件、应用软件和数
据库系统具有一定的安全保护功能，并保证网络部件（如终端、调制解调器和数据链路等）的
功能只能被授权的人所访问。网络的安全问题实际上包括两方面的内容，一是网络的系统安
全，二是网络的信息安全，而保护网络的信息安全是最终目的。
从广义来说，凡是涉及网络上信息的保密性、完整性、可用性、不可否认性和可控性的
相关技术与理论都是网络安全的研究领域。
网络安全的具体含义会随着“角度”的变化而变化。从用户（个人、企业等）的角度来
说，希望涉及个人隐私或商业利益的信息在网络上传输时受到机密性、完整性和不可否认性的
保护，避免其他人或对手利用窃听、冒充、篡改和抵赖等手段侵犯，即用户的利益和隐私不被
非法窃取与破坏。从网络运行和管理者角度来说，希望其网络的访问、读写等操作受到保护和
控制，避免出现“后门”、病毒、非法存取、拒绝服务，以及网络资源被非法占用和非法控制
等威胁，制止和防御黑客的攻击。对安全保密部门来说，希望对非法的、有害的或涉及国家机
密的信息进行过滤和防堵，避免机要信息泄露，避免对社会造成危害，避免给国家造成巨大损
失。从社会教育和意识形态角度来讲，网络上不健康的内容会对社会的稳定和人类的发展造成
阻碍，必须对其进行控制。
1.3.2 计算机网络安全的目标
从计算机网络安全定义中可以看出，计算机网络安全应达到以下几个目标。
1. 保密性
保密性是指网络中的保密信息只能供经过允许的人员，以经过允许的方式使用，信息不泄
露给非授权用户、实体或过程，或供其利用。从技术上说，任何传输线路，包括电缆（双绞或
同轴）、光缆、微波和卫星，都是可能被窃听的。提供保密性安全服务取决千以下若干因素。
·需保护数据的位置：数据可能存放在PC 或服务器、局域网的线路上，或其他流通机制
（如磁带、U 盘和光盘等）上，也可能流经一个完全公开的媒体（如经过互联网或通信
卫星）。
·需保护数据的类型：数据元素可以是本地文件（如口令或密钥）、网络协议所携带的数
据和网络协议的信息交换（如一个协议数据单元）。
·需保护数据的数量或部分：保护整个数据元素、部分数据单元或协议数据单元。
·需保护数据的价值：被保护数据的敏感性，以及数据对用户的价值。
保密性的要素如下。
·数据保护：防止信息内容的泄露。
·数据隔离：提供隔离路径或采用过程隔离。
·通信流保护：数据的特征，包括频率、数量和通信流的目的地等。通信流保护是指对
通信的特征信息及推断信息（如命令结构等）进行保护。
2. 完整性
完整性是指网络中的信息安全、精确与有效，不因种种不安全因素而改变信息原有的内
容、形式与流向，确保信息在存储或传输过程中不被修改、不被破坏和不丢失。
8
笫1 章绪论
破坏信息的完整性既有人为因素，也有非人为因素。非人为因素是指通信传输中的干扰
噪声、系统硬件或软件的差错等。人为因素包括有意和无意两种，有意危害是指非法分子对计
算机的侵入、合法用户越权对数据进行处理，以及隐藏破坏性程序（如计算机病毒、时间炸弹
和逻辑陷阱等）等；无意危害是指操作失误或使用不当。完整性被破坏是计算机网络安全的主
要威胁。另外，信息完整性是一个很广泛的问题。例如，分布式数据库中并发性操作或者对多
个数据副本的更新所引起的数据一致性问题；又如，由千系统的设计不完善造成使用不当或操
作失误所引起的数据完整性问题等。
提供完整性服务的要求与保密性服务的要求相似，包括需要保护数据的位置、类型、数
量及内容。
3. 可用性
可用性是指网络资源在需要时即可使用，不因系统故障或误操作等使资源丢失或妨碍对
资源的使用，是被授权实体按需求访问的特性。在网络环境下，拒绝服务、破坏网络和系统的
正常运行等都属于对可用性的攻击。
网络可用性还包括在某些不正常条件下继续运行的能力。对网络可用性的破坏，包括合
法用户不能正常访问网络资源和有严格时间要求的服务不能得到及时响应。影响网络可用性的
因素包括人为与非人为两种。前者是指非法占用网络资源、切断或阻塞网络通信、降低网络性
能甚至使网络瘫痪等；后者是指灾害事故（如火、水和雷击等）、系统死锁和系统故障等。
保证可用性的最有效的方法是提供一个具有普遍安全服务的安全网络环境。通过使用访
问控制阻止未授权资源访问，利用完整性和保密性服务来防止可用性攻击。访问控制、完整性
和保密性成为协助支待可用性安全服务的机制。
·避免受到攻击：一些基千网络的攻击旨在破坏、降级或摧毁网络资源。解决办法是加强这
些资源的安全防护，使其不受攻击。免受攻击的方法包括：关闭操作系统和网络配置中的
安全漏洞，控制授权实体对资源的访问，以及防止路由表等敏感网络数据的泄露。
·避免未授权使用：当资源被使用、占用和过载时，其可用性就会受到限制。如果未授
权用户占用了有限的资源（如处理能力、网络带宽和调制解调器连接等），则这些资源
对授权用户就是不可用的，通过访问控制可以限制未授权使用。
·防止进程失败：操作失误和设备故障也会导致系统可用性降低。解决方法是使用高可
靠性设备、提供设备冗余和提供多路径的网络连接等。
4. 不可否认性
“否认”是指参与通信的实体拒绝承认它参与了通信，不可否认是保证信息行为人不能
否认其信息行为。不可否认性安全服务提供了向第三方证明该实体确实参与了通信的能力。
·数据的接收者提供数据发送者身份及原始发送时间的证据。
·数据的发送者提供数据已交付接收者（某些情况下还包括接收时间）的证据。
·审计服务提供信息交换中各涉及方的可审计性，这种可审计性记录了可用来跟踪某些
人的相关事件，这些人应对其行为负责。
不可否认性服务主要由应用层提供。通常用户最关心的是应用程序数据（如电子邮件和
文件）的不可否认性。在低层提供不可否认性功能，仅能证明产生过的连接，而无法将流经该
连接的数据同特定的实体相绑定。
s. 可控性
可控性是指对信息的传播及内容具有控制能力，保证信息和信息系统的授权认证与监控
9
计算机网络安全教程第4 版
管理，确保某个实体（人或系统）身份的真实性，也可以确保执法者对社会的执法管理行为。
1.3.3 计算机网络安全的层次
根据网络安全措施作用位置的不同，可以将网络安全划分为4 个层次，分别为物理安
全、逻辑安全、操作系统安全和联网安全。
1. 物理安全
物理安全主要包括防盗、防火、防静电、防雷击、防电磁泄露和物理隔离等方面。关千
物理安全的具体内容将在第2 章中详细介绍。
2. 逻辑安全
计算机系统的逻辑安全主要通过口令密码、权限控制等方法来实现。例如，可以限制连
续登录的次数或限制连续登录的时间间隔；可以用加密软件保护存储在计算机系统中的信息；
通过身份验证技术限制对存储千计算机系统中文件的访问。此外，可以通过一些安全软件跟踪
可疑、未授权的访问企图。
3. 操作系统安全
操作系统是计算机中最基本、最重要的软件，是计算机系统安全的基础。操作系统安全
主要包括用户权限控制、安全漏洞修复等内容。
4. 联网安全
联网安全主要通过以下安全措施来实现。
·访问控制：用来保护计算机和网络资源不被非授权使用。
·通信安全：用来保证数据的保密性和完整性，以及各通信方的可信赖性。
1.3.4 计算机网络安全所涉及的内容
网络安全研究的主要内容包括以下几个方面。
·网络安全体系结构。
·网络攻击手段与防范措施。
·网络安全设计。
·网络安全标准、安全评测及认证。
·网络安全检测技术。
·网络安全设备。
·网络安全管理和安全审计。
·网络犯罪侦查。
·网络安全理论与政策。
·网络安全教育。
·网络安全法律。
概括起来，网络安全包括下列3 个重要部分。
·先进的技术：先进的安全技术是网络安全的根本保障，用户通过风险评估来决定所需
的安全服务种类，选择相应的安全机制，集成先进的安全技术。
·严格的管理：使用网络的机构、企业和单位建立相宜的信息安全管理办法，加强内部
管理，建立审计和跟踪体系，提高整体信息安全意识。
·威严的法律：安全的基石是社会法律、法规与手段，通过建立与信息安全相关的法
10
第1 章绪论
律、法规，使非法分子慑千法律，不敢轻举妄动。
1.4 计算机网络安全体系结构
研究计算机网络安全的体系结构，就是研究如何从管理和技术上保证网络的安全得以完
整、准确的实现，网络安全需求得以全面准确的满足。
1.4.1 网络安全模型
网络安全的基本模型如图1-1 所示。通信双方在网络上传输信息时，首先需要在收、发
方之间建立一条逻辑通道。为此，就要先确定从发送方到接收方的路由，并选择该路由上使用
的通信协议，如TCP/IP 等。
报文一- 秘密信息一=L四二
信息转换
图1-1 网络安全的基本模型
三二吕信息
信息转换
为了在开放式的网络环境中安全地传输信息，需要为信息提供安全机制和安全服务。信
息的安全传输包含两个方面的内容：一是对发送的信息进行安全转换，如进行加密，以实现信
息的保密性，或附加一些特征码，以实现对发送方身份的验证等；二是收、发方共享的某些秘
密信息，如加密密钥等，除了对可信任的第三方外，对其他用户都是保密的。
为了使信息安全地进行传输，通常需要一个可信任的第三方，其作用是负责向通信双方
分发秘密信息，以及在双方发生争执时进行仲裁。
一个安全的网络通信方案必须考虑以下内容。
·实现与安全相关的信息转换的规则或算法。
·用千信息转换的秘密信息（如密钥）。
·秘密信息的分发和共享。
·利用信息转换算法和秘密信息获取安全服务所需的协议。
1.4.2 OSI 安全体系结构
OSI 安全体系结构的研究始于1982 年，当时OSI 基本参考模型刚刚确立。这项工作由
ISO/IECJTCI/SC21 完成，于1988 年结束，其成果标志是ISO 发布了ISO 7498一2 标准，作为
OSI 基本参考模型的新补充。1990 年， ITU 决定采用1S07498一2 作为它的X.800 推荐标准，
我国的国标GB厅9387.2—1995 《信息处理系统开放系统互连基本参考模型第2 部分：安
全体系结构》等同于ISO/IEC7498—2 。
OSI 安全体系结构不是能实现的标准，而是如何设计标准的标准。因此，具体产品不
应声称自己遵从这一标准。OSI 安全体系结构定义了许多术语和概念，还建立了一些重要
11
计算机网络安全教程笫4 版
的结构性准则。它们中有一部分已经过时，仍然有用的部分主要是术语、安全服务和安全
机制的定义。
1. 术语
OSI 安全体系结构给出了标准族中的部分术语的正式定义，其所定义的术语只限千OSI
体系结构，在其他标准中对某些术语采用了更广的定义。
2. 安全服务
OSI 安全体系结构中定义了五大类安全服务，也称为安全防护措施。
·鉴别服务：提供对通信中对等实体和数据来源的鉴别。对等实体鉴别提供对实体本身
的身份进行鉴别；数据源鉴别提供对数据项是否来自某个特定实体进行鉴别。
·访问控制服务：对资源提供保护，以对抗非授权使用和操纵。
·数据机密性服务：保护信息不被泄露或暴露给未授权的实体。机密性服务又分为数据
机密性服务和业务流机密性服务。数据机密性服务包括：连接机密性服务，对某个连
接上传输的所有数据进行加密；无连接机密性服务，对构成一个无连接数据单元的所
有数据进行加密；选择字段机密性服务，仅对某个数据单元中所指定的字段进行加
密。业务流机密性服务使攻击者很难通过网络的业务流来获得敏感信息。
·数据完整性服务：对数据提供保护，以对抗未授权的改变、删除或替代。完整性服务
有3 种类型：连接完整性服务，对连接上传输的所有数据进行完整性保护，确保收到
的数据没有被插入、篡改、重排序或延迟；无连接完整性服务，对无连接数据单元的
数据进行完整性保护；选择字段完整性服务，对数据单元中所指定的字段进行完整性
保护。
完整性服务还分为具有恢复功能和不具有恢复功能两种类型。仅能检测和报告信
息的完整性是否被破坏，而不采取进一步措施的服务为不具有恢复功能的完整性
服务；能检测到信息的完整性是否被破坏，并能将信息正确恢复的服务为具有恢
复功能的完整性服务。
·抗抵赖性服务：防止参与通信的任何一方事后否认本次通信或通信内容。抗抵赖性服
务可分为两种形式：数据原发证明的抗抵赖，使发送者不承认曾经发送过这些数据或
否认其内容的企图不能得逞；交付证明的抗抵赖，使接收者不承认曾收到这些数据或
否认其内容的企图不能得逞。
表1-8 给出了对付典型网络威胁的安全服务，表1-9 给出了网络各层提供的安全服务。
表1-8 对付典型网络威胁的安全服务
安全威胁安全服务
假冒攻击鉴别服务
非授权侵犯访问控制服务
窃听攻击数据机密性服务
完整性破坏数据完整性服务
服务否认抗抵赖服务
拒绝服务鉴别服务、访问控制服务和数据完整性服务等
12
第1 章
绪
论
表1-9 网络各层提供的安全服务
己物理层数据链路层网络层传输层会话层表示层应用层
对等实体鉴别寸寸寸
鉴别
数据原发鉴别寸寸寸
访问控制寸寸寸
连接机密性寸J J 寸寸寸
数据无连接机密性寸寸寸寸寸
机密
性选择字段机密性寸寸
业务机密性寸寸寸
可恢复的连接完整性✓ ✓
不可恢复的连接完整性寸寸✓
数据
完整选择字段的连接完整性寸
性
无连接完整性寸寸寸
选择字段的无连接完整性寸
抗数据原发证明的抗抵赖寸
抵
赖
交付证明的抗抵赖✓
性
3．安全机制
OSI 安全体系结构没有详细说明安全服务应该如何来实现。作为指南，它给出了一系列可
用来实现这些安全服务的安全机制，基本的机制如图1-2 所示，包括加密机制、数字签名机
制、访问控制机制、数据完整性机制、鉴别交换机制、通信业务流填充机制、路由控制和公证
机制（把数据向可信第三方注册，以便使人相信数据的内容、来源、时间和传递过程）。
7654321
鉴别
访问控制
数据完整性
/ ' ,
数据机密性
抗抵赖/
制
全机
安
公证
路由控制
通信业务流填充
鉴别交换
数据字篮性
访问始徊
层
型
路数字签名模
考
加密参层层层层层链层·
OSI 纽耘鳍呤畦”畦
安全服务
图1-2 计算机网络安全体系结构三维图
13
计算机网络安全教程笫4 版
安全服务与安全机制的关系如表I-IO 所示。
表1一10 安全服务与安全机制的关系
云加密数字签名访问控制
数据
完整性
鉴对等实体鉴别寸寸
别数据原发鉴别寸寸
访问控制寸
数
连接机密性✓
据无连接机密性寸
机
密选择字段机密性✓
性
业务机密性✓
可恢复的连接完整性✓ 寸
数不可恢复的连接完整性✓ 寸
据
元` 选择字段的连接完整性✓ 寸
整
性无连接完整性✓ 寸寸
选择字段的无连接完整性✓ 寸寸
抗数据原发证明的抗抵赖✓ 寸寸
抵
赖交付证明的抗抵赖✓ 寸✓
性
1.4.3P2DR 模型
P2DR 模型是一种常用的网络安全模型，如图1-3 所示。
P2DR 模型包含4 个主要部分： Policy （安全策略）、Protection
（防护）、Detection （检测）和Response （响应）。防护、检测
和响应组成了一个完整的、动态的安全循环。在整体安全策略
的控制和指导下，在综合运用防护工具（如防火墙、身份认证
和加密等手段）的同时，利用检测工具（如网络安全评估、入
侵检测等系统）掌握系统的安全状态，然后通过适当的响应将
网络系统调整到“最安全”或“风险最低＂的状态。该模型认
为：安全技术措施是围绕安全策略的具体需求而有序地组织在
一起构成一个动态的安全防范体系。
鉴别交换
通信业务
公证
流填充
寸
寸
寸
寸寸
寸
寸
• Protection: 防护通常是通过采用一些传统的静态安图1一3 P2DR 模型示意图
全技术及方法来实现的，主要有防火墙、加密和认
证等方法。
• Detection: 在P2DR 模型，检测是非常重要的一个环节，检测是动态响应和加强防护
的依据，也是强制落实安全策略的有力工具，通过不断地检测和监控网络和系统，来
发现新的威胁和弱点，通过循环反馈来及时做出有效的响应。
• Response: 响应在安全系统中占有最重要的地位，是解决潜在安全问题的最有效办
14
第1 章绪论
法。从某种意义上讲，安全问题就是要解决响应和异常处理问题。要解决好响应问
题，就要制定好响应的方案，做好响应方案中的一切准备工作。
• Policy: 安全策略是整个网络安全的依据。不同的网络需要不同的策略，在制定策略以
前，需要全面考虑局域网中如何在网络层实现安全性，如何控制远程用户访问的安全
性，在广域网上的数据传输实现安全加密传输和用户的认证等问题。对这些问题做出
详细回答，并确定相应的防护手段和实施办法，就是针对网络系统的一份完整的安全
策略。策略一旦制定，就应当作为整个网络系统安全行为的准则。
P2DR 模型有一套完整的理论体系，以数学模型作为其论述基础一—基于时间的安全理论
(Time Based Security ）。该理论的基本思想是认为与信息安全有关的所有活动，包括攻击行
为、防护行为、检测行为和响应行为等都要消耗时间，可以用时间来衡量一个体系的安全性和
安全能力。
作为一个防护体系，当入侵者要发起攻击时，每一步都需要花费时间。攻击成功花费的
时间就是安全体系提供的防护时间Pt。在入侵发生的同时，检测系统也在发挥作用，检测到
入侵行为所要花费的时间就是检测时间Dt; 在检测到入侵后，系统会做出应有的响应动作，
该过程所要花费的时间就是响应时间Rt。
P2DR 模型通过一些典型的数学公式来表达安全的要求。
Pt>D廿Rt (1-1)
Pt：系统为了保护安全目标设置各种保护后的防护时间；或者理解为在这样的保护方式
下，黑客（入侵者）攻击安全目标所花费的时间。
Dt: 从入侵者开始发动入侵开始，系统能够检测到入侵行为所花费的时间。
Rt ：从发现入侵行为开始，系统能够做出足够的响应，将系统调整到正常状态的
时间。
那么，针对需要保护的安全目标，如果上述数学公式满足，即防护时间大千检测时间加
上响应时间，则在入侵者危害安全目标之前就能够检测到并及时处理。
Et=D廿Rt Cl-2)
如果Pt=O，公式的前提是假设防护时间为0。这种假设对Web Server 这样的系统可以
成立。
Dt：从入侵者破坏了安全目标系统开始，系统能够检测到破坏行为所花费的时间。
Rt: 从发现遭到破坏开始，系统能够做出足够的响应，将系统调整到正常状态的时间。
比如，对Web Server 被破坏的页面进行恢复。
那么， Dt 与Rt 的和就是该安全目标系统的暴露时间Et。针对需要保护的安全目标， Et
越小，系统就越安全。
通过上面两个公式的描述，实际上对安全给出了一个全新的定义：“及时的检测和响应就
是安全”和“及时的检测和恢复就是安全',0
而且，这样的定义为安全问题的解决给出了明确的方向：提高系统的防护时间Pt, 降低
检测时间Dt 和响应时间Rt。
P2DR 理论给人们提出了新的安全概念，安全不能依靠单纯的静态防护，也不能依靠单纯
的技术手段来解决。网络安全理论和技术还将随着网络技术与应用技术的发展而发展。未来的
网络安全具有以下趋势。
一方面，高度灵活和自动化的网络安全管理辅助工具将成为企业信息安全主管的首选，
15
计算机网络安全教程笫4 版
它能帮助管理相当庞大的网络，通过对安全数据进行自动的多维分析和汇总，使人从海量的安
全数据中解脱出来，根据它提交的决策报告进行安全策略的制定和安全决策。
另一方面，由于网络安全问题的复杂性，网络安全管理将与较成熟的网络管理集成，在
统一的平台上实现网络管理和安全管理。
另外，检测技术将更加细化，针对各种新的应用程序的漏洞评估和入侵监控技术将会产
生，还将有攻击追踪技术应用到网络安全管理的环节当中。
P2DR 安全模型也存在一个明显的弱点，就是忽略了内在的变化因素，如人员的流动、人
员素质的差异和安全策略贯彻执行的不完全等。实际上，安全问题牵涉的面非常广，不仅包括
防护、检测和响应，还包括系统本身安全能力的增强、系统结构的优化和人员素质的提升等，
而这些方面都是P2DR 安全模型没有考虑到的。
1.4.4 网络安全技术
本节将分析网络安全的典型技术。
1. 物理安全技术
物理安全是保护计算机网络设备、设施，以及其他媒体免遭地震、水灾、火灾等环境因
素，人为操作失误，以及各种计算机犯罪行为导致的破坏过程。它主要包括3 个方面。
·环境安全：对系统所在环境的安全保护措施，如区域保护和灾难保护。
·设备安全：设备的防盗、防毁、防电磁信息辐射泄露、防止线路截获、抗电磁干扰及
电源保护技术和措施等。
·媒体安全：媒体数据的安全，以及媒体本身的安全技术和措施。
为保证计算机网络的物理安全，除了网络规划和场地、环境等要求之外，还要防止信息
在空间的扩散。因为，计算机网络辐射的电磁信号可在几百甚至上千米以外截获，重要的政
府、军队和金融机构在建信息中心时都要考虑电磁信息泄露。
2. 数据传输安全技术
为保障数据传输的安全，通常采用数据传输加密技术、数据完整性鉴别技术及防抵赖技
术。数据传输加密技术就是对传输中的数据流进行加密，以防止通信线路上的窃听、泄露、篡
改和破坏。如果以加密实现的通信层次来区分，加密可以在通信的3 个不同层次来实现，即链
路加密（位千OSI 网络层以下的加密）、结点加密和端到端加密（传输前对文件加密，位于
OSI 网络层以上的加密）。一般常用的是链路加密和端到端加密这两种方式。链路加密侧重于
在通信链路上而不考虑信源和信宿，对保密信息通过各链路采用不同的加密密钥提供安全保
护。链路加密是面向结点的，对于网络高层主体是透明的，对高层的协议信息（地址、检错、
帧头帧尾）都加密，数据在传输中是密文，但在中央结点必须解密得到路由信息。端到端加密
是指信息由发送端进行加密，打入TCP/IP 数据包封装，然后作为不可阅读和不可识别的数据
穿过网络，这些信息一旦到达目的地后，将自动重组、解密，成为可读数据。端到端加密是面
向网络高层主体，不对下层协议进行信息加密，协议信息以明文形式传输，用户数据在交换结
点无须解密。
防抵赖技术包括对数据源和目的地双方的证明，常用的方法是数字签名，数字签名采用
一定的数据交换协议，使得通信双方能够满足两个条件：接收方能够鉴别发送方所宣称的身
份；发送方不能否认发送过数据的事实。比如，通信的双方采用公钥体制，发送方使用接收方
的公钥和自己的私钥加密信息，只有接收方凭借自己的私钥和发送方的公钥解密之后才能读
16
笫1 章绪论
懂，而对于接收方的回执也是同样道理。
3. 内外网隔离技术
采用防火墙技术可以将内部网络与外部网络进行隔离，对内部网络进行保护。并且，还
可以防止影响一个网段的问题在整个网络传播。防火墙技术是实现内外网的隔离与访问控制，
保护内部网安全的最主要、最有效、最经济的措施。
4. 入侵检测技术
利用防火墙技术， 通常能够在内外网之间提供安全的网络保护，降低网络的安全风险。
但是，仅利用防火墙，网络安全还远远不够，例如，入侵者会寻找防火墙背后可能敞开的后
门、入侵者可能就在防火墙内等。
入侵检测的目的就是提供实时的检测及采取相应的防护手段，以便对进出各级局域网的
常见操作进行实时检查、监控、报警和阻断，从而防止针对网络的攻击与犯罪行为，阻止黑客
的入侵。
5. 访问控制技术
访问控制是维护计算机网络系统安全、保护计算机资源的重要手段，是保证网络安全最重要
的核心策略之一。访问控制就是给用户和用户组赋予一定的权限，控制用户和用户组对目录、子
目录、文件与其他资源的访问，以及指定用户对这些文件、目录及设备能够执行的操作。受托者
指派和继承权限屏蔽是实现访问控制的两种方式。受托者指派控制用户和用户组如何使用网络服
务器的目录、文件与设备；继承权限屏蔽相当千一个过滤器，可以限制子目录从父目录那里继承
哪些权限。根据访问权限将用户分为以下几类：＠特殊用户，即系统管理员； ＠一般用户，系统
管理员根据用户的实际需要为他们分配操作权限； ＠审计用户，负责网络的安全控制与资源使用
情况的审计。用户对网络资源的访问权限可以用访问控制表来描述。
6. 审计技术
审计技术是记录用户使用计算机网络系统进行所有活动的过程，记录系统产生的各类事
件。审计技术是提高安全性的重要方法，它不仅能够识别谁访问了系统，还能指出系统正被怎
样使用。对系统事件进行记录，能够更迅速和系统地识别系统出现的问题，为事故处理提供重
要依据。另外，通过对安全事件的不断收集与积累，并且加以分析，以及有选择地对其中的某
些用户进行审计跟踪，可以发现并为证明其破坏性行为提供有力的证据。
7. 安全性检测技术
网络系统的安全性取决千网络系统中最薄弱的环节。如何及时发现网络系统中最薄弱的
环节？如何最大限度地保证网络系统的安全？最有效的方法是定期对网络系统进行安全分析，
及时发现并修正存在的弱点和漏洞。
网络安全检测（漏洞检测）是对网络的安全性进行评估分析，通过实践性的方法扫描分
析网络系统，检查系统存在的弱点和漏洞，提出补救措施和安全策略的建议，达到增强网络安
全性的目的。
8. 防病毒技术
在网络环境下，计算机病毒有不可估量的威胁和破坏力， 计算机病毒的防范是网络安全
建设中重要的一环。网络反病毒技术包括预防病毒、检测病毒和消除病毒3 种。
9. 备份技术
采用备份技术可以尽可能快地全面恢复运行计算机网络所需的数据和系统信息。根据系统安
全需求可选择的备份机制有：场地内高速度、大容量自动的数据存储、备份与恢复；场地外的数
17
计算机网络安全教程第4 版
据存储、备份与恢复。备份不仅能在网络系统硬件故障或人为失误时起到保护作用，而且，在入
侵者非授权访问，数据完整性面临破坏时起到保护作用，同时是系统灾难恢复的前提之一。
10. 终端安全技术
终端安全技术主要解决终端的安全保护问题，一般的安全功能有：基于口令或（和）密
码算法的身份验证，防止非法使用终端；自主和强制存取控制，防止非法访问文件；多级权限
管理，防止越权操作；存储设备安全管理，防止非法U 盘复制和硬盘启动；数据和程序代码
加密存储，防止信息被窃；预防病毒，防止病毒侵袭；严格的审计跟踪，便千追查责任事故。
苹果发布了iOS 系统安全技术指南，提供一个针对病毒、恶意软件，．以及其他一些漏洞的安
全防护。Android 保留和继承了Linux 操作系统的安全机制，而且其系统架构的各个层次都有
独特的安全特性。
1.5 计算机网络安全管理
面对网络安全的脆弱性，除了采用各种网络安全技术和完善系统的安全保密措施外，还
必须加强网络的安全管理，诸多的不安全因素恰恰存在千组织管理方面。据权威机构统计表
明：信息安全大约60％以上的问题是由管理造成的，也就是说，解决信息安全问题不应仅从
技术方面着手， 同时更应加强信息安全的管理工作。
1.5.1 网络安全管理的法律法规
网络（信息）安全标准是信息安全保障体系的重要组成部分，是政府进行宏观管理的
重要依据。信息安全标准不仅关系到国家安全，同时也是保护国家利益的一种重要手段，
并且，有利于保证网络安全产品的可信性、实现产品的互联和互操作性，以支持计算机网
络系统的互联、更新和可扩展性，支持系统安全的测评与评估，保障计算机网络系统的安
全可靠。
英国标准协会(BSI) 千1995 年制定了信息安全管理体系标准——BS 7799。目前，我国
有章可循的国际国内信息安全标准有100 多个，如《信息处理64bit 分组密码算法的工作方
式》《计算站场地技术条件》和《计算机机房用活动地板技术条件》等。
1.5.2 计算机网络安全评价标准
计算机网络安全评价标准是一种技术性法规。在信息安全这一特殊领域，如果没有这一
标准，与此相关的立法和执法就会有失偏颇，最终会给国家的信息安全带来严重后果。由于信
息安全产品和系统的安全评价事关国家的安全利益，因此，许多国家都在充分借鉴国际标准的
前提下，积极制定本国的计算机安全评价认证标准。
1.6 计算机网络安全技术发展趋势
随着网络的普及，以及越来越多的人掌握了网络知识，网上攻击事件也越来越多，网络
受到的安全威胁也越发严重，网络用户为了保护自己的信息安全开始关注各类网络防护措施。
据调查，企业局域网用户最关心网络安全的占了66%。
18
笫1 章绪论
1.6.1 网络安全威胁发展趋势
美国基础设施保护中心(NIPC) 做了一个统计，近几年，平均每个月出现IO 个以上新的
攻击手段。CNNS 特地组织安全专家对近3 年的信息安全威胁，尤其是对最近出现的新攻击手
段进行分析，发现基千各种攻击机制的各种现成攻击工具越来越智能化，也越来越傻瓜化。虽
然大多数的攻击手法都非常相似，无非是蠕虫、后门、rootkits、DoS 和sniffer 等，但这些手
段都体现了惊人的威力。与以前出现的相比，攻击手段的新变种更加智能化，攻击目标直指互联
网基础协议和操作系统层次。同时，黑客工具应用起来也越来越简单，很多新手也能轻易使用。
病毒技术与黑客技术的结合对信息安全造成更大的威胁。近年来，流行的计算机病毒无
一例外地与网络结合，并具有多种传播方法和攻击手段，一经爆发即在网络上快速传播，难以
遏制，加之与黑客技术的融合，潜在的威胁和损失更巨大。从发展趋势来看，现在的病毒已经
由从前的单一传播、单种行为，变成依赖互联网传播，集电子邮件、文件传染等多种传播方
式，融黑客、木马等多种攻击手段千一身的广义的“新病毒”。今后恶意代码、网络安全威胁
和攻击机制的发展将具有以下特点。
l) 与Internet 更加紧密地结合，利用一切可以利用的方式（如邮件、局域网、远程管理
和即时通信工具等）进行传播。
2) 所有的病毒都具有混合型特征，集文件传染、蠕虫、木马和黑客程序的特点千一身，
破坏性大大增强。
3) 扩散极快，且更加注重欺骗性。
4) 利用系统漏洞将成为病毒有力的传播方式。
5) 无线网络技术的发展使远程网络攻击的可能性加大。
6) 各种境外情报和谍报人员将越来越多地通过信息网络渠道收集情报和窃取资料。
7) 各种病毒、蠕虫和后门技术越来越智能化，并出现整合趋势，形成混合性威胁。
8) 各种攻击技术的隐秘性增强，常规防范手段难以识别。
9) 分布式计算技术用于攻击的趋势增强，威胁高强度密码的安全性。
10) 一些政府部门的超级计算机资源将成为攻击者利用的跳板。
11) 网络管理安全问题日益突出。
1.6.2 网络安全主要实用技术的发展
网络安全技术的发展是多维的、全方位的，主要有以下几种。
1. 物理隔离
物理隔离的思想是不安全就不联网，要绝对保证安全。在物理隔离的条件下，如果需要
进行数据交换，就如同两台完全不相连的计算机，必须通过移动硬盘、U 盘等媒介，从一台计
算机向另一台计算机复制数据，这也被形象地称为“数据摆渡＇，。由于两台计算机没有直接连
接，就不会有基千网络的攻击威胁。
2. 逻辑隔离
在技术上，实现逻辑隔离的方式多种多样，但主要还是采用防火墙。防火墙在体系结构
上有不同的类型：双网口、多网口、DMZ 和SSN。不同类型的防火墙在OSI 的7 层模型上的
工作机理有明显的不同。防火墙的发展主要是提高性能、安全性和功能。实际上，这三者是相互
矛盾、相互制约的。功能多、安全性好的技术往往性能受影响；功能多也影响到系统的安全。
19
计算机网络安全教程笫4 版
3. 防御来自网络的攻击
主要是抗击DoS 等拒绝服务攻击，其技术是识别正常服务的包，将攻击包分离出来。目
前DDoS （分布式DoS) 的攻击能力可达到10 万以上的并发攻击，因此，抗攻击网关的防御
能力必须达到抗击10 万以上的并发的分布式DoS 攻击。
4. 防御网络上的病毒
传统的病毒检测和杀病毒是在客户端完成的。但是这种方式存在致命的缺点，如果某台计
算机发现病毒，说明病毒已经感染了单位内部几乎所有的计算机。在单位内部的计算机网络和互
联网的连接处放置防病毒网关，一旦出现新病毒，更新防病毒网关就可清除每个终端的病毒。
5. 身份认证
一般认为，鉴别、授权和管理(AAA) 系统是一个非常庞大的安全体系，主要用千大的
网络运营商。实际上单位内部网同样需要一套强大的AAA 系统。根据IDC 的报告，单位内部
的AAA 系统是目前网络安全应用增长最快的部分。
6．加密通信和虚拟专用网
移动办公、单位和合作伙伴之间、分支机构之间通过公用的互联网通信是必不可少的。
加密通信和虚拟专用网(VPN) 有很大的需求。IPSec 已成为主流和标准， VPN 的另外一个方
向是向轻量级方向发展。
7. 入侵检测和主动防卫(IDS)
互联网的发展已经暴露出易被攻击的弱点。针对黑客的攻击，有必要采用入侵检测和主
动防卫(IDS) ，实时交互监测和主动防卫的手段。
8. 网管、审计和取证
网络安全越完善，体系架构就越复杂，最好的方式是采用集中网管技术。审计和取证功
能变得越来越重要。审计功能不仅可以检查安全问题，而且还可以对数据进行系统的挖掘，从
而了解内部人员使用网络的情况，了解用户的兴趣和需求等。
9. 网络行为安全监管技术
网络行为监控是网络安全的重要方面，研究的范围包括网络事件分析、网络流量分析、
网络内容分析，以及相应的响应策略与响应方式。
10. 容灾与应急响应技术
容灾与应急响应是一个非常复杂的网络安全技术领域，涉及众多网络安全关键技术，需
要多个技术产品的支持。主要技术包含应急响应体系的整体架构、应急响应体系的标准制定和
应急响应的工具开发。
u ．可信计算技术
通过增强现有的PC 终端体系结构的安全性来保证整个计算机网络的安全，在计算机网络
中搭建一个诚信体系，每个终端都具有合法的网络身份，并能够被认可；而且终端对恶意代
码，如病毒、木马等有免疫能力。在这样的可信计算环境中，任何终端出现问题，都能保证合
理取证，方便监控和管理。
1.7 小结
随着计算机网络广泛应用千经济、军事和教育等各领域，计算机网络安全成为涉及个
人、单位、社会和国家信息安全的重大问题。计算机网络实体和软件系统面临的不安全因素
20
第1 章绪论
有：偶然发生的故障、自然灾害，以及人为破坏。人为对计算机网络的破坏可分为被动攻击、
主动攻击、邻近攻击、内部人员攻击和分发攻击5 种形式。
造成计算机网络不安全的主要原因首先来自互联网本身，由于互联网的开放性、国际性
和自由性，使其不可避免地会受到黑客的攻击。操作系统和数据库存在的安全缺陷是造成网络
系统安全受到威胁的最重要原因。另外，传输线路的安全，以及网络的安全管理不当都直接影
响着网络的安全性。
计算机网络安全要达到的目标就是确保信息系统的保密性、完整性、可用性、不可否认
性和可控性。要确保计算机网络的安全，就必须依靠先进的技术、严格的管理和配套的法律。
OSI 安全体系结构中定义了鉴别、访问控制、数据机密性、数据完整性和抗抵赖5 种网络安全
服务，以及加密机制、数字签名机制、访问控制机制、数据完整性机制、鉴别交换机制、通信
业务流填充机制、路由控制和公证机制8 种基本的安全机制。
1.8 习题
l ．计算机网络面临的典型安全威胁有哪些？
2. 分析计算机网络的脆弱性和安全缺陷。
3. 分析计算机网络的安全需求。
4. 计算机网络安全的内涵和外延分别是什么？
5. 论述OSI 安全体系结构。
6. 简述P2DR 安全模型的结构。
7. 简述计算机网络安全技术及其应用。
8. 简述网络安全管理的意义和主要内容。
21
第2 章
物理安全
物理安全是整个计算机网络系统安全的前提。物理安全是保护计算机网络设备、设施及
其他媒体免遭地震、水灾、火灾等环境事故，人为操作失误或各种计算机犯罪行为导致的破坏
过程。物理安全主要考虑的问题是环境、场地和设备的安全，以及物理访问控制和应急处置计
划等。物理安全技术主要是指对计算机及网络系统的环境、场地、设备和人员等采取的安全技
术措施。物理安全在整个计算机网络信息系统安全中占有重要地位。它主要包括以下几个
方面。
·机房环境安全：计算机网络系统机房环境的安全特点是：可控性强，损失也大。对计
算机网络系统所在环境的安全保护，如区域保护和灾难保护的相关标准，可参见有关
国家标准。机房环境安全主要包括机房防火与防盗、防雷与接地、防尘与防静电、防
地震等自然灾害等。
·通信线路安全：通信线路安全主要包含通信线路的防窃听技术。
·设备安全：设备安全主要包括防电磁信息辐射泄露、防止线路截获、抗电磁干扰及电
源保护等。硬盘损坏、设备使用寿命到期等的物理损坏，停电、电磁干扰和意外事故
等引起的设备故障，也是保障设备安全的重要内容。
·电源安全：电源是机房内所有电子设备正常工作的能量源泉，在机房安全中占有重要
地位。电源安全主要包括电力能源供应、输电线路安全和保持电源的稳定性等。
对千任何计算机网络系统，物理安全都是必须考虑的重要问题，物理安全措施包括安全制
度、数据备份、辐射防护、屏幕口令保护、隐藏销毁、状态检测、报警确认、应急恢复、加强
机房管理、运行管理、安全组织和人事管理等手段。物理安全是相对的，在设计物理安全方案
时，要综合考虑需要保护的硬件、软件及其信息价值，从而采用适当的物理保护措施。
2.1 机房安全
机房安全技术涵盖的范围非常广泛，机房从里到外，从设备设施到管理制度都属千机房
安全技术研究的范围。从这个意义上讲，下面几节的内容都是机房安全技术在某些方面的具体
实现。
计算机机房的安全保卫技术是机房安全技术的重要一环，主要的安全技术措施包括防盗
报警、实时监控和安全门禁等。计算机机房的温度、湿度等环境条件保持技术可以通过加装通
风设备、排烟设备和专业空调设备来实现。计算机机房的用电安全技术也是机房安全技术的重
要环节，主要包括不同用途电源分离技术、电源和设备有效接地技术、电源过载保护技术，以
及防雷击技术等。计算机机房安全管理技术是指制定严格的计算机机房工作管理制度，并要求
所有进入机房的人员严格遵守管理制度，将制度落到实处。
机房的安全等级分为A 类、B 类和C 类3 个基本类别。
•A 类：对计算机机房的安全有严格的要求，有完善的计算机机房安全措施。
22
第2 章物理安全
•B 类：对计算机机房的安全有较严格的要求，有较完善的计算机机房安全措施。
•c 类对计算机机房的安全有基本的要求，有基本的计算机机房安全措施。
计算机机房的安全要求的详细情况如表2-1 所示。
表2-1 计算机机房安全要求
安全类别
A 类机房B 类机房C 类机房
安全项目
场地选择
防火
内部装修+
供配电系统+
空调系统+
火灾报警和消防设施+
防水+
防静电+
防雷击+
防鼠害+
防电磁泄露
表中符号说明：十表示要求，一表示有要求或增加要求。
1. 机房的安全要求
如何减少无关人员进入机房的机会是计算机机房设计时首先要考虑的问题。为此，计算
机机房在选址时应避免靠近公共区域，避免窗户直接临街，此外，在机房布局上应使工作区在
内，生活辅助区域在外。在一个大的建筑内，计算机机房最好不要安排在底层或顶层，这是因
为底层一般较潮湿， 而顶层有漏雨、穿窗而入的危险。在较大的楼层内，计算机机房应靠近楼
层的一边安排布局。这样既便于安全警卫，又利千发生火灾险情时及时转移撤离。
应当保证所有进出计算机机房的人都必须在管理人员的监控之下。外来人员一般不允许
进入机房内部，有特殊需要进入机房内部的，应办理相关手续，并对来访者的随身物品进行相
应的检查。
计算机机房所在建筑物的结构从安全的角度还应该考虑以下几个问题。
l) 电梯和楼梯不能直接进入机房。
2) 建筑物周围应有足够亮度的照明设施和防止非法进入的设施。
3) 外部容易接近的进出口，如风道口、排风口、窗户和应急门等应有栅栏或监控措施，
而周边应有物理屏障（如隔墙、带刺铁丝网等）和监视报警系统，窗口应采取防范措施，必要
时安装自动报警设备。
4) 机房进出口必须设置应急电话。
5) 机房供电系统应将动力照明用电与计算机系统供电线路分开，机房及疏散通道要安装
应急照明装置。
6) 机房建筑物方圆100m 内不能有危险建筑物。危险建筑物主要指易燃、易爆或有害气
体等的存放场所，如加油站、煤气站、天然气煤气管道和散发强烈腐蚀气体的设施、工厂等。
23
计算机网络安全教程第4 版
7) 机房内应设置更衣室和换鞋处，机房的门窗要具有良好的封闭性能。
8) 机房内的照明应达到规定标准。
2. 机房的防盗要求
众所周知，计算机网络系统的大部分设备都是放置在计算机机房中的，重要的应用软件
和业务数据也都是存放在服务器计算机系统的磁盘或光盘上的。此外，机房内的某些设备可
能是用来进行机密信息处理的，这类设备本身及其内部存储的信息都非常重要，一旦丢失或
被盗，将产生极其严重的后果。因此，对重要的设备和存储媒体（磁盘等）应采取严格的防
盗措施。
早期主要采取增加质量和胶粘的防盗措施，即将重要的计算机网络设备永久地固定或粘
接在某个位置上。虽然该方法增强了设备的防盗能力，但给设备的移动或调整位置带来了不
便。随后，又出现了将设备与固定底盘用锁连接的防盗方法，只有将锁打开才可移动设备。现
在某些笔记本计算机还在采用机壳加锁扣的防盗方法。
一种更方便的防护措施类似千图书馆和超市使用的防盗系统。首先在需要保护的重要设
备、存储媒体和硬件上贴上特殊标签（如磁性标签），当非法携带这些重要设备或物品外出
时，检测器就会发出报警信号。
视频监视系统是一种更为可靠的防盗设备，能实时地对计算机网络系统的外围环境和操
作环境进行全程监控。对重要的机房，还应采取特别的防盗措施，如值班守卫、出入口安装金
属探测装置等。
3. 机房的三度要求
温度、湿度和洁净度并称为三度，为保证计算机网络系统的正常运行，对机房内的三度
都有明确的要求。为使机房内的三度达到规定的要求，空调系统、去湿机和除尘器是必不可少
的设备。重要的计算机系统安放处还应配备专用的空调系统，它比公用的空调系统在加湿、除
尘等方面有更高的要求。
1) 温度。计算机系统内有许多元器件，不仅发热量大而且对环境温度敏感。温度过低会
导致硬盘无法启动，温度过高会使元器件性能发生变化，耐压性降低，导致工作不正常。总
之，环境温度过高或过低都容易引起硬件损坏。统计数据表明：温度超过规定范围时，每升高
10·c ，机器可靠性下降25%。机房温度一般应控制在18,...,22°C 。
2) 湿度。湿度也是影响计算机网络系统正常运转的重要因素，机房内相对湿度过高会加
速金属器件的腐蚀，引起电气部分绝缘性能下降，耐潮性能不良，同时湿度过大还会使灰尘的
导电性能增强，电子器件失效的可能性也随之增大；而相对湿度过低则会导致计算机网络设备
中的某些器件龟裂，印制电路板变形，特别是静电感应增加会使计算机内存储的信息丢失或异
常，严重时还会导致芯片损坏，严重危害计算机系统。机房内的相对湿度一般控制在40%～
60％为宜。湿度控制与温度控制最好都与空调联系在一起，由空调系统集中控制。机房内应安
装温、湿度显示仪，随时观察和监测。
3) 洁净度。洁净度要求机房尘埃颗粒直径小千0.5μm, 平均每升空气含尘量小千1 万
颗。灰尘会造成接插件的接触不良、发热元件的散热效率降低、电气元件的绝缘性能下降；灰
尘还会增加机械磨损，尤其对驱动器和盘片，灰尘不仅会使磁盘数据的读写出现错误，而且可
能划伤盘片，甚至导致磁头损坏。因此，计算机机房必须有除尘、防尘的设备和措施，保持清·
洁卫生，以保证设备的正常工作。
24
笫2 章物理安全
4. 防静电措施
不同物体间的相互摩擦或接触会产生静电。如果静电不能及时释放而保留在物体内，就
会产生能量不大但非常高的电位，而且静电在放电时还可能发生火花，容易造成火灾或损坏芯
片等意外事故。计算机系统的CPU 、ROM 和RAM 等关键部件大都是采用MOS 工艺的大规
模集成电路，对静电极为敏感，容易因静电而损坏。
静电对电子设备的损害具有如下特点。
·隐蔽性：人体不能直接感知静电，除非发生静电放电，但是发生静电放电人体也不一
定能有电击的感觉，这是因为人体感知的静电放电电压为2~3kV，所以静电具有隐
蔽性。
·潜在性：有些电子元器件受到静电损伤后的性能没有明显的下降，但多次累加放电会
给器件造成内伤而形成隐患。因此静电对器件的损伤具有潜在性。
·随机性：从一个电子元件生产出来以后，一直到它损坏以前，时刻都受到静电的威
胁，而这些静电的产生也具有随机性，其损坏过程也具有随机性。
·复杂性：静电放电损伤的失效分析工作，因电子产品的精、细、微小的结构特点而费
时、费事、费钱，要求较高的技术并往往需要使用扫描电镜等高精密仪器。即使如
此，有些静电损伤现象也难以与其他原因造成的损伤加以区别，使人误把静电损伤失
效当作其他失效。这在对静电放电损害未充分认识之前，常常归因千早期失效或情况
不明的失效，从而不自觉地掩盖了失效的真正原因。所以静电对电子器件损伤的分析
具有复杂性。
机房的内装修材料一般应避免使用挂毯、地毯等吸尘、容易产生静电的材料，而应采用
乙烯材料。为了防静电，机房一般要安装防静电地板，并将地板和设备接地以便将设备内积聚
的静电迅速释放到大地。机房内的专用工作台或重要的操作台应有接地平板。此外，工作人员
的服装和鞋最好用低阻值的材料制作，机房内应保持一定的湿度，特别是在干燥季节应适当增
加空气湿度，以免因干燥而产生静电。
5. 接地与防雷要求
接地与防雷是保护计算机网络系统和工作场所安全的重要安全措施。接地是指整个计算
机网络系统中各处电位均以大地电位为零参考电位。接地可以为计算机系统的数字电路提供一
个稳定的ov 参考电位，从而可以保证设备和人身的安全，同时也是防止电磁信息泄露的有效
手段。
(1) 地线种类
1) 保护地。计算机系统内的所有电气设备，包括辅助设备，外壳均应接地。如果电子设
备的电源线绝缘层损坏而漏电时，设备的外壳可能带电，将造成人身和设备事故。因而必须将
外壳接地，以使外壳上积聚的电荷迅速释放到大地。
要求良好接地的设备有：各种计算机外围设备、多相位变压器的中性线、电缆外套管、
电子报警系统、隔离变压器、电源和信号滤波器，以及通信设备等。
配电室的变压器中点要求接大地。但从配电室到计算机机房如果有较长的输电距离，则
应在计算机机房附近将中性线重复接地，这是因为零线上过高的电势会影响设备的正常工作。
保护地一般是为大电流泄放而接地。我国规定，机房内保护地的接地电阻<"}。保护地在插
头上有专门的一条芯线，由电缆线连接到设备外壳，插座上对应的芯线（地）引出与大地相连。
保护地线应连接可靠，一般不用焊接，而采用机械压紧连接。地线导线应足够粗，至少
25
计算机网络安全教程第4 版
应为4 号AWG 铜线，或为金属带线。
2) 直流地。直流地又称逻辑地，是计算机系统的逻辑参考地，即计算机中数字电路的低
电位参考地。数字电路只有1 和0 两种状态，其电位差一般为3~5V。随着超大规模集成电路
技术的发展，电位差越来越小，对逻辑地的接地要求也越来越高。因为逻辑地(0) 的电位变
化直接影响到数据的准确性。直流地的接地电阻一般要求:::::;2.a。
3) 屏蔽地。为避免计算机网络系统各种设备间的电磁干扰、防止电磁信息泄露，重要的
设备和机房都要采取适当的屏蔽措施，即用金属体来屏蔽设备或整个机房。金属体称为屏蔽机
柜或屏蔽室。屏蔽体需与大地相连，形成电气通路，为屏蔽体上的电荷提供一条低阻抗的泄放
通路。屏蔽效果的好坏与屏蔽体的接地密切相关，一般屏蔽地的接地电阻要求:::::;4.a 。
4) 静电地。机房内人体本身、人体在机房内的运动，以及设备的运行等均可能产生静
电。人体静电有时可达上于伏，人体与设备或元器件导电部分直接接触极易造成设备损坏。而
设备运行中产生的静电干扰则会引起设备的运行故障。为消除静电可能带来的不良影响，除采
取如测试人体静电、接触设备前先触摸地线、泄放电荷、保持室内一定的温度和湿度等管理方
面的措施外，还应采取防静电地板等措施，即将地板金属基体与地线相连，以使设备运行中产
生的静电随时释放掉。
5) 雷击地。雷电具有很大的能量，雷击产生的瞬时电压可高达lOMV 以上。单独建
设的机房或机房所在的建筑物必须设置专门的雷击保护地（简称雷击地），以防止雷击产
生的巨大能量和高压对设备和人身带来的危害。应将具有良好导电性能和一定机械强度的
避雷针安置在建筑物的最高处，引下导线接到地网或地桩上， 形成一条最短、最牢固的对
地通路，即雷击地线。防雷击地线地网和接地桩应与其他地线系统保持一定的距离，至少
应在10m 以上。
(2) 接地系统
计算机机房的接地系统是指计算机系统本身和场地的各种地线系统的设计和具体实施。
1) 各自独立的接地系统。这种接地系统主要考虑直流地、交流地、保护地、屏蔽地和雷
击地等的各自作用，为避免相互干扰，分别单独通过地网或接地桩接到大地。这种方案虽然理
论上可行，但实施起来难度很大。
2) 交、直流分开的接地系统。这种接地系统将计算机的逻辑地和雷击地单独接地，其他
地共地。这既可使计算机工作可靠，又可减少一些地线。但这样仍需3 个单独的接地体，无论
从接地体的埋设场地考虑，还是从投资和施工难度考虑，都是很难承受的。
3) 共地接地系统。共地接地系统的出发点是除雷击地外，另建一个接地体，此接地体的
地阻要小，以保证泄放电荷迅速排放到大地。而计算机系统的直流地、保护地和屏蔽地等在机
房内单独接到各自的接地母线，自成系统，再分别接到室外的接地体上。
这种接地系统的优点是减少了接地体的建设，各地之间独立，不会产生相互干扰。缺点
是直流地（逻辑地）与其他地线共用，易受其他信号干扰影响。
4) 直流地、保护地共用地线系统。这种接地系统的直流地和保护地共用接地体，屏蔽
地、交流地和雷击地单独埋没。该接地方案的出发点是许多计算机系统内部已将直流地和保护
地连在一起，对外只有一条引线，在此情况下，直流地与保护地分开已无实际意义。由千直流
地与交流地分开，使计算机系统仍具有较好的抗干扰能力。,
5) 建筑物内共地系统。随着城市高层建筑群的不断增多，建筑物内各种设备、供电系统
和通信系统的接地问题越来越突出。一方面，建筑高层化、密集化，接地设备多、要求高；另
26
第2 章物理安全
一方面，高层建筑附近又不可能有足够的场地构造地线接地体．高层建筑目前基础施工都
是光打桩，整栋建筑从下到上都有钢筋基础。由于这些钢筋很多，且连成一体，深入到地
下漏水层，同时各楼层钢筋均与地下钢筋相连，作为地线地阻很小（经实际测星可小于
0.20) 。由千地阻很小，可将计算机机房及各种设备的地线共用建筑地，从理论上讲不会
产生相互干扰，从实际应用看也是可行的。它具有投资少、占地少、阻值稳定等特点，符
合城市建筑的发展趋势。
(3) 接地体
接地体的埋设是接地系统好坏的关键。通常使用的接地体有地桩、水平栅网、金属接地
板和建筑物基础钢筋等。
l) 地桩。垂直打入地下的接地金属棒或金属管，是常用的接地体。它用在土壤层超过
3m 厚的地方。金属棒的材料为钢或铜，直径一般应为15mm 以上。为防止腐蚀、增大接触面
积并承受打击力，地桩通常采用较粗的锁锌钢管。
金属棒做地桩形成的地阻主要与金属棒的长度和土壤情况有关，受直径的影响不大。金
属棒的长度一般选择3m 以上。由于单根接地桩地阻较大，在实际使用中常将多根接地桩连成
环形或网格形，每两根地桩间的距离一般要大于地桩长度的两倍。
土壤的含水率和含盐量的多少决定了土壤的电阻率，而土壤电阻率是决定地线地阻的重
要因素。为降低大地电阻率，常需采取水分保持和化学盐化措施。
在地网表层土壤适当种植草类或豆类植物，可保持土壤中的水分，又不致出现盐分流失
的现象。此外，在接地桩周围土壤中要添加一些产生离子的化学物品，以提高土壤的电导率。
这些化学物品有硫酸镁、硝酸钾和氯化钠等。其中硫酸镁是一种较好的降阻材料，它成本低，
电导率高，对接地电极和附近的金属物体腐蚀作用弱。在土壤中添加硫酸镁时，可在地桩周围
挖一条0.3m 深的沟，在沟内填满硫酸镁，用土覆盖。这样硫酸镁不与地桩直接接触，以使其
分布最佳而腐蚀作用又最小。另一种方法是用一个0.6m 长的套管套在地桩外面，套管内填充
硫酸镁至距地面0.3m, 套管与地面持平并用木盖盖住管口。这样，套管内的硫酸镁会随着雨
水均匀地潜入到地桩周围。
化学盐化并不能永久地改变接地电阻。化学材料会随着雨水逐渐流失，一般有效期为3
年，随着时间的延长应适当补充化学材料。
2) 水平栅网。在土质情况较差，特别是岩层接近地表面无法打桩的情况下，可采用水平
埋设金属条带和电缆的方法。金属条带应埋在地下0.5,...,lm 深处，水平方向构成星形或栅格
网形，在每个交叉处，条带应焊接在一起，且带间距离大于lm。
水平铺设金属条带的方法同样要求采取保持水平和增加化学盐分的方法，使土壤的电阻
率降低。
3) 金属接地板。这种方法是将金属板与地面垂直埋在地下，与土壤形成至少0.2m2 的双
面接触。深度要求在永久性潮土壤以下0.3m, 一般至少在地下埋1.5m 深。金属板的材料通常
为铜板，也可为铁板或钢板。
这种方法占地面积小，但为获得较好的效果，必须埋设多个金属板，使埋设难度和造价
增高。因此，除特殊情况外，近年来已逐渐为地桩所代替。
4) 建筑物基础钢筋。如前所述，现代高层建筑的基础桩深入地下几十米，基础钢筋在地
下形成很大的地网并从地下延伸至顶层，每层均可接地线。这种接地体节省场地，经济、适
用，是城市建设机房地线的发展方向。
27
计算机网络安全教程第4 版
(4) 防雷措施
机房的外部防雷应使用接闪器、引下线和接地装置吸引雷电流，并为其泄放提供一条低
阻值通道。
机器设备应有专用地线，机房本身应有避雷设施，包括通信设备和电源设备有防雷击的
技术设施，机房的内部防雷主要采取屏蔽、等电位连接、合理布线或防闪器、过电压保护等技
术措施，以及拦截、屏蔽、均压、分流和接地等方法，从而达到防雷的目的。机房的设备本身
也应有避雷装置和设施。
6. 机房的防火、防水措施
计算机机房的火灾一般是由电气原因、人为事故或外部火灾蔓延引起的。电气原因主要
是指电气设备和线路的短路、过载、接触不良、绝缘层破损或静电等原因导致电打火而引起的
火灾。人为事故是指由千操作人员不慎、吸烟或乱扔烟头等，使充满易燃物质（如纸片、磁带
和胶片等）的机房起火。外部火灾蔓延是因外部房间或其他建筑物起火而蔓延到机房，从而引
起机房起火。
计算机机房的水灾一般是由千机房内有渗水、漏水等原因引起的。
机房内应有防火、防水措施。如机房内应有火灾、水灾自动报警系统，如果机房上层有
用水设施，需加防水层；机房内应放置适用于计算机机房的灭火器，并建立应急计划和防火制
度等。
为避免火灾和水灾，应采取如下具体措施。
(1) 隔离
建筑物内的计算机机房四周应设计一个隔离带，以便外部的火灾至少可隔离一个小时。
系统中特别重要的设备，应尽量与人员频繁出入的地区和堆积易燃物（如打印纸）的区域隔
离。所有机房门应为防火门，外层应有金属蒙皮。计算机机房内部应用阻燃材料装修。
机房内应有排水装置，机房上部应有防水层，下部应有防漏层，以避免出现渗水、漏水
现象。
(2) 火灾报警系统
火灾报警系统的作用是在火灾初期就能检测到并及时发出警报。
火灾报警系统按传感器的不同，分为烟报警和温度报警两种类型。烟报警器可在火灾开
始的发烟阶段就检测出，并发出警报。它的动作快，可使火灾及时被发觉。而热敏式温度报警
器是在火焰发生、温度升高后发出报警信号。近年来还开发出一种新型的co 探测报警器，它
可在发烟初期即可探测到火灾的发生，避免损失，且可避免人员因缺氧而死亡。
为安全起见，机房应配备多种火灾自动报警系统，并保证在断电后24 小时之内仍可发出
警报。报警器可采用音响或灯光报警，一般安放在值班室或人员集中处，以便工作人员及时发
现并向消防部门报告、组织人员疏散等。
(3) 灭火设施
机房应配置适用于计算机机房的灭火器材，机房所在楼层应有防火栓，以及必要的灭火
器材和工具，这些设施应具有明显的标记，且需定期检查。主要的消防器材和工具包括以下
两类。
l) 灭火器。虽然机房建筑内要求有自动喷水、供水系统和各种灭火器，但并不是任何机
房火灾都要自动喷水，因为有时对设备的二次破坏比火灾本身造成的损坏更为严重。因此，灭
火器材最好使用气体灭火器，推荐使用不会造成二次污染的卤代烧1211 或1301 灭火器，如无
28
亘物理安全
条件，也可使用CO2 灭火器。一般每4m2 至少应配置一个灭火器，还应有手持式灭火器，用
于大设备灭火。
2) 灭火工具及辅助设备。如液压于斤顶、手提式锯、铁掀、镐、椰头和应急灯等。
(4) 管理措施
机房应制定完善的应急计划和相关制度，并严格执行计算机机房环境和设备维护的各项
规章制度。加强对火灾隐患部位的检查，如电源线路要经常检查是否有短路处，防止出现火花
引起火灾。要制订灭火的应急计划并对所属人员进行培训。此外，还应定期对防火设施和工作
人员的掌握情况进行测试。
2.2 通信线路安全
如果所有的计算机系统都锁在室内，并且所有连接计算机系统的网络设备和接到计算机
系统上的终端设备也都锁在同一室内，则通信与计算机系统一样安全（假定不存在对外连接的
Modem) 。但是当有计算机网络系统的通信线路连接到室外时，问题就产生了。
尽管从网络通信线路上提取信息所需要的技术比直接从通信终端获取数据的技术要高几
个数量级，以目前的技术水平也是完全有可能实现的。
用一种简单（但很昂贵）的高技术加压电缆可以获得通信线路上的物理安全，这一技术
是若干年前为美国国家电话系统而开发的。通信电缆密封在塑料套管中，并在线缆的两端充气
加压。线上连接了带有报警器的传感器，用来测量压力。如果压力下降，则意味着电缆可能被
破坏了，技术人员还可以进一步检测出破坏点的位置，以便及时进行修复。
电缆加压技术提供了安全的通信线。将加压电缆架设千整座楼中，每寸电缆都将暴露在
外。如果任何人企图切割电缆，监视器会启动报警器，通知安全保卫人员电缆已被破坏。假设
任何人成功地在电缆上接了自己的通信线，在安全人员定期检查电缆的总长度时，就可以发现
电缆拼接处。加压电缆是包裹在波纹铝钢丝网中的，几乎没有电磁发射，从而大大增强了通过
通信线路窃听的难度。
光纤通信线曾被认为是不可搭线窃听的，其断破处立即就会被检测到，拼接处的传输
速度会非常缓慢，令人难以忍耐。光纤没有电磁辐射，所以也不能用电磁感应窃密。不幸
的是光纤的最大长度有限制，这就需要将信号转换成电脉冲，然后再恢复成光脉冲，继续
通过另一条线传送。完成这一操作的设备（复制器）是光纤通信系统的安全薄弱环节，因
为信号可能在这一环节被搭线窃听。有两个办法可解决这一问题：距离大千最大长度限制
的系统之间，不采用光纤通信；或加强复制器的安全，如用加压电缆、警报系统和加强警
卫等措施。
对千任何可以直接存取而不加安全防护措施的系统，通信是特别严重的安全薄弱环节。
当允许用户通过拨号连接到Modem 访问计算机网络系统时，则计算机网络系统的安全程度将
被大大削弱，因为有电话和Modem 的任何人就可能非法进入该系统。因此，应当避免这一情
况的发生，要确保Modem 的电话号码不被列于电话簿上，并且最好将电话号码放在不同千本
单位普通电话号码所在的交换机上。总之，不要假设没人知道自己的拨入号码，大多数攻击者
都能使用自动拨号软件通过一个Modem 整天依次调用拨号码，记录下连接上的Modem 的号
码。如果可能，安装一个局域PBX, 使得对外界的拨号产生ls 的拨号蜂音，并且必须输入一
个与Modem 相关联的扩展号码，就可有效提高系统的安全性。
29
计算机网络安全教程第4 版
2.3 设备安全
设备安全是一个比较宽泛的概念，包括设备的维护与管理、设备的电磁兼容和电磁辐射
防护，以及信息存储媒体的安全管理等内容。
2.3.1 硬件设备的维护和管理
计算机网络系统的硬件设备一般价格昂贵，一旦损坏而又不能及时修复，不仅会造成经
济损失，而且可能导致整个网络系统瘫痪，产生严重的不良影响。因此，必须加强对计算机网
络系统硬件设备的使用管理，坚持做好硬件设备的日常维护和保养工作。
1. 硬件设备的使用管理
l) 要根据硬件设备的具体配置情况，制定切实可行的硬件设备的操作使用规程，并严格
按照操作规程进行操作。
2) 建立设备使用情况日志，并严格登记使用过程的情况。
3) 建立硬件设备故障情况登记表，详细记录故障性质和修复情况。
4) 坚持对设备进行例行维护和保养，并指定专人负责。
2. 常用硬件设备的维护和保养
常用硬件设备的维护和保养包括主机、显示器、打印机和硬盘的维护保养；网络设备如
HUB、交换机、路由器、Modem、RJ-45 接头和网络线缆等的维护保养；还要定期检查供电系
统的各种保护装置及地线是否正常。
所有的计算机网络设备都应当置千上锁且有空调的房间里。同时还要注意，电源插座附
近清扫的工作人员或粗心的使用人员都可能使设备掉电。同时还要将对设备的物理访问权限限
制在最小。
2.3.2 电磁兼容和电磁辐射的防护
1. 电磁兼容和电磁辐射
计算机网络系统的各种设备都属于电子设备，在工作时都不可避免地会向外辐射电磁波，同时
也会受到其他电子设备的电磁皮干扰，当电磁干扰达到一定的程度时就会影响设备的正常工作。
电磁干扰可通过电磁辐射和传导两条途径影响电子设备的工作。一条是电子设备辐射的
电磁波通过电路耦合到另一台电子设备中引起干扰；另一条是通过连接的导线、电源线和信号
线等耦合而引起相互之间的于扰。
电子设备及其元器件都不是孤立存在的，而是在一定的电磁干扰环境下工作。电磁兼容
性就是电子设备或系统在一定的电磁环境下互相兼顾、相容的能力。
电磁兼容问题由来已久。1831 年法拉第发现电磁感应现象，总结出电磁感应定律； 1881
年英国科学家希维思德发表了“论干扰”的文章； 1888 年赫兹通过试验演示了电磁干扰现
象。20 世纪以来，特别是在第二次世界大战中，电磁兼容理论进一步发展，逐步形成了一门
独立的学科。电磁兼容设计已成为军用武器装备和电子设备研制中必须严格遵守的原则，电磁
兼容性成为产品可靠性保证的重要组成部分。如果设备的电磁兼容性很差，在电磁干扰的环境
中就不能正常工作。我国已将电磁兼容性作为强制性的标准来执行。
1985 年在法国举办的“计算机与通信安全“国际会议上，荷兰的一位工程师现场演示了
30
第2 章物理安全
用一套稍加改装的黑白电视机还原心n 以外机房内计算机显示屏上的信息。这说明计算机的
电磁辐射造成信息泄露的危险是真实存在的。尤其是在微电子技术和卫星通信技术飞速发展的
今天，各种信息窃取手段日趋先进，电磁辐射泄密的危险也越来越大。
美国、俄罗斯等国家已对电磁辐射泄密问题进行了多年研究，并逐渐形成了一种专门的
技术一一抑制信息处理设备的噪声泄露技术，简称信息泄露防护技术(Tempest 技术）。
Tempest 技术是一项综合性非常强的技术，包括泄露信息的分析、预测、接收、识别、
复原、防护、测试和安全评估等技术，涉及多个学科领域。Tempest 技术基本上是在传统的
电磁兼容理论的基础上发展起来的，但比传统的抑制电磁干扰的要求要高得多，在技术实现
上也更复杂。一般认为显示器的视频信号、打印机打印头的驱动信号、磁头读／写信号、键
盘输入信号，以及信号线上的输入／输出信号等为需要重点防护的对象。美国政府规定，凡
属高度机密部门所使用的计算机等信息处理设备，其电磁泄露发射必须达到Tempest 标准规
定的要求。
2．电磁辐射防护的措施
为保证计算机网络系统的物理安全，除在网络规划、场地和环境等方面进行防护之外，
还要防止数据信息在空间中的扩散。计算机系统通过电磁辐射使信息被截获而失密的案例已经
很多，在理论和技术支持下的验证工作也证实了这种截取距离在几百米甚至可达千米的复原显
示给计算机系统信息的保密工作带来了极大的威胁。为了防止计算机系统中的数据信息在空间
中的扩散，通常是在物理上采取一定的防护措施，以减少或干扰扩散到空间中的电磁信号。这
对政府、军队及金融机构在构建信息中心时都将成为首先要解决的问题。
目前防护措施主要有两类：一类是对传导发射的防护，主要是对电源线和信号线加装性
能良好的滤波器，减小传输阻抗和导线间的交叉耦合；另一类是对辐射的防护，这类防护措施
又可分为以下两种：一种是采用各种电磁屏蔽措施，如对设备的金属屏蔽和各种接插件的屏
蔽，同时对机房的下水管、暖气管和金属门窗进行屏蔽与隔离；另一种是干扰的防护措施，即
在计算机系统工作的同时，利用干扰装置产生一种与计算机系统辐射相关的伪噪声向空间辐射
来掩盖计算机系统的工作频率和信息特征。
为提高电子设备的抗干扰能力，除在芯片和部件上提高抗干扰能力外，主要的措施有屏
蔽、滤波、隔离、接地和吸波等，其中屏蔽是应用最多的方法。
1) 屏蔽。电磁波经封闭的金属板之后，大部分能量被吸收、反射和再反射，再传到板内
的能量已很小，从而保护内部的设备或电路免受强电磁干扰。
2) 滤波。滤波是另一种重要的方法。滤波电路是一种无源网络，它可让一定频率范围内
的电信号通过而阻止其他频率的电信号，从而起到滤波作用。在有导线连接或阻抗耦合的情况
下，进出线采用滤波器可使强干扰被阻止。还有一种吸波作用，是采用铁氧体等吸波材料，在
空间很小的情况下起到类似滤波器的作用。
3) 隔离。隔离是将系统内的电路采用隔离的方法分别处理，将强辐射源、信号处理单元
等隔离开，单独处理，从而减弱系统内部和系统向外的电磁辐射。
4) 接地。接地对电磁兼容来说十分重要，它不仅可起到保护作用，而且可使屏蔽体、滤
波器等集聚的电荷迅速排放到大地，从而减小干扰。用于电磁兼容的地线最好单独埋放，对其
地阻、接地点等均有很高的要求。
电磁防护层主要是通过上述种种措施，提高计算机的电磁兼容性，提高设备的抗干扰能
31
计算机网络安全教程笫4 版
力。使计算机能抵抗强电磁干扰；同时将计算机的电磁泄露发射降到最低，使之不致将有用的
信息泄露出去。
2.3．3 信息存储媒体的安全管理
计算机网络系统的信息要存储在某种媒体上，常用的存储媒体有硬盘、磁盘、磁带、打
印纸和光盘等。对存储媒体的安全管理主要包括以下几个方面。
l) 存放有业务数据或程序的磁盘、磁带或光盘，应视同文字记录妥善保管。必须注意防
磁、防潮、防火、防盗，必须垂直放置。
2) 对硬盘上的数据，要建立有效的级别和权限，并严格管理，必要时要对数据进行加
密，以确保硬盘数据的安全。
3) 存放业务数据或程序的磁盘、磁带或光盘，管理必须落实到人，并分类建立登记簿，
记录编号、名称、用途、规格、制作日期、有效期、使用者和批准者等信息。
4) 对存放有重要信息的磁盘、磁带和光盘，要备份两份并分两处保管。
5) 打印有业务数据或程序的打印纸，要视同档案进行管理。
6) 凡超过数据保存期的磁盘、磁带和光盘，必须经过特殊的数据清除处理。
7) 凡不能正常记录数据的磁盘、磁带和光盘，必须经测试确认后由专人进行销毁，并做
好登记工作。
8) 对需要长期保存的有效数据，应在磁盘、磁带和光盘的质量保证期内进行转储。转储
时应确保内容正确。
2.4 电源系统安全
电源是计算机网络系统的命脉，电源系统的稳定可靠是计算机网络系统正常运行的先决
条件，电源系统电压的波动、浪涌电流和突然断电等意外情况的发生还可能引起计算机系统存
储信息的丢失、存储设备的损坏等情况的发生。电源系统的安全是计算机网络系统物理安全的
一个重要组成部分。国内外关千电源的相关标准主要有以下两个。
·直流电源的相关标准。国际电工委员会(IEC) 制定了直流稳定电源标准： IEC478.1一
1974 《直流输出稳定电源术语》； IEC478.2一1986 《直流输出稳定电源额定值和性能》；
IEC478.3-1989 《直流输出稳定电源传导电磁干扰的基准电平和测量》； IEC478.4一
1976 《直流输出稳定电源除射频干扰外的试验方法》； IEC478.5—1993 《直流输出稳
定电源电抗性近场磁场分量的测量》。这一套标准颁布实施的时间较早，而国内相应
的国家标准尚未颁布。国内颁布的有关直流稳定电源的电子行业标准有SJ2811.1一87
《通用直流稳定电源术语及定义、性能与额定值》和SJ2811.2一87 《通用直流稳定电
源测试方法》。
·交流电源的相关标准。国际电工委员会(IEC) 于1980 年颁布了IEC686一80 《交流输
出稳定电源》。1994 年，原电子工业部颁布了电子行业标准SJ厅10541一94 《抗干扰型
交流稳压电源通用技术条件》和SJ厅10542—94 《抗干扰型交流稳压电源测试方法》。
在国标GB2887一2011 和GB9361 —2011 中也对机房安全供电做了明确的要求。国标
GB2887一2011 将供电方式分为了3 类。
32
第2 章物理安全
·一类供电：需建立不间断供电系统。
·二类供电：需建立带备用的供电系统。
·三类供电：按一般用户供电考虑。
GB9361一2011 中也提出A、B 类安全机房应符合如下要求。
·计算站应设专用可靠的供电线路。
·计算机系统的电源设备应提供稳定可靠的电源。
·供电电源设备的容昼应具有一定的余量。
·计算机系统的供电电源技术指标应按GB2887—2011 《计算站场地技术要求》中的第9
章的规定执行。
·计算机系统独立配电时，宜采用干式变压器。安装油浸式变压器时应符合GBJ232一82
《电气装置安装工程规范》中的规定。
·从电源室到计算机电源系统的分电盘使用的电缆，除应符合GB232一2010 中配线工程
中的规定外，载流量应减少50% 。
·计算机系统用的分电盘应设置在计算机机房内，并应采取防触电措施。
·从分电盘到计算机系统的各种设备的电缆应为耐燃铜芯屏蔽的电缆。
·计算机系统的各设备走线不得与空调设备、电源设备的无电磁屏蔽的走线平行。交叉
时，应尽量以接近千垂直的角度交叉，并采取防延燃措施。
·计算机系统应选用铜芯电缆，严禁铜、铝混用，若不能避免时，应采用铜、铝过渡头
连接。
·计算机电源系统的所有接点均应进行锁铅锡处理，冷压连接。
·在计算机机房出入口处或值班室，应设置应急电话和应急断电装置。
·计算站场地宜采用封闭式蓄电池。
·使用半封闭式或开启式蓄电池时，应设专用房间。房间墙壁和地板表面应做防腐蚀处
理，并设置防爆灯、防爆开关和排风装置。
·计算机系统接地应采用专用地线。专用地线的引线应和大楼的钢筋网及各种金属管道
绝缘。
·计算机系统的几种接地技术要求及诸地之间的相互关系应符合GB2887一2011 中的规定。
·计算机机房应设置应急照明和安全口的指示灯。
C 类安全机房应满足GB2887一2011 中规定的三类供电要求。
电源系统安全不仅包括外部供电线路的安全，更重要的是室内电源设备的安全。下面将
从电力能源的可靠供应和影响电源设备安全的潜在威胁等方面展开论述。
1．电力能源的可靠供应
为了确保电力能源的可靠供应，以防外部供电线路发生意外故障，必须有详细的应急预
案和可靠的应急设备。应急设备主要包括备用发电机、大容量蓄电池和UPS 等。除了要求这
些应急电源设备具有高可靠性外，还要求它们具有较高的自动化程度和良好的可管理性，以便
在意外情况发生时保证电源的可靠供应。
2．电源对用电设备安全的潜在威胁
(I) 脉动与噪声
理想的直流电源应提供纯净的直流，然而总有一些干扰存在，比如在开关电源(SMPS)
输出端口叠加的脉动电流和高频振荡。这两种干扰再加上电源本身产生的尖峰噪声，使电源出
33
计算机网络安全教程笫4 版
现断续和随意的漂移(PARD) 。
(2) 电磁干扰
电磁干扰会产生电磁兼容性问题，目前这方面的标准有美国的FCC 标准， FCC 分为A 和
B 两个级别。国内相应的标准为China Compulsory Certification 认证标准，即3C 认证。
FCC-A 级指工业标准， FCC-B 级指家用电器标准，只有达到B 级的电源才被认为是安全无害
的。当电源的电磁干扰比较强时，其产生的电磁场就会影响到硬盘等磁性存储介质，久而久之
就会使存储的数据受到损害。
在电磁兼容性方面，国标GBff 9254. 1—2021: 《信息技术设备、多媒体设备和接收机电磁
兼容第1 部分：发射要求》对电磁干扰的极限值和测量方法都做了明确的规定。
GBff9254.l一2021 将信息设备按安全性分为两级，即A 级和B 级，具体要求如下。
•A 级设备保护距离为30m, 通常用千工业环境中。
•B 级设备的保护距离为10m, 可用千住宅区、商业区、商务区、公共娱乐场所、户外
场所和轻工业区等。
电磁骚扰可以通过设备的电源端子传导发射，造成电网的污染。因此，电磁兼容标准中
对电源端子的传导骚扰发射进行了限制，这就是电源端子传导发射限值。表2-2 给出了A 级
和B 级电源端子的传导骚扰限值。
表2-2 电源端子的传导骚扰限值
A 级B 级
频率范围／ 限值／dBμV 频率范围I 限值／dBμV
MHz 准峰值平均值MHz 准峰值平均值
0.15~0.50 79 66 0.15~0.50 66 ~ S6 56 ~ 46
o.so~so 78 60 o.so~s 56 46
5~30 60 50
电缆上的共模电流会产生很强的电磁辐射，大部分设备在不连接电信电缆时能够顺利通
过有关的标准，而连接上电缆后就不再满足标准的要求，这就是由于电缆中共模电流产生了共
模辐射。因此本项对电信端口的共模传导发射提出了限制。表2-3 给出了A 级和B 级电信端
口的共模传导骚扰限值。
表2-3 电信端口的共模传导骚扰限值
A 级B 级
频率范围／
电压限值／dBμV 电流限值俎3μA 电压限值|dBμV 电流限值／dBμA
MHz
准峰值平均值准峰值平均值准蜂值平均值准峰值平均值
0.15~0.5 97~87 84~74 S3~43 40~30 84~74 74~64 40~30 30~20
O.S-30 87 74 43 30 74 64 30 20
信息设备在工作时会向空间辐射电磁波，这构成了对其他设备的骚扰，特别是对无线接
收设备的影响很大。因此，本项对设备辐射的电磁波强度提出了限制。表2-4 给出了A 级和
B 级辐射骚扰限值。
34
第2 章物理安全
表2-4 辐射骚扰限值
频率范围I 准峰值／（dBμV/m)
MHz
A 级B 级
30~230 40 30
230-1000 47 37
此外，当电源纹波系数过大时，电源所输出的直流电压中掺杂了过多的交流成分，会使
主板、内存和显卡等半导体器件不能正常工作，而且当市电有较大波动时，电源输出电压产生
大的变化，还有可能导致计算机和网络设备重新启动或不能正常工作。
2.5 小结
物理安全在整个计算机网络信息系统安全体系中占有重要地位，也是其他安全措施得以
实施并发挥正常作用的基础和前提条件。计算机网络系统物理安全的内涵是保护计算机网络设
备、设施及其他媒体免遭地震、水灾、火灾等环境事故，以及人为操作失误或错误及各种计算
机犯罪行为导致的破坏。主要内容为机房安全技术、通信线路安全技术和计算机网络系统设备
安全技术等。机房安全主要是从机房场地、机房防盗、机房三度、防静电和防雷击等方面进行
讨论。通信线路安全主要着重介绍加压电缆和光纤等通信线路的防窃听技术。计算机网络系统
设备安全应采取的主要手段有计算机网络系统设备的安全管理和维护、信息存储媒体的管理、
计算机网络系统设备的电磁兼容技术。电源系统安全应该注意电源电流或电压的波动可能会对
计算机网络系统造成的危害。
2.6 习题
l ．简述物理安全在计算机网络信息系统安全中的意义。
2. 物理安全主要包含哪些方面的内容？
3. 计算机机房安全等级的划分标准是什么？
4. 计算机机房安全技术主要包含哪些方面的内容？
5. 保障通信线路安全的主要技术措施有哪些？
6．电磁辐射对网络通信安全的影响主要体现在哪些方面，防护措施有哪些？
7. 保障信息存储安全的主要措施有哪些？
8. 简述各类计算机机房对电源系统的要求。
35
第3 章
信息加密与PKI
密码技术是保障信息安全的基石，它以很小的代价，对信息提供一种强有力的安全保
护。长期以来，密码技术广泛应用千政治、经济、军事、外交和情报等重要部门。近年来随着
计算机网络和通信技术的发展，密码学得到了前所未有的重视并迅速普及，同时其应用领域也
广为拓展，如今密码技术不仅服务于信息的加密和解密，还是身份认证、访问控制和数字签名
等多种安全机制的基础。
在理论上，信息加密是利用密码学的原理与方法对传输数据提供保护，它以数学计算为基础，
信息论和复杂性理论是其两个重要组成部分。其中，信息论主要包括Shannon 关千保密系统的信
息理论和Simmoms 关于认证系统的信息理论。密码学复杂性理论主要讨论算法复杂性和问题复杂
性两方面的内容。在构成上，密码技术主要由密码编码技术和密码分析技术两个既相互对立又相
互依存的分支组成，密码编码技术主要解决产生安全有效的密码算法问题，实现对信息的加密或
认证；密码分析技术主要解决破译密码或伪造认证码问题，从而窃取保密信息或进行破坏活动。
3.1 密码学概述
为方便学习本章后续内容，先对密码学的发展历程、一些基本概念，以及单钥密码体制
和双钥密码体制的原理进行概要性介绍。
3.1.1 密码学的发展
密码学是一门古老而深奥的科学，它以认识密码变换为本质，以加密与解密的基本规律
为研究对象。密码学的发展历程大致经历了3 个阶段：古代加密方法、古典密码和近代密码。
1. 古代加密方法
应用需求是催生古代加密方法起源和进步的直接动力。据石刻及有关史料记载，许多古
代文明，如埃及人、希伯来人等都是在实践中逐步发明并使用了密码系统。从某种意义上说，
战争是科学技术进步的催化剂，自从有了战争，人类就面临着安全通信需求。研究表明，古代
加密方法大约起源千公元前440 年出现在古希腊战争中的隐写术。当时为了安全传送军事情
报，奴隶主将奴隶的头发剃光，把情报写在奴隶的光头上，待头发长长后将奴隶送到另一个部
落，再次剃光头发，原有的信息复现出来，从而实现两个部落间的秘密通信。
另一个将密码学用于通信的记录是，斯巴达人于公元前400 年将Scytale 加密工具用千军
官间传递秘密信息。Scytale 实际上是一个锥形指挥棒，周围环绕一张羊皮纸，将要保密的信
息写在羊皮纸上。解下羊皮纸，上面的消息杂乱无章、无法理解，但将它绕在另一个同等尺寸
的棒子上后，就能看到原始的消息。
我国古代也早就出现以藏头诗、藏尾诗、漏格诗及绘画等形式，将需表达的消息或“密
语“隐藏在诗文或画卷中特定位置，若只注意诗或画的表面意境，则很难发现其中隐藏的“话
外之音”。
36
第3 章信息加密与PKI
总而言之，虽然这些古代加密方法只能限定在局部范围内使用，但其体现了密码学的若
干典型特征。
2. 古典密码
相比千古代加密方法， 古典密码系统已变得较为复杂，并初步显现出近代密码系统的雏
形，文字置换是其主要加密思想，一般通过手工或借助机械变换方式实现加密。古典密码的密
码体制主要有单表代替密码、多表代替密码及转轮密码。例如， Caesar 密码就是一种典型的单
表加密体制，多表代替密码有Vigenere 密码、Hill 密码等。20 世纪20 年代，随着机械和机电
技术的逐步成熟，以及电报和无线电应用的出现，引起了密码设备方面的一场革命一转轮
密码机（简称转轮机， Rotor) 被发明了出来。转轮机的出现是密码学发展的重要标志之一，
由此传统密码学有了长足的进展，利用机械转轮人们开发出了许多极其复杂的加密系统，密码
加密速度也大大提高。在第二次世界大战中，盟军破获的德军Enigma 密码就是转轮密码的著
名实例。由千转轮机的密钥量有限，二战中后期曾引发了一场加密与破译的对抗。
二战结束后，电子学开始被引入到密码机之中，第一个电子密码机也仅仅是一个转轮
机，只是后来转轮被电子器件取代而已。这些电子转轮机的唯一优势在千其操作速度，但它们
仍受制千机械式转轮密码机固有弱点（如密码周期有限、制造费用高等）的影响。
3. 近代密码
20 世纪70 年代，由千计算机科学的蓬勃发展，电子计算机和现代数学方法为加密技术提
供了新的概念和工具，当然也给破译者提供了有力的武器。新技术的到来给密码设计者带来了
前所未有的自由，他们可以轻易地摆脱原先用铅笔和纸张进行手工设计时易犯的错误，也不用
为机械方式实现密码机的高额费用而发愁，从而可以设计出更为复杂的密码系统。
1949 年Claude Shannon 发表了《保密系统的通信理论》(The Communication Theory of
Secrecy Systems) ，这篇论文作为近代密码学的理论基础之一，直至30 年之后才显示出它的价
值。1976 年Diffie 和Hellman 发表了《密码学的新方向》(New Directions in Cryptography) -
文，提出了适用千网络保密通信的公钥密码思想，开辟了公开密钥密码学的新领域，掀起了公
钥密码研究的序幕。在这些思想的启迪下，各种公钥密码体制相继被提出， 特别是RSA 公钥
密码体制的提出，是密码学史上的一个重要里程碑。可以说，没有公钥密码的研究就没有近代
密码学。与此同时，美国国家标准局(NBS, 即现在的国家标准与技术研究所NIST) 正式公
布实施了美国的数据加密标准(Data Encryption Standard, DES) 及其加密算法，并将之用千
政府等非机密单位及商业领域的保密通信。上述两篇重要论文和美国数据加密标准DES 的实
施，标志着密码学理论与技术的划时代变革，宜布了近代密码学的开始。
近代密码学与计算机技术、电子通信技术紧密相关。在这一阶段，密码理论蓬勃发展，
密码算法设计与分析互相促进，出现了大量的密码算法和各种攻击方法。另外，密码使用的范
围也在不断扩大，而且出现了许多通用的加密标准。当然，密码学在飞速发展的同时，也出现
了一些新的课题和方向。例如，在分组密码领域，由千DES 已经无法满足高保密性的要求，
美国千1997 年开始征集新一代数据加密标准，即高级数据加密标准(Advanced Encryption
Standard, AES), AES 征集活动使国际密码学界掀起了分组密码研究的新高潮。2006 年，高
级数据加密标准已成为对称密钥加密中最流行的算法之一。
在公开密钥密码领域，椭圆曲线密码体制由千其安全性高、计算速度快等优点引起了人们
的普遍关注。此外，由于嵌入式系统的发展和智能卡的应用，这些设备上所使用的密码算法由
于系统本身资源的限制，要求密码算法以较小的资源快速实现，这样，公开密钥密码的快速实
37
计算机网络安全教程第4 版
现就成为一个新的研究热点。随着相关技术的发展，一些具有潜在密码应用价值的技术也得到
了密码学家的高度重视，一些新的密码技术如混沌密码、量子密码等，正在逐步走向实用化。
3.1.2 密码学基本概念
密码学(Cryptology) ：密码学作为数学的一个分支，是研究信息系统安全保密的科学，
是密码编码学和密码分析学的统称。
密码编码学(Cryptography) ：是使消息保密的技术和科学。密码编码学是密码体制的设
计学，即怎样编码，采用什么样的密码体制保证信息被安全地加密。从事此行业的人员称为密
码编码者(Cryptographer) 。
密码分析学(Cryptanalysis) ：是与密码编码学对应的技术和科学，即研究如何破译密文
的科学和技术。密码分析学是在未知密钥的情况下从密文推演出明文或密钥的技术。密码分析
者(Cryptanalyst) 是从事密码分析的专业人员。
在密码学中，有一个五元组： ｛明文，密文，密钥，加密算法，解密算法｝，对应的加密
方案称为密码体制（或密码）。
明文(Plaintext) ：是作为加密输入的原始信息，即消息的原始形式，通常用m 或p 表
示。所有可能明文的有限集称为明文空间，通常用M 或P 来表示。
密文(Ciphertext) ：是明文经加密变换后的结果，即消息被加密处理后的形式，通常用c
表示。所有可能密文的有限集称为密文空间，通常用C 来表示。
密钥(Key) ：是参与密码变换的参数，通常用K 表示。一切可能的密钥构成的有限集称
为密钥空间，通常用K 表示。
加密算法(Encryption Algorithm) ：是将明文变换为密文的变换函数，相应的变换过程称
为加密，即编码的过程（通常用E 表示，即c=Ek(p) ）。
解密算法(Decryption Algorithm) ：是将密文恢复为明文的变换函数，相应的变换过程称
为解密，即解码的过程（通常用D 表示，即p=压(c) ）。
对于有实用意义的密码体制而言，总是要求它满足： p=Dtc＠舫），即用加密算法得到的密文总
是能用一定的解密算法恢复出原始的明文来。而密文消息的获取同时依赖千初始明文和密钥的值。
一般地，密码系统的模型可用图3-1 表示。
密文C
攻击者
加密密钥比解密密钥比
图3-1 一般密码系统示意图
3.1.3 密码体制分类
密码体制从原理上可分为两大类，即单钥或对称密码体制(One-Key or Symmetric
Cryptosystem)、双钥或非对称密码体制(Two-Key or Asymmetric Cryptosystem) 。
1. 单钥密码体制
单钥密码体制的本质特征是所用的加密密钥和解密密钥相同，或实质上等同，从一个可
以推出另外一个。单钥体制不仅可用于数据加密，也可用千消息的认证，最有影响的单钥密码
38
第3 章信息加密与PK.I
是1977 年美国国家标准局颁布的DES 算法。系统的保密性主要取决千密钥的安全性，因此必
须通过安全可靠的途径（如信使递送）将密钥送至收端。这种如何将密钥安全、可靠地分配给
通信对方，包括密钥产生、分配、存储和销毁等多方面的问题统称为密钥管理(Key
Management) ，是影响系统安全的关键因素。古典密码作为密码学的源头，其多种方法充分体
现了单钥加密的思想，典型方法如代码加密、代替加密、变位加密和一次性密码簿加密等。
单钥密码体制的基本元素包括原始的明文、加密算法、密钥、密文及攻击者。单钥系统
对数据进行加解密的过程如图3-2 所示。
图3-2 单钥密钥体制示意图
颓方的明文消息P=[Pi,P2, …， PM], p 的M 个元素是某个语言集中的字母，如26 个英文字
母，现在最常见的是二进制字母表{0,1} 中元素组成的二进制串。加密之前先产生一个形如
K=[K1,K2, …,KJ] 的密钥作为密码变换的输入参数之一。该密钥或者由消息发送方生成，然后通
过安全的影邕觑接收方；或者由可信的第三方生成，然后通过安全渠道分发给发送方和接收方。
发送方通过加密算法根据输入的消息P 和密钥K 生成密文C=[C1,C2,…,CN] ，即：
C = EK (P) (3-1)
接收方通过解密算法根据输入的密文C 和密钥K 恢复明文P=[P1,P2, … ,PM] ，即：
P =DK (C) (3-2)
一个攻击者（密码分析者）能够基千不安全的公开信道观察密文C, 但不能接触到明文
P 或密钥K, 他可以试图恢复明文P 或密钥K 。假定他知道加密算法E 和解密算法D, 只对
当前这个特定的消息感兴趣，则努力的焦点是通过产生一个明文的估计值P' 来恢复明文P 。
如果他也对读取未来的消息感兴趣，他就需要试图通过产生一个密钥的估计值k' 来恢复密钥
K ，这是一个密码分析的过程。
单钥密码体制的安全性主要取决千两个因素：©加密算法必须足够安全，使得不必为算法保
密，仅根据密文就能破译出消息是不可行的； ＠密钥的安全性，密钥必须保密并保证有足够大的
密钥空间，单钥密码体制要求基千密文和加密／解密算法的知识能破译出消息的做法是不可行的。
单钥密码算法的优点主要体现在其加密／解密处理速度快、保密度高等，其缺点主要体现
在以下几个方面。
l) 密钥是保密通信安全的关键，发信方必须安全、妥善地把密钥护送到收信方，不能泄
露其内容。如何才能把密钥安全地送到收信方，是单钥密码算法的突出问题。单钥密码算法的
密钥分发过程十分复杂，所花代价高。
2) 多人通信时密钥组合的数量会出现爆炸性膨胀，使密钥分发更加复杂化， N 个人进行
两两通信，总共需要的密钥数为N(N-1)/2 个。
3) 通信双方必须统一密钥，才能发送保密的信息。如果发信方与收信方素不相识，这就
无法向对方发送秘密信息了。
39
计算机网络安全教程第4 版
4) 除了密钥管理与分发问题，单钥密码算法还存在数字签名困难问题（通信双方拥有同
样的消息，接收方可以伪造签名，发送方也可以否认发送过某消息）。
2. 双钥密码体制
双钥体制是由Diffie 和Hellman 千1976 年提出的，采用双钥密码体制（又称为公钥密码
体制或非对称密码体制）的主要特点是将加密和解密能力分开，因而可以实现多个用户加密的
消息只能由一个用户解读，或只能由一个用户加密消息而多个用户可以解读。
双钥密码体制的原理是加密密钥与解密密钥不同，而且从一个难以推出另一个。两个密
钥形成一个密钥对，用其中一个密钥加密的结果，可以用另一个密钥来解密。双钥密码体
制的发展是整个密码学发展史上最伟大的一次革命，它与以前的密码体制完全不同。这是
因为双钥密码算法基千数学问题求解的困难性，而不再是基千代替和换位方法；另外，双
钥密码体制是非对称的，它使用两个独立的密钥，一个可以公开，称为公钥，另一个不能
公开，称为私钥。
双钥密码体制的产生主要基千以下两个原因：一是为了解决常规密钥密码体制的密钥管
理与分配的问题；二是为了满足对数字签名的需求。因此，双钥密码体制在消息的保密性、密
钥分配和认证领域有着重要的意义。
在双钥密码体制中，公开密钥是可以公开的信息，而私有密钥是需要保密的。加密算法E
和解密算法D 也都是公开的。用公开密钥对明文加密后，仅能用与之对应的私有密钥解密才
能恢复出明文，反之亦然。
在使用双钥体制时，每个用户都有一对选定的密钥：一个是可以公开的，用K1 表示，另
一个则是秘密的，用k2 表示，公开的密钥k1 可以像电话号码一样进行注册公布，因此双钥体
制又称为公钥体制(Public Key System) 。双钥密码体制既可用千实现公共通信网的保密通
信，也可用千认证系统中对消息进行数字签名。为了同时实现保密性和对消息进行确认，且加
密、解密运算次序可换，即Ek1(D匕(m)) = D1c2 (Ek1 (m)) = m 时，可采用双钥密码体制实现双重
加、解密功能，如图3-3 所示。例如，用户A 要向用户B 传送具有认证性的机密消息m, 可
按图3-3 的顺序进行变换。这样， A 发送给B 的密文为c= EkB1 (DkA2 (m)), B 恢复明文的运
算过程如下。
m = Ek.Ai (DkB2 (c)) = EkA1 (DkB2 (EkB1 (D心(m))))= Ek.At (DkA2 (m)）。
公开
图3-3 双钥保密和认证体制示意图
双钥密码体制的优点是可以公开加密密钥，适应网络的开放性要求，且仅需保密解密密
钥，所以密钥管理问题比较简单。此外，双钥密码可以用于数字签名等新功能。最有名的双钥
密码体系是1977 年由Rivest、Shamir 和Adleman 等人提出的RSA 密码体制。双钥密码的缺
点是双钥密码算法一般比较复杂，加解密速度慢。因此，实际网络中的加密多采用双钥和单钥
密码相结合的混合加密体制，即加解密时采用单钥密码，密钥传送时则采用双钥密码。这样既
40
第3 章信息加密与PK.I
解决了密钥管理困难的问题，又解决了加解密速度的问题。
3.2 加密算法
加密算法就其发展而言，共经历了古典密码、对称密钥密码（单钥密码体制）和公开密
钥密码（双钥密码体制） 3 个发展阶段。其中，古典密码是基于字符替换的密码，现在已很少
使用，但其代表了密码的起源，仍在使用的有对位进行变换的密码算法。按密钥管理方式来区
分，上述加密算法可以分为两大类，即对称密钥算法与公开密钥算法。这里，对称密钥算法的
加密和解密密钥相同，也称单钥算法。按加密模式来分，对称算法还可分为序列密码和分组密
码两大类。序列密码每次加密一位或一字节的明文，也称为流密码，序列密码是手工和机械密
码时代的主流方式；分组密码将明文分成固定长度的组，用同一密钥和算法对每一块加密，输
出也是固定长度的密文。公开密钥算法也称双钥加密算法，它使用完全不同但又完全匹配的一
对钥匙一—公钥和私钥；在公开密钥算法加密文件时，只有使用匹配的一对公钥和私钥，才
能完成对明文的加密和解密过程。
此外，随着云计算、电子商务等迅速发展，近年来，人们越来越重视同态加密的研究与
应用。
3.2.1 古典密码算法
古典密码大都比较简单，可用手工或机械操作实现加解密夕虽然现在很少采用，但研究这些
密码算法的原理，对千理解、构造和分析现代密码是十分有益的。古典密码算法主要有代码加
密、代替加密、变位加密和一次性密码簿加密等几种。代码加密是一种比较简单的加密方法，它
使用通信双方预先设定的一组有确切含义的代码，如日常词汇、专有名词或特殊用语等来发送消
息，一般只能用千传送一组预先约定的消息。代替加密是将明文中的每个字母或每组字母替换成
另一个或一组字母，这种方法可用来传送任何信息，但安全性不及代码加密。变位加密不隐藏明
文的字符，即明文的字母保持相同，但其顺序被打乱重新排列成另一种不同的格式，由千密文字
符与明文字符相同，密文中字母的出现频率与明文中字母的出现频率相同，密码分析者可以很容
易地由此进行判别。虽然许多现代密码也使用换位，但由千它对存储要求很大，有时还要求消息
为某个特定的长度，因而比较少用。一次性密码簿加密具有代码加密的可靠性，又保持了代替加
密的灵活性，密码簿的每一页都是不同的代码表，可用一页上的代码来加密一些词，用后销毁，
再用另一页加密另一些词，直到全部明文完成加密。破译的唯一方法就是获取一份相同的密码
簿。该方法可操作性不强因此也很少使用。下面，介绍代替加密的几种算法实现。
1. 简单代替密码或单字母密码
简单代替密码就是将明文字母表M 中的每个字母用密文字母表C 中的相应字母来代替。这
一类密码包括移位密码、替换密码、乘数密码、仿射密码、多项式代替密码和密钥短语密码等。
1) 移位密码是最简单的一类代替密码，将字母表的字母右移k 个位置，并对字母表长度
做模运算， 其形式为：兑(m)=(k+m)=cmodq, 解密变换为： dk(C)=(c-k)=mmodq。其中， q 为
字母表M 的长度， m 既代表字母表M 中的位置，也代表该字母在M 中的位置。c 既代表字母
表C 中的位置，也代表该字母在C 中的位置。凯撒(Caesar) 密码是对英文26 个字母进行移
位代替的密码，其q=26。这种密码之所以称为凯撒密码，是因为凯撒使用过k=3 的这种密
码。使用凯撒密码，若明文为：
M=Caesar cipher is a shift substitution
41
计算机网络安全教程笫4 版
则密文为：
C=Fdvhvdu flskhu Iv d vkliw vxevwlwxwlrq 。
2) 替换密码可对明文字母表进行q 个字符的所有可能置换得到密文字母表。移位密码是
替换密码算法的一个特例。
3) 乘数密码也是一种替换密码，它将每个字母乘以一个密钥k, 即ek(m)=km mod q, 其
中， k 和q 互素，这样字母表中的字母会产生一个复杂的剩余集合；若k 和q 不互素，则会有
一些明文字母被加密成相同的密文字母，且不是所有的字母都会出现在密文字母表中。
4) 替换密码的另一个特例就是仿射密码，其加密的形式为~(m)=(k1m+k2)=c mod q, 其
中， k1 和q 互素。
简单代替密码由千使用从明文到密文的单一映射，所以明文字母的单字母出现频率分布
与密文中相同，可以很容易地通过使用字母频率分析法进行唯密文攻击。
2. 多名或同音代替
该方法与简单代替密码类似，区别在千映射为一对多关系，每个明文字母可以加密成多
个密文字母。同音代替密码比简单代替密码更难破译，尤其是当对字母的赋值个数与字母出现
频率成比例时，这是因为密文符号的相关分布会近似于平的，可以挫败频率分析。若明文字母
的其他统计信息在密文中仍很明显，同音代替密码仍然是可破译的。
3. 多表代替
由千单字母出现的频率分布与密文中相同，因此多表代替密码使用从明文字母到密文字
母的多个映射来隐藏单字母出现的频率分布，每个映射是简单代替密码中的一对一映射。
维吉尼亚(Vigenere) 密码和博福特(Beaufort) 密码均是多表代替密码的实例。多表代替密
码有多个单字母密钥，每一个密钥被用来加密一个明文字母。第一个密钥加密明文的第一个字
母，第二个密钥加密明文的第二个字母……所有密钥用完后，密钥再循环使用。维吉尼亚密码是
1858 年法国密码学家Blaise de Vigenere 所发明，其算法可简述为：设密钥为k, 明文为m, 加密
为C, 则有加密变换以m)=c应”Cu, 其中，萨皿吐imodq。密钥k 可以通过周期性地延长，反复
进行以至无穷。博福特密码是按mod q 减法运算的一种周期代替密码，它的加密变换与维吉尼亚
密码类似，只是密文字母表为英文字母表（若q=26) 逆序排列进行循环右移~+1 次而成。
4. 多字母或多码代替
不同于前面介绍的代替密码都是每次加密一个明文字母，多字母代替密码将明文字符划
分为长度相同的消息单元，称为明文组，对字符块成组进行代替，这样一来使密码分析更加困
难。多字母代替的优点是容易将字母的自然频度隐蔽或均匀化，从而有利千抗击统计分析。
Playfair 密码、Hill 密码等都是这一类型的密码。
3立2 单钥加密算法
单钥密钥体制的加密密钥与解密密钥相同或等价，其加密模式主要有序列密码（也称流
密码）和分组密码两种方式。流密码(Stream Cipher) 是将明文划分成字符（如单个字母）或
其编码的基本单元（如0、1 数字），字符分别与密钥流作用进行加密，解密时以同步产生的同
样的密钥流解密。流密码的强度完全依赖于密钥流序列的随机性和不可预测性，其核心问题是
密钥流生成器的设计，流密码主要应用千政府和军事等要害部门。根据密钥流是否依赖千明文
流，可将流密码分为同步流密码和自同步流密码，目前，同步流密码较为多见。由于自同步流
密码系统一般需要密文反馈，因而使得分析工作复杂化，但其具有抵抗密文搜索攻击和认证功
42
笫3 章信息加密与PKI
能等优点，所以这种流密码也是值得关注的方式。流密码的设计方法有信息论方法、系统论方
法、复杂性理论方法及随机化方法等。
分组密码(Block Cipher) 是将明文消息编码表示后的数字序列x1,x2,···,xi，划分为长为
m 的组x=(Xo, X1, …， Xm-1) ，各组（长为m 的矢噩）分别在密钥k=(k。,k1, …， k口）控制下变换成
等长的输出数字序列Y9Yo, Y1, …， Yn-1) （长为n 的矢噩），其加密函数E: VnXK-Vn, Vn 是n
维矢量空间， K 为密钥空间，如图3-4 所示。在相同密钥条件下，分组密码对长为m 的输入
明文组所实施的变换是等同的，所以只需关注对任一组明文数字的变换规则。这种密码实质上
是字长为m 的数字序列的代替密码。通常取n=m, 若n>m, 则为有数据扩展的分组密码；
若n<m, 则为有数据压缩的分组密码。
密钥炉(ko,k1,…，如） 密钥k=(k0,屈··,k1-1)
密文y=(yo,Y1,…y忙1)
图3-4 分组密码原理框图
围绕单钥密钥体制，密码学工作者已经开发了众多行之有效的单
钥加密算法，并且对基于这些算法的软硬件实现进行了大量的工作，
下面介绍其中的典型代表算法DES 和IDEA。
1. 标准数据加密算法DES
DES 即数据加密标准(Data Encryption Standard)，它于1977
年由美国国家标准局公布，是田M 公司研制的一种对二元数据进
行加密的分组密码，数据分组长度为64bit (8B) ，密文分组长度也
是64bit, 没有数据扩展。密钥长度为64bit, 其中有效密钥长度为
56bit，其余8bit 为奇偶校验。DES 的整个体制是公开的，系统的安
全性主要依赖千密钥的保密，其算法主要由初始置换IP 、16 轮迭
代的乘积变换、逆初始置换IP一I' 以及16 个子密钥产生器构成，
如图3-5 所示。
下面介绍各个组成部分的功能。设明文m 是0 和1 组成的长
度为64bit 的符号串，元为经初始置换的置换码组，密钥k 也为
64bit 长度的0、1 字符串。令m=m血2…ID64, k=k1k2…知，其中
皿,蚐=0 或1, i=l, 2, …， 64。这里，密钥k 中第8、16、24、32、40、48、56、64 位共8 位是
奇偶校验位，在算法中不起作用。DES 的加密过程可表示为：
DES(m)=IP一1 •T16 ·T1s …·T2 •T1 ·IP(m) 。
(l) 初始置换IP 及其逆初始置换1P一1
初始置换IP 是将64bit 明文的位置进行置换，得到一个乱序的64bit 明文组，而后分为左
右两个32bit 的分段，以Lo 和Ro 表示，为随后进行的乘积变换做准备。逆初始置换1P一1 是将
16 轮迭代后给出的64bit 组进行置换，得到输出的密文组。初始置换和逆初始置换在密码意义
中作用不大，它们主要用于打乱输入明文码字的划分关系，并将分布在明文不同位置的8 位校
验位作为初始置换输出的一个字节。
如图3-6 所示， 64bit 下标序号依次为1~64 的明文输入，经过初始置换后，其下标依次
输人
64bit明文数据
64bit密文数据
标准数据加密算法
图3-5 DES 算法框图
43
计算机网络安全教程笫4 版
为58, 50, …, 15, 7, 即m ➔ IP ➔ 巾置换后，血＝ m58 ，觅＝ m50, …,
凸＝ m58m50m42 …m2画画。对于逆置换IP一1 来说，满足性质IP·IP一I =IP一1·1P=I,
m.-IP一1 一m 置换后，有m=ll140卧由48 …面冲s1ffi2s 0
元64=m1,
经过
58
60
62
IP:
64
57
59
61
63
50
52
54
56
49
5 1
53
55
42
44
46
48
41
43
4S
47
34
36
38
40
33
3S
37
39
1820222417192123
26笃303225272931
图3-6
10
12
14
16
9
II
13
IS
24681357
40 8 48
39 7 47
38 6 46
IP 一1: 37 5 45
36 4 44
35 3 43
34 2 42
33 I 41
161514131211109
56
55
54
53
52
51
50
49
24
23
22
21
20
19
18
17
64
63
62
61
60
S9
58
57
32
31
30
29
28
27
26
2S
初始置换和逆初始置换
(2) 乘积变换
乘积变换是DES 算法的核心部分，主要完成DES 的迭代运算过程，它将经过IP 置换后
的数据分成32bit 的左右两组，在迭代过程中左右交换位置。每次迭代时只对右边的32bit 进
行一系列的加密变换，在此轮迭代快结束时，将左边的32bit 与右边得到的32bit 逐位模2 运
算，作为下一轮迭代时右边的分段，并将原来右边未经变换的段直接送到左边的寄存器中作为
下一轮迭代时左边的段，如图3-7 所示。
ki
k2
ki
-------二-：-：＝~＿＿--＿＿- ＿- - L. R.
其中的第i次迭代运算
R1tFLis$f(R1s.k16)
图3-7 DES 迭代过程
44
第3 章信息加密与PKI
图3-7 的右侧为DES 第i 次迭代运算的操作，这里i=l, 2, …,16, 4-, 和RH 分别为第
i-1 次迭代结果的左右两个部分，均为32bit。易知巨＝Rr1, R严4-1 EBf (Ri一,, kj), Lo 和Ro 是
输入明文经过初始置换1P 后的运算结果，＠是按位模2 相加运算符。ki 是由64bit 密钥产生的
子密钥，其长度为48bit, 子密钥的产生过程如图3-8 所示，它将64bit 初始密钥经过置换选择
PCI 、循环移位置换、置换选择PC2 得到迭代加密用的子密钥ki。具体过程为：将64bit 中的
56 位有效密钥位送入置换选择PCl 、经过坐标置换后分成两组，每级为28bit, 分别送入C 寄
存器和D 寄存器中，在每次迭代运算中， C 和D 寄存器分别将所存数据进行左循环移位置
换，置换选择PC2 将C 寄存器中第9 、18 、22、25 位和D 寄存器中第7、9 、15 、26 位删
去，并将其余数字置换位置后送出48bit 数字作为第i 次迭代时所用的子密钥ki, 置换选择
PCI 、PC2, 以及左循环移位置换的次数如图3-8 所示。
去掉第8、16、32、48 、S6和64位共6个校验位
密钥(56bit)
置换选择PCI
Ci (28bit) I I D1 (28bit)
循环左移i+l位
57 49
1 58
10 2
19 11
63 ss
7 62
14 6
21 13
41 33
so 42
59 51
3 60
47 39
54 46
61 53
5 28
PCI PC2
25 17 9 14 17 II 24 I
34 26 18 3 28 IS 6 21
43 35 27 23 19 12 4 26
52 44 36 16 7 27 20 13
31 23 15 41 52 31 37 47
38 30 22 30 40 51 45 33
45 37 29 44 49 39 56 34
20 12 4 心42 so 36 29
循环左移i+l位 左移位次数
置换选择PC2
迭代顺序I 12 3 4 5 6 7 8 9 1011 12 13 14 15 16
左移位数1 122222212 2 2 2 2 2 1
k1
图3-8 DES 迭代过程子密钥的产生及置换选择和左移位次数
(3) 选择扩展运算、选择压缩运算和置换运算
5
10
8
2
55
48
53
52
由图3-7 可知， DES 的关键在于们＼－1， ki)的功能， f 是将32bit 的输入转化为32bit 的输
出，其中需要进行选择扩展运算E、密钥加密运算和选择压缩运算s, 以及置换运算P, 具体
转化过程如图3-9 所示。
选择扩展运算E 是将输入的32bit ~-1 扩展成48bit 的愉出。选择压缩运算S 是将密钥加密运算
得到的48bit 数据自左至右分成8 组，每组6 个bit, 而后并行送入8 个S 盒中，每个S 盒为一非线
性代换网络，有4 个输出。这样， 8 个S 盒输出的32bit 数据可盼赶行坐标置换运算P。这几种运算
作为DES 加密过程的重要组成部分涉及的计算比较复杂，其详细说明可参阅专业论著。
(4) DES 安全性分析及其变形
DES 的出现是密码学上的一个创举，由千其公开了密码体制及其设计细节，因此其安全
性完全依赖于其所用的密钥，关千DES 的安全问题，学术界有过激烈的争论，普遍的看法是
其密钥仅有56bit 有点偏短。Diffie 和Hellman 曾设想花千万美元来制造一台专用机，希望一
天内找到DES 的一个密钥，其基本思想是穷举，即强行攻击。此外， 1990 年Eli Biham 和Adi
Shamir 提出用“微分分析法”对DES 进行攻击，但其也只有理论上的价值。后来，有人提出
一种明文攻击法—-“线性逼近法”，它需要243=4.398X 1012 对明文－密文对，在这样强的要
求条件下，要10 多台工作站协同工作数天才能完成攻击。总之，随着各种针对DES 新攻击手
45
计算机网络安全教程笫4 版
法的不断出现， DES 己感觉到面临的实际威胁。尽管如此，自DES 正式成为美国标准以来，
已有许多公司设计并推广了实现DES 算法的产品，有的设计专用LSI 器件或芯片，有的用现
成微处理器实现，有的只限千实现DES 算法，有的则可运行各种工作模式。
R1-1 (32bit)
选择扩展运算E
置换运算P
1 _../
f (Rt一h k1)
32bit
图3-9 DES 的f(Ri_1,k1) 转化过程
为了解决DES 存在的安全问题，同时也为了适应不同情况的需求，人们设计了多种应用
DES 的方式，即DES 变形，主要有独立子密钥方式、DESX、CRYPT (3) 、S 盒可变的
DES 、RDES 、S0DESi 、xDESi, 以及GDES 等，这里不再赘述。
2．国际数据加密算法IDEA
近年来新的分组加密算法不断出现， IDEA 就是其中的杰出代表。IDEA 是International
Data Encryption Algorithm 的缩写，即国际数据加密算法。它是根据中国学者朱学嘉博士与著
名密码学家James Massey 于1990 年联合提出的建议标准算法PES (Proposed Encryption
Standard) 改进而来的。它的明文与密文块都是64bit, 密钥长度为128bit, 作为单钥体制的密
码，其加密与解密过程相似，只是密钥存在差异， IDEA 无论是采用软件还是硬件实现都比较
容易，而且加解密的速度很快。IDEA 算法的加密过程如图3-10 所示。
64bit 的数据块分成4 个子块，每一子块为16bit, 令这4 个子块为X1 、X2 、X3 和X4'
作为迭代第1 轮的输入，全部共8 轮迭代运算。每轮迭代都是4 个子块彼此间以及16bit 的子
密钥进行异或mod2“ 做加法运算， mod(i16 +1) 做乘法运算。任何一轮迭代第2 和第3 子块
互换，每一轮迭代运算步骤如下。
1) 丸和第1 个子密钥块做乘法运算。
2) X2 和第2 个子密钥块做加法运算。
3) X3 和第3 个子密钥块做加法运算。
4) 及和第4 个子密钥块做乘法运算。
5) 1) 和3) 的结果做异或运算。
6) 2) 和4) 的结果做异或运算。
7) 5) 的结果与第5 个子密钥块做乘法运算。
46
第3 章信息加密与PKI
8) 6) 和7) 的结果做加法运算。
9) 8) 的结果与第6 个子密钥块做乘法运算。
10) 7) 和9) 的结果做加法运算。
11) 1) 和9) 的结果做异或运算。
12) 3) 和9) 的结果做异或运算。
13) 2) 和10) 的结果做异或运算。
14) 4) 和10) 的结果做异或运算。
X1 X2
田表示16bit的整数做mod2“的加法运算
＠表示16bit子块间诸位做异或运算
。表示16bit的整数做mod(2'6+1)的乘法运算
图3-10 IDEA 加密算法原理框图
X3 x4
结果输出为11) 、13)、12)、14)，除最后一轮外，第2 和第3 子块交换。第8 轮结束
后，最后输出变换如下。
1) X1 和第1 个子密钥块做乘法运算。
2) X2 和第2 个子密钥块做加法运算。
3) X3 和第3 个子密钥块做加法运算。
4) 及和第4 个子密钥块做乘法运算。
子密钥块的产生过程也比较简单。子密钥块每轮输出6 个，最后输出变换4 个，共52
个。首先将128bit 的密钥分成8 个子密钥，每个子密钥16bit。这8 个子密钥正好是第1 轮的
6 个及第2 轮的前2 个。再将密钥左旋转25bit, 再将它分成8 个子密钥。前4 个是第2 轮的
子密钥，后4 个是第3 轮的子密钥。将密钥再向左旋转25bit, 产生后8 个子密钥。以此类
47
计算机网络安全教程笫4 版
推，直至算法结束。
解密密钥和加密密钥的对应关系如下。
轮次加密子密钥块
l234 却Z归l)动Z阳l)动z~l)
犁Z伊Z}2)z}2)犁Z;2)
zpz伊Z归3)砰Z}3)z;3)
犁Z沪4)犁Z归4)动z~4)
解密子密钥块
（加）一l_z~) ＿卯(Z俨）一1动Z;8)
(Zi8) ）一1-Zi8) 一动（Z；8))一1 弈Z;7)
（加）一1 _zi7) ＿叩(Zf))一1 动Z;6)
(z~6)rl -z炉－ Z｝6)(Z俨）一1 动Z;5)
(Zf沪－ Z伊－ Z俨(Z;5) )一1 动Z;4)
(Z\4))一I -zi4) －犁（z~4) ）一1动Z;3)
(Z俨）一l -Zi3) 一动（Z？沪Z沪2)z;2)
(Z尸）一1 _zi2) ＿哗（z~2) ）一1 动Z;l)
z(5)z(5)z(5)z(5)z(5)z(5)
1 2 3 4 5 6
6 Z钤Z陀哗Z炉6)犁Z;6)
z(7)z(7)z(7)z(7)z(7)z(7)
l 2 3 4 5 6
8 Z(8)z(8)z(8)z(8)z(8)z(8)
1 2 3 4 5 6
输出变换z~9>zr>z~9>z~) (ZP))一1-Z驴－ Z炉(Z沪）一1
这里矿表示Z mod (i6+1) 乘法的逆，即z0z-1=1 。-Z 表示Z mod i16 加法运算的
逆，即ZEB (-Z)=0 。
IDEA 的密钥长为128bit, 若采用穷搜索进行破译，则需要进行i28=34028X 1038 次尝
试，这将是用同样方法对付DES 的272=4.7X 1021 倍工作量，有关学者进行分析表明IDEA 对
千线性和差分攻击是安全的。此外，将IDEA 的字长由16bit 加长为32bit, 密钥相应长为
256bit，采用232 模加， 232+1 模乘，可进一步强化IDEA 的安全性能。
3. 单钥算法性能分析
前面重点介绍了单钥密码体制的典型代表DES 和IDEA 算法， 类似的算法还有SA庄R
K-64 (Secure And Fast Encryption Routine) 、GOST、RC-4、RC-5 、Blowfish 和CAST-128 等。
为了提高单钥密码的安全性，人们还将分组密码算法通过组合以得到新的分组密码算法，但这
种组合密码的安全性必须经仔细检验后才能付诸实用，如二重DES 加密、三重DES 加密等。
各种加密算法的具体实现互不相同，其性能也存在较大差异，表3-1 对单钥密码体制的
主要算法在总体实现、速度、安全性能和改进措施等方面进行了比较，并基千比较结果给出了
各算法合适的应用场合。
名称实现方式运算速度安全性改进措施应用场合
DES 心～56bit 密钥一般
完全依赖千密钥， 易受穷举双重／ 二重
适用千硬件实现
攻击DES 、AES
加长字长为
IDEA
128bit 密钥、8 轮
较慢
军事级，可抗差值分析和相关32bit 、密钥为适用于ASIC
迭代分析，没有DES 意义下的弱密钥256bit, 采用产模设计
加、i2+l 模乘
256bit 密钥、32
以长密钥S 盒S 盒可随机秘
GOST 较快军事级代换盒、加大迭密选择，便千软
轮迭代代轮数件实现
适合固定密钥
Blow酗
巧6~448bit 密钥、最快
军亭级、可通过改变密钥长度场合，不适合常
16 轮迭代调整安全性换密钥场合和智
能卡
RC4 密钥长度可变
快D邸10 对差分攻击和线性攻击具免疫能密钥长度放宽算法简单，易
倍力，顽部旺吓如毗生到64bit 千编程实现
表3-1 单钥算法性能比较表
48
笫3 章信息加密与PKI
（续）
名称实现方式运算速度安全性改进措施应用场合
速度可根6 轮以上时即可抗线性攻击，
RC-S
密钥长度和迭代据3 个参数通过调整字长、密钥长度和迭代引入数据相倚适用千不同字
轮数均可变的取值进行轮数可以在安全性和速度上取得旋转长的微处理器
选择折中
密钥长度可变、
强度取决于S 盒、抗线性和差
增加密钥长、形适用千PC 和CAST-128 较快分攻击，具有SAC 和BIC, 没有
16 轮迭代
弱密钥和半弱密钥等特性
成CAST256 UNIX 工作站
3上3 双钥加密算法
双钥密码体制的加密密钥和解密密钥不相同，它们的值不等，属性也不同，一个是可公
开的公钥，另一个则是需要保密的私钥。双钥密码体制的特点是加密能力和解密能力是分开
的，即加密与解密的密钥不同，很难由一个推出另一个。其应用模式有两种，一是多个用户
用公钥加密的消息可由一个用户用私钥解读，二是一个用户用私钥加密的消息可被多个用户
用公钥解读。前者可用千在公共网络中实现保密通信，后者则可用于认证系统对消息进行数
字签名。
双钥密码体制大大简化了复杂的密钥分配管理问题，但公钥算法要比私钥算法慢得多。
因此，在实际通信中，双钥密码体制主要用于认证（如数字签名、身份识别）和密钥管理等，
而消息加密仍采用私钥密码体制。
1. RSA 算法
RSA 体制是由R L. Rivest、A. Shamir 和L.Adleman 共同提出的，它既可用千加密，也可
用于数字签名。国际标准化组织ISO 、ITU 及SWIFT 等均已接受RSA 体制作为标准。在
Internet 中所采用的PGP (Pretty Good Privacy) ．也将RSA 作为传送会话密钥和数字签名的标
准算法。RSA 算法的安全性建立在数论中“大数分解和素数检测” 的理论基础上， 能够抵抗
到目前为止已知的绝大多数密码攻击。
(1) 大数分解
双钥密码体制算法按由公钥推算出密钥的途径可分为两类： 一类是基千素数因子分解问
题（如RSA 算法），其安全性基千100 位十进制数以上的所谓“大数”的素数因子分解难题，
这是一个至今尚无有效快速算法的数学难题：另一类是基千离散对数问题（如ElGamal 算
法），其安全性基于计算离散对数的困难性，离散对数问题是指模指数运算的逆问题，即找出
一个数的离散对数。一般地，计算离散对数是非常困难的。
(2) RSA 算法表述
假定用户A 要传送消息m 给用户B, 则RSA 算法的加／解密过程如下。
l) 首先用户B 产生两个大素数p 和q (p 、q 是保密的）。
2) B 计算n=pq 和cp(n)= (p-l)(q -1) 句(n) 是保密的）。
3) B 选择一个随机数e (0 < e < cp(n) ），使得（e,cp(n))= 1 ，即e 和叭互素。
4) B 通过计算得出d, 使得demodcp(n)= 1 （即在与n 互素的数中选取与<p(n)互素的数，
可以通过Euclidean 算法得出。d 是B 自留且保密的，用作解密密钥）。
5) B 将n 及e 作为公钥公开。
6) 用户A 通过公开渠道查到n 和e。
7) 对m 施行加密变换，即E8(m)= m0 modn = o 。
49
计算机网络安全教程第4 版
8) 用户B 收到密文c 后，施行解密变换。
D8(c) =cd modn = (me modnt modn = med modn = mmodn 。
下面举一个简单的实例来说明这个过程：令26 个英文字母对应千0~25 的整数，即
a--+00, b-+0 I, …, y-+24, z-+25 。设m = public, 则m 的十进制数编码为： m = 15 20 01 11
08 02。设n = 3xl I =33, p =3, q =11, cp(n) = 2xl0 = 20 。取e =3, 则d =7 。B 将n = 33 和
e=3 公开，保留d=7。
A 查到n 和e 后，将消息m 加密。
EB(p) = 153 = 9 mod 33,
E曲）＝ 203= 14mod33,
EB(b) = !3=1 mod 33,
EB(l) = 113= 11 mod 33,
马（i) = 83 = 17 mod 33,
EB(c) = i3 = 8 mod 33,
则c ＝ EB(m)=091401 ll 1708, 它对应的密文为c=joblri。
当B 接到密文c 后施行解密变换。
邸）＝ 097= 15 mod 33, 即明文p,
乌(o) = 147 = 20 mod 33, 即明文U,
压(b)=017= 01 mod 33 ，即明文b,
压(1) =117 = 11 mod 33, 即明文1,
压(r) = 177 = 08 mod 33, 即明文i,
压(i) = 08 7 = 02 mod 33, 即明文c。
(3) RSA 安全性分析
在理论上， RSA 的安全性取决千模n 分解的困难性，但数学上至今还未证明分解模就是攻击
RSA 的最佳方法，也未证明分解大整数就是NP 问题。尽管如此，人们还是从消息破译、密钥空
间选择等角度提出了针对RSA 的其他攻击方法， 如迭代攻击法、选择明文攻击法、公用模工文击
法、1珈密指数攻击法和定时攻击法等，但其攻击成功的概率微乎其微。有关RSA 安全性的全面
评述可参阅Kaliski 和Robshaw 于1995 年发表的论文The secure use of RSA。
2. ElGamal 算法
RSA 算法是基于素数因子分解的双钥密码， EIGamal 算法则是基于离散对数问题的另一
种类型的双钥密钥，它既可用于加密，也可用于签名。
(I) ElGamal 算法方案
令zP 是一个有p 个元素的有限域p 是素数，令g 是z; (zP 中除去0 元素）中的一个本
原元或其生成元。明文集m 为Z; ，密文集e 为z; xz; 。
么洘月为：选定p (g<p 的生成元），计算公钥p 三旷modp;
私钥为： a.<p 。
(2) EIGamal 加解密及其安全性
选择随机数kez户，且(k,p-1)=1 ，计算： y1 =gkmodp （随机数K 被加密），
y2 =MPk modp, 这里， M 是发送明文组。密文则由YI 和Y2 级连构成，即密文C=Y1 IIY2 o
这种加密方式的特点是，密文由明文和所选随机数K 来决定，因而是非确定性加密，一般称之
50
笫3 章信息加密与PK.I
为随机化加密，对同一明文由千不同时刻的随机数K 不同而给出不同的密文，这样做的代价是
使数据扩展一倍。
在收到密文组C 后， EIGamal 的解密是通过下列计算得到明文的。
M=
Y2 _M旷Mgak
yf = gka = gka
modp
g
例如，选择p=2579, g=2, a.= 765, 计算出~ = g 165 mod 2579 = 949 。若明文组为M=1299,
现在选择随机数k=853, 可算出y1 = 2853 mod2579 = 435 及Y2 三1299x94少SJ mod2579 = 2396 。密
文C= (435,2396) 。解密时由C 可算出消息组M = 2396/(435)765 mod2579 = 1299 。
ElGamal 算法的安全性是基千Z；中有限群上的离散对数的困难性。研究表明， mod p 生成
的离散对数密码可能存在陷门，这会造成有些“弱“素数p 下的离散对数较容易求解，但密码
学家也发现可以较容易地找到这类陷门，以免选用可能会产生脆弱性的这些素数。
3. 双钥算法性能分析
双钥密钥体制因其密钥管理和分配较为简单，进而可以方便地用千数字签名和认证，尽
管其算法都较为复杂、运算量大，但仍不失为一种非常有前途的加密体制，它的出现是密码学
发展史上的划时代事件。前面分析了双钥密码体制的典型代表RSA 和ElGamal 算法，类似的
算法还有LUC 密码、Rabin 密码及DSA 密码等。
对于RSA 体制，可以将其推广为有多个密钥的双钥体制，即在多个密钥中选用一部分密
钥作为加密密钥，而另一些作为解密密钥。同样地， RSA 还可以推广为多签名体制，例如有
k1 、K2 和k3 共3 个密钥，可将k1 作为A 的签名私密钥， k2 作为B 的签名私密钥， k3 作为么吁F
的验证签名用密钥，实现这种多签名体制需要一个可信赖中心对A 和B 分配秘密签名密钥。
近年来，人们还提出了一些新的双钥密钥体制，如隐含域方程和多项式同构等，但有的方案并
没有达到其宣称的安全水平。
表3-2 对双钥密码体制的主要算法在总体实现、速度、安全性能和改进措施等方面进行
了比较，并基于比较结果给出了各算法合适的应用场合。
表3-2 双钥算法性能比较表
名称运算速度安全性改进措施适用场合
RSA
很慢， RSA 最快时
安全性完全依赖大数分解， 产
改用2048bit 长度的
也比D邸慢100 倍
生密钥麻烦， n 至少要为600bit 只用于少阳邸蜘密
以上
密钥
ElGamal 较慢
主要基于Z．p 中的有限群上的将EIGamal 方案推适用千加密密钥，或
离散对数求解的困难性
广到女上的单元群单重或多重签名
LUC 较慢
由求d 和P 的难度决定， 比采用各种置换多项适用于少量数据加密
RSA 难破译式取代指数运算场合
R吐血最快
其安全性相当千分解大整数， 用MJ 代替M2，即
可用千签名系统
在选择明文攻击下不安全williams 体制
DSA 比RSA 慢，有预基于整数有限域离散对数难
密钥加长到Sl2~ 可用刊仪字签名中，以
计算时远快于RSA 题，安全性与RSA 接近
1024 中可被64 除尽及电子邮件、电了转账等
的数认证系统中
3.2.4 同态加密算法
随着互联网的发展和云计算概念的诞生，以及人们在密文搜索、电子投票、移动代码和
多方计算等方面的需求日益增加，同态加密(Homomorphic Encryption) 变得更加重要。同态
51
计算机网络安全教程笫4 版
加密是一类具有特殊自然属性的加密方法，此概念是Rivest 等人在20 世纪70 年代首先提出
的，与一般加密算法相比，同态加密除了能实现基本的加密操作之外，还能实现密文间的多种
计算功能，即先计算后解密可等价千先解密后计算。这个特性对千保护信息的安全具有重要意
义，利用同态加密技术可以先对多个密文进行计算之后再解密，而不必对每一个密文解密而花
费高昂的计算代价；利用同态加密技术可以实现无密钥方对密文的计算，密文计算无须经过密
钥方，既可以减少通信代价，又可以转移计算任务，由此可平衡各方的计算代价；利用同态加
密技术可以实现让解密方只能获知最后的结果，而无法获得每一个密文的消息，从而可以提高
信息的安全性。正是由千同态加密技术在计算复杂性、通信复杂性与安全性上的优势，越来越
多的研究力量投入到其理论和应用的探索中。近年来，云计算受到广泛关注，而它在实现中~
到的问题之一即是如何保证数据的私密性，同态加密可以在一定程度上解决这个技术难题。
本质上，同态加密是指这样一种加密函数，对明文进行环上的加法和乘法运算再加密，
与加密后对密文进行相应的运算，结果是等价的。由千这个良好的性质，人们可以委托第三方
对数据进行处理而不泄露信息。具有同态性质的加密函数是指两个明文a、b 满足Dec(En(a)®
En(b))=affib 的加密函数，其中En 是加密运算， Dec 是解密运算，＠、0分别对应明文和密文
域上的运算。当＠代表加法时，称该加密为加同态加密；当＠代表乘法时，称该加密为乘同
态加密。
全同态加密是指同时满足加同态和乘同态性质，可以进行任意多次加和乘运算的加密函
数。用数学公式来表达，即Dec (f(En （厮）， En(m2), … ,En(亚)）)=f(m1, m2, … , mlc), 或
写成： f(En(m1), En（亚），…， En(亚))=En (f (m1, m2, …，血）），如果f是任意函数，称为全
同态加密。
直到2009 年， IBM 的研究人员Gentry 首次设计出一个真正的全同态加密体制，即可以
在不解密的条件下对加密数据进行任何可以在明文上进行的运算，使得对加密信息仍能进行深
入和无限的分析，而不会影响其保密性。经过这一突破，存储他人机密电子数据的服务提供商
就能受用户委托来充分分析数据，不用频繁地与用户交互，也不必看到任何隐私数据。同态加
密技术允许公司将敏感的信息储存在远程服务器里，既避免了从当地的主机端发生泄密，又依
然保证了信息的使用和搜索；用户也得以使用搜索引擎进行查询并获取结果，而不用担心搜索
引擎会留下自己的查询记录。为提高全同态加密的效率，密码学界对其研究与探索仍在不断推
进，这将使得全同态加密越来越向实用化靠近。
3.3 信息加密技术应用
在网络安全领域，网络数据加密是解决通信网中信息安全的有效方法。有关密码算法的
知识已在本章前面内容中加以介绍，这里主要讨论通信网中对数据进行加密的应用方式。常见
的网络数据加密应用主要有链路加密、结点加密、端到端加密和同态加密应用等。
3.3.1 链路加密
链路加密（又称在线加密）是对网络中两个相邻结点之间传输的数据进行加密保护，如
图3-11 所示。对于链路加密，所有消息在被传输之前进行加密，在每一个结点对接收到的消
息进行解密后，先使用下一个链路的密钥对消息进行加密，再进行传输。在到达目的地之前，
52
笫3 章信息加密与PK.I
一条消息可能要经过多条通信链路的传输。
结点0 结点1 结点2
图3-11 链路加密
结点n
由千在每一个中间传输结点消息均被解密后重新进行加密，因此包括路由信息在内的链
路上的所有数据均以密文形式出现。这样，链路加密就掩盖了被传输消息的源点与终点。由千
填充技术的使用，以及填充字符在不需要传输数据的情况下就可以进行加密，使得消息的频率
和长度特性得以掩盖，从而可以防止对通信业务进行分析。
尽管链路加密在计算机网络环境中广泛使用，但也存在一些问题。链路加密通常用在点
对点的同步或异步线路上，它要求先对在链路两端的加密设备进行同步，然后使用一种链模式
对链路上传输的数据进行加密，这就给网络的性能和可管理性带来了副作用。在线路信号连通
性不好的海外或卫星网络中，链路上的加密设备需要频繁地进行同步，带来的后果是数据丢失
或重传。因此，即使一小部分数据需要进行加密，也会使得所有传输数据需要重新加密。
在一个网络结点，链路加密仅在通信链路上提供安全性，消息以明文形式存在，因此所
有结点在物理上必须是安全的，否则就会泄露明文内容。在传统的单钥加密算法中，解密密钥
与加密密钥是相同的，该密钥必须被秘密保存，并按一定规则进行变化。这样，密钥分配在链
路加密系统中就成了一个问题，每一个结点必须存储与其相连接的所有链路的加密密钥，这就
需要对密钥进行物理传送或者建立专用网络设施。网络结点地理分布的广阔性使得这一过程变
得复杂，同时增加了密钥连续分配时的代价。
3.3.2 结点加密
结点加密是指在信息传输路过的结点处进行解密和加密。尽管结点加密能给网络数据提
供较高的安全性，但它在操作方式上与链路加密是类似的，两者均在通信链路上为传输的消息
提供安全性，都在中间结点先对消息进行解密，然后进行加密。因为要对所有传输的数据进行
加密，所以加密过程对用户是透明的。与链路加密不同的是，结点加密不允许消息在网络结点
以明文形式存在，它先把收到的消息进行解密，然后采用另一个不同的密钥进行加密，这一过
程是在结点上的一个安全模块中进行的。
结点加密要求报头和路由信息以明文形式传输，以便中间结点能得到如何处理消息的信
息，边方法对于防止攻击者分析通信业务是脆弱的。
3.3.3 端到端加密
端到端加密是指对一对用户之间的数据连续地提供保护，如图3-12 所示。端到端加密允
许数据在从源点到终点的传输过程中始终以密文形式存在。采用端到端加密（又称脱线加密或
包加密），消息在被传输时到达终点之前不进行解密，因为消息在整个传输过程中均受到保
护，所以即使有结点被损坏也不会使消息泄露。
端到端加密系统的价格便宜，且与链路加密和结点加密相比更可靠，更容易设计、实现
和维护。端到端加密还避免了其他加密系统所固有的同步问题，因为每个报文包均是独立被加
53
计算机网络安全教程第4 版
密的，所以一个报文包所发生的传输错误不会影响后续的报文包。此外，从用户对安全需求的
直觉上讲，端到端加密更自然。
结点0 结点1 结点2 结点n
图3-12 端到端加密
端到端加密系统通常不允许对消息目的地址进行加密，这是因为每一个消息所经过的结
点都要用此地址来确定如何传输消息。由于这种加密方法不能掩盖被传输消息的源点与终点，
因此它对千防止攻击者分析通信业务也是脆弱的。
3立4 同态加密应用
1. 应用千云计算
云存储安全是云计算领域的重要安全问题之一，为解决数据隐私保护的问题，常见的方
法是由用户对数据进行加密，把加密后的密文信息存储在服务器端。但当用户需要服务器提供
数据搜索、分析和处理等功能时，传统加密方案难以实现，同态加密为之提供了实现的可能。
(1) 云计算中的加密数据检索
随着云计算技术的广泛应用，服务器端存储的加密数据必将成爆炸式增加，对加密数据
的检索成为一个迫切需要解决的问题。现有的加密数据检索算法包括线性搜索、公钥搜索和安
全索引等，这些算法可以快速地检索出所需信息，但是只适用千小规模数据的检索，而且代价
很高。基千全同态加密技术的数据检索方法可以直接对加密的数据进行检索，不但能保证被检
索的数据不被统计分析，还能对被检索的数据进行简单的运算，同时保持对应的明文顺序。
数据检索有多种方法，如向量空间模型等。首先对文档进行分词和词干化，即从文档中
抽取出能表征文档主要内容特征和形式特征的检索词，以形成文档的向量表示，然后将得到的
检索词和待检索文档进行加密，并储存至云服务器。采用了全同态加密方案后，当服务器需要
检索加密文档时，可直接提交加密后的检索词，此时每个文档都可根据所提交的关键词进行权
重向量表示，对用全同态加密后的词频和倒排文档频率进行操作可以得到权重。该权重反映了
关键词与文档的相关度，因而可以根据大小进行排序，筛选出用户需要的文档，用户得到加密
文档后，用私钥对文档解密即可得到原始文档。
(2) 云计算中的加密数据处理
云计算中的加密数据处理与数据检索的思路类似，首先对待处理的关键数据进行加密和
特殊标记，以与普通加密数据区分开来，然后再上传到服务器，服务器会直接对密文数据进行
操作来完成用户的需求，并将处理后的密文返回给用户。
在医疗应用中，人们提出了一种医疗记录云存储系统（病人控制加密），医疗服务提供者
先对病人的医疗记录进行加密，然后传输到云存储系统，病人通过与某个服务提供者分享私
钥，共享其医疗记录，然而，该系统只提供云搜索服务（关键词匹配或者其他的一些搜索方
法），并没有提供云计算服务。利用全同态加密体制，该系统可以对加密的医疗记录进行计
算，为病人提供云计算服务。随着科技的发展，基于无线局域网的监视器或者其他设备将能够
54
笫3 章信息加密与PKI
代替病人连续不断地向云端服务器传输加密数据。利用全同态加密体制，云端服务器可以对加
密数据进行计算，并根据具体的计算结果，返回给病人一些警告或者建议等。在这个方案中，
可能需要计算平均值、标准差和最小二乘法等统计函数，加密输入可能包括血压、心率等实时
信息，以及体重、性别等病人的基本信息，而加密用的函数则可以公开。
在金融行业中，全同态加密也有着潜在的应用，一些数据和进行加密的函数是需要保密
的，例如公司的数据、股票价格、绩效和存货清单等信息都与投资决策有关，是制定交易策略
的关键信息。全同态加密体制可以使一些函数能够被秘密地计算，用户可以将函数的加密形式
和敏感数据的密文分别上传到云端服务器（或许它们分别来自不同的用户）：第三方的管理者
可利用这些函数的加密形式对加密数据进行处理，在处理完成后，云端服务器把处理的结果以
密文的形式发送给用户，用户解密后则可得到处理后的敏感数据。
2. 应用千电子投票
电子投票在计票的快捷准确、人力和开支的节省，以及投票的便利性等方面有着传统投
票方式无法企及的优越性，而设计安全的电子选举系统是全同态加密的一个典型应用。这里，
以一个简单的电子选举方案为例进行说明。若有同态函数Enck(x什X2)=Enck(x1)X Enck(x2)，选
民将自己的选票进行加密Ci=Enck(Mi)，其中M乒{O, 1} ；投票中心收集同态加密后的选民选
票Cl；投票中心基于全同态加密方案的同态性质对加密后的选票G 进行计票c=C心EIX … X
g，得到经过同态加密后的选举结果C=Enck(M1+M计…＋Mn): 只有拥有解密密钥的某个可信
机构才能够对加密后的选举结果进行解密，公布选举结果。在上述过程中，选票收集与计票完
全对加密后的选票数据进行操作，不需要使用任何解密密钥，因此，任何一个主体或机构都可
以完成计票员的职责，无论其是否可信。
3. 应用千数字水印
数字水印技术是指用信号处理的方法在数字化的多媒体数据中嵌入隐蔽的标记， 这种标
记通常是不可见的，只有通过专用的检测器或阅读器才能提取，如何应对复杂网络环境下数据
隐藏与数字水印系统的安全挑战，是目前迫切需要解决的问题。针对数字水印的一种主要的安
全性攻击手段是非授权检测攻击，即攻击者在未经授权的情况下对含有水印的载体进行检测，
以确定水印是否存在，进而猜测或破译水印的含义， 甚至去除载体中的水印并嵌入一个伪造的
水印。将全同态加密技术应用千数字水印可以有效地抵抗这种攻击。首先利用全同态加密体制
对水印信号与原始载体进行加密，然后将加密后的水印嵌入到原始载体中，在用户检测水印之
前，必须对含有水印的载体进行同态解密，从而保证解密后的水印信号与含水印的载体之间没
有明显的相关性，在解密含水印的载体之后，可以通过计算解密后的载体与水印信号之间的相
关度，判断水印的存在性，进而提取水印。
3.3.5 其他应用
除上述应用之外，加密技术还在电子商务、移动通信和VPN 等其他领域发挥着作用，这
里就以虚拟专用网VPN (Vntual Private Network) 为例来说明远程访问中的加密应用。
当前，越来越多的公司走向国际化，一个公司可能在多个国家或地区驻有办事机构或销
售中心，每一个机构都有自己的局域网LAN (Local Area Network) ，为将这些分布在不同地域
的LAN 连接在一起构成一个公司广域网，可以在Internet 环境中构建VPN 。VPN 是专用网络
在公共网络如Internet 上的扩展，它通过运用私有隧道技术在公共网络上虚拟一条点到点的专
线来达到数据安全传输的目的。VPN 属于远程访问技术，为保证利用公网链路架设私有网络
55
计算机网络安全教程第4 版
时数据的安全， VPN 服务器和客户机之间的通信数据都进行了加密处理。有了数据加密，就
可认为数据是在一条专用的数据链路上进行安全传输，如同架设了一个专用网络，因此VPN
实质上就是利用加密技术在公网上封装出一个数据通信隧道。有了VPN 技术，用户无论是在
外地出差还是在家中办公，只要能上互联网就能利用VPN 非常方便地访问公司的内网资源。
VPN 主要采用隧道(Tunneling）、加解密、密钥管理，以及用户与设备身份认证等技术来
保证用户数据的安全。用户依托VPN 传输数据过程中，数据离开发送者所在的局域网时，将
首先被用户端连接到互联网上的路由器进行硬件加密，而后数据在互联网上以加密形式进行传
送，当到达目的LAN 路由器时，该路由器将对数据进行解密，这样目的LAN 中的用户就可
以看到正确的数据信息。
3.4 认证技术
如前所述，数据加密是密码技术应用的重要领域，而在认证技术中密码技术也同样作用明
显，但两者的应用目的不同。加密是为了隐蔽消息内容，认证是防止不法分子实施主动信息攻击
的一种重要技术，其应用目的包括3 个方面：一是消息完整性认证，验证信息在传送或存储过程
中是否被篡改；二是身份认证，验证消息的收发者是否持有正确的身份认证符，如口令、密钥
等；三是消息的序号和操作时间（时间性）等认证，目的是防止消息重放或会话劫待等攻击。
3.4.1 认证技术分层模型
如图3-13 所示，认证技术可以分为3 个层次： 安全管理协
议、认证体制和密码体制。安全管理协议的主要任务是在安全体制
的支持下，建立、强化和实施整个网络系统的安全策略；认证体制
在安全管理协议的控制和密码体制的支持下，完成各种认证功能；
密码体制是认证技术的基础，它为认证体制提供数学方法支持。
典型的安全管理协议有公用管理信息协议CMIP、简单网络管
理协议SNMP 和分布式安全管理协议DSM。典型的认证体制有
比如ms 体制、X509 体制和Light Kryptonight 体制。密码体制已在
本章前面内容中介绍过。这里将主要介绍认证体制层的有关技术。
3.4.2 认证体制要求与模型
一个安全的认证体制应该至少满足以下要求。
安全管理协议
认证体制
密码体制
图3-13 认证技术层次模型
1) 指定的接收者能够检验和证实消息的合法性、真实性和完整性。
2) 消息的发送者对所发的消息不能抵赖， 有时也要求消息的接收者不能否认收到的消息。
3) 除了合法的消息发送者外，其他人不能伪造发送消息。
认证体制的基本模型（又称纯认证系统模型）如图3-14 所示。
在这个模型中，发送者通过一个公开的无扰信道将消息送给接收者。接收者不仅得到消息本
身，而且还要验证消息是否来自合法的发送者及消息是否经过篡改。攻击者不仅可截收和分析信
道中传送的密报，而且可能伪造密文送给接收者进行欺诈等主动攻击。认证体制中通常存在一个
可信中心或可信第三方（如认证机构CA)，用于仲裁、颁发证书或管理某些机密信息。
56
第3 章信息加密与PKI
严
信道
安全信道
图3-14 纯认证系统模型
3.4.3 数字签名技术
数字签名技术是一种实现消息完整性认证和身份认证的重要技术。
一个数字签名方案由安全参数、消息空间、签名、密钥生成算法、签名算法和验证算法
等成分构成。根据接收者验证签名的方式可将数字签名分为真数字签名和公证数字签名两类。
在真数字签名中（见图3-15) ，签名者直接把签名消息传送给接收者，接收者无须求助千第三
方就能验证签名。而在公证数字签名中（见图3-16)，签名者把签名消息通过被称为公证者的
可信第三方发送给接收者，接收者不能直接验证签名，签名的合法性是通过公证者作为媒介来
保证的，也就是说接收者要验证签名必须同公证者合作。
密钥密钥
消息
图3-15 真数字签名方式图3-16 公证数字签名方式
数字签名算法可分为普通数字签名算法、不可否认数字签名算法、Fail-Stop 数字签名算
法、盲数字签名算法和群数字签名算法等。普通数字签名算法包括RSA 数字签名算法、
ElGamal 数字签名算法、Fiat-Shamir 数字签名算法和Guillou-Quisquarter 数字签名算法等。数
字签名与手写签名的主要区别在于：一是手写签名是不变的，而数字签名对不同的消息是不同
的，即手写签名因人而异，数字签名因消息而异；二是手写签名是易被模拟的，无论哪种文字
的手写签名，伪造者都容易模仿，而数字签名是在密钥控制下产生的，在没有密钥的情况下，
模仿者几乎无法模仿出数字签名。
3.4.4 身份认证技术
身份认证的目的是验证信息收发方是否持有合法的身份认证符（口令、密钥和实物证件
等）。从认证机制上讲，身份认证技术可分为两类：一类是专门进行身份认证的直接身份认证
技术，另一类是在消息签名和加密认证过程中，通过检验收发方是否持有合法的密钥进行的认
证，称为间接身份认证技术。下面着重介绍直接身份认证技术。
在用户接入（或登录）系统时，直接身份认证技术要首先验证他是否持有合法的身份认
证符（口令或实物证件等）。如果他有合法的身份认证符，就允许他接入系统中，进行允许的
收发等操作，否则就拒绝其接入系统。通信和数据系统的安全性常常取决于能否正确识别通信
57
计算机网络安全教程笫4 版
用户或终端的个人身份，如银行的自动取款机(ATM) 系统可将现金发放给经它正确识别的
账号持卡人。对计算机的访问和使用，以及安全地区的出入放行等都是以准确的身份认t正作为
基础的。
进入信息社会，传统的身份认证方法，如户籍管理、身份证制度以及单位机构的证件和
图章等，都已不能适应时代的要求。虽然有不少学者试图电子化生物唯一识别信息（如指纹、
掌纹、声纹、视网膜和脸形等），但由千代价高、传输效率低，只能作为辅助措施应用。使用
密码技术，特别是公钥密码技术，能够设计出安全性高的识别协议。下面介绍一些常用的身~
认证技术。
1. 身份认证方式
身份认证常用的方式主要有两种：通行字（口令）方式和持证方式。
通行字方式是使用最广泛的一种身份认证方式。比如我国古代调兵用的虎符、现代~~
网的接入协议等。通行字一般为数字、字母和特殊字符等组成的长字符串，通行字识别的方法
是：被认证者先输入他的通行字，然后计算机确定其正确性。被认证者和计算机都知道这个秘
密的通行字，每次登录时计算机都要求输入通行字，这样就要求计算机存储通行字，一旦~1于
字文件暴露，攻击者就有机可乘。为此，人们采用单向函数来克服这种缺陷，此时，计算~~
储通行字的单向函数值而不是存储通行字本身，其认证过程如下。
l) 被认证者将他的通行字输入计算机。
2) 计算机完成通行字的单向函数值计算。
3) 计算机把单向函数值和机器存储的值进行比较。
由于计算机不再存储每个人的有效通行字表，即使攻击者侵入计算机也无法从通行字的
单向函数值表中获得通行字，当然这种保护对字典式攻击是比较脆弱的。
持证方式是一种实物认证方式。持证(Token) 是一种个人持有物，它的作用类似于钥
匙，用千启动电子设备。使用较多的是一种嵌有磁条的塑料卡，磁条上记录有用千机器识别的
个人识别号(PJN) 。这类卡易于伪造，因此产生了一种被称为“智能卡“(Smart Card) 的~
成电路卡来代替普通的磁卡，智能卡已经成为身份认证的一种更有效、更安全的方法。但智能
卡仅为身份认证提供一个硬件基础，要想得到安全的识别，还需要与安全协议配套使用。
2. 身份认证协议
目前，认证协议大多数为询问－应答式协议，其基本工作过程是：认证者提出问题（通
常为口令、图像识别或验证码等），由被认证者回答，然后认证者验证其身份的真实性。询问
一应答式协议可分为两类：一类是基于私钥密码体制，在这类协议中认证者知道被认证者的秘
密；另一类是基千公钥密码体制，在这类协议中认证者不知道被认证者的秘密，因此，又称为
零知识身份认证协议。
下面介绍著名的Feige-Fiat-Shamir 零知识身份认证协议。在该协议中，可信赖的CA （认
证机构）选定一个随机数m 作为模数，井把m 分发给认证双方（用户A 和B) 。CA 产生随机
数v, 使x2 = v mod m (v 为模m 的平方剩余），且存在v 的逆元v一1 （即V*V一1 =lmodm) 。
以v 作为公钥分发给用户。然后计算最小的整数s, s =.Ji冗modm, 并把s 作为私钥分发给
用户A。实施身份证明的协议如下。
l) 用户A 取随机数r (r<m) ，计算x=r2modm 送给B 。
2) B 将一个随机位数b 送给A。
58
第3 章信息加密与PK.I
3) 若b=O, 则A 将r 送给B；若b= I, 则A 将y=rs 送给B。
4) 若b = 0, 则B 证实x=r2modm, 从而证明A 知道五：；若b = 1, 则B 证实
x = y2 •vmodm, 从而证实A 知道s。
这是一次鉴定， A 和B 可重复t 次鉴定，每次可采用不同的r 和b, 直到B 相信A 知道s
为止。
该协议的安全性分析如下。
1) A 欺骗B 的可能性。A 不知道s, 他也可取r, 送x =r2modm 给B, B 送b 给A, A
可将r 送出。当b寸时，则B 可通过检验而受骗，当b=l 时，则B 可发现A 不知S, B 受骗
的概率为1/2, 但连续重复t 次受骗的概率仅为2一I o
2) B 伪装A 的可能性。B 和其他被认证者c 开始一个协议，第一步他可使用A 用过的随
机数r, 若c 所选的b 值恰好与以前发给A 的一样，则B 可将在协议第3 步所发的数值重发给
C, 从而成功地伪装A, 但c 随机选b 为0 或1, 故这种攻击的成功概率仅为1/2。但重复执行
t 次后，攻击成功概率降为2-t 0
3.4.5 消息认证技术
消息认证是指通过对消息或消息相关信息进行加密或签名变换进行的认证，其目的包括
消息内容认证（即消息完整性认证）、消息的源和宿认证（即身份认证），以及消息的序号和操
作时间认证等。
1. 消息内容认证
在介绍消息内容认证方法之前，首先介绍杂凑函数。
(I) 杂凑函数
杂凑(Hash) 函数是将任意长的数字串M 映射成一个较短的定长数字串H 的函数，以h
表示， h(M)易千计算，称H=h(M)为M 的杂凑值，也称杂凑码、杂凑结果等。这个H 无疑打
上了输入数字串的烙印，因此又称其为输入M 的数字指纹(Digital Fingerprinting) 或数据摘
要(Message Digest) 。h 是多对一映射，因此无法从H 求原来的M, 但可以验证任意给定序列
M' 是否与M 有相同的杂凑值。
若杂凑函数h 为单向函数，则称其为单向杂凑函数。用于消息认证的杂凑函数都是单向
杂凑函数。单向杂凑函数按其是否有密钥控制划分为两大类：一类有密钥控制，以h(k,M)表
示，为密码杂凑函数；另一类无密钥控制，为一般杂凑函数。无密钥控制的单向杂凑函数，其
杂凑值只是输入字串的函数，任何人都可以计算，因而不具备身份认证功能，只用于检测接收
数据的完整性。而有密钥控制的单向杂凑函数要满足各种安全要求，其杂凑值不仅与输入有
关，而且与密钥有关，只有持此密钥的人能够计算出相应的杂凑值，因此具有身份验证功能。
杂凑函数在实际工作中有着广泛的应用，在密码学和数据安全技术中，它是实现有效、安全可
靠数字签名和认证的重要工具，是安全认证协议中的重要模块。由于杂凑函数应用的多样性和
其本身的特点而有很多不同的名称，其含义也有差别，如压缩(Compression) 函数、紧缩
(Contraction) 函数、数据认证码、消息摘要、数字指纹、数据完整性校验(Data Integrity
Check) 、密码检验和(Cryptographic Check Sum)、消息认证码MAC (Message Authentication
Code) 和窜改检测码MDC (Manipulation Detection Code) 等。
构造杂凑函数的方法有两种，一是直接构造，比如由美国麻省理工学院Rivest 设计的
砌5 杂凑算法，可以将任意长度的明文转换为128 位的数据摘要；美国国家标准局(NIST)
59
计算机网络安全教程笫4 版
为配合数字签名标准千1993 年对外公布的安全杂凑函数(SHA) ，可对任意长度的明文产生
160 位的数据摘要。另一种是间接构造，主要是利用现有的分组加密算法，如DES 、AES
等，对其稍加修改，采用它们加密的非线性变换构造杂凑函数。如Rabin 在1978 年利用DES
提出了一种简单快速的杂凑函数，其方法是：首先将明文分成长度为64 位的明文组m1,
m2, … ,mN, 采用DES 的非线性变换对每一明文组依次进行变换，即令h。＝初始值，
hi＝比脰］，最后输出的伽就是明文的杂凑值。
杂凑函数必须满足密码学的安全性要求。显然，对于一个单向杂凑函数h, 由M 计算H=
h(M)是容易的，但要产生一个M' 使h(M' ）等千给定的杂凑值H 则非常困难，这正是应用密码所
希望的，否则对手就会用M' 代替M, 窜改消息内容。若单向杂凑函数h 对任意给定M 的杂凑值
H=h(M)，找到一个M' 使h(M') = H 在计算上可行，则称h 为弱单向杂凑函数；若要找任意一
对输入(M1,M2:M) ＃岛），使h(M1)=h(M滩计算上不可行， 则称h 为强单向杂凑函数。
杂凑函数的安全性取决于其抗击各种攻击的能力，攻击者的目标是找到两个不同消息可
映射为同一杂凑值。一般假定攻击者知道杂凑算法，采用选择明文攻击法。强杂凑函数是基于
生日攻击法定义的。所谓“生日攻击“，是指在一个会场参加会议的人中，找到一个人与某人
生日相同的概率超过0.5 时，所需参加会议人员为183 人。但要使参会人员至少有两个生日相
同的概率超过0.5 的参会人数仅为23 人。即在一定元素所组成的集合中，给定M 找到与M
匹配的M' 概率要比从集合中任意取出一对相同元素(M=M' ）的概率小得多。弱单向杂凑函
数考察的是任意元素与特定元素的无碰撞性(Collision-free) ；而强单向杂凑函数考察的是输
入集中任意两个元素的无碰撞性。因此，就无碰撞性而言，对强单向杂凑函数的要求比对．弱单
向杂凑函数的要求高。为了抵抗生日攻击及其他杂凑函数的攻击法，根据目前的计算技术，杂
凑函数值至少为128 位长。
目前已研制出适合各种用途的杂凑算法，这些算法都是伪随机函数，任何杂凑~都是等
可能的，输出并不以可辨别的方式依赖于输入。在任何输入串中单个位的变化，将会导~输出
位串中大约一半的位发生变化。
总之，为了抵抗各种攻击，所采用的杂凑函数应满足单向性、伪随机性、非线性性及杂
凑速率的高效性等密码学性质。
(2) 消息内容认证
消息内容认证的常用方法是：消息发送者在消息中加入一个鉴别码(MAC 、MDC 等），
经加密后发送给接收者（有时只需加密鉴别码即可），接收者利用约定的算法对解密后的消息
进行鉴别运算，若获得的鉴别码与原鉴别码相等则接收，否则拒绝接收。
2. 消息的源和宿认证
在消息认证中， 消息源和宿认证的常用方法有两种：一种是通信双方事先约定发送消息的数
据加密密钥，接收者只需证实发送来的消息是否能用该密钥还原成明文就能鉴别发送者，如果双
方使用同一个数据加密密钥，那么只需在消息中嵌入发送者识别符即可；另一种是通信双方事先
约定用于各自发送消息的通行字，发送消息时将通行字一并进行加密，接收者只需判别消息中解
密的通行字是否与约定通行字相符就可鉴别发送者。为安全起见，通行字应该是可变的。
3. 消息的序号和操作时间认证
消息的序号和操作时间的认证主要用千阻止消息的重放攻击，常用的方法有消息的流水
作业、链接认证符随机数认证法和时间戳等。
60
第3 章信息加密与PK.I
3.4.6 数字签名与消息认证
杂凑函数产生的杂凑值（鉴别码）可直接用千消息认证，也可通过数字签名方法间接用
千消息认证。一般地，对长度较大的明文直接进行数字签名需要的运算量和传输开销也较大，
而杂凑值就是明文的”指纹”或“摘要“，因而对杂凑值进行数字签名可以视为对其明文进行
数字签名。· 实际应用中，通常也是对明文杂凑值而非明文本身进行数字签名，目的就在于提高
数字签名效率。
数字签名与消息认证的区别是，消息认证可以帮助接收方验证消息发送者的身份，以及
消息是否被篡改。当收发者之间没有利害冲突时，这种方式对千防止第三者破坏是有效的，但
当收发者之间存在利害冲突时，单纯采用消息认证技术就无法解决纠纷，这时就需要借助于数
字签名技术来辅助进行更有效的消息认证。
3.5 公开密钥基础设施(PKI)
随着互联网技术的迅速推广和普及，各种网络应用如电子商务、电子政务、网上银行和
网上证券交易等也在迅猛发展。互联网以其开放性、易接入、信息丰富及成本低廉等优点获得
了人们的广泛认可。同时，其安全问题也成为人们担心的焦点，网络非法入侵、网上诈骗等案
件造成的损失已逐年上升。因此，解决网络信息安全问题已成为发展网络通信的重要任务。
在信息安全技术领域，特别是网络安全技术方向，公开密钥加密技术（即前面介绍的双
钥加密技术）近年来发展很快，这主要是由公钥体制本身的特点所决定的。公钥体制采用了两
个密钥，一个公钥作为加密密钥，一个私钥作为用户专有的解密密钥，通信双方无须交换专用
密钥，这就避免了在网上传递私钥这样的敏感信息，进而可以实现保密通信。
在这项技术基础上形成和发展起来的PKI (Public Key Infrastructure, 公钥基础设施）很
好地适应了互联网的特点，为互联网及类似网络应用提供了全面的安全服务，如安全认证、密
钥管理、数据完整性检验和不可否认性等。可以说，今天互联网的安全应用已经离不开PKl
的有力支持。
从参与电子政务与电子商务的用户实体出发，网络应用常规的安全需求主要包括以下几个。
1) 认证需求：提供某个实体（人或系统）的身份保证。
2) 访问控制需求：保护资源，防止被非法使用和操作。
3) 保密需求：保护信息不被泄露或暴露给非授权的实体。
4) 数据完整性需求：保护数据，防止未经授权的增删、修改和替代。
5) 不可否认需求：防止参与某次通信交换的一方事后否认交换行为。
针对电子政务和电子商务的这些安全需求，以公钥加密技术为基础的PKI 应运而生。
3.5.1 PKI 的基本根捻
所谓安全基础设施，就是为整体网络应用系统提供的安全基本框架，它应该可以被系统
中的任何用户按需使用。安全基础设施的本质必须是统一、便千使用的，只有这样，那些需要
基础设施支撑的对象在使用安全服务时才不会遇到困难。因此， PKl 首先是适用千多种环境的
框架，这个框架避免了零碎的、点对点的、特别是那些没有互操作性的解决方案，它引入了可
管理的机制，以及跨越多个应用和多种计算平台的一致安全性。
PKI 是一个用公钥密码算法原理和技术来提供安全服务的通用性基础平台，用户可利用
61
计算机网络安全教程笫4 版
PKI 平台提供的安全服务进行安全通信。PK.I 采用标准的密钥管理规则，能够为所有应用~明
地提供加密和数字签名等服务需要的密钥和证书管理。
1. 认证机构
使用公钥技术实现安全通信面临的一个基本问题是，通信发送方如何可靠地获得接收~
的真实公钥。如果发送方获得的不是接收方的真实公钥，那么，接收方就不能解密发送方加密
的信息。更严重的是，如果接收方获得的是由窃密者提供的假冒公钥，则窃密者就可以解密该
信息，并利用它进行其他破坏活动。PKI 通过使用公钥证书来解决这一问题，公钥证书是用户
（接收方）的身份标识与其持有公钥的结合，在生成公钥证书之前，由一个可信任的权威~构
CA （认证机构或认证中心）来证实用户的身份，然后CA 对由该用户身份标识及对应公钥组
成的证书进行数字签名，以证明公钥的有效性。因此， CA 是PKI 的核心部分，它是数字证书
的签发机构。PKI 首先必须具有可信任的权威CA, 然后在公钥加密技术基础上，实现证书的
产生、管理、存档及作废管理等功能。
2. 身份识别
为了启动一个应用系统，简单的做法是本地安全登录，其操作过程是用户输入身份标识
符（用户1D) 及认证口令，计算机通过检查这两个输入验证用户身份，确认是否为合法登
录。这种身份识别方法较为简单，其假设前提是除合法用户之外，无人能获取该用户口令。当
系统要求用户远程登录时，口令在未受保护的网络上传送，很容易被截取或监听，即使口令~
加密也无法防范重放攻击，因此这种简单识别带来的问题是明显的。
PKI 采用公钥技术、高级通信协议和数字签名等方式进行远程登录，既不需要事先建立共
享密钥，也不必在网上传递口令等敏感信息。因此，口令的保密性较高，机器对用户身份识别
的可靠性也高。与简单的身份识别机制相比， PK.I 的身份识别机制称为强识别。
3. 透明性
作为一种基础设施， PKI 对终端用户的操作是透明的，即所有安全操作在后台自动进行，
无须用户干预，也不应由于用户的错误操作对安全造成危害。总之，安全不应该成为用户完成
其他任务的障碍。除初始登录操作之外， PKI 对用户是完全透明的。
4. 一致性
作为安全基础设施， PKI 的最大优势是在整个应用环境中使用单一可信的安全技术，如公
钥技术，它能保证数目不受限制的应用程序、设备和服务器无缝地协调工作，安全地传输、存
储和检验数据，安全地进行事务处理等。电子邮件、Web 服务、防火墙、远程访问设备、应
用服务器、文件服务器、数据库及其他应用等，都能够采用统一的方式理解和使用安全服务基
础设施， PKI 是使系统达到全面安全性的一个重要机制。
5．相关的标准
(1) X.509
X.509 是ISO 和CCITT/1TU-T 的X.500 标准系列中的一部分，在PKI 概念由小的封闭式
网络实验环境发展到大的开放式分布环境的过程中， X.509 标准的作用不可或缺。从发展的角
度来看， X.509 标准是PKI 的雏形， PKI 源千X.509 标准并标准化了一个通用的证书格式。
X.509 被广泛应用，其实用性来源千其版本3 (V3 版）中证书撤销列表定义的强有力的扩展机
制，这一机制是很通用的，并且指示了认证者如何在认证过程中校验这些扩展。
(2) X.500
ISO/ITU-T 中有关目录的标准族通常称为X.500 规范系列。X.500 目录服务是一个高度复
62
第3 章信息加密与PK.I
杂的信息存储机制，包括客户机—目录服务器访问协议、服务器一服务器通信协议、完全或部
分的目录数据复制、服务器对查询的响应，以及复杂搜寻的过滤功能等。X.500 对PK.I 有着特
别重要的作用，它定义了一种方案，即在实体目录访问入口处使用标准化方法，完成证书和证
书撤销列表数据结构的存储访问。
(3) LDAP
LDAP (Lightweight Directory Access Protocol, 轻量级目录访问协议）最初被视为X.500
目录访问协议(DAP) 中那些容易被描述、易千执行的功能子集。后来其功能逐渐增强扩
展，进而可以适应不同环境的需求，这些环境都采用LDAP 作为存储器的访问协议。
3.5.2 PKI 认证技术的组成
公钥基础设施在组成上主要包括认证机构CA、证书库、密钥备份（即恢复系统）、证书
作废处理系统和PK.I 应用接口系统等。
1. CA
CA 作为数字证书签发机构是PKI 的核心，是PKI 应用中权威、可信任、公正的第三方
机构。
由千公钥需在网上公开传输， PKI 服务系统的关键问题是如何实现公钥的管理，因而引入
证书机制至关重要。证书是公开密钥体制的一种密钥管理媒介，是一种权威的电子文档，形同
网络计算环境中的一种身份证，用千证明某一主体（如用户、服务器等）的身份及其公开密钥
的合法性。在使用公钥体制的网络环境中，必须向公钥使用者证明公钥的真实合法性。因此，
必须有一个可信的机构来对任何一个主体的公钥进行公证，证明主体的身份及其与么洘月的匹配
关系。CA 正是这样的机构，其职责有以下几个。
·验证并标识证书申请者的身份。
·确保用于签名证书的非对称密钥的质量。
·确保整个验证过程中的安全性，确保签名私钥的安全性。
·证书资料信息（包括公钥证书序列号、CA 标识等）的管理。
·确保并检查证书的有效期限。
·发布并维护作废证书列表。
·对整个证书签发过程做日志记录。
·向申请人发出通知。
其中，最重要的是CA 自己的一对密钥的管理，它必须确保其高度的机密性，防止他人伪
造证书。CA 公钥在网上公开，整个网络系统必须保证完整性。CA 的数字签名保证了证书
（实质是持有者的公钥）的合法性和权威性。主体（用户）的公钥有两种产生方式。
l) 用户自己生成密钥对，然后将公钥以安全的方式传送给CA, 该过程必须保证用户公
钥的可验证性和完整性。
2) CA 替用户生成密钥对，然后将其以安全的方式传送给用户，该过程必须确保密钥对
的机密性、完整性和可验证性。由千这里的用户私钥为CA 所产生，故对CA 的可信性要求更
高， CA 必须在事后有效地销毁用户的私钥。
用户A 在网上可通过两种方式获取用户B 的证书和公钥，一种是由B 将证书随同发送的
正文信息一起传送给A, 另一种是所有的证书集中存放千一个证书库中，用户A 通过网络从
该库中获取B 的证书。
63
计算机网络安全教程第4 版
前面提到，公钥不仅可以用千加密信息，还可以用千数字签名。相应地，系统中需要配
置用千数字签名／验证的密钥对和用千数据加密／解密的密钥对，它们分别被称为签名密钥~和
加密密钥对，这两对密钥对之于密钥管理有不同的要求。
l) 签名密钥对。签名密钥对由签名私钥和验证公钥组成．为保持其唯一性，签名私钜l不
能存档备份，丢失后需重新生成新的密钥对，原来的签名可以使用旧公钥的备份来验证， F斤以
验证公钥需要存档备份，以用千验证旧的数字签名。
2) 加密密钥对。加密密钥对由公钥和脱密私钥组成。为防止密钥丢失时不能脱密数据，
脱密私钥应该进行存档备份，以便能在任何时候脱密密文数据，加密公钥无须存档备份，加密
公钥丢失时，需要重新产生密钥对。
显然，这两对密钥对的管理要求存在互相冲突的地方，因此系统必须针对不同的用~1吏
用不同的密钥对。若加密和签名采用同一对密钥，那是不安全的。
2. 证书库
证书库是CA 颁发证书和撤销证书的集中存放地，是网上的一种公共信息库，供广大用户
进行开放式查询。
证书及证书撤销信息的分发办法是发布(Publication)，其思想是将PKI 的信息放在一个·
广为人知的、公开且易千访问的地点， 这对广大用户群体来说十分重要，因为即使属千同一~
体中的人也难以互相认识。
到证书库访问查询，可以得到想要与之通信的实体的公钥。若甲想与乙进行保密通信，就必
须找到乙的公钥，而证书签发机构事先已将乙的身份与其公钥捆绑，进行了数字签名，发布在i正
书库中。甲可以通过某种可靠、安全的方式从证书库中找到乙的证书，从而得到其么洘月。
由千证书的不可伪造性，因此，可以在数据库中公布，而无须其他的安全措施来保护~
些证书。现在，通常的做法是将证书和证书撤销信息发布到一个数据库（证书库或目~月展~
器）中，它采用LDAP 目录访问协议，其格式符合X.500 标准，客户端可以通过多种访问~
议从证书库中实时查询证书和证书撤销信息。
证书库支持分布式存放，当PKI 所支持的环境扩充到几十万或上百万用户时， PKI 信息
的及时和强有力的分布机制就显得非常关键， 如目录服务器的分布式存放，这是任何一~大~
模PKI 系统成功实施的基本需求，也是创建一个有效认证机构CA 的关键技术之一。
3. 证书撤销
认证机构CA 通过签发证书来为用户的身份和公钥进行捆绑，但同时还必须存在一种~制
来撤销这种捆绑关系，将现行的证书撤销。比如，在用户身份姓名改变、私钥被窃或泄露、用
户与其所属单位关系变更时，就需要一种方法警告其他用户不要再使用其原来的公钥。在PKI
中，这种警告机制被称为证书撤销，它所使用的手段为证书撤销列表(CRL) 。
证书撤销信息的更新和发布频率是非常重要的，一定要确定合适的间隔频率来发布证书
撤销信息，并且要将这些信息及时地散发给那些正在使用这些证书的用户。通常，两次证书撤
销信息之间的间隔被称为撤销延迟。
证书撤销的实现方法有多种，一种方法是利用周期性的发布机制，如CRL, 这是常用方
法，另一种方法是在线查询机制，如在线证书状态协议OCSP 。
(1) CRL
CRL 的结构是按X.509 证书标准定义的，其结构如图3-17 所示。
64
笫3 章信息加密与PKI
版本号1 签名1 颁发者1 本次更新1 下次更新1 撤销的证书列表1 扩展域1
(i) 版本号~出CRL的版本号．
©签名一计算本CRL的数字签名所用的算法的对象标识符．
O 颁发者-CRL颁发者（即CRL的签名者）的可识别名(DN) ，本字段必须写出且唯一..
＠本次更新一—本CRL的发布时间，以UTCTime或Generalized Time的形式表示．
＠下次更新一一凤可选项，下一个CRL的发布时间，其表示形式与本次更新字段一样．
＠撤销的证书列表—一撤销的证书的列表，每个证书对应一个唯一的标识符．
0 扩展域-有4 个定义可用干每项的扩展．
理由代码一证书撤销理由，包括密钥损坏、CA损坏、关系变动、取代、操作终止、证书控制、
从CRL的去除，以及未指明的理由。
证书颁发者—一证书颁发者的名字。
控制指示代码－一－用干证书的临时冻结。
无效日期一一本证书不再有效的时间．
图3-17 CRL 结构
事实上， CRL 是一种包含撤销证书列表的签名数据结构， CRL 的完整性和可靠性由其自
身的数字签名来保证。CRL 的签名者一般也是颁发证书的签名者。
(2) 在线查询机制
对证书撤销信息的查询，也可利用在线查询机制，即要求用户无论检索证书撤销与否都
必须与数据库保持在线状态。
目前，最普遍的在线撤销机制就是在线证书状态协议（OCSP) ，这是一种相对简单的请求／响
应协议。一个OCSP 请求由协议版本号、服务请求类型，以及一个或多个证书标识符组成。
响应信息由证书标识符、证书状态(“正常”“撤销”等），以及对应千原请求中具体证书
标识符的验证响应时间组成。响应信息必须经过数字签名，以保证其源于可信任方并且在传输
过程中未被篡改。签名密钥一般属于颁发证书的CA, 是一个可信任的第三方。因此，在任何
情况下，用户必须信任这个响应信息。
关千证书撤销信息查询问题，有多种技术来实现，但不同的技术适用于不同的环境， PKI
应提供多种选择，进而构成最佳的撤销方案。
4. 密钥备份和恢复
为避免解密密钥丢失带来的不便， PKI 提供了密钥备份与解密密钥的恢复机制，即密钥备
份与恢复系统，它由可信任的CA 来完成。值得注意的是，密钥备份与恢复只针对解密密钥，
签名密钥是不能做备份的。
一个证书的生命周期主要包括3 个阶段，即证书初始化注册阶段、颁发阶段和取消阶
段。而证书密钥的备份与恢复就发生在初始化注册阶段和颁发阶段。
(I) 密钥／证书生命周期
密钥／证书的生命周期可分为初始化、颁发和取消3 个阶段，如图3-18 所示。
初始化阶段指的是终端用户在使用PKI 服务之前，必须经过初始化程序进入PKI, 由以
下几步组成。
·终端实体注册。
·密钥对产生。
·证书创建和密钥／证书分发。
·密钥备份。
65
计算机网络安全教程第4 版
终端实休注册
密钥对产生
证书创建和密钥／证书分发
密钥备份（如果适用）
证书检索
证书验证
密钥恢复
密钥更新
证书过期
证书撤销
密钥历史
密钥档案
图3-18 密钥／证书生命周期管理
颁发阶段包括以下几个。
·证书检索一一远程数据库的证书检索。
·证书验证一—确定一个证书的有效性。
·密钥恢复—一不能正常解读加密文件时，从CA 中恢复。
·密钥更新一当一个合法的密钥对将要过期时，新的公／私密钥对会自动产生并颁发。
取消阶段是密钥／证书生命周期管理的结束，主要步骤包括以下几个。
·证书过期一一证书的自然过期。
·证书撤销－~宣布一个合法证书（及相关密钥）不再生效。
·密钥历史一维护一个有关密钥资料的连续记录，以便以后过期的密钥所加密的数据
可以被解密。
·密钥档案一—为了密钥历史恢复、审计和解决争议的目的，密钥历史档案由CA
储存。
由此可见，密钥备份与恢复贯穿证书的整个生命周期。
(2) 密钥备份
用户在申请证书的初始阶段，如果声明公／私密钥对是用于数据加密的，则CA 对该用户
的密钥和证书进行备份，备份设备的位置可以从一个PKI 域变到另一个PKI 域。
. (3) 密钥恢复
密钥恢复功能发生在颁发阶段，其功能是将终端用户丢失的加密密钥予以恢复，这种恢
复由可信任的密钥恢复中心或CA 完成。密钥恢复的手段可以从远程设备恢复，也可由本地设
备恢复。考虑到可扩展性并将PKI 管理员和终端用户的负担减到最小，恢复过程必须尽可能
地自动化和透明化。此外，任何综合的生命周期管理协议都必须具有对这个能力的支待。
密钥恢复和密钥备份一样，只适用于用户的加密密钥，签名密钥或私钥不应备份，因为
这样将影响提供不可否认性的能力。
5．自动更新密钥
一个证书的有效期是有限的，这样规定既有理论原因，又有实际操作因素。因此，在很
多PKI 环境中，一个已颁发的证书需要有过期的措施，以便更换新的证书。为避免密钥更新
的复杂性和人工操作的烦琐， PKI 支持自动密钥或证书更新。其指导思想是，无论用户的证书
用千何种目的，认证时都会在线自动检查有效期，在失效日期到来之前的某段时间内，自动启
66
第3 章信息加密与PKT
动更新程序，生成一个新的证书来代替旧证书，新旧证书的序列号也不相同。
(1) 密钥更新
密钥更新发生在证书的颁发阶段。当证书“接近“过期时，必须颁发一个新的公／私密钥
和相关证书，这称为密钥更新。所谓“接近“过期，一般是指在证书到达有效期之前的时间
“提前量”，通常规定这个提前噩为整个密钥生存期的20％左右。实践证明，这是一个合理的
转变时间，可以防止证书过期而得不到安全服务。源千扩展性的要求，这个更新过程必须自动
进行，对终端用户而言，也应该是透明的。
(2) 证书更新与证书恢复
证书更新与证书恢复是两个不同的概念，证书恢复是保持最初的公钥／私钥对，密钥证书
更新是在证书中产生了一个新的公钥／私钥对。证书之所以能够恢复，取决于最初颁发证书的
环境没有变化，并且还认为这个公／私钥对仍是可信的。
6. 密钥历史档案
从密钥更新的概念可知，在经过一段时间之后，每个用户都会形成多个“旧”证书和至
少一个“当前“证书，这一系列旧证书和相应的私钥就组成了用户密钥和证书的历史档案。
记录整个密钥历史是一件十分重要的事情。例如，甲5 年前加密的数据或他人用甲的公
钥加密的数据无法用现在的私钥解密，那么，甲就需要从其密钥历史档案中找到正确的解密密
钥来解密数据。以此类推，有时也需要从密钥历史档案中找到合适的证书验证甲5 年前的数字
签名。与密钥更新相同，管理密钥历史档案也应由PK.I 自动完成，密钥历史档案发生在密钥／
证书生命周期的取消阶段。
(1) 密钥历史
即使密钥资料已过期，可靠和安全地存储加密密钥也是必需的。在PK.I 中，存储加密密
钥的数据库称为密钥历史。一定程度上，密钥历史主要是为保证数据的机密性服务的。具体而
言，就是用做解密的私有密钥资料被存储，以便将来对已加密数据进行恢复。对千那些用于数
字签名目的的密钥，只能通过密钥档案适当地满足这种需求。
(2) 密钥档案
与密钥历史不同，密钥档案主要在审计和交易争端时使用。密钥历史一般直接与终端实
体相结合，以便在访问已过期密钥加密的数据时，快捷地提供过期密钥资料。密钥档案一般则
是由第三方提供服务，其提供的服务包括公证和时间戳服务、跟踪审计，以及终端实体的密钥
历史恢复等。当局部密钥历史丢失或遭破坏后，密钥档案服务就显得相当重要。一个给定终端
实体的密钥历史可以由密钥档案设备存储起来，以便将来响应来自密钥历史所有者的请求，或
者其他无终端实体但已被授权访问该密钥资料者的请求。
另外，当试图验证一个已过期的密钥资料所创建的数字签名时，密钥档案设备可能是必
需的，因为在这种情况下，需要恢复对该数字签名有用的公钥证书。
7. 交叉认证
在全球范围内建立一个容纳所有用户的单一PKI 是不太可能实现的，可行的模型是建立
多个PK.I 域，进行独立的运行和操作，为不同环境和不同行业的用户团体服务。
为在不同PK.I 之间建立信任关系，“交叉认证”的概念应运而生。在没有统一的全球PKI
的环境下，交叉认证是一个可以接受的机制，因为它能够保证一个PK.I 团体的用户验证另一
个团体的用户证书。总之，交叉认证是一种把以前无关的CA 连接在一起的机制，从而使得它
们在各自主体群间实现安全通信。
67
计算机网络安全教程笫4 版
交叉认证方式以CA 所在的域为标准，可分为域内交叉认证和域间交叉认证两种形式。如
果两个CA 属于相同的域，即在一个组织的CA 层次结构中， 某一层的CA 认证下一层的
CA，这种处理方式被称为域内交叉认证。如果两个CA 属千不同的域，即在一个公司中的CA
认证在另一家公司中的CA, 这种处理方式被称为域间交叉认证。
交叉认证既可以是单向的，也可以是双向的。所谓单向认证，是指CAI 可以交X~t正
CA2 ，但CA2 却无法交叉认证CAl 。双向认证则是指CAI 与CA2 可以互相交叉认证，这利I
相互交叉认证需要两个不同的交叉证书。
在X.509 标准中，对千交叉认证给出的定义是：从CAI 的观点来看，把它当作主~ 由
其他CA 来颁发证书，被称为“正向交叉证书“，被CAl 颁发的证书则称为“反向交叉证
书“。如果一个X.500 目录被用作证书资料库，则正确的正向和反向交叉证书可以被存~~~
个相关的CA 目录项中的交叉证书对结构中，这个结构可以构造证书路径，如图3-19 所~。
CAI 目录实体
交叉证书对
正向交叉证书
·主体＝ CAI
·颁布者＝CA2
反向交叉证书
·主体＝ CA2
·颁布者＝CAI
CA2 目录实体
交叉证书对
正向交叉证书
·主体＝ CA2
·颁布者＝ CAI
反向交叉证书
·主体＝ CAI
·颁布者＝ CA2
图3-19 CAl 与CA2 之间的相互交叉认证证书对
交叉认证的目的在千，在不同的群体中扩展信任，其方法有3 类。
l) 一个给定的CA 可承认另一个CA 在其所控制的范围内被授权颁发的证书。
2) 允许不同的PK.I 域建立互操作路径。
3) 交换根CA 的密钥，并用外部域的根CA 的密钥填充每个终端实体的软、硬件。
现举例说明如何使交叉认证能在不同的证书群体中扩展信任。假设：甲已被CAI iAi.iE,
并持有一份可信的CAl 的公钥，并且乙已经被CA2 认证，也持有一份可信的CA2 的公钥。
最初，甲只信任其证书是由CA1 签发的实体，因为甲能够验证这些证书。此时甲尚不能验证：
乙的证书，因为甲此时还没有持有一份可信的CA2 的公钥。类似地，此时乙也不能验证甲的
证书。然而，在CAl 和CA2 交叉认证之后，甲的信任能够扩展到CA2 的包括乙在内的主~
群，这是因为甲能够用其可信的CAl 的公钥验证CA2 的证书，然后用其现在信任的CA2 的
公钥验证乙的证书。
8．不可否认性
PK.I 的不可否认性适用于从技术上保证实体对他们行为的不可否认性，即他们对自已发~
和接收数据这个事实的不可抵赖性。如甲签发了某份文件，一段时间后他不能否认他对该X1牛
进行了数字签名。
从数字签名的角度来说，一个公司或机构若需要用PKI 支持不可否认性，则维护多密钥
对和多个证书就非常必要。要真正支持不可否认性需要一个必要条件，那就是用户用千不可畴否
认性操作的私钥不能被包括可信任实体CA 在内的任何其他人知道。否则，实体就会随便~宣
布这个操作不是本人所为，某些情况下这种私钥只能装载在防篡改的硬件加密模块中。
另一方面，不是用千不可否认性的密钥，如加密密钥，可备份在一个可信任机构（如
68
第3 章信息加密与PKI
CA) 中，甚至可以存放在软件里。正是由千这种冲突，一个PKI 实体一般需要拥有两对或三
对不同的密钥对及相关证书，一对用千加密和解密，一对用千普通的签名和认证，一对用千不
可否认性的签名和认证。
9. 时间戳
时间戳也称安全时间戳，是一个可信的时间权威用一段可认证的完整数据表示的时间戳
（以格林尼治时间为标准的32 位值）。重要的不是时间本身的精确性，而是相关日期时间的安
全性。支持不可否认性服务的一个关键措施就是在PKl 中使用时间戳，即时间源是可信的，
它赋予的时间值必须被安全地传送。
PKI 中必须存在用户可信任的权威时间源，权威时间源的时间并不需要准确，重在为用户
指明”参照“时间，以便完成基千PKl 的事务处理。一般地， PKl 中都设置一个时钟系统，以
便统一PKI 的时间。当然，也可用世界官方时间源所提供的时间，甚至是网络上权威时间源
发布的时间。当实体需要在数据上盖上时间戳时，就可向PKI 权威时间源提出请求，一份文
档的时间戳实质上就是文档内容和时间的杂凑值(Hash 值），即数字签名，它可为数据的真实
性和完整性验证提供依据。
10. 客户端软件
客户端软件是一个全功能、可操作PKI 的必要组成部分。与常见的客户／服务器应用相
同，只有客户端提出请求服务，服务器端才会对此请求做相应处理，这个原理同样适用于
PKI。客户端软件的主要功能有以下几个。
1) 询问证书和相关的撤销信息。
2) 在一定时刻为文档请求时间戳。
3) 作为安全通信的接收点。
4) 进行传输加密或数字签名。
5) 执行取消操作。
6) 证书路径处理。
客户端软件独立于所有应用程序，应用程序应通过标准接入点与客户端软件连接。
对PK.I 而言，这些应用程序是指客户端应用程序、协议引擎、数据库和操作系统等，它
们都需要诸如认证、完整性、机密性和不可否认性等安全服务。为了在应用程序之间获得一致
的安全性，客户端软件必须被置千一个单一的应用程序之外，可以被应用程序调用。
3.5.3PKI 的特点
PK.I 的主要特点包括以下几个。
l) 节省费用。在一个大型的应用系统中，实现统一的安全解决方案，比起实施多个有限
的解决方案，费用要少得多。
2) 互操作性。在一个系统内部，实施多个点对点的解决方案，无法实现互操作性。在
PKl 中，每个用户程序和设备都以相同的方式访问和使用安全服务功能。
3) 开放性。任何先进技术的早期设计，都希望在将来能与其他系统实现互操作，而一个
专有的点对点技术方案不能处理多域间的复杂性，不具有开放性。
4) 一致的解决方案。一致的解决方案在一个系统内更易千安装、管理和维护，并且开销小。
5) 可验证性。PKI 在所有应用系统和设备之间所采用的交互处理方式都是统一的，因
此，它的操作和交互都可以被验证是否正确。
69
计算机网络安全教程笫4 版
6) 可选择性。PK.I 为管理员和用户提供了许多可选择性。
3.6 常用加密软件介绍
在日常工作和学习过程中， POP (Pretty Good Privacy) 软件及其免费代替产品GnuPG 软
件是两款常见的加密产品，下面主要介绍其功能、主要技术特点及使用方法。
3.6.1 PGP
1 、PGP 简介
PGP 是一款基千RSA 公钥加密体系的邮件加密软件，提出了公共钥匙或不对称文件加密
和数字签名的方法。该软件的创始人是美国的Phil Zimmermann, 他创造性地把RSA 公~~
系的方便和传统加密体系的高速结合起来，并且在数字签名和密钥认证管理机制上有巧妙的~
计，因此PGP 几乎成为目前最流行的公钥加密软件包。
由千美国对信息加密产品有严格的法律约束，特别是向美国、加拿大以外的其他国家散
播、出售和发布该类软件的约束更为严格，因而限制了PGP 的一些发展和普及，现在该软件
的主要使用对象为情报机构、政府机构和信息安全工作者。PGP 最初的设计主要是用千邮件：
加密，如今已经发展到了可以加密整个硬盘、分区、文件及文件夹，甚至可以对ICQ 等即时
通信软件的聊天信息实时加密。
PGP 不是一种完全的非对称加密体系，它是一个混合加密算法，由一个对称加密算法
(IDEA)、一个非对称加密算法(RSA)、一个单向散列算法(MD5) 及一个随机数产生器(JA
用户击键频率产生伪随机数序列的种子）组成，每种算法都是PGP 不可分割的组成部分。
PGP 之所以流行， 并得到广泛认可，最主要的就是它集成了几种加密算法的优点，使它们彼
此得到互补。
2. PGP 的功能与使用
PGP 软件原来是美国PGP 公司的产品，后来被Symantec 公司收购，并更名为Symantec
Encryption Desktop, 目前版本是10.3，下面就以Symantec Encryption Desktop 10.3 为例对其功
能进行介绍。
Symantec En叩rption Desktop 10.3 的主操作界面如图3-20 所示，主要包括PGP Keys 、
PGP Messaging、POP Zip、POP Disk、PGPViewer 和File Share Encryption 等几个功能模块。
其中， POP Keys 模块主要负责密钥的生成与管理， PGP Messaging 模块主要完成邮件、即
时消息等的加解密， POP Zip 模块主要用来创建和查看压缩包， PGP Disk 模块主要用来创建和
管理虚拟磁盘、加密磁盘或分区， POP Viewer 模块主要完成加密邮件消息的解密与查看， File
Share En叨ption 模块主要完成文件或目录的加密分享。此外， Symantec Encryption Desktop 的
Shred Files 和Shred Free Space 模块可以实现文件和磁盘空闲空间的安全擦除。下面仅对密钥创
建和PGPDisk 创建虚拟磁盘进行介绍，其他功能的使用可以参考该软件的帮助文档。
(1) 创建PGPKey
要使用PGP 加密系统，首先要创建一对PGP Key, 方法是在PGP Desktop 主界面上选择
File一New PGP Key 命令，在弹出对话框中按提示执行下一步操作，进入如图3-21 所示的界
面，输入用户名和邮件地址。此时可以通过单击Advanced 按钮进一步设置密钥的类型、加密
算法和密钥长度等信息。
70
笫3 章信息加密与PK.l
I
心m`.d....凡，吻一·
...,,.,....,.....－“'，印j...化..-..._,碰-冒＿，一一一一一1
“一r,... ....,....l,····P.-
。且J..巳J..归"...--
，已乏五」
4
：注如吓子可＝竺4二至动
图3-20 PGP 的主操作界面图3-21 创建PGPKey 的用户信息
单击“下一步”按钮，进入设置私钥保护密码界面，如图3-22 所示。
根据提示执行余下操作即可以完成PGPKey 的创建，如图3-23 所示。在创建了PGP Key
后，就可以利用该PGPKey 进行各种加解密操作。
o.....“曰
、,.-.......＂..J』j..“巴中已..曰叭呱帕一“'
μ出1,...-.......＂。胄命呵L
岫...............mm......｀“'...l 巳－
1...- －厂
~..一=_ __J -~ ．已主乒“三一土志
五万
- - - I
亨丘立正立」1
图3-22 创建PGPKey 的密码信息图3-23 创建的PGPKey
(2) 创建POP Disk
创建PGPDisk 的方法是在POP Desktop 主界面左侧功能导航栏中选择New Vrrtual Disk,
图3-24 给出了创建的界面，其中要设置的内容主要包括虚拟盘的文件名、存储路径、挂载虚
拟盘符、容量、分区格式、加密级别和选用密钥等信息。设置了所需信息后单击Create 按
钮，即可以完成POP Disk 的创建。
在创建完成POP Disk 后，会在图3-24 指定目录下创建New POP Diskl.pgd 文件，在如
图3-25 所示的界面中，先选中创建的New POP Diskl.pgd, 然后单击mount 按钮，即可进行
虚拟磁盘的加载，同时mount 按钮变为unmount 按钮，单击该按钮就可以卸载虚拟磁盘。在
进行加载时会提示输入私钥的保护密码。
n,..,.,“”童雪”.. ..＂ "...口O·
图3-24 创建PGPDisk 图3-25 使用POP Disk
71
计算机网络安全教程笫4 版
3.6.2 GnuPG
1. GnuPG 简介
GnuPG (http://www.gnupg.org）是PGP 的免费代替软件。PGP 使用了IDEA 等许多专利
算法，属千美国加密出口限制产品。GnuPG 是GPL 软件，并且没有使用任何专利加密算~，
所以使用起来自由很多。作为PGP 的替代产品， GnuPG 的技术特点主要包括以下几个。
·完全兼容PGP。
·没有使用任何专利算法， 无专利问题。
·遵循GNU 公共许可证。
·支持多种加密算法。
·支持扩展模块。
·用户标识遵循标准结构。
·多语言支持（包括简体中文） 。
·在线帮助系统。
·拥有众多的GUI 界面支持。
GnuPG 最初是运行在UNIX 系列操作系统之上，现在已经可以在Wmdows 系列操作系统上
运行，目前的最新版本是2.1.9。下面以Wmdows 版本GnuPG 为例介绍其功能和使用方法。
2. GnuPG 的功能与使用
(1) GnuPG 的安装
在Wmdows 系统上安装GnuPG 非常简单，只需到GnuPG 网站下载并运行最新的安装包
（目前为gnupg-w32-2.l.9_20151009) ，然后按照提示即可完成安装过程。
(2) GnuPG 的主要功能
GnuPG 的主要功能可以通过在命令行窗口中执行gpg -h 命令来查看。该命令的执行结果
如下。
72
gpg-h
gpg (GnuPG) 2.1.9
libgcrypt 1.6.4
Copyright (C) 2015 Free Software Foundation, Inc.
LicenseGPL刃＋： GNU GPL version 3 or later<http://gnu.org/licenses/gpl.html>
This is free software: you are free to change and redistribute it.
There is NO WARRANTY, to the extent pennitted by law.
Home: C:\Documelits and Settings\Administrato从pplication Data\gnupg
Supported algoritluns:
Pubkey: RSA, ELG, DSA, ECDH, ECDSA, EDDSA
Cipher: IDEA, 3DES, CASTS, BLOWFISH, AES, AES192, AES256, TWOFISH,
CAMELLIA128, CAMELLIA192, CAMELLIA256
血h: SHAJ , RIPEMD160, SHA256, SHA384, SHA512, SHA224
Compre函on: Uncompressed, ZIP, ZLIB, BZIP2
Syntax: gpg [options] [files]
Si驴， check, encrypt or如rypt
Default operation depends on the input data
笫3 章信息加密与PKI
-s，一sign make a sigi1aturc 1
--clearsign make a clear text signature
-b, --detach-sign make a detached signature
女--enctypt encrypt data
-c, --syinmetric encryption only with symmetric cipher
-d, --decrypt decrypt data (default)
--verify verify a signature
-k, --list-keys list keys
--list-sigs list keys and signatures
--cbeck-sigs list and check key signatures
--fingerprint list keys and fingerprints
-K, --list-secret-kcys list secret keys
--gen-key generate a new key pair
--quick-gen-key quickly generate a new key pair
--quick-adduid quickly add a new user-id
--full-gen-key full featured key pair generation
-gen-revoke generate a revocation certificate
--delete-keys remove keys from the public keyring
--delet仑secret-keys remove keys from the secret keyring
--quick-sign-key quickly sign a key
--quick-lsign-key quickly sign a key locally
--sign-key sign a key
-!sign-key sign a key locally
-edit-key sign or edit a key
--passwd change a passphrase
-export export keys
--send-keys export keys to a key server
--recv-keys import keys from a key server
--search-keys search for keys on a key server
-refresh-keys update all keys from a keyseiver
--import import/merge keys
--card-status print the card status
--card-edit change data on a card
--change-pin change a card's PIN
--update-trustdb update the trust database
--print-rod print message digests
--server run in server mode
Options:
-a,-armor create ascil annored output
-r, -recipient USER-ID encrypt for USER-ID
-u, --local-user USER-ID use USER-ID to sign or decrypt
~zN set compress level to N (0 disables)
--textmode use canonical text mode
-o, --output FILE write output to FILE
习;-verbose verbose
-n, -dry-run do not make any changes
-J, -interactive prompt before overwriting
一openpgp use strict OpenPGP behavior
73
计算机网络安全教程笫4 版
Examples:
-se -r Bob [file]
--clearsign [file)
--detach-sign [file]
--list-keys [names]
蜘－他g9屯rint 他至］
(3) 生成密钥对
要生成密钥对，只需在命令行下执行gpg --gen-key 命令，然后根据提示选择相应的~项
即可完成。图3-26 给出了一个生成名为hacker 的密钥的过程。
sign and encrypt for user Bob
make a clear text signature
make a detached signature
show keys
S的W 他g呾血ts
—血因
＿竺
，八加，““”·· ·nd So'”“「.｀如山“”“to”“......··-加y
rot <O.uPO) 2.1.91 Copyrl1ht (C) 2仇S P..。”“”“Found.tion.,no.
M.”“”“””“1,.. ．“'......缸叮0 ··d”“”“....o It.
幻”“i. NO 隔m“”.”“. ．mo“',....”“d b, 1.u.
1”: U·· 、“一”11...on士o,“ 『0俨·,ull”“叮od...y”“”“”“.JoI·
户叩mo”“”“'...ot • ··”“”“”“”“叮妇，
,．1”“呻，比ok”
..Il 暴d山｀＂＇缸d曰d如叩....
,·· ·olo.tod eMo USER-lp:
.....o妇俨<hoo妇戍归....彝"
，忙归n.. （N)”正(E)..u..r <O)缸y/(Q)ult7 o
恤···d eo..”“to • lot or...do• bytn, It lo •..”“• to..“° ..
0..."叮·otion”“....ho 妇吵°"J..... tho...“. ueil江..归
“比） d...In, tho,d.....nomtio., th"'“”“畴"ndo啊·••bo铲
,..”“r. bottor ohoneo t0 1.In onou.h one..“
, nnd to ••••..t. .lot”“ndo. bytOI. It 让· ·。”“”“..“0..
....“”“tIon (t”..n eho 妇吵0.rd..... tho..”“”“”,. .ho •:
＂归） d...ln1 ．加prl.....nor.tion; th1· 1”“”° "几...皿心o妒.
ln”`to俨． botto铲ohmeo to“In onou.h one..... ... 急.. 嘈： c,心e....n”“dSo..In"＾如lnl”“”“食pplic.tIon 妇t“'nu".......“b....I•.一....`lb o俨”“d
，归'A39PB1P8 吵妒妇d..ult归·oly“”“d
..In : rdr让oo•c•t.o.,.y 'c：心c....nt. md SottIng.＾妇Ini”“to“'ppl”“ion 归t"吓U”`` d• •..••od
,l”“'d goo..t 伽y C...••d..d gi旷'od.
'， c归l.klngt归t...tdlo
: 3....伍蠡l(I) n”dod. 1 C0叩lo”“> noo妇d. PCP t...t..妇l
1 妇吓hI.”“d: l ·i...d: e t...t: 贮.... In....“.“ , "立“'^”“”· 211S-l1嘈3
..y''"•·....int. 呻”“D1 `P31 8“'“”“ID IDDP,17D”“11”
lolt让td....K·· ＜缸o妇d归···••> , “”“.^DS5”m 211S-1仁如
图3-26 生成GnuPG 密钥
可以通过gpg -list-keys 命令查看当前的密钥列表，如图3-27 所示。
:',l)oc叩ont· 如d Sotting.Vkhin让t炉atoDgpg 一li•仁key•
：心cu吻ntI 叩d Sotting1^d“in”“atoWApplioation Datagnupg/"!bring.kb)(
“”“8八39PB1P8 2815-11心
id Cult江atol 缸c妇铲＜妇吐o..酝·n.OO啊＞
1吐，＂心”8/2DSS68C9 2815-11也
:`OCIIMnt. and. Sot”ng.｀妇幼i".. ato..>_
且
图3-27 查看GnuPG 密钥列表
(4) 加密与解密
加密和解密一个文件非常容易，这里以密钥hacker <hacker@msn.com>为例来进行说明，操
作过程如图3-28 所示。在测试前，首先创建一个内容为“GnuPG 测试”的文本文件sn.txt。
其中，命令gpg-ea 干hacker sn.txt 的功能是用hacker 的公钥对sn.txt 进行加密，并将密文以
ASCII 的方式输出到sn.txtasc。命令gpg-dsn.txt.asc 对信息原文进行加密，此过程中会要求输入
加密者backer 的私钥保护密码。其中，原文sn.txt 与密文sn.txtasc 的内容如图3-29 所示。
74
笫3 章信息加密与PK.I
一啊叫I =- ｀｀岫e田畴...... e”““'｀缸In1”“”“m”--...,. 、彝0... .. .... i.·:.·•, .....，...，一•l -<l•••YP• Ull•••.., f
11 、..........．布tt In" ｀缸In1”“”““' J ·句，＂. .... ,•：.： l1 ........” “”“”心It 黜n...,. 1. ．沉Sm,.....“”“'•-11心 L＆`·'． ........『（归“'.H归.....,.. `、·' 叩哪« 窃
心一....` ”“”“`d”“”“”“ 移
衫 皿忽』
图3-28 GnuPG 加密与解密
3.7 小结
屯心＇烹亨烹一一·14]
图3-29 原文与密文
信息加密是保障信息安全最核心的技术措施和理论基础，它采用密码学的原理与方法对
信息进行可逆的数学变换，从而使非法接入者无法理解信息的真正含义，达到保证信息机密性
的目的。信息加密算法共经历了古典密码、单钥密码体制（对称密钥密码）和双钥密码体制
（公开密钥密码） 3 个阶段，近年来云计算、电子商务等迅速发展，人们对同态加密的研究与
应用日益重视。
古典密码是密码学的源头，常见的算法有：简单代替密码或单字母密码、多名或同音代
替、多表代替，以及多字母或多码代替等。现代密码按照使用密钥方式的不同，可分为单钥密
码体制和双钥密码体制两类。按照加密模式的差异，单钥密码体制有序列密码（也称流密码）
和分组密码两种方式，它不仅可用于数据加密，还可用于消息认证，其中，最有影响的单钥密
码是DES 算法和IDEA 算法。双钥密码体制的加密密钥和解密密钥不同，在网络通信中，主
要用于认证（如数字签名、身份识别等）和密钥管理等，其杰出的算法有基于素数因子分解问
题的RSA 算法和基于离散对数问题的ElGamal 算法。同态加密是一类具有特殊自然属性的加
密方法，与一般加密算法相比，同态加密除了能实现基本的加密操作之外，还能实现密文间的
多种计算功能，即先计算后解密等价于先解密后计算。
在网络安全领域，网络数据加密是解决通信网中信息安全的有效方法，网络数据加密常
见的方式有链路加密、结点加密和端到端加密，以及一些同态加密典型应用等。其中，链路加
密是对网络中两个相邻结点之间传输的数据进行加密保护，结点加密是指在信息传输路过的结
点处进行解密和加密，端到端加密是指对一对用户之间的数据连续地提供保护。同态加密可对
密文数据进行直接运算，而不会破坏对应明文信息的完整性和保密性，对密文的操作等价于对
明文实施相应操作之后再加密。
在认证技术领域，通过使用密码手段， 一般可实现3 个目标，即消息完整性认证、身份
认证，以及消息的序号和操作时间（时间性）等认证。认证技术模型在结构上由安全管理协
议、认证体制和密码体制3 层组成。
PKI 是一个采用公钥密码算法原理和技术来提供安全服务的通用性基础平台，用户可利用
PKI 平台提供的安全服务进行安全通信， PKI 采用标准的密钥管理规则，能够为所有应用透明
地提供采用加密和数字签名等密码服务所需要的密钥和证书管理。PKI 在组成上主要包括认证
机构CA、证书库、密钥备份、证书作废处理系统和PKI 应用接口系统等。
PGP 和GnuPG 是两个常用的公钥加密软件， PGP 软件被Symantec 公司收购后，已经融
入其产品体系，形成了Symantec Encryption 解决方案， GnuPG 作为PGP 的代替软件，属于开
75
源免费软件，可以自由使用。
3.8 习题
计算机网络安全教程第4 版
1 ．简述信息加密技术对千保障信息安全的重要作用。
2. 简述加密技术的基本原理，并指出有哪些常用的加密体制及其代表算法。
3. 试分析古典密码对于构造现代密码有哪些启示。
4. 选择凯撒(Caesar) 密码系统的密钥k=6, 若明文为Caesar, 密文是什么？
5. DES 加密过程有哪几个基本步骤，试分析其安全性能。
6. 在本章RSA 实例的基础上，试给出m=student 的加解密过程。
7. RSA 签名方法与RSA 加密方法对密钥的使用有什么不同？
8. 试简述网络数据加密中的链路加密、结点加密和端到端加密方式。
9. 试简述同态加密技术在云计算中的典型应用方式。
10. 认证的目的是什么？试简述认证技术相互间的区别。
ll ．什么是PKI? 其用途有哪些？
12. 简述PKI 的功能模块组成。
13. 缸学习，你认为密码技术在网络安全实践中还有哪些重要应用领域，请举例说明。
76
4章
防火墙技术
防火墙(Firewall) 是使用最为广泛的一种网络安全技术。在构建安全网络环境的过程
中，防火墙作为第一道安全防线，正受到越来越多的关注。本章主要介绍防火墙的基本概念、
功能、体系结构及主要关键技术，简单介绍由防火墙脆弱性可能引起的入侵及其防护对策， 以
及防火墙产品应用示例和个人防火墙，最后介绍防火墙技术发展的动态和趋势。
4.1 概述
防火墙是一种将内部网络和外部网络（如Internet) 分开的方法，是提供信息安全服务、
实现网络和信息系统安全的重要基础设施，主要用千限制被保护的内部网络与外部网络之间进
行的信息存取及信息传递等操作。防火墙可以作为不同网络或网络安全域之间信息的出入口，
能根据安全策略控制出入网络的信息流，且本身具有较强的抗攻击能力。在逻辑上，防火墙是
一个分离器、一个限制器，也是一个分析器，可有效地监控内部网络和外部网络之间的任何活
动，保证内部网络的安全。
4.1.1 防火墙的概念
防火墙的本意是指古时候人们在住所之间修建的墙，这道墙可以在火灾发生时防止火势
蔓延到其他住所。
在计算机网络上，如果一个内部网络与Internet 连接，内部网络就可以访问外部网络
并与之通信。但同时，外部网络同样也可以访问该网络并与之交互。为安全起见，人们就
希望在内部网络和Internet 之间设置一个安全屏障，其作用是阻断来自外部网络对内部网
络的威胁和入侵，提供扼守本网络的安全和审计的第一道关卡。由于这样的安全屏障的作
用与古代的防火墙类似，因此人们习惯性地将其称为“防火墙',0
防火墙是位千被保护网络和外部网络之间执行访问控制策略的一个或一组系统，包括硬
件和软件，构成一道屏障，以防止发生对被保护网络的不可预测的、潜在破坏性的侵扰。它对
两个网络之间的通信进行控制，通过强制实施统一的安全策略，限制外界用户对内部网络的访
问，管理内部用户访问外部网络，防止对重要信息资源的非法存取和访问，以达到保护内部网
络系统安全的目的。
防火墙配置在不同网络（如可信任的单位内部网络和不可信的公共网络）或网络安全域
之间，本质上它遵循的是一种允许或阻止业务来往的网络通信安全机制，也就是提供可控的过
滤网络通信，只允许授权的通信，能根据单位的安全政策控制（允许、拒绝、监测）出入网络
的信息流，尽可能地对外部屏蔽网络内部的信息、结构和运行状况，以此来实现内部网络的运
行安全。
77
计算机网络安全教程笫4 版
4.1.2 防火墙的功能
防火墙是网络安全政策的有机组成部分，它通过控制和监测网络之间的信息交换和ijj 问
行为来实现对网络安全的有效管理。从基本要求上看，防火墙还是在两个网络之间执行控制~
略的系统（包括硬件和软件），目的是不被非法用户侵入。它遵循的是一种允许或禁止业务＊
往的网络通信安全机制，也就是提供可控的过滤网络通信，只允许授权的通信。因此，对~~
和访问的控制，以及对网络活动的记录，是防火墙发挥作用的根本和关键。
无论何种类型的防火墙，从总体上看，都应具有以下五大基本功能：过滤进、出网~的
数据，管理进、出网络的访问行为，封堵某些禁止的业务，记录通过防火墙的信息内容和~
动，以及对网络攻击的检测和告警。
1. 过滤进、出网络的数据
防火墙是任何信息进、出网络的必经之路，它检查所有数据的细节，并根据事先定义~
的策略允许或禁止这些数据进行通信。这种强制性的集中实施安全策略的方法，更多的是~~
内部网络的整体安全共性， 一般不为网络中的某一台计算机提供特殊的安全保护，简化了~
理，提高了效率。
2. 管理进、出网络的访问行为
网络数据的传输更多的是通过不同的网络访问服务而获取的，只要对这些网络访问
服务加以限制，包括禁止存在安全脆弱性的服务进、出网络，也能够达到安全目的。即
通过将动态的、应用层的过滤能力和认证相结合，实现HTTP 、FTP 和Telnet 等广泛的服鲁
务支持。
3. 封堵某些禁止的业务
传统的内部网络系统与外界相连后，往往把自己的一些本身并不安全的服务，比如NFS
和NIS 等完全暴露在外，使它们成为外界主机侦探和攻击的主要目标，可利用防火墙对相~
的服务进行封堵。
4. 记录通过防火墙的信息内容和活动
对一个内部网络已经连接到外部网络上的机构来说，重要的问题并不是网络是否会受到
攻击，而是何时会受到攻击。网络管理员必须审计并记录所有通过防火墙的重要信息。如果网
络管理员不能及时响应报警并审查常规记录，防火墙就形同虚设。
5．对网络攻击进行检测和告警
如果一个单位没有设置传达室和门卫，任何人都可以长驱直入地到各房间中去，特别~
当单位规模较大时，更难以保证每个房间都有较高的安全度。况且，随着失误变得越来越~
遍，很多“入侵”是由于配置或密码错误造成的，而不是故意和复杂的攻击。而防火墙的作用
就是提高主机整体的安全性，主要包括以下5 点。
l) 控制不安全的服务。防火墙可以控制不安全的服务，因为只有授权的协议和服务才能
通过防火墙，这就大大降低了内部网络的暴露度，提高了网络的安全度，从而使内部网络免千
遭受来自外界的基千某协议或某服务的攻击。防火墙还能防止基千路由的攻击策略，拒绝这种
攻击试探并将情况通知系统管理员。
2) 站点访问控制。防火墙还提供了对站点的访问控制。比如，从外界可以访问某些主
机，却不能非法地访问另一些主机，即在网络的边界上形成一道关卡。一般而言，一个站点应
78
第4 章防火墙技术
该对进来的外部访问有所选择，至千邮件服务和信息服务肯定是要开放的。如果一个用户很少
提供网络服务，或几乎不跟别的站点打交道，防火墙就是他保护自己的最好选择。
3) 集中安全保护。如果一个内部网络中大部分需要维护的软件，尤其是安全软件能集中
放在防火墙系统上，而不是分散到每个主机中，会使整体的安全保护相对集中，也相对便宜，
简化网络的安全管理，提高网络的整体安全性。例如，对千密码口令系统或其他的身份认证软
件等放在防火墙系统中更是优千放在每个Internet 能访问的计算机上。
4) 强化私有权。对一些站点而言，私有性是很重要的，因为，某些看似不甚重要的信息
往往会成为攻击者灵感的源泉。使用防火墙系统，站点可以防止finger 及DNS 域名服务。
finger 会列出当前使用者名单，他们上次登录的时间，以及是否读过邮件等。但finger 同时会
不经意地告诉攻击者该系统的使用频率，是否有用户正在使用，以及是否可能发动攻击而不被
发现。防火墙也能封锁域名服务信息，从而使Internet 外部主机无法获取站点名和IP 地址。通
过封锁这些信息，可以防止攻击者从中获得另一些有用信息。
5) 网络连接的日志记录及使用统计。通过防火墙可以很方便地监视网络的安全性，并产
生报警信号。当防火墙系统被配置为所有内部网络与外部Internet 连接均需经过的安全系统
时，防火墙系统就能够对所有的访问进行日志记录。日志是对一些可能的攻击进行分析和防范
的十分重要的信息。另外，防火墙系统也能够对正常的网络使用情况做出统计。通过对统计结
果的分析，可以使网络资源得到更好的使用。网络管理员必须经常审查并记录所有通过防火墙
的重要信息。
为实现防火墙系统的以上功能，在防火墙产品的开发中，人们广泛应用网络拓扑技术、
计算机操作系统技术、路由技术、加密技术、访问控制技术和安全审计技术等。
虽然防火墙是保证内部网络安全的重要手段，但防火墙也有其局限性，市场上每个防火
墙产品几乎每年都有安全脆弱点被发现。
4.1.3 防火墙的局限性
防火墙的局限性主要体现在以下几个方面。
1. 网络的安全性通常是以网络服务的开放性和灵活性为代价
在网络系统中部署防火墙，通常会使网络系统的部分功能被削弱。
l) 由千防火墙的隔离作用，在保护内部网络的同时使它与外部网络的信息交流受到
阻碍。
2) 由于在防火墙上附加各种信息服务的代理软件，增大了网络管理开销，还减慢了信息
传输速率，在大量使用分布式应用的情况下，使用防火墙是不切实际的。
2. 防火墙只是整个网络安全防护体系的一部分，而且防火墙井非万无一失
l) 只能防范经过其本身的非法访问和攻击，对绕过防火墙的访问和攻击无能为力。
2) 不能解决来自内部网络的攻击和安全问题。
3) 不能防止受病毒感染的文件的传输。
4) 不能防止策略配置不当或错误配置引起的安全威胁。
5) 不能防止自然或人为的故意破坏。
6) 不能防止本身安全漏洞的威胁。
79
计算机网络安全教程笫4 版
4.2 防火墙体系结构
防火墙的目的在于实现安全访问控制，因此按照OSI 模型的安全要求，防火墙可以在
OSI 七层中的五层设置。防火墙从功能上分，通常
人机接口
由几部分组成， 如图4-1 所示。
目前，防火墙的体系结构一般有以下几种。访间控制策略1 审计1 安全管理1 数据加密
·双重宿主主机体系结构。
·屏蔽主机体系结构。
·屏蔽子网体系结构。
4.2.1 双重宿主主机体系结构
网络互连设备
图4-1 防火墙功能图
双重宿主主机体系结构是围绕具有双重宿主的主机计算机而构筑的，该计算机至&有节可
个网络接口。这样的主机可以充当与这些接口相连的网络之间的路由器；它能够从一个网~~
送IP 数据包到另一个网络。然而，实现双重宿主主机的防火墙体系结构禁止这种发送~能托
因而， IP 数据包从一个网络（如互联网）并不是直接发送到其他网络（如内部的、被保：护，的
网络）。防火墙内部的系统能与双重宿主主机通信，同时防火墙外部的系统能与双重宿~主；机｀
通信，但是这些系统不能直接互相通信。它们之间的IP 通信被完全阻止。
双重宿主主机的防火墙体系结构是相当简单的：双重宿主主机位于两者之间， 并且甩支连；
接到外部网络和内部网络。图4-2 显示了这种体系结构。
尸口
L
．一勺， • .., , .. .. .~..
一二： 一＿1L
勹， ．． 内部网络
. .,... 4 .,“ ·..“' ···- :. . . 'i, __ ＿，恤－ ．．
内部主机工作站工作站
图4-2 双重宿主主机体系结构
4.2.2 屏蔽主机体系结构
工作站
双重宿主主机体系结构是由一台同时连接内外部网络的双重宿主主机提供安全保障的，而？屏
蔽主机体系结构则不同，在屏蔽主机体系结构中，提供安全保护的主机仅仅与被保护的内剖邓习络
相连。屏蔽主机体系结构还使用一个单独的过滤路由器来提供主要安全，其结构如图4-3 所方:;;'o
80
笫4 章防火墙技术
防火墙
内部网络
血
堡垒主机1 内部主机工作站工作站
图4-3 屏蔽主机体系结构
在图4-3 中，堡垒主机位于内部的网络上，是外部网络上的主机连接到内部网络上的系
统的桥梁（例如，传送进来的电子邮件）。即使这样，也仅有某些确定类型的连接被允许，任
何外部的系统试图访问内部的系统或者服务将必须连接到这台堡垒主机上。因此，堡垒主机需
要拥有高等级的安全。
数据包过滤也允许堡垒主机开放可允许的连接（什么是“可允许“将由用户站点的安全
策略决定）到外部网络。
在该结构的路由器中数据包过滤配置可以按下列方法执行。
l) 允许其他的内部主机为了某些服务与外部网上的主机连接（即允许那些已经由数据包
过滤的服务）。
2) 不允许来自内部主机的所有连接（强迫那些主机通过堡垒主机使用代理服务）。用户
可以针对不同的服务混合使用这些手段；某些服务可以被允许直接通过数据包过滤，而其他服
务可以被允许仅仅间接地经过代理。这完全取决于用户实行的安全策略。
因为这种体系结构允许数据包从外部网络向内部网络的移动，所以，它的设计比没有外
部数据包能到达内部网络的双重宿主主机体系结构似乎更冒风险。但实际上双重宿主主机体系
结构在防范数据包从外部网络穿过内部网络时，也容易产生失败（如黑客侵袭）。另外，保护
路由器比保护主机较易实现，因为它提供的服务非常有限。多数情况下，屏蔽主机体系结构比
双重宿主主机体系结构具有更好的安全性和可用性。
4.2.3 屏蔽子网体系结构
屏蔽子网体系结构添加额外的安全层到屏蔽主机体系结构，即通过添加周边网络更进一
步把内部网络与外部网络隔离开。
堡垒主机是用户网络上最容易受侵袭的计算机。在屏蔽主机体系结构中，堡垒主机是非
常诱人的攻击目标，因为它一旦被攻破，被保护的内部网络就会在外部入侵者面前门户洞开，
在堡垒主机与内部网络的其他内部计算机之间没有其他的防御手段（除了它们可能有的通常非
常少的主机安全之外）。如果有人成功地侵入屏蔽主机体系结构中的堡垒主机，那就毫无阻挡
地进入了内部系统。
81
计算机网络安全教程笫4 版
通过用周边网络隔离堡垒主机，能减少堡垒主机被入侵而造成的影响。可以说，它只~
入侵者一些访问的机会，但不是全部。屏蔽子网体系结构的最简单形式为：两个屏蔽路由器；的
每一个都连接到周边网，一个位千周边网与被保护的内部网络之间，另一个位千周边网与外部
网络之间（通常为Internet) 。其结构如图4-4 所示。
周边网络
防火墙
内部主机
工作站工作站工作站
图4-4 屏蔽子网体系结构
为了侵入用这种类型的体系结构保护的内部网络，入侵者必须通过两个路由器。即使〉、
侵者设法侵入堡垒主机，他将仍然必须通过内部路由器。
下面介绍在这种结构里所采用的组件。
1. 周边网络
周边网络是另一个安全层，是在外部网络与用户的被保护的内部网络之间的附加网~ 。
如果入侵者成功地侵入用户的防火墙的外层领域，周边网络能在入侵者与用户的内部系统Z间
提供一个附加的保护层。
对千周边网络的作用举例说明如下。
在许多网络设置中，用给定网络上的任何计算机来查看这个网络上的每一台计算机的~
信是可能的，对大多数以以太网为基础的网络确实如此（而且以太网是当今使用最广泛的局划；
网技术）；对若干其他成熟的技术，诸如令牌环和FDDI 也是如此。探听者可以成功获取那些：
在Telnet、FfP 及rlogin 会话期间使用过的口令信息。即使口令未被攻破，探听者仍然能~看·
或访问他人的敏感文件的内容， 或阅读他们感兴趣的电子邮件等；探听者能完全监视何人~使：
用网络。
对千周边网络，如果某人侵入周边网上的堡垒主机，他仅能探听到周边网上的通信。因
为所有周边网上的通信仅通过周边网络来往千外部网络或堡垒主机。因为没有严格的内部~~
（即在两台内部主机之间的通信，这通常是敏感的或者专有的）能越过周边网。所以，即使堡皂
垒主机被损害，内部的通信也将是安全的。
一般来说， 来往于堡垒主机或者外部世界的通信仍然是可监视的。防火墙设计工作的一
82
第4 章防火墙技术
部分就是确保上述信息流的暴露不至千影响到整个内部网络的安全。
2. 堡垒主机
在屏蔽的子网体系结构中，用户把堡垒主机连接到周边网，这台主机便是接受来自外界
连接的主要入口。它为内部网络服务的功能如下。
l) 接收外来的电子邮件(SMTP) ，再分发给相应的站点。
2) 接收外来的FTP 连接，再转接到内部网的匿名FTP 服务器。
3) 接收外来的对有关内部网站点的域名服务(DNS) 查询。
这台堡垒主机向外（从内部网的客户向外部服务器）的服务功能按以下方法实施。
l) 在外部和内部的路由器上设置数据包过滤来允许内部的客户端直接访问外部的服务器。
2) 设置代理服务器在堡垒主机上运行，允许内部网的用户间接地访问外部网的服务器。
也可以设置数据包过滤，允许内部网的用户与堡垒主机上的代理服务器进行交互，但是禁止内
部网的用户直接与外部网进行通信。
3. 内部路由器
内部路由器（在有关防火墙著作中有时被称为阻塞路由器）保护内部的网络免受外部网
和周边网的侵犯。
内部路由器完成防火墙的大部分数据包过滤工作。它允许从内部网到外部网的有选择的外连
服务。这些服务是根据内部网络的需要和安全规则选定的，如Telnet、FI'P 和Gopher 等。
内部路由器可以设定，使周边网上的堡垒主机与内部网之间传递的各种服务不同千内部
网和外部网之间传递的各种服务。限制堡垒主机和内部网之间服务的理由是减少在堡垒主机被
入侵后而受到侵袭的内部网主机的数量。
4. 外部路由器
在理论上，外部路由器（在有关防火墙著作中有时称为访问路由器）保护周边网和内部
网免受来自外部网络的侵犯。实际上，外部路由器倾向千几乎让所有周边网的外出请求通
过，通常只执行非常少的数据包过滤。保护内部计算机的数据包过滤规则在内部路由器和外
部路由器上基本是一样的，如果在规则中有允许入侵者访问的错误，错误就可能出现在两个
路由器上。
由千外部路由器一般由外界提供（例如，用户的因特网服务供应商一ISP) ，所以用户
对外部路由器的访问是受限制的。ISP 可能愿意放入一些通用型数据包过滤规则来维护路由
器，但是不愿意使用维护复杂或者频繁变化的过滤规则。因此，对千安全保障而言，不能像依
靠内部路由器那样依靠外部路由器。
外部路由器能有效地执行的安全任务是：阻断从外部网络上伪造源地址进来的任何数据
包。这样的数据包自称来自内部的网络，但实际上是来自外部网络。
4.2.4 防火墙体系结构的组合形式
建造防火墙时，一般很少采用单一的技术，通常是多种解决不同问题的技术的组合。这
种组合主要取决于网管中心提供什么样的服务，以及网管中心能够接受什么等级的风险。采
用哪种技术主要取决于经费、投资的大小或技术人员的技术、时间等因素。一般有以下一些
形式。
·使用多堡垒主机。
·合并内部路由器与外部路由器。
83
计算机网络安全教程笫4 版
·合并堡垒主机与外部路由器。
·合并堡垒主机与内部路由器。
·使用多台内部路由器。
·使用多台外部路由器。
·使用多个周边网络。
·使用双重宿主主机与屏蔽子网。
4.3 常用防火墙技术
从工作原理角度看，防火墙主要可以分为网络层防火墙和应用层防火墙。这两种~型防
火墙的具体实现技术主要有包过滤技术、代理服务技术、状态检测技术和NAT 技术等。
4.3.1 包过滤技术
包过滤防火墙工作在网络层，通常基千1P 数据包的源地址、目的地址、源端口和目的端口进：行
过滤。它的优点是效率比较高，对用户来说是透明的，用户可能不会感觉到包过滤防火墙的存~除
非他是非法用户被拒绝了。缺点是对千大多数服务和协议不能提供安全保障，无法有效地区分·同一－
IP 地址的不同用户，并且包过滤防火墙难以配置、监控和管理，不能提供足够的日志和报警。
数据包过滤(Packet Filtering) 技术是在网络层对数据包进行选择，选择的依据是系~内
设置的过滤逻辑，被称为访问控制列表(Access Control List, ACL) 。通过检查数据流中每个
数据包的源地址、目的地址、所用的端口号和协议状态等因素或它们的组合，来确定是否允许
该数据包通过。
数据包过滤防火墙逻辑简单，价格便宜，易于安装和使用，网络性能和透明性好，它通
常安装在路由器上。路由器是内部网络与Internet 连接必不可少的设备，因此在原有网~上增
加这样的防火墙几乎不需要任何额外的费用。数据包过滤防火墙的缺点有两个：一是非~i方问
一旦突破防火墙，即可对主机上的软件和配置漏洞进行攻击；二是数据包的源地址、目的~址
及1P 的端口号都在数据包的头部，很有可能被窃听或假冒。分组过滤或包过滤是一种~用、
廉价、有效的安全手段。之所以通用，是因为它不针对各个具体的网络服务采取特殊的处理方
式；之所以廉价，是因为大多数路由器都提供分组过滤功能；之所以有效，是因为它能很大程
度地满足企业的安全要求。过滤所根据的信息来源千1P、TCP 或UDP 包头。包过滤的优点是
不用改动客户机和主机上的应用程序，因为它工作在网络层和传输层，与应用层无关。~~弱
点也是明显的：用来过滤判别的只有网络层和传输层的有限信息，因而各种安全要求不可能充
分满足；在许多过滤器中，过滤规则的数目是有限制的，且随着规则数目的增加，性能会受到
很大的影响；由千缺少上下文关联信息，不能有效地过滤如UDP 或RPC 一类的协议；另外，
大多数过滤器中缺少审计和报警机制，且管理方式和用户界面较差；对安全管理人员素质要求
高，建立安全规则时，必须对协议本身及其在不同应用程序中的作用有较深入的理解。因此，
过滤器通常是与应用网关配合使用，共同组成防火墙系统。
1. 包过滤模型
包过滤型防火墙一般有一个包检查模块，可以根据数据包头中的各项信息来控制站点与站点、
站点与网络、网络与网络之间的相互访问，但不能控制传输的数据内容，因为内容是应用层数据。
包检查模块应该深入到操作系统的核心，在操作系统或路由器转发包之前拦截所有的数
84
笫4 章防火墙技术
据包。当包过滤型防火墙安装在网关上之后，包过滤检查模块深入到系统的网络层和数据链路
层之间，即TCP 层和IP 层之间。抢在操作系统或路由器的TCP 层之前对1P 包进行处理。因
为数据链路层事实上就是网卡(NIC) ，网络层是第一层协议堆栈，所以包过滤型防火墙位千
软件层次的最底层。包过滤模型如图4-5 所示。
7 应用层
6 表示层
5 会话层
4 传输层
3 网络层
防火墙检查模块
|2 数据链路层1
I )物理层1
IP I TCP Application Data
图4-S 包过滤模型
通过检查模块，防火墙能拦截和检查所有进出的数据。防火墙检查模块首先验证这个数
据包是否符合过滤规则。无论是否符合过滤规则，防火墙一般都要记录数据包情况，不符合规
则的包要进行报警或通知管理员。对千丢弃的数据包，防火墙可以发给发送方一个消息，也可
以不发，这取决千包过滤策略。如果返回一个消息，攻击者可能会根据拒绝包的类型猜测包过
滤规则的大致情况。
2. 包过滤的工作过程
数据包过滤技术可以允许或不允许某些数据包在网络上传输，主要依据如下。
·数据包的源地址。
·数据包的目的地址。
·数据包的协议类型（如TCP、UDP 和ICMP 等）。
• TCP 或UDP 的源端口。
• TCP 或UDP 的目的端口。
• ICMP 消息类型。
大多数包过滤系统判断是否传送数据包时都不关心包的具体内容。包过滤系统只能进行
类似以下情况的操作。
l) 不让任何用户从外部网用Telnet 登录。
2) 允许任何用户使用SMTP 向内部网发电子邮件。
3) 只允许某台计算机通过NNTP 向内部网发新闻。
但包过滤不允许如下操作。
l) 允许某个用户从外部网用Telnet 登录而不允许其他用户进行这种操作。
2) 允许用户传送一些文件而不允许用户传送其他文件。
85
计算机网络安全教程笫4 版
包过滤系统不能识别数据包中的用户信息，同样包过滤系统也不能识别数据~中的文：件
信息。包过滤系统的主要特点是可在一台计算机上提供对整个网络的保护。以Telnet 关I仔tl, 假
定为了不让使用Telnet 而将网络中所有计算机上的Telnet 服务器关闭，即使这样做了，也刁＜能
保证在网络中新增计算机时，新计算机的Telnet 服务器也被关闭或其他用户不重新安~ Telnet
服务器。如果有了包过滤系统，只要在包过滤中对此进行设置，也就无所谓计算机中的Telnet
服务器是否存在的问题了。
包过滤路由器为所有进出网络的数据流提供了一个有用的阻塞点。有些类型的保：护1 只能
由放置在网络中特定位置的过滤路由器来提供。比如，设计这样的安全规则，让网络拒绝托E何
含有内部地址的包一就是那种看起来好像来自内部主机其实来自外部网的包，这种包经切仵
被作为地址伪装入侵的一部分。入侵者总是用这种包把他们伪装成来自内部网。要用包过：淀括各
由器来实现设计的安全规则，唯一的方法是通过参数设置网络上的包过滤路由器。图4-6 说｀明
了对这种包的防范。只有处在如图4-6 所示位置上的包过滤路由器才能查看包的源地址，从｀而
辨认出这个包到底是来自内部网还是来自千外部网。
172.16.1.1
I,
外部路由器
渊地址假冒为10.1.1.3
目的地址也为10.1.1.3
内部主机
10.U.2
，周边网络
192.168.100.1
内部路由器
10.1.1.l
部网
工作站
)0.1.1.4
图4-6 源地址伪装
匕堡垒主机
I 92.168.1.3
工作站
包过滤方式有许多优点，其中之一是仅用一个放置在重要位置上的包过滤路由器即可节卡
护整个网络。如果站点与外部网络间只有一台路由器，那么无论站点规模有多大，只~~这：台
路由器上设置合适的包过滤，站点就可获得很好的网络安全保护。
包过滤不需要用户软件的支持，也不要求对客户机做特别的设置，也没有必要~用户做
任何培训。当包过滤路由器允许包通过时，它表现得和普通路由器没有任何区别。此时，用户
甚至感觉不到包过滤功能的存在，只有在某些包被禁入或禁出时，用户才认识到它与~通辟压1
器的不同。包过滤工作对用户来讲是透明的。这种透明就是可在不要求用户进行任何~作书勺前
提下完成包过滤。
86
第4 章防火墙技术
3. 包过滤路由器的配置
在配置包过滤路由器时，首先要确定哪些服务允许通过而哪些服务应被拒绝，并将这些
规定翻译成有关的包过滤规则。对包的内容一般并不需要多加关心。比如：允许站点接收来自
外部网的邮件，而不关心该邮件是用什么工具制作的。路由器只关注包中的一小部分内容。下
面给出将有关服务翻译成包过滤规则时非常重要的几个概念。
l) 协议的双向性。协议总是双向的，协议包括一方发送一个请求而另一方返回一个应
答。在制定包过滤规则时，要注意包是从两个方向来到路由器的，比如，只允许往外的Telnet
包将键入信息送达远程主机，而不允许返回的显示信息包通过相同的连接，这种规则是不正确
的，同时，拒绝半个连接往往也是不起作用的。在许多攻击中，入侵者向内部网发送包，他们
甚至不用返回信息就可完成对内部网的攻击，因为他们能对返回信息加以推测。
2)“往内”与“往外”的含义。在制定包过滤规则时，必须准确理解“往内”与“往
外”的包和“往内”与“往外”的服务这几个词的语义。一个往外的服务（如上面提到的
Telnet) 同时包含往外的包（键入信息）和往内的包（返回的屏幕显示的信息）。虽然大多数人
习惯于用“服务”来定义规定，但在制定包过滤规则时，一定要具体到每一种类型的包。在使
用包过滤时也一定要弄清“往内” 与“往外”的包和“往内”与“往外”的服务这几个词之间
的区别。
3)“默认允许”与“默认拒绝”。网络的安全策略中有两种方法：默认拒绝（没有明确地
被允许就应被拒绝）与默认允许（没有明确地被拒绝就应被允许）。从安全角度来看，用默认
拒绝应该更合适。如前面讨论的，首先应从拒绝任何传输开始设置包过滤规则，然后再对某些
应被允许传输的协议设置允许标志。这样做系统的安全性会更好一些。
4. 包过滤处理内核
过滤路由器可以利用包过滤作为手段来提高网络的安全性。许多商业路由器都可以通过
编程来执行过滤功能。路由器制造商，如Cisco、华为等提供的路由器都可以通过编写访问控
制列表(ACL) 来执行包过滤功能。
(1) 网络安全策略
包过滤还可以用来实现大范围内的网络安全策略。网络安全策略必须清楚地说明被保护
的网络和服务的类型、它们的重要程度，以及这些服务要保护的对象。
一般来说，网络安全策略主要集中在阻截入侵者，而不是试图警戒内部用户。其工作的
重点是阻止外来用户的突然侵入和故意暴露敏感性数据，而不是阻止内部用户使用外部网络服
务。这种类型的网络安全策略决定了过滤路由器应该放在哪里和怎样通过编程来执行包过滤。
网络安全策略的一个目标就是要提供一个透明机制，保证这些策略不会对用户产生障碍。
(2) 包过滤策略
包过滤器通常置千一个或多个网段之间。网络段区分为外部网段和内部网段。外部网段是通
过网络将用户的计算机连接到外面的网络上，内部网段用来连接公司的主机和其他网络资源。
包过滤器设备的每一个端口都可用来完成网络安全策略，该策略描述了通过此端口可访
问的网络服务类型。如果连在包过滤设备上的网络段的数目很大，那么包过滤所要完成的服务
就会变得很复杂。一般来说，应当避免对网络安全问题采取过千复杂的解决方案，大多数情况
下包过滤设备只连两个网段，即外部网段和内部网段。包过滤用来限制那些它拒绝的服务的网
络流量。因为网络策略是应用于那些与外部主机有联系的内部用户的，所以过滤路由器端口两
边的过滤器必须以不同的方式工作。
87
计算机网络安全教程笫4 版
(3) 包过滤器操作
几乎所有的包过滤设备（过滤路由器或包过滤网关）都按照以下方式工作。
l) 包过滤标准必须由包过滤设备端口存储起来，这些包过滤标准称为包过滤规则。
2) 当包到达端口时，对包的报头进行语法分析，大部分包过滤设备只检查IP 、TCP 或；
UDP 报头中的字段，不检查数据的内容。
3) 包过滤器规则以特殊的方式存储。
4) 如果一条规则阻止包传输或接收，此包便不允许通过。
5) 如果一条规则允许包传输或接收，该包可以继续处理。
6) 如果一个包不满足任何一条规则，该包被丢弃。
过滤规则可以用图4-7 来表示。从规则中可以看到，过滤规则的排列顺序是非常~~
的。配置包过滤规则时，常犯的错误就是把规则的顺序放错了，如果包过滤器规则以错~的JI顶
序放置，那么有效的服务也可能被拒绝了，而该拒绝的服务却允许了。另外，规则的排列沙J字
不恰当，也影响数据包的处理效率。
访问包过滤规则
分析报头字段： IP、UDP和TCP
应用下一条过滤规则
图4-7 包过滤操作流程图
从方式6) 可以看到，在为网络安全设计过滤规则时，应该遵循自动防止故障的原；
理：未明确表示允许的便被禁止，此原理是为包过滤设计的。因此，随着网络应用的深入，会？
有新应用（服务）的增加，这样就需要为新服务调整过滤规则，否则新的服务就不能~过：~
火墙。
5. 包过滤技术的缺陷
虽然包过滤技术是一种通用、廉价的安全手段，许多路由器都可以充当包过滤防~~，
满足一般的安全性要求，但是它也有一些缺点及局限性。
(1) 不能彻底防止地址欺骗
大多数包过滤路由器都是基于源1P 地址和目的IP 地址而进行过滤的。而数据~的~炖i
88
第4 章防火墙技术
址、目的地址及IP 的端口号都在数据包的头部，很有可能被窃听或假冒(IP 地址的伪造是很
容易、很普遍的），如果攻击者把自己主机的IP 地址设成一个合法主机的IP 地址，就可以很
轻易地通过报文过滤器。所以，包过滤最主要的弱点是不能在用户级别上进行过滤，即不能识
别不同的用户和防止IP 地址的盗用。
过滤路由器在这点上大都无能为力。即使绑定MAC 地址，也未必是可信的。对千一些安
全性要求较高的网络，过滤路由器是不能胜任的。
(2) 无法执行某些安全策略
有些安全规则是难以用包过滤系统来实施的。例如，在数据包中只有来自某台主机的信
息而无来自某个用户的信息，因为包的报头信息只能说明数据包来自什么主机，而不是什么用
户，若要过滤用户就不能用包过滤。再如，数据包只说明到什么端口，而不是到什么应用程
序，这就存在着很大的安全隐患和管理控制漏洞。因此数据包过滤路由器上的信息不能完全满
足用户对安全策略的需求。
(3) 安全性较差
过滤判别的只有网络层和传输层的有限信息，因而各种安全要求不可能充分满足；在
许多过滤器中，过滤规则的数目是有限制的，且随着规则数目的增加，性能会受到很大的
影响；由千缺少上下文关联信息，不能有效地过滤如UDP、RPC 一类的协议：非法访问一
旦突破防火墙，即可对主机上的软件和配置漏洞进行攻击：大多数过滤器中缺少审计和报
警机制，通常没有用户的使用记录，这样管理员就不能从访问记录中发现黑客的攻击记
录。而攻击一个单纯的包过滤式的防火墙对黑客来说是比较容易的，他们在这一方面已经
积素了大量的经验。
(4) 一些应用协议不适合千数据包过滤
即使在系统中安装了比较完善的包过滤系统，也会发现对有些协议使用包过滤方式不太
合适。比如，对UNIX 的r 系列命令(rsh、rlogin) 和类似千NFS 协议的RPC, 用包过滤系统
就不太合适。
(5) 管理功能弱
数据包过滤规则难以配置，管理方式和用户界面较差；对安全管理人员素质要求高；建
立安全规则时，必须对协议本身及其在不同应用程序中的作用有较深入的理解。
从以上的分析可以看出，包过滤防火墙技术虽然能确保一定的安全保护，且也有许多优
点，但毕竟是早期防火墙技术，本身存在较大缺陷，不能提供较高的安全性。因此，在实际应
用中，很少把包过滤技术当作单独的安全解决方案，通常是把它与应用网关配合使用或与其他
防火墙技术鞣合在一起使用，共同组成防火墙系统。
4.3.2 代理服务技术
代理服务(Proxy) 技术是一种比较新型的防火墙技术，它分为应用层网关和电硌层网关。
1. 代理服务的原理
所谓代理服务器，是指代表客户处理连接请求的程序。当代理服务器得到一个客户的连
接意图时，它将核实客户请求，并用特定的安全化的Proxy 应用程序来处理连接请求，将处理
后的请求传递到真实的服务器上，然后接收服务器应答，并做进一步处理后，将答复交给发出
请求的最终客户。代理服务器在外部网络向内部网络申请服务时发挥了中间转接和隔离内、外
部网络的作用，所以又称代理防火墙。
89
计算机网络安全教程第4 版
代理防火墙工作千应用层，且针对特定的应用层协议。代理防火墙通过编程来掌握用户
应用层的流噩，并能在用户层和应用协议层间提供访问控制，而且还可用来保持一个所有~用
程序使用的记录。记录和控制所有进出流量的能力是应用层网关的主要优点之一。代理防火墙f
的工作原理如图4-8 所示。
真实的客户端
图4-8 代理防火墙的工作原理
从图4-8 中可以看出，代理服务器(Proxy Server) 作为内部网络客户端的服务器，~褥；
住所有请求，也向客户端转发响应。代理客户机(Proxy Client) 负责代表内部客户端向外剖；
服务器发出请求，当然也向代理服务器转发响应。
2. 应用层网关防火墙
(1) 原理
应用层网关(Application Level Gateways) 防火墙是传统代理型防火墙，它的核心技术就：
是代理服务器技术，它是基于软件的，通常安装在专用工作站系统上。这种防火墙通过代~技：
术参与到一个TCP 连接的全过程，并在网络应用层上建立协议过滤和转发功能， 所以被利寸3
应用层网关。当某用户（无论是远程的还是本地的）想和一个运行代理的网络建立联系时，此；
代理（应用层网关）会阻塞这个连接，然后在过滤的同时对数据包进行必要的分析、登记和统：
计，形成检查报告。如果此连接请求符合预定的安全策略或规则，代理防火墙便会在用户和服；
务器之间建立一个“桥”，从而保证其通信。对不符合预定的安全规则的，则阻塞或抛弃。~
句话说，“桥”上设置了很多控制。
同时，应用层网关将内部用户的请求确认后送到外部服务器，再将外部服务器的响~回
送给用户。这种技术对ISP 很常见，用千在Web 服务器上高速缓存信息，并且扮演Web 客
户和Web 服务器之间的中介角色。它主要保存Internet 上那些最常用和最近访问过的内容，
在Web 上，代理首先试图在本地寻找数据，如果没有，再到远程服务器上去查找。应用层网
关为用户提供了更快的访问速度，并且提高了网络安全性。应用层网关的工作原理如图4-9
所示。
90
第4 章防火墙技术
应用层应用层应用层
传输层传输层传输层
因特网层μ 因特网层因特网层
I 网络接口层1 I 网络接口层1 I 网络接口层1
图4-9 应用层网关防火墙
(2) 优点
应用层网关防火墙最突出的优点就是安全，这种类型的防火墙被网络安全专家和媒体公
认为是最安全的防火墙。由于每一个内外网络之间的连接都要通过Proxy 的介入和转换，通过
专门为特定的服务（如HTfP) 编写的安全化的应用程序进行处理，然后由防火墙本身提交请
求和应答，不给内外网络的计算机任何直接会话的机会，从而避免了入侵者使用数据驱动类型
的攻击方式入侵内部网络。从内部发出的数据包经过这样的防火墙处理后，就好像是源于防火
墙外部网卡一样，从而可以达到隐藏内部网结构的作用。包过滤类型的防火墙是很难彻底避免
这一漏洞的。
应用层网关防火墙同时也是内部网与外部网的隔离点，起着监视和隔绝应用层通信流的
作用，它工作在OSI 模型的最高层，掌握着应用系统中可用做安全决策的全部信息。
(3) 缺点
代理防火墙的最大缺点就是速度相对比较慢，当用户对内外网络网关的吞吐量要求比较
高时（如要求达到75,.....,lOOMbit/s 时），代理防火墙就会成为内外网络之间的瓶颈。所幸的
是，目前用户接入Internet 的速度一般都远低千这个数字。在现实环境中，要考虑使用包过
滤类型防火墙来满足速度要求的情况，大部分是高速网(ATM 或千兆位Intranet 等）之间的
防火墙。
3. 电路层网关防火墙
另一种类型的代理技术称为电路层网关(Circuit Level Gateway) 或TCP 通道(TCP
Tunnels) 。这种防火墙不建立被保护的内部网和外部网的直接连接，而是通过电路层网关中继
TCP 连接。在电路层网关中，包被提交给用户应用层处理。电路层网关用来在两个通信的终
点之间转换包，其原理如图4-10 所示。
TCP Socket
TCP
[P
网络接口
图4-10 电路层网关原理
TCP Socket
电路层网关是建立应用层网关的一个更加灵活的方法。它是针对数据包过滤和应用网关技
91
计算机网络安全教程笫4 版
术存在的缺点而引入的防火墙技术，一般采用自适应代理技术，也称为自适应代理防火墙。在
电路层网关中，需要安装特殊的客户机软件。组成这种类型防火墙的基本要素有两个：自适应
代理服务器(Adaptive Proxy Server) 与动态包过滤器(Dynamic Packet Filter) 。在自适应代理服
务器与动态包过滤器之间存在一个控制通道。在对防火墙进行配置时，用户仅仅将所需要的服
务类型和安全级别等信息通过相应Proxy 的管理界面进行设置就可以了。然后，自适应代~月员
务器就可以根据用户的配置信息，决定是使用代理服务从应用层代理请求还是从网络层转
发数据包。如果是后者，它将动态地通知包过滤器增减过滤规则，满足用户对速度和安~
性的双重要求。所以，它结合了应用层网关防火墙的安全性和包过滤防火墙的高速度~优；
点，在毫不损失安全性的基础上将代理型防火墙的性能提高IO 倍以上。电路层网关防＊
墙的工作原理如图4-11 所示。
应用层应用层应用层
传输层传输层传输层
因特网层因特网层因特网层
I 网络接口层I 网络接口层l 网络接口层
图4-11 电路层网关防火墙
电路层网关防火墙的特点是将所有跨越防火墙的网络通信链路分为两段。防火墙内夕卜计四
算机系统间应用层的“链接”由两个终止代理服务器上的＂链接”来实现，外部计算~的网络厥
链路只能到达代理服务器，从而起到了隔离防火墙内外计算机系统的作用。此外，代理月员务·也i
对过往的数据包进行分析、注册登记，形成报告，同时当发现被攻击迹象时会向网络管理员发：
出警报，并保留攻击痕迹。
4. 代理技术的优点
1) 代理易于配置。代理因为是一个软件，所以它较过滤路由器更易配置，配置界面十夕}
友好。如果代理实现得好，可以对配置协议要求较低，从而避免了配置错误。
2) 代理能生成各项记录。因代理工作在应用层，它检查各项数据，所以可以按一定准则iJ:
代理生成各项日志和记录。这些日志、记录对千流量分析、安全检验是十分重要和宝贵的。当
然也可以用千计费等应用。
3) 代理能灵活、完全地控制进出流量及内容。通过采取一定的措施，按照一定的规则，
用户可以借助代理实现一整套的安全策略，如可以控制“谁”和“什么“，还有“时间”和l
“地点“。
4) 代理能过滤数据内容。用户可以把一些过滤规则应用于代理，让它在高层实现过~:cJJ
能，例如文本过滤、图像过滤（目前还未实现，但这是一个热点研究领域）、预防病毒或扫描
病毒等。
5) 代理能为用户提供透明的加密机制。用户通过代理进出数据，可以让代理完成加~~
的功能，从而方便用户，确保数据的机密性。这点在虚拟专用网中特别重要。代理可以广泛炖i
用千企业外部网中，提供较高安全性的数据通信。
6) 代理可以方便地与其他安全手段集成。目前的安全问题解决方案很多，如~证：
(Authentication) 、授权(Authorization) 、审计(Accounting) 、数据加密和安全协议(SSL)
92
第4 章防火墙技术
等。如果把代理与这些手段联合使用，将大大增加网络安全性。这也是近期网络安全的发展
方向。
5．代理技术的缺点
1) 代理速度较路由器慢。路由器只是简单查看TCP/IP 报头，检查特定的几个域，不做
详细分析和记录。而代理工作于应用层，要检查数据包的内容，按特定的应用协议（如
HTTP) 进行审查，扫描数据包内容，并进行代理（转发请求或响应），故其速度较慢。
2) 代理对用户不透明。许多代理要求客户端做相应改动或安装定制客户端软件，这给用
户增加了不透明度。由于硬件平台和操作系统都存在差异，要为庞大的互异网络的每一台内部
主机安装和配置特定的应用程序既耗费时间，又容易出错。
3) 对于每项服务代理可能要求不同的服务器，可能需要为每项协议设置一个不同的代理
服务器。因为代理服务器不得不理解协议以便判断什么是允许的，什么是不允许的，并且还扮
演着一个对真实服务器来说是客户、对代理客户来说是服务器的角色。挑选、安装和配置所有
这些不同的服务器也可能是一项较大的工作。
4) 代理服务不能保证免受所有协议弱点的限制。作为一个安全问题的解决方法，代理取
决于对协议中哪些是安全操作的判断能力。每个应用层协议都或多或少存在一些安全问题，对
千一个代理服务器来说，要彻底避免这些安全隐患几乎是不可能的，除非关掉这些服务。代理
取决于在客户端和真实服务器之间插入代理服务器的能力，这要求两者之间交流的相对直接
性。而且有些服务的代理是相当复杂的。
5) 代理不能改进底层协议的安全性。因为代理工作千TCP/IP 之上，属于应用层，所以
它就不能改善底层通信协议的能力，如1P 欺骗、伪造ICMP 消息和一些拒绝服务的攻击。而
这些方面，对千一个网络的健壮性是相当重要的。
4.3.3 状态检测技术
1. 状态检测技术的工作原理
基千状态检测技术的防火墙是由Check Point 软件技术有限公司率先提出的，也称为动态
包过滤防火墙。基于状态检测技术的防火墙通过一个在网关处执行网络安全策略的检测引擎而
获得非常好的安全特性。检测引擎在不影响网络正常运行的前提下，采用抽取有关数据的方法
对网络通信的各层实施检测。它将抽取的状态信息动态地保存起来作为以后执行安全策略的参
考。检测引擎维护一个动态的状态信息表并对后续的数据包进行检查，一旦发现某个连接的参
数有意外变化，则立即将其终止。
状态检测防火墙监视和跟踪每一个有效连接的状态，并根据这些信息决定是否允许网络
数据包通过防火墙。它在协议栈底层截取数据包，然后分析这些数据包的当前状态，并将其与
前一时刻相应的状态信息进行对比，从而得到对该数据包的控制信息。
检测引擎支持多种协议和应用程序，并可以方便地实现应用和服务的扩充。当用户访问
请求到达网关操作系统前，检测引擎通过状态监视器要收集有关状态信息，结合网络配置和安
全规则做出接纳、拒绝、身份认证和报警等处理动作。一旦有某个访问违反了安全规则，该访
问就会被拒绝，记录并报告有关状态信息。
状态检测防火墙试图跟踪通过防火墙的网络连接和包，这样防火墙就可以使用一组附加
的标准，以确定是否允许和拒绝通信。它是在使用了基本包过滤防火墙的通信上应用一些技术
来做到这点的。
93
计算机网络安全教程第4 版
在包过滤防火墙中，所有数据包都被认为是孤立存在的，不关心数据包的历史或未来，
数据包的允许和拒绝的决定完全取决千包自身所包含的信息，如源地址、目的地址和端口号
等。状态检测防火墙跟踪的则不仅仅是数据包中所包含的信息，还包括数据包的状态信息。为
了跟踪数据包的状态，状态检测防火墙还记录有用的信息以帮助识别包，例如已有的网络连
接、数据的传出请求等。
状态检测技术采用的是一种基千连接的状态检测机制，将属千同一连接的所有包作为一
个整体的数据流看待，构成连接状态表，通过规则表与状态表的配合，对表中的各个连~~态
因素加以识别。
2. 状态检测防火墙可提供的额外服务
状态检测防火墙可提供的额外服务如下。
·将某些类型的连接重定向到审核服务中去。例如，到专用Web 服务器的连接，在Web
服务器连接被允许之前，可能被发到审核服务器（用一次性口令来使用）。
·拒绝携带某些数据的网络通信，如带有附加可执行程序的传入电子消息，或包至r
ActiveX 程序的Web 页面。
3. 状态检测技术跟踪连接状态的方式
状态检测技术跟踪连接状态的方式取决千数据包的协议类型。
1) TCP 包。当建立起一个TCP 连接时，通过的第一个包被标上包的SYN 标志。通常情况
下，防火墙丢弃所有外部的连接企图，除非已经建立起某条特定规则来处理它们。对内部~机过；
图连到外部主机的数据包，防火墙标记该连接包，允许响应及随后在两个系统之间的数~包通i
过，直到连接结束为止。在这种方式下，传入的包只有在它是响应一个已建立的连接时，才允许
通过。
2) UDP 包。UDP 包比TCP 包简单，因为它们不包含任何连接或序列信息。它们只包含
源地址、目的地址、校验和携带的数据。这种信息的缺乏使得防火墙确定包的合法性很困难主，
因为没有打开的连接可利用，以测试传入的包是否应被允许通过。可是，如果防火墙跟~宗包庄的
状态，就可以确定。对传入的包，若它所使用的地址和UDP 包携带的协议与传出的连~~求
匹配，该包就被允许通过。和TCP 包一样，没有传入的UDP 包会被允许通过，除非它是响应
传出的请求或已经建立了指定的规则来处理它。对其他种类的包，情况和UDP 包类似。防火
墙仔细地跟踪传出的请求，记录下所使用的地址、协议和包的类型，然后对照保存过的信息、核
对传入的包，以确保这些包是被请求的。
4. 状态检测技术的特点
状态检测防火墙结合了包过滤防火墙和代理服务器防火墙的长处，克服了两者的不~，
能够根据协议、端口，以及源地址和目的地址的具体情况决定数据包是否允许通过。
状态检测防火墙具有以下几个优点。
l) 高安全性。状态检测防火墙工作在数据链路层和网络层之间，它从这里截取数据包”
因为数据链路层是网卡工作的真正位置，网络层是协议栈的第一层，这样防火墙就确保了穗涓又
和检查所有通过网络的原始数据包。
2) 高效性。状态检测防火墙工作在协议栈的较低层，通过防火墙的数据包都在｛氐~处
理，不需要协议栈的上层处理任何数据包，这样就减少了高层协议的开销，使执行效率提高了
很多。
94
笫4 章防火墙技术
3) 可伸缩性和易扩展性。状态检测防火墙不像代理防火墙那样，每一个应用对应一个服务
程序，这样所能提供的服务是有限的。状态检测防火墙不区分具体的应用，只是根据从数据包中
提取的信息、对应的安全策略及过滤规则处理数据包，当有一个新的应用时，它能动态产生新规
则，而不用另写代码。
4) 应用范围广。状态检测防火墙不仅支持基于TCP 的应用，还支持无连接协议的应用，
如RPC 和UDP 的应用。对千无连接协议，包过滤防火墙和应用代理要么不支持，要么开放一
个大范围的UDP 端口，这样就会暴露内部网，降低安全性。
在带来高安全性的同时，状态检测防火墙也存在着不足，主要体现在对大量状态信息的
处理过程可能会造成网络连接的某种迟滞，特别是在同时有许多连接激活时，或者有大量的过
滤网络通信的规则存在时。不过，随着硬件处理能力的不断提高，这个问题也变得越来越不易
察觉。
4.3.4 NAT 技术
1. NAT 技术的工作原理
网络地址转换(Network Address Translation, NAT) 是一个Internet 工程任务组(Internet
Engineering Task Force, IETF) 的标准，允许一个整体机构以一个公用1P 地址出现在互联网
上。顾名思义，它是一种把内部私有1P 地址翻译成合法网络IP 地址的技术。
简单地说， NAT 就是在局域网内部网络中使用内部地址，而当内部结点要与外部网络进
行通信时，就在网关处将内部地址替换成公用地址，从而在外部公网上正常使用， NAT 可以
使多台计算机共享互联网连接，这一功能很好地解决了公共1P 地址紧缺的问题。通过这种方
法，可以只申请一个合法1P 地址，就把整个局域网中的计算机接入互联网中。这时， NAT 屏
蔽了内部网络，所有内部网络计算机对千公共网络来说是不可见的，而内部网络计算机用户通
常不会意识到NAT 的存在。
NAT 功能通常被集成到路由器、防火墙、ISDN 路由器或者单独的NAT 设备中。比如
Cisco 路由器中已经加入这一功能，网络管理员只需在路由器的10S 中设置NAT 功能，就可
以实现对内部网络的屏蔽。再比如防火墙将Web Server 的内部地址192.168. 1.1 映射为外部地
址202.96.23.11, 外部访问202.96.23.11 地址实际上就是访问内部地址192.168.1.1 。
2. NAT 技术的类型
NAT 有3 种类型：静态NAT (S组tic NAT)、动态NAT (Pooled NAT) 和网络地址端口转
换NAPT (Port-Level NAT) 。
其中，静态NAT 是设置起来最为简单和最容易实现的一种，内部网络中的每个主机都被
永久映射成外部网络中的某个合法的地址。而动态NAT 则是在外部网络中定义了一系列的合
法地址，采用动态分配的方法映射到内部网络。NAPT 则是把内部地址映射到外部网络的一个
IP 地址的不同端口上。根据不同的需要， 3 种NAT 方案各有利弊。
动态NAT 只是转换IP 地址，它为每一个内部的IP 地址分配一个临时的外部IP 地
址，主要应用千拨号，对千频繁的远程连接也可以采用动态NAT。当远程用户连接上之
后，动态NAT 就会分配给他一个1P 地址，用户断开时，这个1P 地址就会被释放而留待以
后使用。
网络地址端口转换NAPT 是人们比较熟悉的一种转换方式。NAPT 普遍应用千接入设备
95
计算机网络安全教程笫4 版
中，它可以将中小型的网络隐藏在一个合法的IP 地址后面。NAPT 与动态NAT 不同，它将内
部连接映射到外部网络中的一个单独的IP 地址上，同时在该地址上加上一个由NAT 设备~定
的TCP 端口号。
在互联网中使用NAPT 时，所有不同的信息流看起来好像来源千同一个IP 地址。~个·优
点在小型办公室内非常实用，通过从ISP 处申请的一个IP 地址，将多个连接通过NAPT~A
互联网。
3. NAT 技术的特点
(1) NAT 技术的优点
·所有内部的IP 地址对外面的人来说都是隐蔽的。因为这个原因，网络之外没有A可．以
通过指定IP 地址的方式直接对网络内的任何一台特定的计算机发起攻击。
·如果因为某种原因公共IP 地址资源比较短缺的话， NAT 技术可以使整个内部网络~享
一个IP 地址。
·可以启用基本的包过滤防火墙安全机制，因为所有传入的数据包如果没有专门指~~
置到NAT，那么就会被丢弃。内部网络的计算机就不可能直接访问外部网络。
(2) NAT 技术的缺点
NAT 技术的缺点和包过滤防火墙的缺点类似，虽然可以保障内部网络的安全，但也存：在
一些类似的局限。此外，内部网络利用现在流传比较广泛的木马程序可以通过NAT 进行夕卜剖；
连接，就像它可以穿过包过滤防火墙一样容易。
4.4 防火墙的安全防护技术
防火墙自开始部署以来，已保护无数的网络躲过窥探的眼睛和恶意的攻击者，然而它们
还远远不是确保网络安全的灵丹妙药。每种防火墙产品几乎每年都有安全脆弱点被发现。~~
糕的是，大多数防火墙往往配置不当且无人维护和监视。
如果不犯错误，从设计到配置再到维护都做得很好的防火墙几乎是不可渗透的。事实....t.
大多数的攻击者也知道这一点，因而他们往往通过发掘信任关系和最薄弱环节上的安全脆弱点
来绕过防火墙，或者经由拨号账号实施攻击来避开防火墙。总之，大多数攻击者尽最大努力~
过强壮的防火墙，而防火墙的拥有者的目标是确保自己的防火墙强壮。
知道攻击者为绕过防火墙而采取的最初几个步骤，将有助千对攻击进行检测并做出~
应。下面介绍现今的攻击者用于发现和侦察防火墙的典型技巧，并讨论他们试图绕过防火~的
一些方法。对千一些技巧，将讨论如何能够检测并预防相应的攻击。
从1 防此坊火墙标识被获取
几乎每种防火墙都会有其独特的电子特征。也就是说，凭借端口扫描和标识获取~技
巧，攻击者能够有效地确定目标网络上几乎每个防火墙的类型、版本和规则。这种标识之JiJr 以
重要，是因为一旦标识出目标网络的防火墙，攻击者就能确定它们的脆弱点所在，从而尝试攻
击它们。
1. 防止通过直接扫描获取防火墙标识的对策
查找防火墙最容易的方法是对特定的默认端口执行扫描。市场上有些防火墙会在简~的
96
笫4 章防火墙枝术
端口扫描下独特地标识自己·—一只需知道应扫描哪些端口。例如， CheckPoint 的Firewall-! 在
256、257 和258 号TCP 端口上监听， Microsoft 的Proxy Server 则通常在1080 和1745 号TCP
端口上监听。掌握这一点后，使用像nmap 这样的端口扫描程序来搜索这些类型的防火墙就轻
而易举了．
nmap-n-vv-p0-p256, 1080, 1745 192.168.50.1 -60.254
只有愚蠢和鲁莽的攻击者才会以这种方式对目标网络执行大范围扫描，以此搜索这些防
火墙。攻击者可使用多种技巧来躲避目标网络管理员的注意，包括对Ping 探测分组、目标端
口、目标地址和源端口进行随机编排，使用欺骗性源主机地址，以及执行分布式源扫描
(Source Scan) 等。
为防止来自外部网络的防火墙端口扫描，可以在防火墙前面的路由器上阻塞这些端口。
例如使用以下Cisco 路由器ACL 规则显式地阻塞这些扫描。
access-list l O1 deny tcp any any eq 256 log ! Block Firevwall-1 scans
access-list 101 deny tcp any any eq 257 log ! Block Firevwall-1 scans
access-list 10 l deny tcp any any eq 258 log ! Block Firevwall-1 scans
access-list 101 deny tcp any any eq 1080 log! Block Socks scans
access-list 101 deny tcp any any eq 1745 log ! Block Wmsock scans
当然，如果在边界路由器上阻塞了CheckPoint 防火墙的端口(256-258 号），将不能通过
外部网络（如因特网）管理防火墙。
通过部署入侵检测系统(IDS) 也能够检查出这些攻击者。但是大多数IDS 默认情况下不
能检测单个的端口扫描，因此在能够依赖它们进行检测之前，需调理它们的敏感性。要准确地
检测使用随机处理和欺骗性主机的端口扫描，需要精心调整每个端口扫描检测特征。具体细节
参见IDS 厂家提供的文档。
2．防止防火墙标志被获取的对策
许多流行的防火墙只要简单地连接它们就会声明自己的存在。举例来说，许多代理性质
的防火墙会声明它们作为防火墙的功能，有的还通告自己的类型和版本。例如在21 号端口
(FTP) 上使用netcat 连接到一台可能是防火墙的主机时，会看到一些有意思的信息。
C:\>nc-v-n192.168.51.129 21
(UNKNOWN) [192.168.51.129] 21 (?) open
220 Secure Gateway FI'P seP{er ready.
一··-- 盲~六-·
其中， Secure Gateway FTP seiver ready 标志是Eagle Raptor 防火墙的特征标志。再连接到
它的23 号端口(t.eJnet) 证实了该防火墙名为Eagle。
C: ＼＞应-V-n192.168.51.129 23
(UNKNOWN) [192.168.51.129] 23 (?) open
Eagle斡ure Gateway.
Ho8tname;
.- -- - ~ -]
从上面的实例可以看出，标志信息在标识防火墙时能给攻击者提供有价值的信息。使用
这些信息，就能发掘防火墙已知的脆弱点或常见的配置错误。
补救这种信息泄露脆弱点的办法就是限制给出标志信息。好的标志可能是包含合法性通
97
计算机网络安全教程笫4 版
告，警告说任何连接尝试都会被记录下来。修改默认标志的具体过程取决千所用的防火墙，需
要跟其厂商联系确定。
3. 防止利用nmap 进行简单推断获取防火墙标志的对策
runap 在发现防火墙信息上是一个比较好的工具。使用runap 扫描一台主机时，它不仅告
知哪些端口打开或关闭，还告知哪些端口被阻塞。从端口扫描取得的数据能够得出关千防~墙
配置的一些信息。
使用runap 时被过滤掉的探测分组对应的端口表明以下3 种情况之一。
·没有接收到SYN/ACK 分组。
·没有接收到RST/ACK 分组。
·接收到类型为3 (Destination Unreachable, 目的地不可达）且代码为13
(Communication Administratively Prohibited，通信由管理手段禁止）的ICMP 分组。
runap 将把所有这些条件合在一起作为“过滤掉的(filtered)“ 端口报告。例如，在扫描
www.mycompany.com 时，接收到两个ICMP 分组，告知防火墙把系统阻塞在23 号和111 号·端
口之外。
[root]#nmap-p20). l,23,53,80, 111-p0 -vv 192.168.51.100
Starting mnap V.2.08 by Fyodor (fyodor@dhp.com, www.insecure.o咽nmap/）
Initiating TCP connect() scan against (192.168.51.100)
Adding TCP port 53 (state Open).
Adding TCP port 111 (state Firewalled).
Aruling TCP port 80 (state Open).
Adding TCP port 23 (state Firewalled).
Interesting ports on (192.168.51.100):
Port State Protocol Service
23 filtered tcp telnet
53 open tcp domain
80 open tcp http
111 filtered tcp sumpc
其中的Firewalled 状态是接收到类型为3 代码为13 的IC:MP 分组(Admin Prohibited
Filter) 的结果。
通过分析端口扫描报告可以分析出防火墙及其访问控制规则。
为了防止攻击者使用nmap 技巧查找路由器和防火墙的ACL 规则，应该禁止路由器响应：
类型为3 代码为13 的ICMP 分组的能力。在Cisco 路由器上通过阻止它们对1P 不可到达消息
做出响应可做到这一点，命令如下。
厂二叩印．－bables
4.4.2 防止穿透防火墙进行扫描
穿透防火墙从而发现隐藏在防火墙后面的目标，这是网络黑客和网络入侵者梦寐以＊的
事情。下面将讨论一些黑客在防火墙附近徘徊的技巧，并汇集关千穿透和绕过防火墙的~科诵;
径的一些关键信息。
1. 防止利用原始分组传送进行穿透防火墙扫描的对策
由Salvatore Sanfilippo 编写的hping 通过向一个目的端口发送TCP 分组并报告由它引回的
98
笫4 章防火墙技术
分组进行工作。依据多种条件， hping 返回各种各样的响应。每个分组部分全面地提供了防火
墙具体访问控制的相当清晰的细节。例如， hping 可以发现打开、被阻塞、被丢弃或者被拒绝
的分组。
在下面的实例中， hping 报告80 号端口打开并准备好接收连接。这是从它接收到一个设
置了SA 标志的分组(SYN/ACK 分组）获悉的。
[root]#hping 192.168.51.101-c2-S-p80-n
HPINGwww.yourcompany.com (ethO 172.30.1.20): Sset, 40databytes
60 bytes from 172.30.1.20: Oa旷SAs呵=Ottl=242 id=65121 win=64240 time=144.4ms
现在知道了穿越防火墙到达目标系统的一个打开的端口，不过还不清楚防火墙在哪儿。
下一个实例中， hping 报告从192.168.70.2 接收到一个代码为13 的ICMP 不可达类型分组。
ICMP 类型为3 代码为13 的分组是1Cl\.1P Admin Prohibited Filter 分组，它通常是从某个分组过
滤路由器发出的（例如Cisco 的iOS) 。
厂－hp响192.168.二-s-p23-n
HP ING 192.168.51.101 (ethO 172.30.1.20): S set, 40 data bytes
ICMPUnreachabletype 13 from 192.168.70.2
- -
现在证实192.168.70.2 很可能是防火墙。因为它明确地阻塞了去往目标系统23 号端口的
探测分组。换句话说，如果它是一个Cisco 路由器，那么其配置文件中也许有如下一行。
．一会·、.
aecess-list 101 deny tcp any any 23 I te血t
在下一个实例中，接收到表示以下两件事情之一的一个返回的RST/ACK 分组：＠探测分
组穿过了防火墙，不过目标主机不在那个端口上监听； ＠防火墙拒绝了探测分组（如
CheckPoint 的拒绝规则就是这样）。
上,· l l l l • , 俨一
[root]#bping 192.168.50.3-c2-S--t>22-n
HPING 192.168.50.3 (ethO 192.168.50.3): S set, 40 date bytes
60 bytes from 192.168.50.3: flag=RA seq=O ttl=59 id=O win=Otime=O.3ms
7-
既然早先接收过类型为3 代码为13 的ICMP 分组，因此可以推断该防火墙
(192.168.70.2) 允许探测分组穿过防火墙，不过目标主机恰好没在那个端口上监听。
如果被穿透扫描的防火墙是CheckPoint, 那么hping 会报告目标主机的源IP 地址。然而
该分组确实是从该CheckPoint 防火墙的外部NIC 上发送来的。CheckPoint 具有代表其内部系
统做出响应的能力，而且所发送的响应分组冒用了目标主机的地址。
最后，当一个防火墙完全阻塞通达某个端口的分组时，往往会什么也收不到。
:
—
L
}
[root]# hping 192.168303 立忑-p22-n
HP ING 192.168.50.3 (ethO 192.168.S0.3) 1 S set, 40 date b . --- ．． 一一·~ · -- - .于~. _ _ _ _ _. , ytes ~ _ _ _ `m.. 二二
这个hping 结果表明有以下两种可能： ©探测分组不能到达目的地，在中途丢失；＠更可
能的是，某个设备（也许是防火墙192.168.70.2) 作为其ACL 规则的一部分丢弃了探测分组。
防止hping 攻击比较困难。最好是简单地阻塞类型为3 代码为13 的ICMP 消息（与前面
讨论的nmap 扫描的对策一样）。
99
计算机网络安全教程第4 版
2. 防止利用源端口扫描进行穿透防火墙扫描的对策
传统的分组过滤（也称包过滤）防火墙，比如Cisco 的iOS, 有一个主要的缺点：它们不
能维持连接状态。如果防火墙不能维持连接状态，就不能分辨出连接是源于防火墙内还是外。
换句话说，它不能完全控制一些传输。因此，就可以将源端口设置为通常允许通过的TCP 53
（区域传送）和TCP20 端口(FTP) ，从而可以扫描（或攻击）核心的内容。
为了发现防火墙是否允许通过源端口扫描（如TCP 20 、FTP 数据通道等），可以使用
nrnap 的－g 特性。
nmap-sS-pO-g20-p139 10.1.1.l
7
如果端口是打开的，就很可能是碰到了一个比较脆弱的防火墙。如果发现防火墙不能保持连；
接状态，就可以利用这一点攻击防火墙后面脆弱的系统了。利用一个经修改的端口重定向工具，
比如Folllldstone 的Fpipe, 就可以将源端口设为20, 在突破防火墙后可运行漏洞挖掘工具。
对此弱点的解决办法比较简单， 但也不那么令人满意。要么是禁止那些需要多个端口组．
合（如系统的FTP) 的通信，要么是切换到一个基于状态或应用的代理防火墙，从而对~出
的连接做更好的控制。
4.4.3 克服分组过滤的脆弱点
诸如CheckPoint 的Firewall-I 、Cisco 的PIX 和Cisco 的iOS (Cisco 的iOS 也能设置成防
火墙）之类的分组过滤防火墙依赖于ACL 规则确定各个分组是否有权出入内部网络。大多~
情况下，这些ACL 规则是精心设计的，难以绕过。然而有些情况下会碰到ACL 规则设计牙；
完善的防火墙，允许某些分组不受约束地通过。
1. 针对不严格的ACL 规则的对策
不严格的ACL 规则频繁光顾防火墙，因此在这里必须谈及。考虑一个机构可能希望自己的
ISP 执行区域传送的例子。”允许来自53 号TCP 源端口的所有活动”这样的不严格的ACL~则
可能会被采用，而不是严格的“允许来自ISP 的DNS 服务器的源和目的端口号都为53 的活·
动”。这些误配置造成的危险可能真正具有破坏性，允许攻击者从外部扫描整个目标网络。~~
攻击大多数从扫描目标网络防火墙后一台主机并冒充53 号TCP 源端口(DNS 端口）开始。
确保自己的防火墙规则严格限制谁能连接到哪儿。例如，如果某个ISP 要求区域传~育巷
力，那就在规则中显式地说明，指明需要一个源1P 地址和硬编码的目的IP 地址（内部DNS
服务器主机地址）。
如果使用的是CheckPoint 防火墙，那么可以使用以下规则来限制只允许从53 号源~口
(DNS) 到自己的ISP 的DNS 服务器的分组。例如，如果某个ISP 的DNS 服务器的主机地址
为[ 172.30.140.l, 其内部DNS 服务器的主机地址为 192.168.66.2, 那么可以使用以下规则。 Source Destination
192.168.66.2 172.30.J 40.1
Serv.ic e Action Track
domai.n -tcp Accept Short
.- － 一·-
2. 针对ICMP 和UDP 隧道的对策
ICMP 归(ICMPTwmeling) 有能力在ICMP 分组头部封装真正的数据。许多允许ICMP 回
射请求、ICMP 回射应答和UDP 分组出入的路由器和防火墙会遭受这种攻击的侵害。与CheckPoint
的DNS 脆弱点很相似， ICMP 和UDP 隧道攻击也依赖于防火墙之后已有一个受害的系统。
100
笫4 章防火墙技术
Jeremy Ranch 和Mike Shiffinan 把这种隧道概念付诸实施，编写了发掘它的工具loki 和
lokid （分别是客户和服务器程序）。在允许ICMP 回射请求和回射应答分组穿行的防火墙后面的
某个系统上运行lokid 服务器工具。它将允许攻击者运行Joki 客户工具，而loki 把待执行的每个
命令包裹在ICMP 回射请求分组中发送给lokid。lokid 解出命令后在本地运行它们， 再把结果包
裹在IC.MP 回射应答分组中返回给攻击者。使用这种技巧， 攻击者就能完全绕过防火墙。
防止这种类型攻击的办法既可以是完全禁止通过防火墙的ICMP 访问，也可以是对ICMP
分组提供小粒度的访问控制。举例来说， Cisco 路由器上的以下ACL 规则将因管理上的目的
而禁止通过不是来往千172.29.10.0 子网(DMZ 区域）的所有ICMP 分组。
access-list I 01 pemrit icmp any 172.29.10.0 0.255.255.255 81 echo
access-list 101 pennit icmp any 172.29.10.0 0.255.255.255 0 I echo-reply
access-list 102 de~'!ip any any log I deny and log all else
4.4.4 克服应用代理的脆弱点
总体来说，应用代理脆弱点极为少见。一旦加强了防火墙的安全并实施了稳固的代理规
则，代理防火墙就难以绕过。然而不幸的是，误配置并不少见。
1. 针对主机名： localhost 的对策
用户在使用某些较早期的UNIX 代理时，很容易忘了限制本地访问。尽管内部用户访问
因特网时存在认证要求，却有可能获取防火墙本身的本地访问权。当然，这种攻击需要知道防
火墙上的一个有效用户名和密码，然而有时候猜测起来又非常容易。要检查自己的代理防火墙
是否存在这种脆弱点，可使用netcat 工具，在收到登录提示符后，按下列步骤进行操作。
C:\>nc-v--n192.168.51.129 23
(UNKNOWN) [192.168.51.129] 23 (?) open
Eagle Secure Gat.eway.
Hostname
l) 输入localhost。
2 ) 输入已知的或猜测的用户名和密码（可以猜测若干次）。
3) 如果认证通过，就拥有了该防火墙的本地访问权，这时可运用一个本地的缓冲区溢出
（例如rdist) 或类似的漏洞发掘获取root 访问权。
这种误配置的预防措施很大程度上取决于特定的防火墙产品。总的来说， 可以提供一个
只允许从某个特定站点访问的限制规则。理想的对策是不允许本地主机(localhost) 登录。如
果需要本地主机登录，就需要根据1P 地址限制允许连接的主机。
2. 针对未加认证的外部代理访问的对策
这种情形在应用透明代理的防火墙上较为常见，不过在其他防火墙上也不鲜见。防火墙
管理员可能极大地加强了防火墙的安全，建立起了强壮的访问控制规则，但忘了阻止外部的访
问。这种危险是两方面的：攻击者可能使用这样的代理服务器在外部网上（如因特网）匿名地
跳来跳去，使用诸如CGI 脆弱点和Web 欺骗之类的基千Web 的攻击手段攻击Web 服务器；
攻击者可能获取通达整个内部网的Web 访问权。
通过把浏览器的代理设置改为指向有嫌疑的代理防火墙，就能检查它是否存在这种脆弱
点。在Internet Explorer (IE) 中执行的步骤如下。
101
计算机网络安全教程笫4 版
l) 选择“工具”菜单。
2) 选择“Internet 选项”命令。
3) 在弹出的对话框中选择“连接”选项卡。
4) 单击“局域网配置”按钮。
5) 把有嫌疑的防火墙地址加到代理服务器地址中，并设置它的监听端口（通常是80 、
81 、8000 或8080, 但差异很大，应使用runap 或类似的工具扫描出正确的端口）。
6) 把浏览器指向某个偏爱的Web 网站，留意状态栏上的活动。
如果该浏览器的状态栏显示所设置的代理服务器被访问了，并且所访问网页也出来了，
那么它有可能是一个未加认证的代理服务器。
如果有某个内部Web 网站的IP 地址（不管该地址是否能够路由到），就可以接着以同样
的方式尝试访问。这种内部1P 地址有时可通过查看HTIP 源代码取得。Web 设计人员往往会
在网页的HREF 中硬编码主机名和IP 地址。
预防攻击这种脆弱点的措施是禁止从防火墙的外部接口进行代理访问。既然这么~的方
法高度依赖千厂家，一般应该与防火墙厂家联系以获取更深入的信息。
这种攻击的网络解决办法是在边界路由器上限制外来的访问代理的分组。在这些~由器
上使用一些坚固的ACL 规则就能很容易地做到这一点。
总之，现实世界中配置得当的防火墙要想绕过可能非常困难，然而使用诸如traceroute、hping
和nmap 之类的信息汇集工具，攻击者可以发现（或者至少能够推断）经由目标站点的路由~禾1J防
火墙的访问通路，并确定所用防火墙的类型。当前发现的许多脆弱点的根源在千防火墙的误配置阳和
缺乏管理性监视。然而这两种条件一旦被发掘，所导致的后果可能是毁灭性的。
代理和分组过滤这两种防火墙中都存在一些特定的脆弱点，包括未加认证的W的~
Telnet 访问，以及本地主机登录。对千其中大多数脆弱点，可采取相应的对策防止对它们的~
掘，然而有些脆弱点却只能检测是否有人在发掘它们而已。
4.5 防火墙应用示例
最近几年，国内许多公司纷纷推出国产防火墙产品，其中比较知名的有天融信“猎~＂
系列防火墙、启明星辰防火墙和联想网御防火墙等。下面对“猎豹III" 系列中的TG-470C 1W
火墙的使用进行简单介绍。
4.5.1 TG-470C 防火墙系统组成
TG-470C 防火墙系统由一套专用硬件设备(Firewall) 搭载其自主知识产权的安全操~系
统TOS (Topsec Operating System) 及一次性用户口令客户端软件(otp.exe) 组成。
·防火墙设备（硬件）：是一个基于安全的操作系统平台的自主版权系统。它是专用~、
硬件设备，具备丰富的扩展插槽，可扩展不同子卡，最多可支持26 个端口。用户可结
合自身业务需要，选配不同的接口模块。管理员通过一次性口令认证，对防火墙~行
配置、管理和审计。
．一次性口令用户客户端（软件）：是一个安装千客户主机上的登录软件，运~千
Wmdows 环境下。凡是需要对其身份进行认证的用户都需要使用该软件，例如，管理
者需要通过WWW 页面管理防火墙时，必须先进行一次性口令认证。
102
笫4 章防火墙技术
防火墙在网络环境中的逻辑位置依据安全要求来确定，物理位置根据网络的实际情况确
定。目前常用的配置方式是采用WebUI 方式进行防火墙配置。
4.S.2 WebUI 加文配置示例
某企业的网络结构示意图如图4-12 所示。
192.168.IOO:. •·.
•.. .. 68.83.23
I O. I O. I I. l l24 | 1 0. I O. I O. l l24
Vlan.002 I Vlan.001
口
图4-12 某企业的网络结构示意图
l．用户要求
l) 内网area_eth2 区域的文档组(10.10.10.0/24) 可以上网；允许项目组领导(10.10.11.2
和10.10.11.3) 上网，禁止项目组普通员工上网。
2) 外网和area_ethO 区域的机器不能访问研发部门内网。
3) 仅允许外网用户访问area_ethO 区域的Web 服务器：真实1P 为202.99.27.201, 虚拟IP
为192.168.100.143 。内网用户不允许访问Web 服务器。
2. 配置要点
l) 设置地址对象。
2) 设置区域对象的默认访问权限： area_ethO、area_eth2 为禁止访问， area_ethl 为允许访问。
3) 定义源地址转换规则，保证内网用户能够访问外网；定义目的地址转换规则，使得外
网用户可以访问area_ethO 区域的Web 服务器。
4) 定义访问控制规则，禁止项目组除领导外的普通员工上网。
5) 定义访问控制规则，允许用户访问area_ethO 区域的Web 服务器。
3. 配置步骤
l) 定义主机和子网地址对象。
103
计算机网络安全教程第4 版
＠选择“资源管理” 一“地址”命令，选择“主机”选项卡，定义主机地址资源。定义
完成后的界面如图4-13 所示．
主机， 嘈U，飞冒』rn可｀-
十淑加而漕空
名歉
一bugserver
- j
•I叩
上．企．一
192. 1的． 83， 23`
1亿． l的． 83. 饺I
一192. 1-的．幻， 23`
202． 的．叮． 201
202. ＂．叮． 1”
归飞息＿噤0-0_D-0凸
． 一
图4-13 定义主机和子网地址对象
其中， webserver 表示Web 服务器， IP 为192.168.83.234; M战－IP 表示Web 服务器的公
网1P 地址对象， IP 为202.99.27.201 ; host_ethl 表示接口主机地址对象， IP 为202.99.27. 199。
＠选择“资源管理”一“地址”命令，选择“子网”选项卡，单击“添加”按钮，定义
子网地址资源rd_group，表示项目组中除了领导以外的普通员工，如图4-14 所示。
, 1 子阿
埴0m` 0m
名靠巳云已：
陨昢：匹
子网印匣巨芭吞． 0
蝴挝址I'l,I-1 1. I I. 2
ll. 11. 11.3
I:.
己二二
-匾已-匾耐
图4-14 定义子网资源
2) 定义区域资源的访问权限（整个区域是否允许访问）。
选择“资源管理”一“区域”命令，设定外网区域area_ethl 的默认属性为“允许“访问，内
网区域area_ethO 和area_eth2 的默认属性为“禁止“访问。以area_ethO 为例，设置界面如图4-15
所示。
区域` 5 '1斗，＇、b•，t，织、J,心乍，飞护等心!式...J `、|
区域告
式一生三五耐
.
'，」l
盂
·拉1 温性］
龟dsl2 氓性］
“gl3 氓性］
boncll 氓性］
--
图4-15 设置内网区域area_ethO 的访问权限
104
第4 章防火墙技术
设置完成后的界面如图4- 16 所示。
区域文
十添加扁漕空
名称• I 蚴定熏性
王－－飞勹急计： 3
竺．＿ 庄作一
:4—一千
图4-16 区域资源的访问权限设置完成后的界面
3) 选择“ 防火墙”一“ 地址转换”命令，定义地址转换规则。
©定义源地址转换规则，使得内网用户能够访问外网，如图4-17 所示。
＠定义目的地址转换规则， 使得area_ethl 区域的外网用户可以通过访问公网IP:
202.99.27.201, 访问area_ethO 区域的Web 服务器，如图4-18 所示。
I
蚕址转集
稹式1 目药行冢国
乖加堆社转换观
模式 l薪拉 回
旺I 任意I[) I
艾它El
渥
吐I 任意11> I
其它D
吐旧|e> I
区域I ".....dh1 l~I 目的
吐I 任意I 1:> I
兀它巴
吐1 任意IO|
区域I ”“_.thl 忙I
鼠各1 任意1 心I
嫡口1 任意I[) I
目的
昢I应＿n I~ iiii
工它D
鼠各
IQ'TP 忙I
渺妃'J lhost_eth1 庄机］ · |
咖口不如噱E ［檬贮酝）
目缓呻换为IW8bso"引庄机1 匾I
目纽口转执为1一不如矜拱… 匾I
规| I 规I |
－一－ 千一. '-• · ·-卢＿ _
e一酮一） 6·- m ; （一症一） 已：漱清一）
图4-17 源地址转换规则设置图4-18 目的地址转换规则设置
4) 选择“防火墙”一“访问控制”命令，单击“添加策略” 按钮，定义访问控制规则。
＠配置规则允许访问Web 服务器。
由于Web 服务器所在的area_ethO 区域禁止访问，所以要允许用户访问Web 服务器，需
要定义访问控制规则，如图4-19 所示。
105
计算机网络安全教程笫4 版
乖加访何控剽攘略
源
区域1 任意I[) I
媳址1 任意Ir> I
其它D
目的
区域
ar1a...1tb0 。而1
~I 地址
“bg”“lr
其它口
佩务I HTTP 忙I
卢＠允许l O 禁止。收集
日志记录＠不记录。记录0 系抚报警
连接选项□亟
内容安全策略l 无固
► 高级
. -
.- -
己；症3 己～．职消3
图4-19 允许访问Web 服务器规则设置
注意事项：
a) 在“源”选项组中不设置任何参数，表示不对数据报文的源加以限制。
b) 在“目的地址”选项组中需要选择Web 服务器的真实IP 地址(WebServer) ，因为防
火墙要先对数据包进行目的地址转换处理，当内网用户利用bttp://202.99.27.201 访问area_ethO
区域的Web 服务器时，由于符合目的地址转换规则，所以数据包的目的地址将被转换为
192.168.83.234。然后才进行访问规则查询，此时只有设定为Web 服务器的真实IP 地址才能达
到内网用户访问area_ethO 区域Web 服务器的目的。
如果需要根据服务器的公网IP 对访问进行控制，只需要在“目的”选项组中选择“其他“
复选框，然后在“转换前地址”处选择M战＿IP 即可。无须在“目的地址”中再选择地址，如
图4-20 所示。
c) 如果Web 服务器中采用非标准端口提供HITP 服务，只需要添加自定义服务资源，然
后在图4-9 中的“服务”处选择自定义的服务对象即可。
＠禁止项目组领导以外的普通员工访问外网。
由千外网区域area_ethl 允许访问，所以需要添加禁止访问外网的规则如图4-21 所示。
注意事项：
a) 如果要求用户只能使用特殊源端口访问Web 服务器，不能使用其他端口，只需在
“源”选项组的“端口”处选择定义好的“自定义服务对象”即可。
106
第4 章防火墙技术
b) 如果只要求指定角色的用户可以使用某些资源，需要配置“用户角色”，并在访问控制规
则的＂源”选项组的“角色”处引用该角色，并开放认证相关的服务，即可实现基千角色的访问
控制。
目的
区域1 任意I[} I
媳址佃鼠Ir> I
其它巴
吐［任意
芒卫
目的域名F
坠阴l,
图4-20 根据服务器的公网1P 对访问进行控制
添擂访问控铡策略
漫
区域I".oth2 忙I
地址匕忙I
其它巳
角色I 旺lg. I
四I Yl111.0002 忙I
觽口1 任意|I:> I
目的E 任”“重一”hi
, 飞l 堆址
其它□
鼠务 I旺 |G> I
动作04需l° 妇日志记录。。系抚报警
匡授选项□ 纪纽
保护内枣褒l另眉
► 高级
=．皿=
图4-21 禁止访问外网的规则设置
107
计算机网络安全教程第4 版
4.6 个人防火墙
个人防火墙其本身是在单台计算机上使用的防火墙软件，它不但可以监视计算机在网络
上的通信状况，而且同时注重发现网络中存在的威胁，以做出相应的判断，并根据其尸斤设计．的
安全规则加以匹配，以防止网络有害数据的攻击和破坏。
4.6.1 个人防火墙概述
个人防火墙是一个运行在单台计算机上的软件，它可以截取进出计算机的TCP/IP 网络．连
接数据包，并使用预先定义的规则允许或禁止其连接。通常，个人防火墙安装在计算积斥牡各接
口的较低级别上，监视传入传出网卡的所有网络通信。
一旦安装上个人防火墙，就可以把它设置成“学习模式”，这样，对遇到的每一种~的网
络通信，个人防火墙都会提示用户一次，询问如何处理那种通信。然后个人防火墙便i已~llJPj应
方式，并应用千以后遇到的相同的网络通信。例如，如果用户已经安装了一台个人Web 服务
器，个人防火墙可能将第一个传入的Web 连接做上标志，并询问用户是否允许它通过。用户
可以允许所有的Web 连接或来自某些特定1P 地址范围的连接等，个人防火墙然后把这条规则
应用于所有传入的Web 连接。
可以将个人防火墙想象成在用户计算机上建立了一个虚拟网络接口。不再是计算机A的操
作系统直接通过网卡进行通信，而是以操作系统通过和个人防火墙对话，仔细检查网络通信i,
然后再通过网卡通信。
4.6.2 个人防火墙的主要功能
不同厂商的个人防火墙产品的功能不尽相同，但是作为一个完整的个人防火墙系统，
般应包含以下功能。
1. IP 数据包过滤功能
个人防火墙能够依据TCP/IP 中的网络数据包的数据格式约定制定规则，并根据规则对．数
据包进行过滤，对数据包的过滤动作应包含拦截、通行和继续匹配下一规则等。每一条匹~规
则一般包括下列要素。
·数据包方向（连接发起方I接收方）。
·远程1P 地址（任何IP 地址／指定1P 地址／指定1P 地址范围）。
·协议的匹配类型。
具体协议至少应包括以下3 种。
I) ICMP 数据包过滤。根据ICMP 网络数据包中的类型和代码字段进行设定，当匹配到
相同类型和代码字段时则按对应规则中的数据包处理方式进行处理。
2) UDP 数据包过滤。根据UDP 网络数据包中的本地端口（包括单一端口和／或端口范
围）和／或远程端口（包括单一端口和／或端口范围）进行规则匹配。
3) TCP 数据包过滤。根据TCP 网络数据包中的本地端口（包括单一端口和／或端口范
围）和／或远程端口（包括单一端口和／或端口范围），以及TCP 数据包的标志位进行规则匹配
过滤。
108
第4 章防火墙枝术
2. 安全规则的修订功能
个人防火墙一般都允许用户能选择使用或弃用个人防火墙产品提供的安全规则，根据需
要添加、删除或修改自定义安全规则。
3. 对特定网络攻击数据包的拦截功能
个人防火墙产品一般具备对千某些特定攻击的抵挡及防御能力，配合抵御攻击的能力，
个人防火墙产品一般还具备建立可更新的攻击特征库的能力。
4. 应用程序网络访问控制功能
个人防火墙产品一般都能控制每个应用程序访问网络的权限， 对应用程序网络访问控制
包括以下3 种方式。
·允许访问：允许该程序使用网络。
·禁止访问：禁止该程序使用网络。
·网络访问时询问：当应用程序访问网络时，个人防火墙产品应对其将进行的访问操作
向用户提供详细的报告及询问， 根据询问结果对应用程序访问网络的行为进行处理。
5．网络快速切断／恢复功能
个人防火墙一般都提供快捷的方式，方便用户迅速地切断／恢复所有网络通信。
6．日志记录功能
个人防火墙一般都提供一个有关包过滤和网络攻击事件的网络通信日志，便千用户查阅
网络系统近况。
7．网络攻击的报警功能
根据匹配系统指定规则发现异常网络数据包，个人防火墙一般可以以一定的方式警告用
户，并能够建议用户采取哪些应对措施。
8. 产品自身安全功能
个人防火墙产品一般都能抵御已知手段的攻击，保证其自身正常运行不受影响。某些具
有特殊安全功能要求（如控制儿童上网）的个人防火墙，还具备身份鉴别功能，以防止控制规
则被随意更改。
4.6.3 个人防火墙的特点
1 ．个人防火墙的优点
个人防火墙的优点主要体现在以下几个方面。
1) 增加了保护级别，不需要额外的硬件资源。
2) 个人防火墙除了可以抵挡外来攻击外，还可以抵挡内部的攻击。
3) 个人防火墙是对公共网络中的单个系统提供了保护，能够为用户隐蔽暴露在网络上的
信息，比如JP 地址之类的信息等。
2．个人防火墙的缺点
个人防火墙的主要缺点体现在以下几个方面。
l) 个人防火墙对公共网络只有一个物理接口，导致个人防火墙本身容易受到威胁。
2) 个人防火墙在运行时需要占用个人计算机的内存、CPU 时间等资源。
3) 个人防火墙只能对单机提供保护，不能保护网络系统。
4.6A 主流个人防火墙简介
1. 主流个人防火墙产品
个人防火墙领域除了专业的个人防火墙软件厂商的产品外，许多传统的反病毒软件厂商
109
计算机网络安全教程第4 版
也开始推出自己的个人防火墙产品，不同公司的个人防火墙产品在功能方面各有特色。下面对
几个主要的个人防火墙产品进行简要介绍。
(1) Zone Alam1 Pro
Zone Al叩Pro 的特色在于其丰富强大的功能，与其相比，其他大部分个人防火墙产品似乎只能
被称为防火墙组件而不能被称为防火墙系统。Zone Alann Pro 可以过滤网址，可以阻止弹出广告窗
口，可以将未受保护的无线网络自动纳入保护范畴。更加重要的是， Zone A1ann Pro 的基于程序的防
护规则不仅仅针对应用级别，还能够在系统组件层次制定访问规则。除了基于IP 协议和应用程序的
安全过滤之外， Zone Alann Pro 还提供了大量的防护特性以将用户计算机的安全推向更高层次。2.one
Alann Pro 实际上是以防火墙功能为核心，以恶意软件检测为主要功能的安全套件，该系统内置的病
毒监控和反间谍软件功能都具有很高的实效。另外，被称为myVAULT 的隐私保护功能可以防止个
人信息被非法用户获得，用户可以为账号密码信息、信用卡号和银行账号等多种敏感信息生成衭见则。
Zone Alann Pro 的规则定义非常细致全面，所有规则都分别针对进入和外出两种活动定
义，即使对相同的应用程序而言，这使得Zone Alann Pro 的防护非常细致、全面，所有的夫见则
集非常灵活和智能，具有良好的可管理性。
(2) 诺顿个人防火墙(Norton Personal Firewall)
诺顿个人防火墙所集成的功能相当丰富，除了基础的防火墙功能外，入侵检测、隐~保
护等功能也颇为强大。诺顿个人防火墙在浏览器中集成增加了Web 辅助功能插件，该插件可
以动态地根据所浏览网站的情况进行弹出广告窗口、Applet 和ActiveX 等内容的阻塞，而用户
可以针对单个网站决定是否阻塞这些内容，同时可以以关键字的形式维护广告信息过滤清单。
另外，该插件还可以帮助用户禁止浏览器信息、访问历史信息等泄露给外部网络。诺顿1'-A防
火墙所集成的入侵检测组件带有大量的攻击指纹，而且能够设定在多长时间内阻止发起攻~的
计算机，其功能已经接近专业的入侵检测系统。
诺顿个人防火墙的定制能力不单体现在对防火墙规则的设定上，辅助功能组件的管~功
能也相当强大。以入侵检测指纹为例，用户可以决定哪些攻击需要被检测而哪些需要被忽略，
同时可以选择发现攻击时的告警方式。另外，不仅仅防火墙具有防护等级，包括隐私保护等辅
助功能在内也可以独立设置级别，用户可以快速、简便地设定计算机的防护强度。
(3) McAfee Desktop Firewall
McAfee 对非法入侵的检测和处理有很多独到之处，例如当入侵发生时， McAfee 可以嗅
探相关数据并予以保存，将产生的攻击告警发送到用户指定的电子邮箱。如果用户将防护~别
设置成学习模式， McAfee 会将学习到的规则加入到刚刚使用的安全等级当中，从而形成自定
义的安全等级。另外McAfee 对应用程序的管理也相当细致，在授予各种应用程序权限的基础
上，还能够管理应用程序是否可以调用其他的程序组件。
McAfee 的规则集定义能力是其最突出的特点之一，不但内置了大量的协议和服务支持，
而且在定义网络过滤规则的同时还可以选择相关的应用程序以进行更细致的限定。
(4) 金山网镖
金山网镖以其易用性著称，只具有基本的防火墙功能，没有集成内容过滤方面的功能。~隐
私保护方面提供了家长保护和反钓鱼功能，但是用户不具有定制能力。由千是金山毒霸套装的一部
分，所以该套装中的漏洞扫描和木马程序防护等功能都随该防火墙组件提供，而文件粉碎和IE 修
复等功能也颇为实用。特别是金山的漏洞扫描功能，不但可以检测出微软操作系统和应用程序中存
在的安全问题，还能发现系统设置上的缺陷，而且该模块可以管理安全漏洞补丁的下载和存放，提
110
第4 章防火墙技术
供更加一体化的安全管理特性。金山网镖一个独有的特性是可以导入天网防火墙的IP 规则。
(5) 瑞星个人防火墙
瑞星个人防火墙的特色是提供了实用的辅助工具，主要包括漏洞扫描功能和安装包生
成，特别是安装包生成，该功能可以让用户基千当前的程序状态及更新状态生成一个安装程序
包，从而方便之后的安装部署。另一个独创的功能是“游戏保护“，用户将游戏程序的快捷方
式及信息加入到游戏保护列表之后，瑞星可以保护该游戏程序相关的账号等信息不被非法窃
取。另外，用户还可以手动维护一个可信任模块的列表，在该列表中的可执行文件和动态链接
库允许对游戏程序进行调用和访问。
(6) 360 安全卫士
360 安全卫士是一款由奇虎360公司推出的安全软件。360 安全卫士拥有查杀木马、清理
插件、修复漏洞、电脑体检、电脑救援和保护隐私等多种功能，并独创了“木马防火墙”“360
密盘”等功能，依靠抢先侦测和云端鉴别，可全面、智能地拦截各类木马，保护用户的账号、
隐私等重要信息。
360 木马防火墙包含首创的64 位驱动级虚拟隔离技术，用户可在隔离沙箱中放心地运行危险的
程序，甚至可以全屏观看刚俭视频，对真实计算机系统毫无影响。其主要功能和恃点包括以下几个。
1) 高性能网络驱动过滤，毫不影响网络带宽使用。
2) 网络恶意行为清晰展示， 无须了解1P 地址、PORT 端口号和协议等信息，就能简单、
快速地判断是否有安全威胁。
3) 云端智能规则同步，即开即用，不需要设置任何网络规则，秒速响应新型木马。
4) 64 位操作系统与32 位操作系统同步支待。
2. 360 木马防火墙使用简介
360 木马防火墙没有独立的安装和运行程序，是集成在360 安全卫士中的360 家族软件中
的重要组成部分之一。360 安全卫士是一款免费使用的安全软件， 且界面清晰、操作简单，使
得其迅速占据了国内个人安全软件的最大份额，而绑定在其中的360 木马防火墙也成为国内使
用最多的个人防火墙。下面就以最新版的360 安全卫士10.0 为例介绍其安装与使用。
(1) 360 安全卫士的下载与安装
360 安全卫士的下载与安装非常简单，登录360 官网www.360.cn, 单击“360 安全卫士”
链接，如图4-22 所示。
霾＝子吐' .._.雹摹μ田·
， 下丘参”“3 丛｀”
O 亡叩0”叩戊
~凰． ＂净RO 比比·， 、
．,＝“ · 凹心l1” `'＿ ．比小
耋“立。伈场
下饥｀ ＇“岭0 伯｀＂
, 皇翰＊阖夏喊阿食金... n O
国.罢... .. 声
飞舅檐、｀僖凶可"..."""...
· ·•`幢.""w”“` U个工具霆"···
..........嗣胤..皇｀障1·叮1`”“”`
图4-22 360 安全卫士下载页面
Ill
计算机网络安全教程笫4 版
程序下载复制完毕之后，会自动安装，安装完成后用户可根据自身需求，进行体~木
马查杀和优化加速等。
(2) 打开360 木马防火墙
360 安全卫士10.0 将木马防火墙功能集成在安全防护中心模块中，如图4-23 所示。
` ` @
纽歹虹网络管理臼：2:雹
回隘回iii 了仓
查杀修复电脑清理优化加速软件，家人卫榜尹暖手宽而舅巨器冕多
图4-23 360 木马防火墙的位置
具体防护功能主要包括：浏览器防护、系统防护、入口防护和隔离防护4 个部~＇~户
可根据需要查看相关防护状态，如图4-24 所示。
．邑I O - X
360安全防护中心.. . 1,_____|
＠立体防护已开启11JJ.~ 贮＄
仅任与阻止安全晒
811 浏览酗护| 7层系筑防护沪即1层咖虾研l
一7 __ -1 言三
励如：固团圈匿I －一国可口回翌吕
图4-24 360 木马防火墙功能页面
112
第4 章防火墙技术
(3) 360 木马防火墙安全设置
在图4-24 中选择“安全设置”选项，用户可根据需要对360 安全防护中心进行有关设
置，主要包括基本设置、弹窗设置、开机小助手、安全防护中心和漏洞修复等几项功能，如
图4-25 所示。
恢复所有默认值
基本设霆
＠开启挂马网站拦戳功能
。关网站拦截珈佬
园咖URL云查询功能
囮白珈网页中的欺诈信息
凹白动上传可尉炀马到36氓拴中心
多浏览器支持
支持Chrome浏览罹立即修复
点击立即骠铝节宠已翌浅的chrome褪卧趼唱示览印铅． 删租“安婆”即可
正坦遏设豆
包开启智能横淏页
更人性化的．网址涧司错误．页面，更便捷的上网引导
1 酝」
图4-25 360 木马防火墙安全设置
在“基本设置”选项组中，用户可根据需要定制相关功能，并可以选择最优的升级方
式，合理地控制软件升级。用户还可以对开机的启动项进行管理并选择是否加入云安全计划。
360 的云安全计划主要分为两种，一种是普通云安全计划，一种是网址云安全计划，其区别在
于前者主要针对可疑文件，后者主要针对网址。
在“弹窗设置”选项组中，用户可根据需要设置弹窗模式，主要包括智能模式、手动模
式和自动处理模式。此外，用户还可设置网购安全、邮件安全及聊天安全的提示。
在“开机小助手”选项组中，用户可定制包括开机时间记录、提示、热点新闻和天气预
报等在内的一些个性化服务。
在“安全防护中心”选项组中，用户可对网页安全防护、搜索安全防护、网络安全防
护、摄像头安全防护、驱动安全防护、聊天安全防护、下载安全防护、U 盘安全防护和应用防
护等多种防护进行自主设置。
在“漏洞修复”选项组中，用户可对补丁保存、补丁下载安装的顺序等进行设置。
(4) 功能开启与关闭
在360 安全防护中心的主页面，用户可以方便地对防护项目和内容进行快速开启与关
闭，如图4-26 所示。
113
计算机网络安全教程第4 版
360安全防护中心=一五；；屯叩句三J
＠立体防护已开启9 贮办。
行任巴fl)止会全19雳
81i 浏即酬护石影舷护
· 网页蛭珈， I
· 暑片安全仿护
· 网购食纠加9
· 搜索安全仿护I
·上网曾页防护O
收起状态V
I 5层入口畛
欢
壹看状态＾
h m
霾
琶看状态＾
听，引擘固回圈回翌巨
图4-26 功能开启与关闭
(5) 信任与阻止
360 安全防护中心还提供被信任或者被阻止运行的程序、网站的查询功能，并可~~自
主管理，将一些恶意软件或者恶意网站添加进阻止名单，也可将360 误阻止的网站和程序添
加进信任名单。在图4-27 中选择“信任与阻止”选项，出现如图4-28 所示的“信任与阻
止“界面。
＠立体防护已开启
8层浏如呱护I f 石皿晌I I
·网页安全防护·网烙安全防沪
.．片安全防护·删印舫护瞿瞿'
·网购安全舫护·键盘记垦防护
·擅案安盆舫护·文件累統防护
· 上网牖页防护。·躯过舫护
收起状态V I 收起状态Y ,
日2(5沪
5Ii 入口防护I 一1 -= 1雇m皿护
涿
圈
薰．状态＾ ..状态＾
励1擘：圈匾．匾l
[__ ____
安釭屯宣国已｀＇ 谥习勺位动
图4-27“信任与阻止”选项
在图4-28 中选择相应列表，就可将程序或文件添加到信任列表， 360 木马防火墙不；再对1
其查杀。同样也可添加阻止的程序和网址到阻止列表。
114
·伯任的枢序
，信任的网址
，阻止的网址
[,拒绝安峻的软件名单
第4 章防火墙技术
全部选中全不选中啤添加其他程序戊：件到倌任列衷自从僖任列衷中移除已选程序戊：件
图4-28“信任与阻止“界面
4.7 防火墙发展动态和趋势
尽管防火墙有许多防范功能，但由千互联网的开放性，它也有一些力不能及的地方，主
要表现在以下几个方面。
·防火墙不能防范不经过防火墙的攻击。例如，如果允许从受保护网内部不受限制地向
外拨号，一些用户可以形成与Internet 的直接的SLIP 或PPP 连接。从而绕过防火墙，
造成一个潜在的后门攻击渠道。
·防火墙目前还不能防止感染了病毒的软件或文件的传输。这只能在每台主机上安装反
病毒软件。
·防火墙不能防止数据驱动式攻击。当有些表面看来无害的数据被邮寄或复制到Internet
主机上并被执行而发起攻击时，就会发生数据驱动攻击。例如，一种数据驱动的攻击
可以使一台主机修改与安全有关的文件，从而使入侵者下一次更容易入侵该系统。
另外，防火墙还存在着安装、管理和配置复杂的缺点，在高流量的网络中，防火墙还容
易成为网络的瓶颈。
针对上述存在的问题，防火墙正向以下趋势发展。
1. 优良的性能
新一代防火墙系统不仅应该能更好地保护防火墙后面内部网络的安全，而且应该具有更
为优良的整体性能。传统的代理型防火墙虽然可以提供较高级别的安全保护，但是同时它也成
为限制网络带宽的瓶颈，这极大地制约了在网络中的实际应用。数据通过率是表示防火墙性能
的参数，由于不同防火墙的不同功能具有不同的工作量和系统资源要求，因此数据在通过防火
墙时会产生延时。显然，数据通过率越高，防火墙性能越好。现在大多数防火墙产品都支持
NAT 功能，它可以让受防火墙保护的一边的IP 地址不至千暴露在没有保护的另一边，但启用
NAT 后，势必对防火墙系统性能有所影响，目前如何尽量减少这种影响也成为防火墙产品的
卖点之一。另外，防火墙系统中集成的VPN 解决方案必须是真正的限速运行，否则将成为网
115
计算机网络安全教程第4 版
络通信的瓶颈。
特别是采用复杂的加密算法时，防火墙性能尤为重要。总之，未来的防火墙系统将~把
高速的性能和最大限度的安全性有机结合在一起，有效地消除制约传统防火墙的性能瓶颈i 。
2. 可扩展的结构和功能
对千一个好的防火墙系统而言，它的规模和功能应该能适应内部网络的规模和安~~略
的变化。选择哪种防火墙，除了应考虑它的基本性能外，毫无疑问，还应考虑用户的实际需求
与未来网络的升级。
因此，防火墙除了具有保护网络安全的基本功能外，还提供对VPN 的支持，同时~~该
具有可扩展的内驻应用层代理。除了支持常见的网络服务以外，还应该能够按照用户的需＊~
供相应的代理服务，例如，如果用户需要NNTP （网络消息传输协议）、X-Window、HTfP 和
Gopher 等服务，防火墙就应该包含相应的代理服务程序。
未来的防火墙系统应是一个可随意伸缩的模块化解决方案，从最为基本的包过滤~到带
加密功能的VPN 型包过滤器，直至一个独立的应用网关，使用户有充分的余地构建自己尸斤需
要的防火墙体系。
3．简化的安装与管理
防火墙的确可以帮助管理员加强内部网的安全性。一个不具体实施任何安全策略的防X
墙无异千高级摆设。防火墙产品配置和管理的难易程度是防火墙能否达到目的的主要考~因素
之一。实践证明，许多防火墙产品并未起到预期作用的一个不容忽视的原因在千配置和实现.J:.
的错误。同时，若防火墙的管理过千困难， 则可能会造成设定上的错误，反而不能发挥作用。
因此未来的防火墙将具有非常易于进行配置的图形用户界面。
4. 主动过滤
Internet 数据流的简化和优化使网络管理员将注意力集中在这一点上：在Web 数据流进入血
他们的网络之前需要在数据流上完成更多的事务。
防火墙开发商通过建立功能更强大的Web 代理对这种需要做出了回应。例如，许多防~
墙具有内置病毒和内容扫描功能，或允许用户将病毒与内容扫描程序进行集成。今天， 许多防
火墙都包括对过滤产品的支持，并可以与第三方过滤服务连接，这些服务提供了不受欢~的
Internet 站点的分类清单。防火墙还在它们的Web 代理中包括时间限制功能，允许非工作时间
的冲浪和登录，并提供冲浪活动的报告。
5. 防病毒与防黑客
尽管防火墙在防止不良分子进入上发挥了很好的作用，但TCP/IP 协议族中存在的脆弱性
使Internet 对拒绝服务攻击敞开了大门。在拒绝服务攻击中，攻击者试图使企业Internet 月反务
器饱和或使与它连接的系统崩溃，使Internet 无法供企业使用。防火墙市场已经对此做出了反
应。虽然没有防火墙可以防止所有的拒绝服务攻击，但防火墙厂商一直在尽其可能阻止拒绝服
务攻击。像对付序列号预测和IP 欺骗这类简单攻击，这些年来已经成为防火墙产品功能的一
部分。像“SYN 泛滥”这类更复杂的拒绝服务攻击需要厂商部署更先进的检测和避免方案来
对付。SYN 泛滥可以锁死Web 和邮件服务，这样没有数据流可以进入。
6．发展联动技术
由千防火墙在实际应用中存在着种种局限，许多人深信联动技术也将成为下一代防火墙
的部分内容。联动即通过一种组合的方式，将不同的技术与防火墙技术进行整合，在提高防火
墙自身功能和性能的同时，由其他技术完成防火墙所缺乏的功能， 以适应网络安全整体化禾］立
11.6 .
第4 章防火墙技术
体化的要求。
1997 年， CheckPoint 软件技术有限公司提出建立联动联盟OPSEC, 通过提供开放接口标
准，与其他厂商进行紧密合作，向用户提供完整的、能够在多厂商之间进行紧密集成的网络安
全解决方案。NAI 已在他们的Active Security 体系结构上实现了某种形式的联动性特性。它允
许一个被检测到的入侵活动引发针对受影响防火墙的预先设计好的变动。举例来说，如果某个
IDS 系统检测到ICMP 隧道攻击，它就会接着指导防火墙关闭对进入其中的ICMP 回射请求分
组的响应。
防火墙与防病毒产品联动，可以在网关处查杀病毒，将病毒的发作限制在最小的可能；
防火墙与认证系统联动，可以在制定安全策略时使用强度更大、安全性更高的认证体系；防火
墙与入侵检测系统联动，可以对网络进行动静结合的保护，对网络行为进行细颗粒的检查，并
对网络内外两个部分都进行可靠管理；防火墙与日志分析系统联动，可以解决防火墙对千大量
日志数据的存储管理和数据分析上的不足。防火墙联动技术的发展，将使防火墙从众多的安全
问题中解脱出来，与其他技术互补互益，架构起立体的防护体系。
综上所述，未来防火墙技术会全面考虑网络的安全、操作系统的安全、应用程序的安
全、用户的安全和数据的安全，五者综合应用。此外，网络防火墙产品还将把网络前沿技
术，如Web 页面超高速缓存、虚拟网络和带宽管理，以及与其他安全技术联动等与其自身
结合起来。
4.8 小结
防火墙是保证网络安全的一种重要手段。防火墙的功能是：过滤进、出网络的数据，管
理进、出网络的访问行为，封堵某些禁止的业务，记录通过防火墙的信息内容和活动，以及对
网络攻击进行检测和告警。目前广泛采用的防火墙体系结构有双重宿主主机体系结构、屏蔽主
机体系结构和屏蔽子网体系结构。
从工作原理角度看，防火墙主要可以分为网络层防火墙和应用层防火墙。这两种类型的
防火墙的具体实现技术主要有包过滤技术、代理服务技术、状态检测技术和NAT 技术等。实
际的防火墙产品往往是多种技术的融合。
防火墙产品固有的安全脆弱点和管理配置上的不当使防火墙有“隙”可寻。黑客和入侵
者可以通过获取防火墙标识、穿透防火墙扫描，发现分组过滤和应用代理的脆弱点，摸清内部
网络的情况，伺机进行进攻。但是对于大多数的防火墙，若脆弱点和配置失当，一般都可采取
相应的对策予以防护。
个人防火墙除了具有普通防火墙对网络数据包的控制能力外，还可以对应用程序、隐私
数据等进行控制，可以有效保护个人用户的上网安全。
现代防火墙正向优良的性能、可扩展的结构和功能、积极主动过滤、防病毒与防黑客
方向发展，同时简化安装、方便管理，并寻求和其他安全产品进行联动，以架构起立体的
防护体系。
4.9 习题
1. 简述防火墙的定义。
117
计算机网络安全教程笫4 版
2. 防火墙的主要功能有哪些？
3. 防火墙的体系结构有哪几种？简述各自的特点。
4. 简述包过滤防火墙的工作机制和包过滤模型。
5. 简述包过滤的工作过程。
6. 简述代理防火墙的工作原理，并阐述代理技术的优缺点。
7. 简述状态检测防火墙的特点。
8. 简述NAT 技术的工作原理。
9. 试描述攻击者用千发现和侦察防火墙的典型技巧。
10. 若把TG-470C 防火墙部署在本单位网络出口处，试给出其应用配置。
11. 简述个人防火墙的特点。
12. 简述防火墙的发展动态和趋势。
118
第5章
人侵检测技术
大量安全实践表明，保障网络系统的安全，仅靠传统的被动防护是不够的，完整的安全
策略应该包括实时的检测(Detection) 和响应(Response)。入侵检测(Intrusion Detection) 作
为一类快速发展的安全技术，以其对网络系统的实时监测和快速响应特性，逐渐发展成为保障
网络系统安全的关键部件。作为继防火墙之后的第二层安全防范措施，入侵检测可在不影响网
络性能情况下对内部攻击、外部攻击和误操作进行保护，是构筑多层次网络纵深防御体系的重
要组成部分。此外，为弥补防火墙和入侵检测存在的不足，人们还积极探索具有主动安全防御
机制的入侵防护系统(Intrusion Prevention System, IPS) ，使得在准确检测出常规网络流量中
的恶意攻击和异常数据时，并非简单地发出安全警告，而是实时地采取措施阻止攻击行为。
5.1 入侵检测概述
入侵检测技术的研究最早可追溯到1980 年James P. Anderson 提出的一份技术报告，他首
先提出了入侵检测的概念，并将入侵尝试(Intrusion Attempt) 或威胁(Threat) 定义为：潜在
地、有预谋地、未经授权地访问信息和操作信息，致使系统不可靠或无法使用的企图。
Anderson 在报告中提出审计追踪可应用于监视入侵威胁，但由千当时已有的系统安全程序全
都着重于拒绝未经认证主体对重要数据的访问，这一设想的重要性并未被理解。1987 年，
Dorothy Denning 提出了入侵检测系统(Intrusion Detection System, IDS) 的抽象模型，如
图5-1 所示，首次提出了入侵检测可作为一种计算机系统安全防御措施的概念，与传统的信
息加密和访问控制技术相比， IDS 是全新的计算机安全措施。
创建活动状况
图5-1 Denning 入侵检测抽象模型
1988 年的Morris Internet 蠕虫事件使Internet 近5 天无法使用，该事件的发生加速了人们
对安全的需求，进而引发了自20 世纪80 年代以来入侵检测系统的开发研制热潮，但早期的
IDS 系统都是基于主机的应用，即通过监视与分析主机的审计记录来检测入侵。1988 年Teresa
Lunt 等人进一步改进了Denning 提出的入侵检测模型，创建了IDES (Intrusion Detection
Expert System)，该系统用千检测单一主机的入侵尝试，提出了与系统平台无关的实时检测思
119
计算机网络安全教程笫4 版
想， 1995 年开发的NIDES (Next-Generation Intrusion Detection Expert System) 作为IDES 完善
后的版本可以检测出多个主机上的入侵。
1990 年， Heberlein 等人提出了一个具有里程碑意义的新型概念：基千网络的入侵检
测一一网络安全监视器NSM (Network Security Monitor) 。NSM 与此前的IDS 系统最大的区
别在千它并不检查主机系统的审计记录，而是通过主动地监视局域网上的网络信息流量来追踪
可疑的行为。1991 年， NADIR (Network Anomaly Detection and Intrusion Reporter) 与DIDS
(Distribute Intrusion Detection System) 提出了通过收集和合并处理来自多个主机的审计信息可
以检测出一系列针对主机的协同攻击。
1994 年， Mark Crosbie 和Gene Spafford 建议使用自治代理(Autonomous Agents) 以提高
IDS 的可伸缩性、可维护性、效率和容错性，该理念非常符合计算机科学其他领域（如软件代
理， Software Agent) 正在进行的相关研究。另一个致力千解决当代绝大多数入侵检测系统伸
缩性不足的方法千1996 年提出，这就是GrIDS (Graph-based Intrusion Detection System) 的设
计和实现，该系统可以方便地检测大规模自动或协同方式的网络攻击。
近年来， 入侵检测技术的创新研究还有：将免疫学原理运用于分布式入侵检测领域，将
信息检索技术引进入侵检测，以及采用状态转换分析、数据挖掘和遗传算法等进行误用和异常
检测。
5.1.1 人侵检测原理
图5-2 给出了入侵检测的基本原理图。入侵检测是用千检测任何损害或企图损害系统的
保密性、完整性或可用性的一种网络安全技术。它通过监视受保护系统的状态和活动，采用误
用检测(Misuse Detection) 或异常检测(Anomaly Detection) 的方式，发现非授权或恶意的系
统及网络行为，为防范入侵行为提供有效的手段。所谓入侵检测系统，就是执行入侵检测任务
的硬件或软件产品。
知识库
安全策略
图5-2 入侵检测原理框图
入侵检测提供了用千发现入侵攻击与合法用户滥用特权的一种方法，其应用前提是入侵
行为和合法行为是可区分的，即可以通过提取行为的模式特征来判断该行为的性质。一般地，
120
笫5 章入侵检测技术
入侵检测系统需要解决两个问题，一是如何充分并可靠地提取描述行为特征的数据，二是如何
根据特征数据，高效并准确地判定行为的性质。
5.1.2 系统结构
由千网络环境和系统安全策略的差异，入侵检测系统在具体实现上也有所不同。从系统
构成上看，入侵检测系统应包括事件提取、入侵分析、入侵响应和远程管理4 部分，另外还
可能结合安全知识库、数据存储等功能模块，提供更为完善的安全检测及数据分析功能，如
图5-3 所示。事件提取负责提取与被保护系统相关的运行数据或记录，并对数据进行简单的
过滤。入侵分析就是在提取到的数据中找出入侵的痕迹，将授权的正常访问行为和非授权的
异常访问行为区分开，分析出入侵行为并对入侵者进行定位。入侵响应功能在发现入侵行为
后被触发，执行响应措施。由千单个入侵检测系统的检测能力和检测范围的限制，入侵检测
系统一般采用分布监视、集中管理的结构，多个检测单元运行于不同的网段或系统中，通过
远程管理功能在一台管理站点上实现统一的管理和监控。
原始数据流
图5-3 入侵检测系统的系统结构
入侵检测的思想源于传统的系统审计，但拓宽了传统审计的概念，它以近乎不间断的方
式进行安全检测，从而形成一个连续的检测过程。通常，这是通过执行下列任务来实现的。
·监视、分析用户及系统活动。
·系统构造和弱点的审计。
·识别分析知名攻击的行为特征井告警。
·异常行为特征的统计分析。
·评估重要系统和数据文件的完整性。
·操作系统的审计跟踪管理，并识别用户违反安全策略的行为。
根据任务属性的不同，入侵检测系统的功能结构可分为两部分，即中心检测平台和代
理服务器。代理服务器负责从各个目标系统中采集审计数据，并把审计数据转换为平台无
关的格式后传送到中心检测平台，同时把中心检测平台的审计数据要求传送到各个目标系
统中。中心检测平台由专家系统、知识库和管理员组成，其功能是根据代理服务器采集来
的审计数据由专家系统进行分析，产生系统安全报告。管理员可以向各个主机提供安全管
理功能，根据专家系统的分析结果向各个代理服务器发出审计数据的需求。中心检测平台
和代理服务器之间通过安全的远程过程调用(Remote Procedure Call, RPC) 进行通信，
如图5-4 所示。
121
计算机网络安全教程第4 版
中心测试平台
图5-4 入侵检测系统的功能结构
S.1.3 系统分类
由千功能和体系结构的复杂性，按照不同的标准入侵检测有多种分类方法。下面分别从
数据源、检测理论和检测时效3 个方面来描述入侵检测系统的类型。
1 ．基千数据源的分类
入侵检测系统首先需要解决的问题是数据源，或者说是审计事件发生器。数据源可以使
用多种方式进行分类。从入侵检测的角度来看，最为直观的分类方法是按照数据源所处的位
置。按照这种方法，通常可以把入侵检测系统分为5 类即基千主机、基于网络、混合入侵检
测、基于网关的入侵检测系统，以及文件完整性检查系统。
l) 基于主机的入侵检测系统安装在需要重点检测的主机之上，监视与分析主机的审it记
录时，如果发现主机的活动十分可疑（如违反统计规律），入侵检测系统就会采取相应措~。
主机入侵检测系统对分析“可能的攻击行为“非常有用，可以提供较为详尽的取证信息，具体
来说，它可以指出入侵者试图执行的“危险命令“，分辨出入侵者的具体行为，如运行程~、
打开文件或执行系统调用等。存在的不足包括，一是目标系统自身的安全和入侵检测系统性能
之间无法统一；二是依赖千目标系统的日志与监视能力，使得能否及时采集获得审计数据成为
问题。
2) 基千网络的入侵检测系统放置在共享网段的重要位置，对监听采集的每个可疑的数据
包进行特征分析，如果数据包与系统规则集数据库中的某些规则吻合，入侵检测系统就~~出
警报直至切断网络连接，当前的大部分入侵检测系统属于该类型产品。其优点是与具体平台的
无关性使其对目标环境和资源影响较小，系统的不可见性使其遭受攻击的可能降低；其不足在
千系统的许多优势受限千交换网络环境，特征检测法很难检测存在大量复杂计算与分析的攻击
方法。不能分析加密信息攻击，这个问题会随着1Pv6 的应用越来越突出，此外，受多网段协
调能力的制约，网络流量回传和攻击告警延迟较大。
3) 混合入侵检测系统是综合基千网络和基于主机两种结构优势的入侵检测系统，其特点
是形成了一套完整的、立体式的主动防御体系，既可发现网络中的攻击信息，也可从系统日志
中发现异常情况。
4) 基于网关的入侵检测系统是由新一代的高速网络结合路由与高速交换技术构成的，它
从网关中提取信息来提供对整个信息基础设施的保护措施。
5) 文件完整性检查系统检查计算机中自上次检查后文件系统的变化情况。文件完整性检
122
笫5 章入侵检测技术
查系统中存有每个文件的数字文摘数据库，每次检查时它重新计算文件的数字文摘并将它与数
据库中的值比较，如比值不同则表示文件已被修改，反之则表示文件未发生变化。文件的数字
文摘使用Hash 函数计算得到，不管文件长度如何， Hash 函数的计算结果都是一个固定长度的
数字。与加密算法不同， Hash 算法是一个不可逆的单向函数，采用高安全性的Hash 算法（ 如
MD5 和安全散列算法(SHA)) 时，两个不同的文件几乎不可能得到相同的Hash 结果， 因
此，文件一经修改就能立即检测出来。目前，文件完整性检查系统功能最全面的软件是
飞ipwire。数学家认为，无论从时间还是空间上攻克文件完整性检查系统都是不可能的， 但是
文件完整性检查系统依赖千本地的文摘数据库，与日志文件一样， 存在被入侵者修改的可能。
此外，文件完整性检查也是一项非常耗时的工作。
2．基千检测理论的分类
就检测理论而言，入侵检测又可分为异常检测和误用检测两种。
所谓异常检测，是指根据使用者的行为或资源使用状况的正常程度来判断是否入侵，而
不依赖于具体行为是否出现来检测。异常检测与系统相对无关，通用性较强，它甚至有可能检
测出以前未出现过的攻击方法。但由于不可能对整个系统内的所有用户行为进行全面的描述，
而且每个用户的行为都是经常改变的，所以它的主要缺陷在千误检率很高，尤其在用户数目众
多或工作方式经常改变的环境中。另外，由千行为模式的统计数据不断更新，入侵者如果知道
某系统处在检测器的监视之下，他们可以通过恶意训练的方式，促使检测系统缓慢地更改统计
数据，以至于最初认为是异常的行为，经一段时间训练后也被认为是正常的。这个问题是目前
异常检测所面临的一大困难。
所谓误用检测，是指运用已知的攻击方法，根据已定义好的入侵模式，通过判断这些入
侵模式是否出现来检测。由千大部分的入侵是利用了已知的系统脆弱性，因而通过分析入侵过
程的特征、条件、顺序及事件间的关系，可以具体描述入侵行为的迹象。误用检测有时也被称
为特征分析(Signature Analysis) 或基于知识的检测(Knowledge-based Detection) 。这种方法
由千依据具体特征库进行判断，所以检测准确度很高，并且因为检测结果有明确的参照，也为
系统管理员做出相应措施提供了方便。其主要缺陷在于检测范围受已知知识的限制。另外， 检
测系统对目标系统的依赖性太强，不但系统移植性不好，维护工作量大，而且将具体入侵手段
抽象成知识也很困难。对千某些内部人员的入侵行为，如合法用户的泄露，由于这些行为并没
有利用系统脆弱性，因此误用检测也显得无能为力。
误用检测和异常检测各有优势，又都有不足之处。在实际系统中，考虑到两者的互补
性，往往将它们结合在一起使用。通常的做法是将误用检测用于网络数据包，将异常检测用千
系统日志。
3．基于检测时效的分类
IDS 在处理数据时可以采用实时在线检测方式，也可以采用批处理方式，定时对处理原始
数据进行离线检测，这两种方法各有特点，如图5-5 所示。
离线检测方式是将一段时间内的数据存储起来，然后定时发给数据处理单元进行分析，
如果在这段时间内有攻击发生就报警。显然这种方法对千有效的防范和响应是很不利的，因为
缺乏必要的实时性，但是这种方法仍然有不可替代的作用。首先，有些检测需要占用大量
CPU 资源，如果采用实时分析的办法将会大大降低系统的效率，这是不可接受的；其次，当
网络流量很大时，即使算法效率很高，也不能满足实时性的要求，在这两种情况下可以采用离
线批处理的方法。
123
计算机网络安全教程笫4 版
用户历史行为
专家经验
神经网络模型
用户的历史记录
断开连接
记录证据
数据恢复
断开连接
记录证据
数据恢复
a)
图5-5 实时与事后入侵检测原理
a) 实时入侵检测的功能原理图b) 事后入侵检测的功能原理图
在线检测方式的实时处理是大多数IDS 所采用的办法，由千计算机硬件速度的提高，
使得对攻击的实时检测和响应成为可能。对用户来说，如果IDS 仅仅能够在事后给出警
报，那么它的实际意义就会大打折扣，但如果网络流量非常大，那么以实时处理方式工作
的IDS 就不可能对数据进行详细的分析，这必然会影响系统的检测效果。所以就目前来
看，批处理和实时处理这两种方法可以互相补充，首先采用实时处理对数据进行初步的分
析，检测明显的攻击特征，然后采用批处理对数据进行更加详细的分析，分析的结果~可
以用千训练异常检测系统。
切
5.2 入侵检测的技术实现
对于入侵检测的研究，从早期的审计跟踪数据分析，到实时入侵检测系统，再到目前应
用千大型网络的分布式检测系统，基本上已发展成为具有一定规模和相应理论的研究领域。入
侵检测的核心问题在于如何对安全审计数据进行分析，以检测其中是否包含入侵或异常行为的
迹象。下面，先从误用检测和异常检测两个方面介绍当前关千入侵检测技术的主流技术实现，
然后对其他类型的检测技术进行简要介绍。
5上1 人侵检测分析模型
基千前面提到的入侵检测的各种类型，在介绍入侵检测的具体实现技术之前，首先来讨
论入侵检测系统对入侵的分析处理过程。
分析是入侵检测的核心功能，它既能简单到像一个已熟悉日志情况的管理员去建立决策
表，也能复杂得像一个集成了几百万个处理的非参数系统。一般地，入侵检测分析处理过程
可分为3 个阶段：构建分析器；对实际现场数据进行分析；反馈和提炼过程。其中，前两个
阶段都包含3 个功能，即数据处理、数据分类（数据可分为入侵指示、非入侵指示或不确
定）和后处理。
在分析模型中，第一阶段主要进行分析引擎的构造，分析引擎是执行预处理、分类和后
124
笫5 章入侵检测技术
处理的核心功能。表5-1 给出了构建分析器的5 个功能步骤中误用检测和异常检测各自不同的
处理方式。
表5-1 误用检测和异常检测构建分析器过程对比表
检测类型
误用检测异常检测
构建过程
收集入侵信息：脆弱性、攻击和威胁、具收集的信息来自活动系统本身或指定的相
1. 收集或生成事件信息体攻击工具和观察到的蜇要细节信息：也收似系统，这些信息用于建立“正常“ 用户行
集典型的不一致策略、过程和活动的信息为的基准特征轮廓
转换收集在通用表格中的享件信息。例事件数据被转换成数组表，部分种类的数
2. 预处理信息如：攻击症状和策略冲突可被转换成基于状据转换成数值表。与误用数据一样，不同的
态转换的信号或相应产品系统的规则信息被转换成一些规范的表格
以规则或模式描述器描绘的行为建立数据由用户过去行为的统计特征轮廓建立区分
3. 建立一个行为分析引擎或区分引擎． 区分引擎的一种结构是产品和专模型，特征轮廓也用于标识系统处理的行
模型家系统，另一种结构是模式匹配引擎，以入为．统计特征轮廓按照各种算法进行计算，
侵作为攻击特征（模式）去匹配审计数据井按固定或可变的进度表修补和完善
用预处理事件数据或攻击知识的内容，以
将收集的参考事件数据植入异常检测器，
4. 向模型植入事件数据及收集到的对引擎有意义的攻击数据填充误
允许系统基千这些数据计算用户轮廓
用检测器
5. 在知识库中保存植入数据
无论采用何种方法，植入数据的模型都被存储在预定的位置，准备检测使用．基于这种意
义，植入数据的模型包含了所有的分析标准和分析引擎的实际核心
在第二阶段，入侵分析主要进行现场实际事件流的分析。如表5-2 所示，在这个阶段分
析器通过分析现场的实际数据，识别出入侵及其他重要的活动。
表S-2 误用检测和异常检测执行事件分析过程对比表
分析过程 三 误用检测 异常检测
I. 输入事件记录
收集可靠信息源产生的事件记录，这些信息源包括：网络数据包、操作系统审计痕迹，
以及应用日志文件
将对应千攻击信号结构的表格事件数据进行集
在异常检测中，事件数据通常精简
2. 预处理成， 或通过捆绑、融合和计算，达到精简数据的
成轮廓向盘，行为属性衰示为标识
目的
预处理事件记录被提交给模式匹配引擎，若产将用户行为轮廓同其历史轮廓比
3. 比较事件记录与知识库
生匹配结果，则事件被缓存以便进一步确认并返较，若两者足够相关则属正常行为，
回警告。能够记住事件顺序的检查引擎称为状态反之则属异常井告警． 异常检测引擎
检查器也可用于误用检测
4. 产生响应
响应性质取决千具体分析方法的性质，若事件记录对应千入侵或其他重要活动，可返回
一个响应（警报、日志条目、自动响应或管理员指定的其他行为）
在第三阶段，与反馈和提炼过程相联系的功能是分析引擎的维护及其他如规则集提炼等
功能。误用检测在这个阶段的活动主要体现在基千新攻击信息对特征数据库进行更新，与此同
时，一些误用检测引擎还对系统进行优化工作，如定期删除无用记录等。对于异常检测而言，
历史统计特征轮廓的定时更新是反馈和提炼阶段的主要工作。以入侵检测专家系统IDES 为
例，特征轮廓每天都进行更新操作，每个用户的摘要资料被加入到知识库中，并且删除最老的
资料（如30 天前），对其余的统计资料（从第1 天到第29 天）则乘以一个老化因子，通过这
种方法，最近的行为将比早些时候的行为更有效地影响入侵检测的决策。
S.2.2 误用检测
误用检测是按照预定模式搜寻事件数据的，最适用于对已知模式的可靠检测。执行误用
检测，主要依赖千可靠的用户活动记录和分析事件的方法。
1. 条件概率预测法
条件概率预测法是基于统计理论来量化全部外部网络事件序列中存在入侵事件的可能程
125
计算机网络安全教程笫4 版
度。预测误用入侵发生可能性的条件概率表达式为： P(Intrusion I Event Pattern) ，其中， Event
Pattern 表示网络事件序列， Intrusion 表示入侵事件。求解该表达式，应用Bayes 公式有：
P(Intrusion I Event Pattern) = P(Event Pattern I Intrusion)
P(Intrusion)
P(Event Pattern)
这样，问题转移为求解等式的右侧。在实际工作中，管理员对其维护的目标网络系统的安~状
况通常比较熟悉，也就是说根据经验值就可知一般情况下发生入侵事件的可能概率，即目标网络环
境中入侵事件发生的先验概率P(Intrusion) 。此外，通过对网络系统全部事件数据的统计，可．知构
成每个入侵的所有事件序列，由此可以计算出构成特定入侵的事件序列占全部入侵事件序列集：的相
对发生频率，这个值就是特定入侵攻击的事件序列条件概率P(Event Sequence I Intrusion) 。同样
地在给定的入侵审计失败事件序列集中，可以统计出入侵审计失败时对应的事件序列的条件湘租已
P(Event Sequence I,Intrusion) 。由上述两个条件概率可以计算出事件序列的先验概率关1:
P(Event Sequence) = (P(ES I I) - P(ES I,I)) · P(I) + P(ES I,I) ，其中ES 表示Event Sequence, I 表
示Intrusion。
至此，等式右侧3 个单项表达式均得出结果，合并可得条件概率预测法的计算公式~：
P(I)
P(Intrusion I Event Pattern)= P(ES11) ·
(P(ESII)-P(ES|-J))·P(I)+P(ES|-J)°
2. 产生式专家系统
用专家系统对入侵进行检测，主要是检测基于特征的入侵行为。所谓规则，即是知识，专·家
系统的建立依赖千知识库的完备性，而知识库的完备性又取决千审计记录的完备性与实时f生。
产生式／专家系统是误用检测早期的方案之一，在MIDAS 、IDES 、NIDES 、DIDS 和
CMDS 中都使用了这种方法。其中， MIDAS 、IDES 和NIDES 使用的产生式系统是由A胆1
W血hurst 设计的P_BEST, DIDS 和CMDS 使用的是CLIPS 产生式系统。
产生式系统成功地将系统的控制推理与解决问题的描述分离开，这个特性使得用户可t 以
使用if-then 形式的语法规则输入攻击信息，再以审计事件的形式输入事实，系统根据~入严的
信息评估这些事实，当表示入侵的if 条件满足时， then 子句的规则就被执行，整个过程天；须
理解产生式系统的内部功能，这就避免了用户自己编写决定引擎和规则代码的麻烦。
由千只能对给定的数据象征性地判断入侵的发生，加之不确定处理能力存在的缺陷，产
生式／专家系统存在的问题在于，不适合处理大批量的数据，这是因为产生式系统中使用的说
明性规则一般作为解释系统实现，而解释器效率低于编译器；没有提供对连续数据的任何．处
理；此外，系统综合能力的不足致使其专业技能只能达到一般技巧安全人员的水准。
3. 状态转换方法
状态转换方法使用系统状态和状态转换表达式来描述和检测入侵，采用最优模式匹配技卫讳卡
结构化误用检测，增强了检测的速度和灵活性。目前，主要有3 种实现方法，即状态转换分村f、
有色Petri-Net 和语言／应用编程接口(API) 。
(1) 状态转换分析
状态转换分析最早由R. Kemmerer 提出，状
态转移分析是一种使用高层状态转移图(State
Transition Diagrams) 来表示和检测已知攻击模
式的误用检测技术。图5-6 以序列的方式给出了1 断言11 断言11 断言(Assertions) I I (Assertions) I I (Assertions)
状态转移图的各个组成部分。图5-6 状态转移图
126
笫5 章入侵检测技术
图中的结点(Nodes) 表示系统的状态，弧线代表每一次状态的转变。所有入侵者的渗透
过程都可以看作是从有限的特权开始，利用系统存在的脆弱性，逐步提升自身的权限。正是
这种共性使得攻击特征可以使用系统状态转移的形式来表示。每个步骤中，攻击者获得的权
限或者攻击成功的结果都可以表示为系统的状态。用千误用检测的状态转移分析引擎包括一
组状态转移图，各自代表一种入侵或渗透模式。在每个给定的时间点，都认为是由一系列的
用户行为使得系统到达了每个状态转移图中的特定状态。每次当新的行为发生时，分析引擎
检查所有的状态转移图， 查看是否会导致系统的状态转移。如果新行为否定了当前状态的断
言(Assertions) ，分析引擎就将转移图回溯到断言仍然成立的状态；如果新行为使系统状态
转移到了入侵状态，状态转移信息就被发送到决策引擎，并根据预先定义的策略采取相应的
响应措施。图5-7 是一个UNIX 系统入侵的状态转移图示例。
suid(user)=root
A
用户建立文件
name(file)="_••
owner(file)=root
access(file,suid)=TRUE
shell_script(file)=TRUE
link(file)=TRUE
图5-7 状态转移图示例： UNIX 系统入侵
(2) 有色Petri-Net
Petri (CP) -Net 是另一种基千状态转换的误用检测方法，该方法由Purdue 大学开发，并
成功应用千IDIOT 系统。当一个入侵被表示成一个CP-Net 时，事件的上下文是通过CP-Net
中每个令牌颜色变化来模拟的，借助审计踪迹模式匹配的驱动，起始状态到结束状态之间的令
牌移动过程指示了一次入侵或攻击的发生。
图5-8 所示的是一个TCP/IP 连接的CP-Net 模式，图中的顶点表示系统状态，入侵模
式存在前提条件和与之相关的后续动作。一般来说，这种模式匹配模型由3 部分组成：一
个上下文描述，能够进行匹配的构成入侵信号的各种事件；语义学内容，容纳了多种混
杂在同一事件流中入侵模式的多个事件源；一个动作描述，当模式匹配成功后执行相关
的动作。
初始状态最终状态
（开始） (after_syn) (after_syn_ack) (after_ack)
TCPI I TCP2 ~I~ TCP3
S ack D
O ..
图S-8 TCP/IP 连接的CP-Net 模式
(3) 语言／基千API 方法
当前，有3 种流行的可以表达入侵的描述语言： RUSSEL、STALKER 系统和N 包过
127
计算机网络安全教程笫4 版
滤语言(NFR, Network Flight Recorder 的一部分），它们的共同点是采用表格的形式来描
述数据。
• RUSSEL: 是一个基千规则的语言，设计用千处理非结构化数据流，尤其适合千操作
系统的数据审计。其目标是向用户提供跨主机关联事件能力和事件的多级别抽象。
RUSSEL 将事件行为表达成“条件一动作”形式的表格，其中动作能具体到用户对给
定入侵指定响应的抽象级别。RUSSEL 处理大量审计数据时采用自底向上的方式。
• STALKER: 是一个商业误用检测系统，系统中使用了通用审计数据格式和一~用于
描述攻击特征的基千状态的数据结构。系统的误用检测器是一个基于有限状态~的实
现，通过传递审计记录至误用引擎来进行检测。引擎在状态转换表格中维护一个检测
特征集，其中特征表达式的数据结构是由一个起始状态、一个结束状态和构成误用的
一个或多个转换功能集组成的。
•N－编码：是指在一个字节编码指令上操作的解释语言，该语言包括流控制、过程和64
位计数器数据类型。网络包过滤器若采用N－编码进行编写，将可以有效地识别网~攻
击和其他网络活动。
4. 用千批模式分析的信息检索技术
当前大多数入侵检测都是通过对事件数据的实时收集和分析来发现入侵的，然而在:r.1(击
被证实之后， 要从大量的审计数据中寻找证据信息，就必须借助千信息检索(Information
Retrieval, IR) 技术， IR 技术已被广泛应用千网络搜索引擎之中。
IR 系统使用反向文件作为索引，允许高效地搜寻关键字或关键字组合，并使用贝叶为f~里
论帮助提炼搜索。由于IR 依靠索引，而不是机器学习去发现数据模式，因此有别于数~挖
掘。在攻击已是既定事实（即批模式）的情况下，信息检索可以限制性地浏览审计数据，从｀而
有效地提高检测活动的效率。此外，索引的存在也可以作为一个安全失败机制，来检验~击·者
是否试图改变审计信息以隐藏攻击的踪迹。
5. Keystroke Monitor 和基千模型的方法
Keystroke Monitor 是一种简单的入侵检测方法，它通过分析用户击键序列的模式来检测入
侵行为，常用千对主机的入侵检测。该方法具有明显的缺点： 首先，批处理或Shell 程序可t 以
不通过击键而直接调用系统攻击命令序列；其次，操作系统通常不提供统一的击键检测接口，
需要通过额外的钩子函数(Hook) 来监测击键。
基千模型的方法是，入侵者在攻击一个系统时往往采用一定的行为序列，如猜测口~的
行为序列， 这种行为序列构成了具有一定行为特征的模型，根据这种模型代表的攻击意图的行
为特征可以实时地检测出恶意的攻击企图。与专家系统通常放弃处理那些不确定的中间结~的
缺点相比，这一方法的优点在于它基千完善的不确定性推理数学理论。基于模型的入侵检测方
法可以先监测一些主要事件，当这些事件发生后，再开始详细审计，从而减少了事件审计的处
理负荷。
5.2.3 异常检测
异常检测基于一个假定：用户的行为是可预测的、遵循一致性模式的，且随着用户事件
的增加，异常检测会适应用户行为的变化。用户行为的特征轮廓在异常检测中是由度量
(Measure) 集来描述的，度量是特定网络行为的定量表示，通常与某个检测阙值或某个域相联
系。异常检测可发现未知的攻击方法，体现了强健的保护机制，但对于给定的度量集能否~备
128
第5 章入侵检测技术
到表示所有的异常行为仍需要深入研究。
1. Denning 的原始模型
Dorothy De血ng 千1986 年给出了入侵检测的IDES 模型，她认为在一个系统中可以包括
4 个统计模型，每个模型适合千一个特定类型的系统度鱼。
l) 可操作模型。该模型将度量和一个阅值进行比较，当度量超过阙值时就会触发一个异
常，例如可以用来度量某个特定时间间隔内登录密码失败的次数。可操作模型既可用于异常检
测，也可用千误用检测。
2) 平均和标准偏差模型。假定所有的分析引擎认为系统的度量是平均和标准偏差，那么一
个新的网络行为如果落在信任间隔之外将被视为异常，信任间隔是由一些参数平均值的标准偏差定
义的。该模型可用千事件计数器、间隔计时器和资源度量，当对其分配权值进行计算时，最近的数
据通常赋予较高的权值。
3) 多变量模型。多变量模型是对上一个模型的扩展，是基千两个或多个度量的模型。
这样考虑的好处是使异常检测不必严格局限千单个度量的计算，进而可以检测与之相关的多
个度量。
4) Markov 处理模型。该模型的检测器将每个不同类型的审计事件作为一个状态变量，通
过使用一个状态转换矩阵来描述不同状态间的转换频率，并由状态转换矩阵中以前的状态和值
来决定新事件的异常与否。事件计数器是Markov 模型中最复杂的部分，该模型引入了执行事件
流的状态分析概念。
2. 量化分析
异常检测最常用的方法就是将检验规则和属性以数值形式表示的量化分析，这种度量方
法在Denning 的可操作模型中有所涉及。量化分析通过采用简单的加法直至比较复杂的密码学
计算得到的结果作为误用检测和异常检测统计模型的基础。下面是几个常用的量化分析技术。
l) 阙值检验。阙值检验也称为阅值或触发器，该方法通过在一定的许可级别上对描述用
户和系统的某些属性进行计数。一个典型的阙值实例就是系统允许有限的登录尝试次数，其他
类型的阙值检验包括：特定类型的网络连接数、企图访问文件次数、访问文件和目录次数，以
及访问网络次数等。这些检验遵循的固有假定是在一个特定时间间隔内进行度量，这种特定时
间间隔可以是固定的，也可以是滑动窗口。
2) 基千目标的集成检查。这种方法是以系统客体作为量化分析的基本单位，通常这样的
系统客体不会发生不可预测的变化。集成检查的一个实例就是使用消息消化函数对可疑系统客
体进行加密校验和运算。系统定期地重新计算校验和，并将其与先前计算的结果进行比较，如
发现不同则发出警告。Tripwire 是具有这种功能的典型产品。
3) 量化分析和数据精简。数据精简是从庞大的事件信息中删除或合并冗余的信息，从而
减少系统的存储负荷并优化基于事件信息的处理。早期的入侵检测系统中，量化分析的一个重
要用途就是采用量化度量来执行数据精简。
3. 统计度量
统计度量方法是产品化的入侵检测系统中常用的方法，常见千异常检测。统计方法有效
地解决了4 个问题： ＠选取有效的统计数据测量点，生成能够反映主体特征的会话向量； ＠根
据主体活动产生的审计记录，不断更新当前主体活动的会话向量； ＠采用统计方法分析数据，
判断当前活动是否符合主体的历史行为特征； ＠随着时间的推移，学习主体的行为特征，更新
历史记录。
129
计算机网络安全教程笫4 版
(1) IDES/NIDES
统计度量是一种成熟的入侵检测方法，它使入侵检测系统能够学习主体的日常行为，将
那些与正常活动存在较大统计偏差的活动标识为异常活动。这里以IDES 和NIDES 系统为例
做一些讨论，两个系统均采用统计分析技术为每个用户和系统主体建立和维护历史统计特征轮
廓，通过定期更新，较老的数据被老化以便特征轮廓适时反映用户行为在时间上的变化。系统
维护一个由特征轮廓组成的统计知识库，每个特征轮廓基千一个度昼集或度量表示不同用户的
正常行为，经过一段时间后，根据用户活动情况新的审计数据将被加入知识库（通过一个指数
退化因子老化旧向量）。
在IDES 系统中，每当产生一个新的审计记录，就会同时计算一个摘要测试统计结果，这：个
被称为IDES 分数的统计结果可通过下列公式计算： IS= (Si,S2,S3, …， Sn)C一I (S1,S2,S3, …,Sny 。
其中，（S1,S2,S3, …，SD)C一1 是相关矩阵或向量的逆，（S1,S2,S3, …,SD)' 是向量的转置。每-t-sn
度量行为的一个方面，例如文件访问、使用的终端和CPU 的使用时间。不同的SD 值也~~同
一行为的不同视图。
(2) 异常度量归并问题
在异常检测中，需要解决的一个重要问题就是如何将不同异常检测的度量值归并~来：~
出一个最终确定的值。有两种方法可以使用，即Bayesian 统计法和信任网络法。
Bayesian 统计法：设AI,A2, …， AD 是用来检测任何时刻系统所发生入侵的n 个度量，其
中每个二进制的Ai 度量系统的不同方面，如磁盘的J/0 操作、系统中的故障页面等，当~1变
量为1 时表明异常， 0 表明正常。令I 为目标系统正在发生的入侵行为，则每个异常度量Ai 的
可信度和灵敏度分别取决千P(Ai =111) 和P(A; =11-,I) 。根据Bayes 理论，在给定每~度谓t
Ai 值的情况下，归并结果表达式为：
P(IIA1,A2,…,AD)= P(A1,A2,…,An | I)
P(I)
P(AI,A2,…,An)'
求解该式需要知道基千I 和-,1 条件下的度董集的联合概率分布，这里联合概率分布的值是：
以指数形式描述的。为了简化计算，假定每个异常度量A1 仅依赖千I, 且相互间是条件独立的，
即A;':# Aj(i':# j) ，则有表达式： P(A1,A2, …，AD I I) =TI心P(Ai II) 和P(A1,A2, …， AD I-,I) =
n?＝lP(Ai1-,I) ，将两个表达式分别代入归并结果表达式，其比值表达式为：
P(II Ai,A2,…,AD) - P(I) TI心P(Ai I I)
P(-,1|AI,A2,…,An) P(-,I)TI品P(A1 1-,I) °
由此可知，根据先前的入侵概率以及入侵发生时每个异常度量的似然程度，可以得到多
异常度量的归并结果。若要更加精确地计算P(Il A1,A2,…， An) ，可以将不同异常度量Ai 之恒］
的相互依赖关系考虑进去，通过协方差矩阵法进行计算。
信任网络法：采用基于Bayes 判决规则的网络来图形化描述不同随机变量之间的依~关
系，并允许在与相邻结点存在概率关系的小规模集合上计算这些变量的联合概率分布。这个指
定的集合中包括除根结点外所有结点的先验概率和所有非根结点与其对应父类结点的~｛牛~
率。在信任网络中，弧线表示父子结点之间的事件依赖关系，并在随机变量值明确的情形下提
供证据吸收和计算框架。图5-9 给出的就是一个基于信任网络的入侵活动描述模型，图中的每
个方框表示一个二进制的随机变量。
130
笫5 章入侵检测技术
大量CPU
密集型任务
图5-9 基千信任网络的入侵活动描述模型
(3) 统计分析的缺陷
统计系统的主要优点是系统不需要误用检测系统所需的经常更新和维护，但这种方法也
存在明显的缺陷：一是大部分设计仅执行批模式审计记录处理，没有执行自动响应以防止进一
步的受损；二是统计分析的本质没有考虑事件间的顺序关系，然而现实系统的大部分异常攻击
都是依赖千事件顺序的。
4. 非参数统计度量
早期的统计分析均采用参数方法来描述用户和其他系统实体的行为模式，在具体方法上
比较类似，其采用的参数方法是假定审计数据服从一些固定分布（如高斯分布）规律。因此，
当这样的假定不正确时，系统将会出现很高的异常误报和漏报率，非参数异常检测方法就是为
解决参数方法的不足而提出的。
非参数统计方法通过使用非数据区分技术，尤其是群集分析技术来分析参数方法无法
考虑的系统度量。群集分析的基本思想是＄｝ 根据评估标准（也称为特性）将收集到的大量历
史数据（一个样本集）组织成群，通过预处理过程，将与具体事件流（经常映射为一个具体
用户）相关的特性转化为向量表示，再采用群集算法将彼此比较相近的向量成员组织成一个
行为类，这样使用该分析技术的实验结果将会表明用何种方式构成的群可以可靠地对用户的
行为进行分组并识别。实际工作中，有多种群集算法可以采用，例如，采用简单距离度量某
个客体是否属于一个群，或采用比较复杂的概念式度量，即运用一个条件集对客体进行记
分，然后根据分数值来判定它是否属千某个群。不同的群集算法服务于不同的数据集和分
析目标。
采用非参数方法还可以对事件数据进行可靠的精简（体现在源事件数据到向量的转化过
程中），从而提高异常检测的速度和准确性。
5．基千规则的方法
上面讨论的异常检测主要基于统计方法，异常检测的另一个变种就是下面将要讨论的基
于规则的方法。与前者不同的是，基于规则的检测使用规则集来表示和存储使用模式。这里介
绍两种方法： W&S 方法和基千时间的引导机(TIM) 。
(1) W&S
基于规则的异常检测Wisdom and Sense (W&S) 系统能在多种系统平台上运行，并能进
行操作系统和应用级描述事件，系统采用两种方法来移植规则库：手工输入（基于策略）和从
历史审计记录中产生。从历史审计记录中产生规则主要是通过执行一个种类检查以找到能够反
映系统主体和客体过去的行为模式，井将其保存在一个称为森林的树结构中。实际工作中通常
将这些审计记录的数值分组封装为线程类，当与线程相关的活动发生时，线程中的规则就对事
131
件起作用。
(2) TIM
计算机网络安全教程笫4 版
与其他异常检测方法不同的是， TIM 在事件顺序中而不是在单个事件中查找入侵者的行
为模式， TIM 使用一个引导方法动态地产生定义入侵的规则，有效地实现了Markov 转换概率
模型。
在进行异常检测时， TIM 针对事件发生的顺序，检查正在发生的事件链是否与基千历史
事件顺序观察所期望的一致，若一个事件顺序匹配了规则头，而下一个事件不在规则实体的预
测事件集中，就被认为是异常事件。系统通过从规则库中删除一些预测性能低的规则来提升其
检测能力。
例如： El 分E2 ➔ E3 ⇒ (E4 = 95%,E5 = 5%), E1 先发生， E2 随后，再后来是E3' 这是
TIM 基千过去的观察得出的事件顺序规则，被保存在规则库中，应用该规则可知，下一~事
件是E4 的概率应是95%。
与统计方法相比， TIM 的优点体现在它适合千与一些事件相关而不是与系统事件完全相
关的环境，且该方法没有与行为渐变(Session Creep) 相关的问题，但该方法的效率依赖千训
练数据的质量。
5.2.4 其他检测技术
在近期入侵检测系统的研究过程中，出现了一些新的入侵检测技术，这些技术不能简单
地归类为误用检测或是异常检测，而是提供了一种有别千传统入侵检测视角的技术层次，例如
免疫系统、基因算法、数据挖掘和基于代理的检测等，它们或者提供了更具普遍意义的分析技
术，或者提出了新的检测系统架构，因此无论对于误用检测还是异常检测来说，都可以4辱到很
好的应用。
1. 神经网络
作为人工智能(AI) 的一个重要分支，神经网络(Neural Network) 在入侵检测领域得到
了很好的应用，它使用自适应学习技术来提取异常行为的特征，需要对训练数据集进行学习以
得出正常的行为模式。这种方法要求保证用千学习正常模式的训练数据的纯洁性，即不包含任
何入侵或异常的用户行为。
神经网络由大量的处理元件组成，这些处理元件称为“单元”，单元之间通过带有权~的
“连接”进行交互。网络所包含的知识体现在网络的结构（单元之间的连接、连接的权值）
中，学习过程也就表现为权值的改变和连接的添加或删除。
神经网络的处理包含两个阶段。第一阶段的目的是构造入侵分析模型的检测器，使用代
表用户行为的历史数据进行训练，完成网络的构建和组装；第二阶段则是入侵分析模型的实际
运作阶段，网络接收输入的事件数据，与参考的历史行为相比较，判断出两者的相似度或偏离
度。在神经网络中，使用以下方法来标识异常的事件：改变单元的状态、改变连接的权值、添
加连接或删除连接，同时也提供对所定义的正常模式进行逐步修正的功能。
神经网络方法对异常检测来说具有很多优势1 由于不使用固定的系统属性集来定义用户
行为，因此属性的选择是无关的；神经网络对所选择的系统度量也不要求满足某种统计分布条
件，因此与传统的统计分析相比，具备了非参量化统计分析的优点。
将神经网络应用在入侵检测中也存在一些问题，例如，在很多情况下，系统趋向千形成
某种不稳定的网络结构，不能从训练数据中学习到特定的知识，这种情况目前尚不能完全确定
l32
笫5 章入侵检测技术
产生的原因。其次，神经网络对判断为异常的事件不会提供任何解释或说明信息，这导致了用
户无法确认入侵的责任人，也无法判定究竟是系统哪方面存在的问题导致了攻击者得以成功入
侵。另外，将神经网络应用千入侵检测，其检测的效率问题也需要解决。
最早提出使用神经网络来构造系统I用户行为模式的是Fox, 他使用Kohonen 的Self
Organizing Map (SOM) 自主学习算法来发现数据中隐藏的结构。Tulane 大学的David Endler
对Solaris 系统的BSM 模块所产生的系统调用审计数据使用神经网络进行了机器学习。Anup
K. Ghosh 也采用针对特定程序的异常检测，建立软件程序的进程级行为模式，通过区分正常
软件行为和恶意软件行为来发现异常，使用预先分类的输入资料对神经网络进行训练，学习出
正常和非正常的程序行为。Ghosh 还对简单的系统调用序列匹配、后向传播网络和Elman 网络
进行了比较。
2. 免疫学方法
New Mexico 大学的Stephanie Forrest 提出了将生物免疫机制引入计算机系统的安全保护框
架中。免疫系统中最基本也是最重要的能力是识别“自我同眻自我”，换句话讲，它能够识别哪
些组织是属于正常机体的，不属于正常的就认为是异常，这个概念和入侵检测中异常检测的概
念非常相似。研究人员通过大量的实验发现：对一个特定的程序来说，其系统调用序列是相当
稳定的，使用系统调用序列来识别“自我”，应该可以满足系统的要求。在这个假设的前提
下，该研究小组提出了基千系统调用的短序列匹配算法，并做了大量开创性的工作。
3. 数据挖掘方法
Columbia 大学的Wenke Lee 在其博士论文中，提出了将数据挖掘(Data Mining, DM) 技
术应用到入侵检测中，通过对网络数据和主机系统调用数据的分析挖掘，发现误用检测规则或
异常检测模型。具体的工作包括利用数据挖掘中的关联算法和序列挖掘算法提取用户的行为模
式，利用分类算法对用户行为和特权程序的系统调用进行分类预测。实验结果表明，这种方法
在入侵检测领域有很好的应用前景。Wenke Lee 还提出并验证了将信息论中“嫡”的概念引入
安全领域，以解决入侵检测系统中特性属性的选择问题，用千构建检测模型。此外，他还对基
于数据挖掘的入侵检测系统在配置到实时环境中时出现的问题进行了深入研究，包括检测的准
确性、检测效率和系统的实用性。
Florida 技术学院的Philip K. Chan 则针对目前商业交易中普遍存在的信用卡欺诈问题，提
出了分布式数据挖掘CDistributed Data M血ng, DDM) 和元学习(Meta Leaming) 概念，用
千检测欺诈行为。
哥伦比亚大学数据挖掘实验室的Leonid Portnoy 则使用了数据挖掘中的聚类算法，通过计
算和比较记录间的矢董距离，对网络连接记录和用户登录记录进行自动聚类，从而完成对审计
记录是否正常的判断工作。
4．基因算法
基因算法是另外一种较为新颖的分析手段。基因算法是进化算法的一种，引入了达尔文
在进化论中提出的自然选择的概念（优胜劣汰、适者生存）对系统进行优化。基因算法利用对
“染色体”的编码和相应的变异及组合，形成新的个体。算法通常针对需要进行优化的系统变
量进行编码，作为构成个体的“染色体”，因此对于处理多维系统的优化是非常有效的。在基
因算法的研究人员看来，入侵检测的过程可以抽象为：为审计事件记录定义一种向量表示形
式，这种向量或者对应于攻击行为，或者代表正常行为。通过对所定义向量进行的测试，提出
改进的向量表示形式，不断重复这个过程直至得到令人满意的结果。在这种方法中，将不同的
133
计算机网络安全教程笫4 版
向量表示形式作为需要进行选择的个体，基因算法的任务是使用“适者生存”的概念，得出最
佳的向量表示形式。通常分为两个步骤来完成：首先使用一串比特对所有的个体（向量表示形
式）进行编码；然后找出最佳选择函数，根据某些评估准则对系统个体进行测试，得出最为合
适的向量表示形式。基因算法的典型代表是由French Engineering University 的Ludovic Me of
Supelec 开发的GASSATA 系统。
5．基千Agent 的检测
近年来， 一种基千Agent 的检测技术(Agent-Based Detection) 逐渐引起研究者的重视。
所谓Agent, 实际上可以看作是在执行某项特定监视任务的软件实体。Agent 通常以自治的方
式在目标主机上运行，本身只受操作系统的控制，因此不会受到其他进程的影响。Agent 的独
立性和自治性为系统提供了良好的扩展性和发展潜力。一个Agent 可以简单到仅仅对一段时间
内某条命令被调用的次数进行计数，也可以复杂到利用数学模型对特定应用环境中的入侵~出
判断，这完全取决千开发者的主观意愿。基千Agent 的入侵检测系统的灵活性保证它可以~保
障系统的安全提供混合式的架构，综合运用误用检测和异常检测，从而弥补两者各自的缺陷。
例如，可以将一个Agent 设置成通过模式匹配的算法来检测某种特定类型的攻击行为， 同时可
以将另一个Agent 设置为对某项服务程序异常行为的监视器，甚至将入侵检测的响应模块也作
为系统的一个Agent 运行。Purdue University 的研究人员为基千Agent 的入侵检测系统提出了
一个基本原型，称为入侵检测自治代理(Autonomous Agents for Intrusion Detection, AAFID) 。
针对基于Agent 的检测技术， Purdue University 的Terran Lane 提出了一种基千用户行为等
级模型的异常检测引擎Agent 生成方法。等级模型的叶结点表示用户行为的临时结构，较高层
次的结点则代表其子结点所表示结构间的相互关系。Lane 采用基于事例学习(Instance Based
Learning, IBL) 和隐马尔可夫模型(Hidden Markov Model, HMM) 的方法，通过基千时间的
序列数据来学习实体的正常行为模式。
Arizona 州立大学的Nong Ye 使用随机过程中的马尔可夫链模型(Markov Chain Model)
来表示主机系统中的正常模式。通过对系统实际观察到的行为的分析，推导出正常模式的马尔
可夫链模型对实际行为的支持程度，从而判断异常。处理的对象是系统中的特权程序所产生的
系统调用序列。NongYe 还使用Bayesian 概率网络进行异常检测，提出了采用结点间无向~~
的对称结构，取代传统Bayesian 网络中的有向连接。采用接合点概率表取代原先的条件~率
表，并修正了证据推论算法。另外， Nong Ye 也对数据挖掘中的分类算法进行了研究，使用决
策树分类器学习入侵特征，将计算机和网络系统事件分类为若干不同的状态，并进行相应的聚
合以利千后端的分析处理。
还有许多国内外的研究人员对入侵检测系统所使用的检测技术进行了大量的研究工作，
提出并实现了其他一些检测方法和原型系统，例如基千流量分析的检测、基于入侵策略分析的
检测等，在此不再赘述。
以上介绍的检测技术，有些针对用户的行为模式，有些针对程序的行为模式，还有一些
则将两者相结合，保证从多个层次对受保护系统进行监测。
5.3 分布式入侵检测
传统的入侵检测系统通常都属于自主运行的单机系统。无论是基于网络数据源，还是基于
主机数据源；无论是采用误用检测技术，还是异常检测技术，在整个数据处理过程中，包括数
134
笫5 章入侵检测技术
据的收集、预处理、分析、检测，以及检测到入侵后采取的响应措施，都由单个监控设备或监
控程序完成。然而，在面临大规模、分布式的应用环境时，这种传统的单机方式就遇到了极大
的挑战。在这种条件下，要求各入侵检测系统（监控设备或监控程序）之间能够实现高效的信
息共享和协作检测。在大范围网络中部署有效的入侵检测系统已经成为一项新的安全需求，推
动了分布式入侵检测系统(Distributed Intrusion Detection System, DIDS) 的诞生和不断发展。
分布式入侵检测是目前入侵检测乃至整个网络安全领域的热点之一，国内外众多的大
学、研究机构、安全团体和商业组织都致力千这方面的研究工作。通常采用的方法中，一种是
对现有的IDS 进行规模上的扩展，另一种则通过IDS 之间的信息共享来实现。具体的处理方
法也有两种：分布式信息收集、集中式处理；分布式信息收集、分布式处理。前者以DIDS 、
NADIR 和ASAX 为代表，后者则采用了分布式计算的方法，降低了对中心计算能力的依赖，
同时也减少了对网络带宽带来的压力，因此具有更好的发展前景。
s.3.1 分布式人侵检测的优势
分布式入侵检测由千采用了非集中的系统结构和处理方式，相对于传统的单机IDS 具有
一些明显的优势。
1. 检测大范围的攻击行为
传统的基千主机的入侵检测系统只能通过检查系统日志和审计记录来对单个主机的行为
或状态进行监测，即使是采用网络数据源的入侵检测系统，也仅在单个网段内有效。对于一些
针对多主机、多网段和多管理域的攻击行为，例如大范围的脆弱性扫描或拒绝服务攻击，由于
不能在检测系统之间实现信息交互，通常无法完成准确和高效的检测任务。
分布式入侵检测通过各个检测组件之间的相互协作，可以有效地克服这一缺陷。
2. 提高检测的准确度
不同的入侵检测数据源反映的是系统不同位置、不同角度、不同层次的运行特性，可以
是系统日志、审计记录或网络数据包等。传统的入侵检测系统为了简化检测过程和算法复杂
度，通常采用单一类型的数据源。这一方面可以提高系统的检测效率，但另一方面也导致了检
测系统输入数据的不完备。另外，检测引擎如果采用单一的算法进行数据分析，同样可能导致
分析结果不够准确。
分布式入侵检测系统各个检测组件针对不同的数据来源，可以是网络数据包、主机审计
记录、系统日志，也可以是特定应用程序的日志，甚至还可以是一些通过人工方式输入的审计
数据。各个检测组件所使用的检测算法也不是固定的，有模式匹配、状态分析、统计分析和量
化分析等，可以分别应用千不同的检测组件。系统通过对各个组件报告的入侵或异常特征，进
行相关分析，可以得出更为准确的判断结果。
3． 提高检测效率
分布式入侵检测实现了针对安全审计数据的分布式存储和分布式计算，相对于单机数据
分析的入侵检测系统来说，这将不再依赖系统中唯一的计算资源和存储资源，可以有效地提高
系统的检测效率，减少入侵发现时间。
4. 协调响应措施
由于分布式入侵检测系统的各个检测组件分布于受监控网络的各个位置，一旦系统检测
到攻击行为，可以根据攻击数据包在网络中经过的物理路径采取响应措施，例如封锁攻击方的
网络通路、入侵来源追踪等。即使攻击者使用网络跳转的方式隐藏真实的IP 地址，在检测系
l35
计算机网络安全教程笫4 版
统的监控范围内通过对事件数据进行相关和聚合，仍然有可能追查到攻击者的真实来源。
5.3.2 分布式人侵检测的技术难点
与传统的单机IDS 相比，分布式入侵检测系统具有明显的优势。然而， 在实现分布检测
组件的信息共享和协作上却存在着一些技术难点。斯坦福研究院(Stanford Research Institute,
SRI) 在研究中，列举了分布式入侵检测必须关注的关键问题： 事件产生及存储、状态空间管
理及规则复杂度、知识库管理，以及推理技术等。
1. 事件产生及存储
在传统的入侵检测系统中，安全事件的产生、存储和处理都是集中式的，这种方式在面
临大规模网络时缺乏良好的扩展性。整个网络范围内分布的大量安全事件数据如果仍采用~中
式存储方式，将会导致网络流量和存储需求的剧增。
2. 状态空间管理及规则复杂度
状态空间管理及规则复杂度关注的是，如何在规则的复杂程度和审计数据处理要求之间取
得平衡。从检测的准确性角度来看，检测规则或检测模型越复杂，检测的有效性就越好，~同
时也导致了复杂的状态空间管理和分析算法。采用复杂的规则集对大量的审计数据进行处~，
对处理机来说会消耗大量的CPU 时间和存储空间，这可能降低系统的实时处理能力。反之，如
果采用较为简单的规则集，虽然可以提高系统的处理能力，但无法保证检测的准确性。
3. 知识库管理
知识库用于存放检测规则或检测模型，在分布式环境下，知识库最大的问题在千如fiiJ实
现快速的规则升级和分发。
4. 推理技术
对千大范围的互联网络来说，集中式处理方式所带来的对计算资源、存储资源和通信资
源的要求是单机系统无法满足的。因而，对安全审计数据采用分布式处理方式成为必然要求，
但这将涉及如何设计和实现高效的分布式处理算法问题。
SRI 的研究人员从技术角度讨论了实现分布式入侵检测系统存在的难点。实际上， 对千实
际的网络系统和应用环境来说，还有其他一些因素需要考虑，例如：入侵检测组件间的通信可
能占用网络带宽，影响系统的通信能力；网络范围内的日志共享导致了安全威胁，攻击者可以
通过网络窃听的方式窃取安全相关信息；检测组件之间缺乏标准的事件描述格式；入侵检测组
件的部署配置严重依赖于目标网络，通用性有待提高等。
5.3.3 分布式人侵检测的实现
尽管分布式入侵检测存在技术和其他层面的难点，但由于其相对于传统的单机IDS 所具
有的优势，目前已经成为这一领域的研究热点。
1. Snortnet
这是在原理和具体实现上最为简单的一种方式，通过对传统的单机IDS 进行规模上的扩
展，使系统具备分布式检测的能力。典型代表是由Kyrgyz Russian Slavic 大学的Yarochlcin
Fyodor 所提出的Snortnet。Snortnet 是基千模式匹配的分布式入侵检测系统的一个具体实现。
系统包括3 个主要组件：网络感应器、代理守护程序和监视控制台。采用这种方式构建分布式
入侵检测系统，其特点是原理简单，系统实现也非常方便，因此作为商业化产品是比较适合
的。但由于其检测能力仍然依赖于原先的单机IDS, 只是在系统的通信和管理能力上进行了改
136
笫5 章入侵检测技术
进，因此并没有体现出分布式入侵检测的真正优势。
2. Agent-Based
基千Agent 的IDS 由千其良好的灵活性和扩展性，是分布式入侵检测的一个重要研究方
向。国外一些研究机构在这方面已经做了大量工作，其中以Purdue 大学的入侵检测自治代理
(A压ID) 和SRI 的EMERALD 最具代表性。
AAFID 的体系结构如图5-10 所示，其特点是形成了一个基千代理的分层顺序控制和报告
结构。一台主机上可驻留任意数量的代理，收发器负责监控运行在主机上的所有代理，向其发
送开始、停止和重新配置命令，并对代理收集的信息执行数据精简，然后向一个或多个监控器
及上一级分层报告结果。由于AAFID 的体系结构允许冗余接收器的汇报，因此个别监视器的
失效并不影响入侵检测系统的性能。监视器具有监控整个网络数据的能力，并可以对接收器的
结果执行高级聚合，系统提供的用户接口可用于管理员输入控制监视器的命令。
图5-10 AAFID 体系结构图
使用分布式代理方法进行入侵检测的另一个系统是SRI 研制开发的EMERLD 系统，该系
统在形式和功能上与AAFID 自动代理相似，其中心组件是EMERLD 服务监控器，监控器以
可编程方式部署在主机上执行不同的功能。由千EMERLD 将分析语义从分析和响应逻辑中分
离出来，因此在整个网络上更易集成，具有在不同抽象层次上进行分析的重要能力，这体现了
现代入侵检测系统的一个重要特征，即协作性。
3. DIDS
DIDS 是由加州大学戴维斯分校的Security Lab 完成的，它集成了两种已有的入侵检测系
统： Haystack 和NSM。前者由Tracor Applied Sciences and Haystack 实验室针对多用户主机的
检测任务而开发，数据源来自主机的系统日志。NSM 则是由加州大学戴维斯分校开发的网络
安全监视器，通过对数据包、连接记录和应用层会话的分析，结合入侵特征库和正常的网络流
或会话记录的模式库，判断当前的网络行为是否包含入侵或异常。DIDS 综合了两者的功能，
并在系统结构和检测技术上进行了改进。DIDS 由主机监视器、局域网监视器和控制器3 个组
件组成，其中控制器是系统的核心组件，采用基于规则的专家系统作为分析引擎。另外，
DIDS 系统还提供了一种基于主机的追踪机制，凡是在DIDS 监测下的主机都能够记录用户的
活动，并且将记录发往中心计算结点进行分析，因此DIDS 具有在自己监测网络下的入侵追踪
能力。DIDS 虽然在结构上引入了分布式的数据采集和部分的数据分析，但其核心分析功能仍
然由单一的中心控制器来完成，因此并不是完全意义上的分布式入侵检测。其入侵追踪功能的
实现也要求追踪范围在系统的监控网络之内，显然在Internet 范围内大规模地部署这样的检测
系统是不现实的。
137
计算机网络安全教程笫4 版
4. GrIDS
GrIDS (Graph-based Intrusion Detection System) 同样由UC Davis 提出并实现，该系统实
现了一种在大规模网络中使用图形化表示的方法来描述网络行为的途径，其设计目标主要针对
大范围的网络攻击，如扫描、协同攻击和网络蠕虫等。OrIDS 的缺陷在千，只是给出了网络连
接的图形化表示，具体的入侵判断仍然需要人工完成，而且系统的有效性和效率都有待~证和
提高。
5. Intrusion Strategy
Boeing 公司的Ming-Yuh Huang 从另一个角度对入侵检测系统进行了研究，针对分布式入
侵检测所存在的问题，他认为可以从入侵者的目的或入侵策略入手，帮助确定如何在不同的
IDS 组件之间进行协作检测。对入侵策略的分析可以帮助系统调整审计策略和参数，构成；自适
应的审计检测系统。通常对千计算机攻击事件来说，攻击的序列并不是随机的。攻击者使用一
系列的工具来达到不同的目的，选择何种工具及使用的次序取决千所处的环境和目标系统的响
应。为了达到特定的攻击目的，攻击者通常会按照固定的逻辑顺序发起一系列攻击行为，这利】
满足逻辑偏序关系的行为可以很好地揭示入侵者的目的。通过入侵策略分析来完成检测4壬务口，
是入侵检测领域的一个重要研究方向。
6. 数据融合
Tinlin Bass 提出将数据融合(Data Fusion) 的概念应用到入侵检测中，从而将分布式A侵
检测任务理解为在层次化模型下对多个感应器的数据综合问题。在这个层次化模型中， A~~
测的数据源经历了从数据到信息再到知识3 个逻辑抽象层次。入侵检测数据融合的重点在于·~!
用已知的入侵检测模板和模式识别，这与前面介绍的数据挖掘不同，数据挖掘注重于发掘先消t
未发现的入侵中隐藏的模式，以帮助发现新的检测模板。
7．基千抽象的方法
乔治梅森大学的Peng Ning 提出了一种基于抽象(Abstraction-based) 的分布式~~检：测
系统，基本思想是设立中间层，提供与具体系统无关的抽象信息，用于分布式检测系统中的~
息共享，抽象信息的内容包括事件信息及系统实体间的断言。中间层用千表示IDS 间的共冯巨
信息时使用的对应关系为： IDS 检测到的攻击或者IDS 无法处理的事件信息作为event, IDS
或受IDS 监控的系统的状态则作为Dynamic Predicates 。
5.4 入侵检测系统的标准
从20 世纪90 年代到现在，入侵检测系统的研发呈现出百家争鸣的繁荣局面，并~智能
化和分布式两个方向取得了长足进展。为提高IDS 产品、组件及与其他安全产品之间的~操
作性， DARPA 和IETF 的入侵检测工作组(IDWG) 发起制定了一系列建议草案，从体系结
构、API、通信机制和语言格式等方面来规范IDS 的标准。
DARPA 提出的建议是公共入侵检测框架(CIDF) ，最早由加州大学戴维斯分校安全~验：室
主持起草， 1999 年6 月IDWG 也出台了一系列草案。此外，致力千提高入侵检测响应能力的
IDIP 协议(Intruder Detection and Isolation Protocol) 也是标准化研究工作中的重要组成部分。
5.4.1 IETF/IDWG
IDWG 定义了用于入侵检测与响应(IDR) 系统之间或与需要交互的管理系统之间的信息
138
笫5 章入侵检测技术
共享所需要的数据格式和交换规程。IDWO 提出了3 项建议草案：入侵检测消息交换格式
(IDMEF)、入侵检测交换协议(IDXP) 及隧道轮廓(Tunnel Profile) 。
1. IDMEF
IDMEF 描述了表示入侵检测系统输出信息的数据模型，并解释了使用此模型的基本原
理。模型采用XML 实现，并设计了一个XML 文档类型定义。自动入侵检测系统使用IDMEF
提供的标准数据格式对可疑事件发出警报，提高商业、开放资源和研究系统之间的互操作性。
IDMEF 最适用千入侵检测探测器和接收警报的控制台之间的数据信道。
IDMEF 数据模型以面向对象的形式表示探测器传递给控制台的警报数据，设计数据模型
的目标是为警报提供确定的标准表达方式，并描述简单警报和复杂警报之间的关系。图5-11
是IDMEF 数据模型各主要部分之间的关系图。
图5-11 IDMEF 数据模型各主要部分之间的关系图
所有IDMEF 消息的最高层类是IDMEF-Message, 每一种类型的消息都是该类的子类。
IDMEF 数据模型采用统一建模语言(UML) 描述， UML 用一个简单的框架表示实体及它们
之间的关系，并将实体定义为类。
IDWG 最早曾提出两个建议实现IDMEF: 用S:MI （管理信息结构）描述一个SNMP MIB
和使用DTD （文档类型定义）来描述XML 文档。XML 是SGML （标准通用标记语言）的简
化版本，是ISO 8879 标准对文本标记说明进行定义的一种语法。从本质上说， XML 是一种元
语言，即一个描述其他语言的语言，它允许应用程序定义自己的标记，还可以为不同类型的文
档和应用程序定义定制化的标记语言。XML DTD （文档类型定义）可用来声明文档所用的标
记，它包括元素（文档包括的不同信息部分）、属性（信息的特征）和内容模型（各部分信息
之间的关系）。
2. IDXP
IDXP （入侵检测交换协议）是一个用于入侵检测实体之间交换数据的应用层协议，能够
实现IDMEF 消息、非结构文本和二进制数据之间的交换，并提供面向连接协议之上的双方认
证、完整性和保密性等安全特征。IDXP 是BEEP 的一部分，后者是一个用千面向连接的异步
交互通用应用协议， IDXP 的许多特色功能（如认证、保密性等）都是由BEEP 框架提供的。
139
计算机网络安全教程笫4 版
IDXP 模型包括建立连接、传输数据和断开连接。
l) 建立连接。使用IDXP 传送数据的入侵检测实体被称为IDXP 的对等体，对等体只能
成对地出现，在BEEP 会话上进行通信的对等体可以使用一个或多个BEEP 信道传输数据。
对等体可以是控制台，也可以是探测器，且相互间是多对多的关系。但IDXP 规定，探测
器之间不可以建立交换。入侵检测实体之间的IDXP 通信在BEEP 信道上完成，其过程是先要
进行一次BEEP 会话，然后就有关的安全特性问题进行协商，协商好BEEP 安全轮廓之后，互
致问候，然后开始IDXP 交换。图5-12 所示为两个入侵检测实体A 和B 之间建立IDXP j匿信
的过程。
B
- - - - - --- - -xport 连接[I]----------
--－－－－－－－－－－－问候一一一一一一一--－－--
--－－－－－－一启动安全轮廓[2] - - - - - - - --
-－－－－－－－－－－－－问候－－－－－－－－－－－-"
-－－－－一－－－－启动IDXP[3]---.:.. －－－－--
图5-12 入侵检测实体A 和B 之间建立IDXP 通信的过程
需要注意的是， IDXP 对等实体之间可能有多个代理，这些代理可能是防火墙，也可能是
将多部门探测器数据转发给总控制台的代理。隧道轮廓描述了使用代理时的IDXP 交换。
2) 传输数据。一对入侵检测实体进行BEEP 会话时，可以使用IDXP 轮廓打开一~或多
个BEEP 信道，每个信道上的对等体均以客户／服务器模式进行通信， BEEP 会话发起者为~户
机，而收听者则为服务器。图5-13 描述了一个探测器将数据传送给控制台的简单过程。
探测器
（客户机）
---BEEP 会话－－－
一一一IDXP 轮廓－－
控制台
（服务器）
图5-13 探测器向控制台传输数据过程简图
在一次BEEP 会话时，使用多个BEEP 信道有利于对在IDXP 对等体之间传输的数据进行
分类和优先权设置。例如，一个管理器Cl 在向另一个管理器C2 传送警报数据时，可以用不
同的信道传送不同类型的警报数据，在每个信道上管理器Cl 的作用都相当千一个客户~而
C2 则对不同信道上的数据做出相应的处理，如图5-14 所示。
140
管理器Cl
（客户机）
------ BEEP 会话· 一一一一一一
一IDXP 轮廓，基于网络的警报－
一一IDXP 轮廓，基于主机的警报
---IDXP 轮廓，其他警报－－
管理器C2
（服务器）
图5-14 基于多BEEP 信道的IDXP 对等体间数据传输示意图
第5 章入侵检测技术
3) 断开连接。在有些情况下， 一个IDXP 对等体可以选择关闭某个IDXP 信道。在关闭
一个信道时， 对等体在0 信道上发送一个“关闭“元素，指明要关闭哪一个信道，一个IDXP
对等体也可以在0 信道上发送一个指明要“关闭“0 信道的元素，来关闭整个BEEP 会话。
在上面的模型中， IDXP 对等实体之间采用了一个BEEP 安全轮廓实现端到端的安全，而
无须通过中间的代理建立安全信任，因此，只有IDXP 对等体之间是相互信任的，而代理是不
可信的。
5.4.2 CIDF
CIDF 的工作集中体现在4 个方面：体系结构、通信机制、描述语言和应用编程接口
(API) 。
1. CIDF 的体系结构
CIDF 在IDES 和NIDES 的基础上提出了一个通用模型，将入侵检测系统分为4 个基本组
件：事件产生器、事件分析器、响应单元和事件数据库，其结构如图5-15 所示。在该模型
中，事件产生器、事件分析器和响应单元通常以应用程序的形式出现，而事件数据库则是以文
件或数据流的形式出现。很多IDS 厂商都以数据收集部分、数据分析部分和控制台部分3 个
术语来分别代替事件产生器、事件分析器和响应单元。CIDF 将IDS 需要分析的数据统称为事
件，它可以是网络中的数据包，也可以是从系统日志或其他途径得到的信息。
以上4 个组件只是逻辑实体，一个组件可能是某台计算机上的一个进程甚至线程，也可
能是多个计算机上的多个进程，它们以GIDO （统一入侵检测对象）格式进行数据交换。
GIDO 是对事件进行编码的标准通用格式（由CIDF 描述语言CISL 定义）， GIDO 数据流在
图5-15 中以虚线表示，它可以是发生在系统中的审计事件，也可以是对审计事件的分析结果。
输出：对事件的响应
输出； 高级/.,,-［5早三］
中断事件， , 输出：事件的存储信息 荨－－－1一一一一五
、、、叶王严，，级；尸
输人： 原始事件源
图5-15 CIDF 体系结构图
2. CIDF 的通信机制
为了保证在各个组件之间安全、高效地进行通信， CIDF 将通信机制构造成一个3 层模
型： GIDO 层、消息层和协商传输层。要实现有目的的通信，各组件就必须能正确理解相互之
间传递的各种数据的语义。GIDO 层的任务就是提高组件之间的互操作性，因而GIDO 对各种
各样的事件表示做了详细的定义。
消息层确保被加密认证消息在防火墙或NAT 等设备之间传输过程中的可靠性。消息层只
负责将数据从发送方传递到接收方，而不携带任何有语义的信息。同样， GIDO 层也只考虑所
传递信息的语义，而不关心这些消息怎样传递。
141
计算机网络安全教程笫4 版
单一的传输协议无法满足CIDF 各种各样的应用需求，只有当两个特定组件对信道使用达
成一致认识时才能进行通信。协商传输层规定了OIDO 在各个组件之间的传输机制。
实际工作中， CIDF 的通信机制主要从4 个方面，即配对服务、路由、消息层及消息层处
理来讨论消息的封装和传递。
3. CIDF 的描述语言
CIDF 的总体目标是实现软件的复用和IDR （入侵检测与响应）组件之间的互操作性。首
先， IDR 组件基础结构必须是安全、健壮、可伸缩的， CIDF 定义了一种应用层的语言CISL
（公共入侵规范语言）用来描述IDR 组件之间传送的信息，制定了一套对这些信息进行编~的
协议。CISL 可以表示CIDF 中的各种信息，如原始事件信息（审计踪迹记录和网络数据~信
息）、分析结果（系统异常和攻击特征描述）和响应提示（停止某些特定的活动或修改组件在I
安全参数）等。
CISL 使用了一种被称为S 表达式的通用语言构建方法， S 表达式可以对标记和数据~行
简单的递归编组，即对标记加上数据，然后封装在括号内完成编组，这与LISP 有些类伦以。S
表达式的最开头是语义标识符（简称为SID) ，用千显示编组列表的语义。例如S 表~式；：
(HostName'firstexample.com' ），它表示该编组列表的SID 是HostName, 因此后面的字符串
firstexample.com 将被解释为一个主机的名称。
对千一些事件的详细情况，需要使用很复杂的S 表达式才能进行描述，这就需要使用大
量的SID。SID 在CISL 中起着非常重要的作用，用来表示时间、定位、动作、角色和属性
等，只有使用大量的SID, 才能构造出合适的句子。CISL 使用范例对各种事件和分析结果
进行编码，把编码的句子进行适当的封装，就得到了GIDO, GIDO 的构建与编码是CISL 的
重点。
4. CIDF 的API
CIDF 的API 负责GIDO 的编码、解码和传递，它提供的调用功能使得程序员可以在不了
解编码和传递过程具体细节的情况下，以一种很简单的方式构建和传递GIDO。GIDO 的~~
分为两个步骤：首先构造表示GJ])O 的树形结构，然后将此结构编成字节码。
在构造树形结构时， SID 被分为两组：一组把S 表达式作为参数（即动词、副词、角色
和连接词等），另一组把单个数据或一个数据阵列作为参数（即原子），这样就可以把一个完整
的句子表示成一棵树，每个SID 表示成一个结点，最高层的SID 是树根。因为每个S 表达式
都包含一定的数据，所以树的每个分支末端都有表示原子SID 的叶子。
由千编码规则是定义好的，所以对树进行编码只是一个深度优先遍历和对各个结点~次
编码的过程。将字节码进行解码的过程正好相反。在SID 码的第一个字节里有一个比特位显/示其
需要的参数是基本数据类型还是S 表达式序列，然后语法分析器再对后面的字节进行解释。CIDF
的API 并不能根据树构建逻辑GIDO, 但提供了将树以普通GIDO 的S 表达式格式进行打印的
功能。
CIDF 的API 为实现者和应用开发者提供了两类接口： GID0 编解码API 和消息层API。
5.5 入侵防护系统
为了能够更好地保护网络和系统免遭越来越复杂的攻击威胁，人们不仅需要可以快~、
准确地检测攻击行为，还衙要有效地协调安全措施对攻击立即采取应对措施，以便在应对．~击
142
笫5 章入侵检测技术
的过程中不会浪费时间和资源，正是在这种需求下IPS 入侵防护系统应运而生。
5.5.1 概念和工作原理
入侵防护系统是一种主动的、智能的入侵检测系统，能预先对入侵行为和攻击性网络流
噩进行拦截，避免其造成任何损失，它不是简单地在恶意数据包传送时或传送后才发出报警信
号。IPS 通常部署在网络的进出口处，当它检测到攻击企图后，就会自动地将攻击包丢掉或采
取措施将攻击源阻断。
入侵防护系统与IDS 在检测方面的原理基本相同，它首先由信息采集模块实施信息收
集，内容包括网络数据包、系统审计数据， 以及用户活动状态及行为等。利用来自网络数据包
和系统日志文件、目录和文件中的不期望的改变、程序执行中的不期望行为，以及物理形式的
入侵信息等内容，然后利用模式匹配、协议分析、统计分析和完整性分析等技术手段，由检测
引擎对收集到的有关信息进行分析，最后由响应模块对分析后的结果做出适当的响应。入侵防
护系统与传统IDS 的主要区别是自动拦截和在线运行，两者缺一不可，防护工具（软／硬件方
案）必须设置相关策略，以对攻击自动做出响应。当攻击者试图与目标服务器建立会话时，所
有数据都会经过IPS 位千活动数据路径中的传感器，传感器检测数据流中的恶意代码并核对策
略，在未转发到服务器之前将含有恶意代码的数据包拦截。由千是在线实时运作，因而能保证
处理方法适当且可预知。
5.5.2 使用的关键技术
1) 主动防御技术：通过对关键主机和服务的数据进行全面的强制性防护，对其操作系统
进行加固，并对用户权力进行适当限制， 以达到保护驻留在主机和服务器上数据的效果。这种
防范方式不仅能够主动识别已知攻击方法，对于恶意的访问予以拒绝， 并且能够成功防范未知
的攻击行为。
2) 防火墙与IPS 联动技术：一是通过开放接口实现联动，即防火墙或IPS 产品开放一
个接口供对方调用，按照一定的协议进行通信、传输警报。该方式比较灵活，防火墙可以行
使它第一层访问控制的防御功能， IPS 系统可以行使它第二层检测入侵的防御功能，丢弃恶
意通信，确保该通信不能到达目的地，并通知防火墙进行阻断。由于是两个系统的配合运
作，所以要重点考虑防火墙和IPS 联动的安全性。二是紧密集成实现联动，把IPS 技术与防
火墙技术集成到同一个硬件平台上，在统一的操作系统管理下有序地运行，所有通过该硬件
平台的数据不仅要接受防火墙规则的验证，还要被检测判断是否含有攻击，以达到真正的实
时阻断。
3) 集成多种检测技术： IPS 有可能引发误操作，阻塞合法的网络事件，造成数据丢失。
为避免发生这种情况， IPS 集成采用了多种检测方法，最大限度地正确判断已知和未知攻击。
其检测方法包括误用检测和异常检测，增加状态信号、协议和通信异常分析功能，以及后门和
二进制代码检测。为解决主动性误操作，采用通信关联分析的方法，让IPS 全方位识别网络环
境，减少错误告警。通过将琐碎的防火墙日志记录、IDS 数据、应用日志记录及系统脆弱性评
估状况收集到一起，合理推断出将要发生哪些情况，并做出适当的响应。
4) 硬件加速系统： IPS 必须具有高效处理数据包的能力，才能实现于兆甚至更高级网络
流量的深度数据包检测和阻断功能。因此， IPS 必须基千特定的硬件平台，必须采用专用硬件
加速系统来提高IPS 的运行效率。
143
计算机网络安全教程笫4 版
5.5.3 JPS 系统分类
入侵防护系统根据部署方式可分为3 类：网络型入侵防护系统(NIPS) 、基千主积肚］入作t
防护系统(IDPS) 和应用型入侵防护系统(AIPS).
1) 网络型入侵防护系统(Network based Intrusion Prevention System, NIPS)。网络型入侵
防护系统采用在线工作模式，在网络中起到一道关卡的作用。流经网络的所有数据流苛珍臣~立
NIPS, 起到保护关键网段的作用。一般的NIPS 都包括检测引擎和管理器，其中流量分木斤模；~
具有捕获数据包、删除基千数据包异常的规避攻击，以及执行访问控制等功能。作为关~剖妗}
的检测引擎，可以采用异常检测模型和误用检测模型，响应模块具有制定不同响应策~的功
能，流量调整模块主要根据协议实现数据包分类和流量管理。NIPS 的这种运行方式实现了实
时防御，但仍然无法检测出具有特定类型的攻击，误报率较高。
2) 基千主机的入侵防护系统(Host based Intrusion Prevention System, HIPS) 。基千.±.杅L
的入侵防护系统用于预防攻击者对关键资源（如重要服务器数据库等）的入侵。HIPS :iffi常住］
代理(Agent) 和数据管理器组成，采用类似IDS 异常检测的方法来检测入侵行为，即允i午用
户定义规则，以确定应用程序和系统服务的哪些行为是可以接受的、哪些是违法的。Agent 驻：
留在被保护的主机上，用来截获系统调用并检测和阻断，然后通过可靠的通信信道与数据管哩呈
器相连。HIPS 这种基千主机环境的防御非常有效，而且也容易发现新的攻击方式，但~置．比
较困难，参数的选择会直接关系到误报率的高低。
3) 应用型入侵防护系统(Application Intrusion Prevention System, AIPS)。应用型入侵防
护系统是网络型入侵防护系统的一个特例， 它把基千主机的入侵防护系统扩展成位千应用月良务m
器之前的网络设备，用来保护特定应用服务（如Web 服务器、数据库等）。它通常被设计成；一·
种高性能的设备，配置在应用数据的网络链路上，通过AIPS 安全策略的控制来防止基千应：用
协议漏洞和设计缺陷的恶意攻击。
5.6 Snort 使用示例
为了直观地理解入侵检测的使用、配置等情况，下面以Snort 为例对构建以Snort 为基湿廿
的入侵检测系统进行概要介绍。
5.6.1 Snort 简介
Snort (http://www.snort.org) 是一个开放源代码的免费软件，它基千libpcap 的数据包~拚:
器，是一个轻量级的网络入侵检测系统。所谓轻量级，是指在检测时尽可能低地影响网络的正
常操作，一个优秀的轻量级NIDS 应该具备跨系统平台操作、对系统影响最小等特征，并且憎r
理员能够在短时间内通过修改配置实时地进行攻击事件响应，更为重要的是能够成为整~安洽;
体系的重要成员。Snort 作为其典型范例，可以运行在多种操作系统平台上，如UNIX~列
（需要libpcap 库支持）和Windows 系列（需要winpcap 库支持），与很多商业产品相比，它对
操作系统的依赖性比较低。
Snort 相对千昂贵的商业IDS 系统来说具有很多优势，如Snort 的代码短小、易于安装；、
便于配置，井且相当灵活。从功能上来看， Snort 的功能十分强大和丰富，正逐步逼近专业仁的
144
笫5 章入侵检测技术
商用NIDS 系统。Snort 具有实时数据包捕获和流量分析能力，能够快速检测网络攻击，及时
发出警报。同时， Snort 能够对网络数据包进行协议分析、内容搜索和匹配，能够检测多种形
式的网络攻击和探测，如缓冲区溢出攻击、端口扫描、CGI 攻击、SMB 探测和操作系统指纹
探测等。
此外，用户还可以根据实际需要调整检测策略，以应对网络突发事件。Snort 集成了多种
告警机制，支持实时告警功能，包括syslog 、用户指定文件、UNIX Socket, 以及基千
SMBClient 运用WinPopup 对Windows 用户告警等。
作为一个轻量级的网络入侵检测系统， Snort 具有非常好的扩展能力。Snort 使用了一种简
单的规则描述语言扩展其功能，能够迅速地对新出现的网络攻击做出反应，还可以通过插件的
形式实现自身功能的扩展。从检测模式而言， Snort 属于误用型检测，因此它仅能够对已知攻
击的特征模式进行匹配。也就是说， Snort 针对每一种入侵行为都提炼出其特征值，并按照规
范写成一个检测规则，从而形成一个规则数据库。然后将捕获的数据包比照规则库逐一匹配，
若匹配成功，则认为该入侵行为成立并做出处理。
Snort 遵循GPL (General Public License)，任何企业、个人和组织都可以免费使用，并可
以对其进行完善和功能扩充。事实上， Snort 也正是得益于GPL, 在全球各地网络程序员的共
同维护下，功能变得越来越强。
5.6.2 Snort 的体系结构
Snort 在结构上由数据包捕获和解码、检测引擎，以及日志及报警3 个子系统组成。
1. 数据包捕获和解码子系统
该子系统的功能是捕获共享网络的传输数据，并按TCP/IP 协议族的分层结构进行数据包
解析。Snort 利用libpcap 库函数采集数据，该库函数可以为应用程序提供直接从链路层捕获数
据包的接口函数，并可以设置数据包的过滤器来捕获指定的数据。网络数据采集和解析机制是
整个NIDS 实现的基础，目前， Snort 可以处理以太网、令牌环及SLIP （串行线路接口协议）
等多种链路类型的数据包。
2. 检测引擎子系统
检测引擎是NIDS 实现的核心，其准确性和快速性是衡量其性能的重要指标。前者
主要取决于对入侵行为特征码提炼的精确性和规则撰写的简洁实用性。由于网络入侵检
测系统自身角色的被动性一一只能被动地检测流经本网络的数据，不能主动发送数据包
去探测，因此只有将入侵行为的特征码归结为协议的不同字段的特征值，通过检测该特
征值来决定入侵行为是否发生。快速性则主要取决于引擎的组织结构是否能够快速地进
行规则匹配。
为了快速、准确地进行检测和处理， Snort 在检测规则方面做了较为成熟的设计。Snort 将
所有已知攻击方法以规则的形式存放在规则库中，每一条规则由规则头和规则选项组成。规则
头对应于规则树结点RTN (Rule Tree Node)，包含动作、协议、源（目的）地址和端口，以
及数据流向，这是所有规则的共有部分。规则选项对应千规则选项结点OTN (Optional Tree
Node) ，包含报警信息(msg)、匹配内容(Content) 等选项，这些内容需要根据具体规则的性
质确定。图5-16 给出了检测Telnet 登录尝试失败的Snort 规则，这是一个TCP 规则，其端口
号为23, TCP 状态标志为A、P, 数据负载中包含的字符串为Login incorrect。
· 145
计算机网络安全教程笫4 版
alert TCP $INTERNAL 23 ->$EXTERNAL any(msg:"IDS127/telnet-login-incorrect";
content:"Login incorrect";flags:AP)
图5-16 Snort 的规则格式
检测规则除了包括上述关千“要检测什么“，还应该定义”检测到了该做什么“。Snort 定
义了3 种处理方式： alert （发送报警信息）、log （记录该数据包）和pass （忽略该数据包），并
定义为规则的第一个匹配关键字。这样设计的目的是为了在程序中可以组织整个规则库，也就
是说，将所有的规则按照处理方式组织成3 个链表，以用千更快速、准确地进行匹配。~~，
Snort 在初始化并解析规则时，就分别生成TCP、UDP 、ICMP 和IP 共4 个不同的规则~每
一个规则树包含独立的三维链表： R'IN （规则头）、01N （规则选项）和指向匹配函数：的指
针，如图5-17 所示。
RTN RTN RTN
规则链表头规则链表头Src/Des IP Srcffies IP -I 规则链表头
Src/Des Port Src/Des Port
OTN OlN
规则链表选项规则链表选项
Content Content
TCP Flags TCP Flags
ICMP Codes{fype ICMPCodes/Type
Payload Size Payload Size
etc etc
IIO TN i
规则链表选项
Content
图5-17 Snort 规则链逻辑结构图
当Snort 捕获一个数据包时，首先分析该数据包使用哪个协议以决定将其与某个规贝U~对
进行匹配。然后与RTN 结点依次进行匹配，当与一个头结点相匹配时，将会向下与OTN 结
点继续进行匹配。每个OTN 结点包含一条规则所对应的全部选项， 同时包含一组函数：指
针，用来实现对这些选项的匹配操作。当数据包与某个OTN 结点相匹配时，即判断Jlt数：~
包为攻击数据包。系统使用的主要匹配函数有预处理函数Preprocess( ）、启动函数
Detect()，以及检测函数EvalPacket( ）、EvalHeader()和EvalOpts( ）等。Snort 的这种规则匹配
过程可称为“二维空间函数指针链表递归机制”，主要是根据规则树对数据进行递归匹酕七
图5-18 给出了其基本过程。
3. 日志及报警子系统
入侵检测系统应具备实时性和多样性，前者指在检测到入侵行为的同时能及时记~和l报
警，后者指能够根据需求选择多种方式进行记录和报警等。一个好的NIDS 更应该提供~好
的输出界面或发声报警等。Snort 作为轻量级的NIDS, 其另一个亮点就是数据包记~器；功
能，它可以采用TCPDUMP 的格式记录信息、向syslog 发送报警信息和以明文形式ia录：报
警信息3 种方式。此外， Snort 在网络数据流量非常大时，支持对数据包信息压缩，进而i实
现快速报警。
146
笫5 章入侵检测技术
巴巴RuleLlsts 头
止一一<?n/>
厅RuleListNode 下
5.6.3 Snort 的安装与使用
1. Snort 的安装模式
根据协议类型云石丁
规则链表头
t
顺序查找规则链表头
直至找到匹配的项
久
>
顽
的项
调用相应函数处理
根据Tag 信息进行记录
图5-18 Snort 规则匹配流程图
一个结点
Snort 可安装为守护进程模式，也可安装为包括很多其他工具的完整的入侵检测系统。
采用简单方式安装Snort 时，可以得到入侵数据的文本文件或二进制文件，然后用文本编
辑器等工具进行查看。在这种安装模式下， Snort 可将告警信息以SNMP trap 的形式发送到类
似于HP OpenView 或OpenNMS 之类的网管系统上，也可以SMB 弹出窗口的形式发送到运行
Wmdows 操作系统的计织扎上。
Snort 若与其他工具一起安装，则可以支持更为复杂的操作。例如，将Snort 数据发送给
数据库系统从而支持通过Web 界面进行数据分析，以增强对Snort 捕获数据的直观认识，避
免耗费大量的时间去查阅晦涩的日志文件。
2. Snort 的简单安装
Snort 的安装程序包括Linux 平台程序和Wmdows 平台程序，所有安装程序可以在Snort 官方
网站http:/./www.snort.org 上获取，当前的最新版本为snort-2.9.7.6。Linux 平台下通常使用源代码包
147
计算机网络安全教程笫4 版
的形式进行安装，可以方便地进行参数配置。在官方网站上还提供针对Fedora 、CentOS 、
FreeBSD 和Wmdows 平台的编译版本。下面介绍Linux 平台下Snort 源代码包的简单安装方法。
(1) 安装Snort
Snort 的正常运行必须有libpcap 库的支持，因此在安装Snort 之前需要确认系统已经安装
了libpcap 库，若未安装，可以到http://www.tcpdump.org 网站下载。之后编译并安装Snort 。
[root@mail]#tar-x,仓snort-2.9.7.6.tar.gz
[root@mail阳snort-2.9.7.6
[root@mail snort-2.9.7.6]# Jconfigure-eneble-sourcetire
[ root@mail snort-2.9. 7.6]#make
[root@mail snort-2.9.7.6]# make install
(2) 更新Snort 规则
Snort 的规则包括Community rules、Registered rules 和Subscriber rules 共3 类，其中，
Community rules 是免费规则。后两种需要用户注册才可下载。
下载最新的规则文件snortrules-snapshot-CURRENT.tar.gz。其中， CURRENT 表示最新的
版本号，当前为2976 。
厂snort]#w,gethttps:／_＿云；；；云一-hot-2976．血一二o玉还＞ －丘-_ ___!,n-snapshot-2?76.tar.gz-CI如snortJrules 二
(3) 配置Snort
建立配置文件目录。
但飞产［函＠皿snmt丑9.7．研兰Ie晌叩咕羹，．名
复制Snort 配置文件snort.conf 到Snort 配置目录。
仁［血钜生竺色竺塑空蛔sno灶切面应snorf/气“雯:·／？＇
编辑snort.conf。
贮'·,．．． L : ` 匣咂严扛血笃7．呼v.i应lSD或snort.颂`:l;?
修改后，一些关键设置如下。
_ _ _ ＿ 山一宁于气， 一· __. l.. - -— ...,....._._一，L
面HOME-NETyolll11etwork
var RULE pATII /ero/snort/rules
preprocessor http inspect: global \
iis -unicode _map/毗/snort/rules/unicode.map1252 ,'/
include/e邸nort/rules/reference.config
~．、,· "·· 了includeI啪细rt/rules/c屿i血on.config '.I丘`: ～．五绿沁七
- - -
. ． l ．尸． ． C :·",n(;Y,;:-~,~ •I -- •. ---- .._ ,-_.· ..._.,.
(4) 测试Snort
,- ·士－儿．． 4· 尸＃恤讥如师in/sno,:t-Afast-b-d-D-l/v叫lo的血n-e /et的srlortlsnort.OO试
广－一．． ， ＿
查看文件／var/log/messages，若没有错误信息，则表示安装成功。
(5) 将日志写入MySQL 数据库
建立数据库。
;,,; -·
＿＿二＿
二二］
.、.4 ·,, l /. 匡一飞础沌亟面D酶泌E8DO戊“ 11，m哼- 吨- 顽t书 ．五：，I ·· 二．. ，炉． '＾'勹-$.，--·.·，：、二，欢·$、..-.,`..．，·` ,..,...
148
第5 章入侵检测技术
建立表（使用schemas/create_mysql 文件） 。
L %mysql 曰Dsno~n-uroot -p< ．fsche咖s/云己云i-
．一T ? .
建立用户及权限。l -——--—· __ ___ mysql> set password for 'snortusr'@'localhost'"'password 行0叩assword1;
~． 俨二二］
修改snort.conf 文件。
[ - outputdatabase: log,mysqhuser=s云志p;sword千ompasswo面阮如云；；；i远亡ost＿＿」
3. Snort 的工作模式
Snort 有3 种工作模式，即嗅探器、数据包记录器和网络入侵检测系统。嗅探器模式仅从
网络上读取数据包并连续不断地流显示在终端上，数据包记录器模式则把数据包记录到硬盘
上，网络入侵检测模式最为复杂，而且可配置。
(1) 嗅探器
所谓的嗅探器模式，就是Snort 从网络上获取数据包，然后显示在控制台上。若只把
TCP/IP 包头信息打印在屏幕上，则只需要执行下列命令。
I jsnort-V__i. ·· r _」
若显示应用层数据，则执行下列命令。
I.. . - ·一” ;, -- $,··,，“'.．．蹈奴a. ::.. .. •, 」snort-vd ,.,. '-_. 一｀一．，记·- 俨t·＇恕· }',..·.. - 立沁二· .J七－ ·个'` ，万·, ?1 ,.; . ,, .:.
二
若同时显示数据链路层信息，则执行下列表命令。
t_ -占. 」snort=vde - ：-，一·…、乙 夕－三该了二．－·.~主．皇--心C一-～” 二
(2) 数据包记录器
如果要把所有的数据包记录到硬盘上，则需要指定一个日志目录， Snort 将会自动记录数据包。
二二］ - - - - 」snort-dev-lAa'g
. •:.. .•.... . :·
. ...,._...心．
~--·_，．气立'-`',
\''...一 ;. . .. ；扮＇，出恼` ： ·一心 ，？ ＇ -- __
当然， Aog 目录必须存在，否则Snort 就会报告错误信息并退出。当Snort 在这种模式下
运行时，它会记录所有捕获的数据包，并将其放到一个目录中，该目录以数据包目的主机的
IP 地址命名，例如： 192. 168. 10. 1 。
如果网络速度很快，或者希望日志更加紧凑以便事后分析，则应该使用二进制日志文件
格式。使用下面的命令可以把所有的数据包记录到一个单一的二进制文件中。
厂—-－正ll Aog-b ＇工f，男＇了易：：．，）=
随后可以使用任何支持tcpdump 二进制格式的嗅探器程序从该文件中读出数据包，例
如: tcpdump 或者Ethereal。使用－r 功能开关也可使Snort 读出包中的数据。Snort 在所有运行
模式下都能够处理tcpdump 格式的文件。
若希望在嗅探器模式下把一个tcpdump 格式的二进制文件内容显示到屏幕上，可以输入
下面的命令。
L jsn~正如钉邸砒随
在数据包和入侵检测模式下，通过BPF 接口可以使用多种方式维护日志文件中的数据。
例如，希望从日志文件中提取ICMP 包，只需要输入下面的命令行。
149
计算机网络安全教程第4 版
jsnort忐packet.log如叩二二勹
(3) 网络入侵检测系统
通过下面的命令行，可以将Snort 启动为网络入侵检测系统模式。
上—— Jsno”-dev-1.llog-h 192.168.l.O/24-csnort.conf
snort.conf 是规则集文件。Snort 会将每个包和规则集进行匹配，一旦匹配成功就会采取响
应措施。若不指定输出目录， Snort 就将日志输出到Ivar/log/snort 目录。
在网络入侵检测模式下，可以有多种方式配置Snort 的输出。默认情况下， Snort 以
ASCII 格式记录日志，使用full 报警机制。如果使用full 报警机制， Snort 会在包头之后打印
报警消息。如果不需要日志包，可以使用－N 选项进行关闭。
Snort 有6 种报警机制： full、fast、socket、syslog、smb (winpopup) 和none。其中下列4
个机制可以在命令行状态下使用－A 选项进行设置。
• -Afast: 报警信息包括时间戳(timestamp)、报警消息、源／目的IP 地址和端口。
• -Afull: 默认报警模式。
• -Aunsock: 把报警信息发送到一个UNIX 套接字。
• -Anone : 关闭报警机制。
使用－s 选项可以使Snort 把报警消息发送到syslog, 默认的设备是LOG_AUTHPRIV 和
LOG_ALERT。可以修改snort.conf文件更改其配置。
Snort 还可以使用SMB 报警机制， 通过SAMBA 把报警消息发送到Wmdows 主机。为了
使用这个报警机制，在运行．／configure 脚本时，必须使用－－enable-smbalerts 选项。
5.6.4 Snort 的安全防护
如果Snort 自身受到安全威胁，则可能收到错误的告警，甚至根本收不到告警信息。~保
护Snort 系统的运行安全，必须采取一些必要的安全防护措施。
1．加固运行Snort 系统的主机
关闭运行Snort 系统的主机上的不必要服务，及时安装操作系统安全补丁。配置防火墙，
使其拒绝对IC:MPecho 请求做出回应，并阻止任何其他不必要的网络访问。
2．在隐秘端口上运行Snort
所谓隐蔽端口(Stealth Interface) ，是指仅有进入数据包而没有任何发出数据包的网络接
口配置方法，这种措施可以有效保护运行Snort 系统主机的安全性。隐蔽端口模式的实现~要
建立在对网线进行特殊处理的基础上，其方法是在运行Snort 的主机上，将网络接口的1 针和
2 针短路， 3 针和6 针连到对端。有关隐蔽端口的更多信息可以参阅Snort 的FAQ 页面
http//www.snort.o咽docs/faq.html。
3. 在不配置1P 地址的接口上运行Snort
在没有配置IP 地址的接口上运行Snort 也可以避免该主机成为直接攻击目标。例如，在
Linux 主机上，可以运行命令ifconfig ethO up 来激活没有配置IP 地址的接口ethO。这种方法的
好处是， Snort 运行主机没有1P 地址，将导致无人可以通过网络访问。
5.7 小结
入侵检测是保障网络系统安全的关键部件，在体系结构上主要由事件提取、入侵分析、入侵
150
第5 章入侵检测技术
响应和远程管理4 个部分组成。执行的检测任务包括：监视、分析用户及系统活动，系统构造和
弱点的审计，识别、分析知名攻击的行为特征并告警，异常行为特征的统计分析，评估重要系统
和数据文件的完整性，操作系统的审计跟踪管理，以及识别用户违反安全策略的行为等。
入侵检测按照不同的标准有多种分类方法，通常有基于数据源、基于检测理论和基于检
测时效3 种分类方法。按检测理论分类，入侵检测有异常检测和误用检测两种类型。误用检测
是按照预定模式进行事件数据搜寻，最适用于对已知模式的可靠检测，其常见方法有条件概率
预测法、产生式／专家系统、状态转换方法、用于批模式分析的信息检索技术，以及Keystroke
Monitor 和基于模型的方法。异常检测基于一个假定，即用户的行为是可预测的、遵循一致性
模式的，且随着用户事件的增加异常检测会适应用户行为的变化，其常见方法有Denning 的原
始模型、量化分析法、非参数统计度量法，以及基千规则的方法。其他检测技术有：神经网络
法、免疫学方法、数据挖掘方法、基因算法和基于代理的检测等。
分布式入侵检测对信息的处理方法可分为两种：分布式信息收集、集中式处理；分布式
信息收集、分布式处理，具体实现方式有Snortnet、Agent-Based、DIDS 、GrIDS 、Intrusion
Strategy、数据融合，以及基千抽象的方法等。
为提高IDS 产品、组件及与其他安全产品之间的互操作性， DARPA 和IETF 的入侵检测
工作组发起制定了一系列建议草案，主要从体系结构、API、通信机制和语言格式等方面来规
范IDS 的标准。
作为一种主动安全防御措施， IPS 入侵防护系统不仅可以快速、准确地检测攻击行为，还
能够有效地协调安全措施对攻击立即采取应对措施，以便在应对攻击的过程中不会浪费时间和
资源。IPS 使用的关键技术主要包括：主动防御技术、防火墙与IPS 联动技术、集成多种检测
技术，以及硬件加速系统。根据部署方式分类，入侵防护系统主要有网络型入侵防护系统
(NIPS)、主机型入侵防护系统(HIPS) 和应用型入侵防护系统(AIPS) 。
在安全实践中，部署入侵检测系统是一项较为烦琐的工作，需要从3 个方面对入侵检测
进行改进，即突破检测速度瓶颈制约，适应网络通信需求；降低漏报和误报，提高其安全性和
准确度；提高系统互动性能，增强全系统的安全性能。
5.8 习题
1. 简述入侵检测系统的基本原理。
2. 简述误用检测的技术实现方法。
3. 简述异常检测的技术实现方法。
4. 简述入侵检测技术当前的研究热点。
5. 试指出分布式入侵检测的优势和劣势。
6. 你认为入侵检测的标准化工作对千当前入侵检测的研究有什么帮助。
7. 上网查找相关资料，整理井分析当前主流入侵检测产品的技术性能指标。
8. 简述Snort 是如何检测分布式拒绝服务攻击的，并在局域网内进行实验验证。
9. 针对入侵检测在实际应用中面临的困难，试提出几种可能的解决方案。
10. 结合IPS 的工作原理，若构建一个基于入侵检测和防火墙的联动安全系统，你是如何
考虑的？
151
第6章
操作系统与数据库安全技术
访问控制是实现既定安全策略的系统安全技术，它可以显式地管理针对所有资源的访问
请求。根据系统的安全策略要求，访问控制对每个资源请求做出许可或限制访问的判断，~而
有效地防止非法用户访问系统资源或合法用户非法使用资源。鉴于访问控制的重要性，~国国
防部的可信计算机系统评估标准(TESEC) 将其列为评价系统安全的主要指标之一。
在信息安全涵盖的众多领域中，操作系统安全是信息安全的核心问题。操作系统安全：是
整个计算机系统安全的基础，采用的安全机制主要包括两个方面，即访问控制和隔离~其
中，访问控制是其安全机制的关键。数据库系统是对数据资料进行管理的有效手段， t午~重：要
的数据资料都存储千各种类型的数据库中，因此，数据库的安全问题在整个信息安全~~中占
有重要地位。数据库安全主要从身份认证、访问控制和数据加密等方面来保证数据的~整？性、
可用性和机密性，应用广泛且最为有效的措施当属访问控制。
6.1 访问控制技术
计算机信息系统访问控制技术最早产生千20 世纪60 年代，随后出现了两种重要的访作］
控制技术，即自主访问控制(Discretionary Access Control, DAC) 和强制访问控制(Mandatory
Access Control, MAC)。它们在多用户系统（如各种UNIX 系统）中应用广泛，对计算机作号息
系统的安全做出了突出贡献。但作为传统访问控制技术，它们已经远远落后千现代系统安全：的
要求，安全需求的发展对访问控制技术提出了一些新的要求，主要体现在两个方面：计算为L信
息系统在各行业的应用进一步普及，与应用领域有关的安全需求大量涌现，如公共信息服夕今系
统对信息完整性和可用性的需求要远大于对保密性的需求，传统访问控制技术很难满足这利渭f
求；网络和分布式技术的发展使得访问控制要立足于单位或部门的网络来设计和实施，~至：还
要考虑其开放性，以便协作单位间的系统互连。为满足这些新的安全需求，近年来的研究工才乍
一方面是对传统访问控制技术的不足进行改进，另一方面则出现了以基千角色的访问控制技：术
(Rol~BasedAccess Control, RBAC) 为代表的新型技术手段。
6上1 认证、审计与访问控制
在讨论传统访问控制技术之前，先就访问控制与认证、审计之间的关系，以及访问拦巴制
的概念和内涵进行概要说明。
在计算机系统中，认证、访问控制和审计共同建立了保护系统安全的基础，如图6-1 所
示。其中认证是用户进入系统的第一道防线，访问控制则在鉴别用户的合法身份后，通~引用
监控器控制用户对数据信息的访问。引用监控器具体是通过进一步查询授权数据库来判定用户
是否可以合法操作该客体的，授权数据库由系统安全管理员根据组织的安全策略进行~权杜］设
置、管理和维护，有时用户也能修改授权数据库的部分内容，如设置他们自己文件的访问权
限。审计通过监视和记录系统中相关的活动，起到事后分析的作用。
152
笫6 章操作系统与数据库安全技术
图6-1 是安全服务的逻辑交互模型，它是在理想化程度上表达认证、访问控制和审计服
务的相互关系，在实际的系统应用中，这种理想化的分离可能不会如此明晰，如被引用监控器
保护的客体可以存储在授权数据库中，而不需要分开的物理空间。
。
安全管理员
证
认
0 胪
引用监控器
、、、\』II ，，，，＇，，/
、、、、巴三＇，，，，，，＇
图6-1 访问控制与其他安全服务关系模型
区别认证和访问控制是非常重要的。正确地建立用户的身份标识是由认证服务实现的。在通过
引用监控器进行访问控制时，总是假定用户的身份已经被确认，而且访问控制在很大程度上依赖用户
身份的正确鉴别和引用监控器的正确控制。同时，访问控制不能作为一个完整的策略来解决系统安
全，它必须结合审计实行。审计主要关注系统所有用户的请求和活动的事后分析，它一方面有助千分
析系统中用户的行为活动来发现可能的安全破坏，另一方面通过跟踪记录用户请求而在一定程度上起
到威慑作用，使用户不敢进行非法尝试。而且，审计对查询系统的安全漏洞很有帮助。
所谓访问控制，就是通过某种途径显式地准许或限制访问能力及范围的一种方法。通过
访问控制服务，可以限制对关键资源的访问，防止非法用户的侵入或者合法用户的不慎操作所
造成的破坏，访问控制是实现数据保密性和完整性机制的主要手段。
访问控制系统一般包括以下几个要素。
·主体(Subject) ：指发出访问操作、存取请求的主动方，包括用户、用户组、终端、
主机或一个应用进程，主体可以访问客体。
·客体(Object) ：指被调用的程序或要存取的数据访问，可以是一个字节、字段、记
录、程序、文件，或一个处理器、存储器及网络结点等。
·安全访问政策：也称为授权访问，它是一套规则，用千确定一个主体是否对客体拥有
访问能力。
在访问控制系统中，区别主体与客体比较重要，通常主体发起对客体的操作由系统的授
权来决定，而且主体为了完成任务可以创建另外的主体，并由父主体控制子主体。此外，主体
与客体的关系是相对的，当一个主体受到另一主体访问时，就成为访问目标，即成为客体。
访问控制规定了哪些主体可以访问，以及访问权限的大小，其一般原理如图6-2 所示。
「-－－ 7 口＄：豆：实施1
1 功能｝
L.. __＿」
决策请求' 1 访问决策
访问控制决策功能
图6-2 访问控制原理图
153
计算机网络安全教程第4 版
在主体和客体之间加入的访问控制实施模块主要用来控制主体对客体的访问。访问控制
决策功能块是访问控制实施功能中最主要的部分，它根据访问控制信息做出是否允许主体操作
的决定，这些访问控制信息可以存放在数据库和数据文件中，也可以选择其他存储方法，并且
要视访问控制信息的多少及安全敏感度而定， 其原理如图6-3 所示。
访问决策
_ l
决策请求
访问控制决策
功能
图6-3 访问控制决策功能示意图
6.1.2 传统访问控制技术
1．自主访问控制DAC 及其发展
DAC 是目前计算机系统中实现最多的访问控制机制，它是在确认主体身份及其所属组．的
基础上对访问进行限定的一种方法。传统的DAC 最早出现在20 世纪70 年代初期的分时系统
中，它是多用户环境下最常用的一种访问控制技术，在目前流行的UNIX 类操作系统中~遍
采用。其基本思想是，允许某个主体显式地指定其他主体对该主体拥有资源的访问类型。
由千DAC 对用户提供灵活的数据访问方式，能够适用千多数系统环境，因而被＊~采
用，尤其是在商业和工业环境中应用广泛。DAC 技术在一定程度上实现了权限隔离和资~保
护，但是在资源共享方面难以控制。为了便于资源共享，一些系统在实现DAC 时，引入．了用
户组的概念，以实现组内用户的资源共享。
DAC 技术存在的明显不足包括：资源管理比较分散；用户间的关系不能在系统中体现l出
来，不易管理；信息容易泄露，无法抵御特洛伊木马(Trojan Horse) 的攻击。所谓特洛伊木
马，是指嵌入在合法程序中的一段以窃取或破坏信息为目的的恶意代码。在自主访问控制下，
一旦带有特洛伊木马的应用程序被激活，木马就可以任意泄露和破坏接触到的信息，甚至改~
这些信息的访问授权模式。
针对DAC 的不足，研究人员对其进行了一系列的改进。20 世纪70 年代末， M. H.
Harrison 等提出了客体所有者自主管理该客体的访问和安全管理员限制访问权限随意扩~ffl结
合的半自主式的HRU 访问控制模型，并设计了安全管理员管理访问权限扩散的描述i吾言。
HRU 模型提出了管理员可以限制客体访问权限的扩散，但没有对访问权限扩散的程度~内容
做出具体的定义。到了1992 年， Sandhu 等为了表示主体需要拥有的访问权限，将HR.um型
发展为TAM (Typed Access Matrix ）模型，在客体和主体产生时就对访问权限的扩散做出了具
体的规定。随后， 为了描述访问权限需要动态变化的系统安全策略， TAM 发展为ATAM
(Augmented TAM) 模型。
上述改进在一定程度上提高了DAC 的安全性能，但由千DAC 的核心是客体所有者书巴制
客体的访问授权，使得它们不能用于具有较高安全要求的系统，因而这些改进模型几乎~有得
到实际应用。
154
笫6 章操作系统与数据库安全技术
2. 强制访问控制MAC 及其发展
MAC 最早出现在Multics 系统中，在1983 美国国防部的TESEC 中被用作B 级安全系统
的主要评价标准之一。MAC 的基本思想是： 每个主体都有既定的安全属性，每个客体也都有
既定的安全属性，主体对客体是否能执行特定的操作取决千两者安全属性之间的关系。
通常所说的MAC 主要是指TESEC 中的MAC, 它主要用来描述美国军用计算机系统环
境下的多级安全策略。在多级安全策略中，安全属性采用二元组（安全级，类别集合）表示，
安全级表示机密程度，类别集合表示部门或组织的集合。一般的MAC 都要求主体对客体的访
问满足BLP (Bell and LaPadula) 安全模型的两个基本特性。
l) 简单安全性：仅当主体的安全级不低千客体安全级且主体的类别集合包含客体的类别
集合时，才允许该主体读该客体。
2) 札特性：仅当主体的安全级不高于客体安全级且客体的类别集合包含主体的类别集合
时，才允许该主体写该客体。
上述两个特性保证了信息的单向流动，即信息只能向高安全属性的方向流动， MAC 就是
通过信息的单向流动来防止信息的扩散， 以及抵御特洛伊木马对系统保密性的攻击。
与DAC 相比，强制访问控制MAC 提供的访问控制机制无法绕过。在MAC 中，每个
用户及文件都被赋予一定的安全级别，用户不能改变自身或任何客体的安全级别，即不允许
单个用户确定权限，只有系统管理员才可以确定用户和组的访问权限。系统通过比较用户和
文件的安全级别来决定用户是否可以访问该文件。此外，强制访问控制不允许进程生成共享
文件，从而防止了进程通过共享文件将信息从一个进程传到另一个进程的情况出现。MAC
可通过使用敏感标签对所有用户和资源强制执行安全策略，即实行强制访问控制。安全级别
一般分为4 级，绝密级(Top Secret) 、机密级(Confidential) 、秘密级(Secret) 和无级别级
(Unclassified) 。这样，用户与访问信息的读写关系将有以下4 种。
1) 下读(read down)：用户级别大千文件级别的读操作。
2) 上写(writeup)：用户级别低千文件级别的写操作。
3) 下写(write down)：用户级别大千文件级别的写操作。
4) 上读(read up)：用户级别低于文件级别的读操作。
MAC 存在的不足主要表现在两个方面：应用领域偏窄，使用不灵活，一般只用千军方等
具有明显等级观念的行业或领域； 完整性方面控制不够，它重点强调了信息向高安全级的方向
流动，对高安全级信息的完整性强调不够。
为了增强传统MAC 的完整性控制，人们提出了TE (Type Enforcement) 控制技术，该技
术把主体和客体分别进行归类，两者之间是否有访问授权由TE 授权表决定， TE 授权表由安
全管理员负责管理和维护。TE 技术在一家美国公司开发的安全操作系统LOCK6 中得到了应
用。TE 技术提高了系统的完整性控制，但维护授权表给管理员带来了很多麻烦。为了改进TE
控制技术管理复杂的不足， TE 发展为DTE (Domain and Type Enforcement) 访问控制技术，
它主要通过定义一些隐含规则来简化TE 授权表，其维护工作也随之大大减少。
Chinese Wall 模型是Brewer 和Nash 开发的用于商业领域的访问控制模型，该模型主要用
千保护客户信息不被随意泄露和篡改。它是应用在多边安全系统中的安全模型，即多个组织间
的访问控制系统中，以及可能存在利益冲突的组织中。Chinese Wall 模型最初是为投资银行设
计的，但也可应用在其他相似的场合。Chinese Wall 安全策略的基础是客户访问的信息不会与
155
计算机网络安全教程笫4 版
目前他们可支配的信息产生冲突，后来它被证明也是一种强制访问模型，其贡献在千对开发商
用访问控制技术的尝试。
上述各种改进在一定程度上使得传统的MAC 技术更加完善，并在商业领域也做出了一定
的努力，但总体来说，这些模型大都针对具体应用开发、灵活性差，产生的影响不大，只有个
别系统采用了这些技术。
6.1.3 新型访问控制技术
1．基千角色的访问控制RBAC
RBAC (Role-Based Access Control) 的概念早在20 世纪70 年代就已经提出，但在相当长
的一段时间内没有得到人们的关注。进入20 世纪9n 比心气，随着安全需求的发展，加之． R. S.
Sandhu 等人的倡导和推动， RBAC 又引起了人们才：注，美国很多学者和研究机松I者切：
从事这方面的研究，如NIST (National Institute of Standard Technology) 和George Manson 大
学的LIST (Laboratory of Infonnation Security Technology) 等。NIST 的研究人员认为RBAC
将是DAC 和MAC 的替代者。自1995 年开始，美国计算机协会ACM 每年都召开RBAC 的专
题研讨会来促进RBAC 的研究，图6-4 给出了RBAC 的结构示意图。
角色分层
项目角色分层
图6-4 RBAC 的结构示意图
在RBAC 中，在用户和访问许可权之间引入了角色的概念，用户与特定的一个或多个｀角
色相联系，角色与一个或多个访问许可权相联系。这里所谓的角色就是一个或多个用户~以执
行的操作的集合，它体现了RBAC 的基本思想，即授权给用户的访问权限通常由用户~一个
组织中担当的角色来确定。当用户被赋予一个角色时，用户具有这个角色所具有的所~~问
权。用户和角色间是多对多的关系，角色与客体间也是多对多的关系。角色可以根据实际工作
的需要生成或取消，而且登录到系统中的用户可以根据自己的需要动态激活自己拥有的角色
（见图6-4 中的会话），从而避免了用户无意间危害系统的安全。在RBAC 模型系统中，每个
用户进入系统时都得到一个会话，一个用户会话可能激活的角色是该用户的全部角色的子~。
对该用户而言，在一个会话内可获得全部被激活的角色所包含的访问权。设置角色和会话带来
的好处是容易实施最小特权原则。除此之外，角色之间、许可权之间、角色和许可权之间定义
了一些关系，如角色间的层次关系，而且还可以按需要定义各种约束，如定义出纳和会计这两
个角色为互斥角色（即这两个角色不能分配给一个用户）。
迄今为止，已发展了4 种RBAC 模型。
l) 基本模型RBACO, 该模型指明了用户、角色、访问权和会话之间的关系。
156
笫6 章操作系统与数据库安全技术
2) 层次模型RBACI, 该模型是偏序的，上层角色可继承下层角色的访问权。
3) 约束模型RBAC2, 该模型除包含RBACO 的所有基本特性外，增加了对RBACO 的所
有元素的约束检查，只有拥有有效值的元素才可被接受．
4) 层次约束模型RBAC3 , 该模型兼有RBACI 和RBAC2 的特点。RBAC 的好处在千一
个组织内的角色相对稳定，系统建立起来以后主要的管理工作即为授权或取消主体的角色， 这
与一些组织通常的业务管理很类似。如一个公司可以建立经理、会计等角色， 然后根据不同的
角色给予授权，进行管理。
RBAC 具有5 个明显的特点。
1) 以角色作为访问控制的主体。用户以什么样的角色对资源进行访问，决定了用户拥有
的权限，以及可执行何种操作。
2) 角色继承。为了提高效率，避免相同权限的重复设置， RBAC 采用了“角色继承” 的
概念，定义了这样的一些角色，它们有自己的属性，但可能还继承其他角色的属性和权限。角
色继承把角色组织起来，能够很自然地反映组织内部人员之间的职权和责任关系。角色继承可
以用祖先关系来表示，如图6-5 所示，角色2 是角色l 的“父亲”，它包含角色l 的属性与权
限。在角色继承关系图中，处于最上面的角色拥有最大的访问权限，越下端的角色拥有的权限
越小。
图6-5 RBAC 角色继承示意图
3) 最小权限原则。所谓最小权限原则， 是指用户所拥有的权力不能超过他执行工作时所
需的权限。实现最小权限原则， 需分清用户的工作内容，确定执行该项工作的最小权限集，然
后将用户限制在这些权限范围之内。在RBAC 中，可以根据组织内的规章制度、职员的分工
等设计拥有不同权限的角色， 只有角色需要执行的操作才授权给角色。当一个主体想要访问某
资源时，如果该操作不在主体当前活跃角色的授权操作之内，该访问将被拒绝。
4) 职责分离。对于某些特定的操作集，某一个角色或用户不可能同时独立地完成所有这
些操作。“职责分离”有静态和动态两种实现方式。所谓静态职责分离，即只有当一个角色与
用户所属的其他角色彼此不互斥时，这个角色才能授权给该用户。动态职责分离是指只有当一
个角色与一个主体的任何一个当前活跃角色都不互斥时，该角色才能成为该主体的另一个活跃
角色。
5) 角色容量。在创建新的角色时，要指定角色的容量。在一个特定的时间段内，有一些
角色只能由一定数量的用户占用。
RBAC 的最大优势在千它对授权管理的支持。通常的访问控制实现方法是将用户与访问
权限直接相联系，当组织内人员新增或有人离开时，或者某个用户的职能发生变化时，需要进
行大量授权更改工作。而在RBAC 中，角色作为一个桥梁，沟通于用户和资源之间。对用户
157
计算机网络安全教程笫4 版
的访问授权转变为对角色的授权，然后再将用户与特定的角色联系起来。RBAC 的另一优势在
于系统管理员在一种比较抽象且与企业通常的业务管理类似的层次上控制访问。这种授权使管
理员从访问控制底层的具体实现机制中脱离出来，十分接近日常的组织管理规则。
与DAC 和MAC 相比， RBAC 具有明显的优势， RBAC 基千策略无关的特性，使其几乎
可以描述任何安全策略，甚至DAC 和MAC 也可用RBAC 描述。这与DAC 和MAC~~很
大区别， DAC 本身就是一种安全策略， MAC 主要是描述军用计算机系统的多级安全策略。由
千RBAC 具有自管理能力，基于RBAC 思想产生的ARBAC (Administrative RBAC) ffl;?J!!很
好地实现了对RBAC 的管理，这使得RBAC 在进行安全管理时更接近应用领域的实际情况。
当然，与DAC 和MAC 相比， RBAC 技术也存在缺陷。一方面由于RBAC 技术还不十分
成熟，在角色配置工程化、角色动态转换等方面还需深入研究， RBAC 实现技术也需进一~探
索。另一方面， RBAC 比DAC 和MAC 复杂，系统实现难度大，其策略无关性需要用户自己
定义适合本领域的安全策略，而定义众多角色、访问权限及其关系是一项很复杂的工作。
2．基千任务的访问控制TBAC
TBAC (Task-Based Access Control) 是一种新的安全模型，从应用和企业层角度来解决安
全问题（而非从系统的角度）。它采用“面向任务”的观点，从任务（活动）的角度来建立安
全模型和实现安全机制，在任务处理的过程中提供动态实时的安全管理。在TBAC 中，对·象
的访问权限控制并不是静止不变的，而是随着执行任务的上下文环境发生变化，这是称其~主
动安全模型的原因。具体说来， TBAC 有两点含义。首先，它是在工作流的环境中考虑~~息
的保护问题。在工作流环境中，每一步对数据的处理都与以前的处理相关，相应的访问~告tl也
是这样，因而TBAC 是一种上下文相关的访问控制模型。其次，它不仅能对不同工作~~行
，不同的访问控制策略，还能对同一工作流的不同任务实例实行不同的访问控制策略。这是“基
于任务”的含义，所以TBAC 又是一种基于实例(Instance-based) 的访问控制模型。最后，
因为任务都有时效性，所以在基于任务的访问控制中，用户对千授予其权限的使用也是有时效
性的。该模型的不足之处在千比任何模型都复杂。
3 ．基千组机制的访问控制
1988 年， RS. Sandhu 等人提出了基千组机制的NTree 访问控制模型，之后该模型又得到
了进一步扩充，相继产生了多维模型N_Grid 和倒树影模型。NTree 模型的基础是偏序的~~
理论，组的层次关系由维数为2 的偏序关系（即NTree 树）表示，通过比较组结点在NTree
中的属性决定资源共享和权限隔离。该模型的创新在千提出了简单的组层次表示方法和自~向
下的组逐步细化模型，倒树影模型是NTree 模型的一个特例，一棵倒立的树加上它的倒~就
构成了一棵倒影树，倒影树的上半部分负责管理权利分离，倒影部分负责资源共享，倒影树~
型解决了组间资源共享问题。
就访问控制技术发展而言，在20 世纪90 年代还出现了一些其他的访问控制技术，如俄
罗斯学者提出的基千加密的访问控制技术，田M 提出的基千进程间通信(IPC) 的访问控制技
术等，这些想法都侧重千访问控制实现技术的研究，没有形成较大的影响。
6.1.4 访问控制的实现技术
访问控制的实现技术是指为了检测和防止系统中的未授权访问，对资源予以保护Jifr采：取
的软硬件措施和一系列的管理措施。访问控制一般是在操作系统的控制下，按事先确定的规！则
决定是否允许主体访问客体，它贯穿千系统工作的全过程，是在文件系统中广泛应用的安~防
158
第6 章操作系统与数据库安全技术
护方法。
访问控制矩阵(Access Control Matrix) 是最初实现访问控制技术的概念模型，它利用二
维矩阵规定了任意主体和任意客体间的访问权限，矩阵中的行代表主体的访问权限属性，列代
表客体的访问权限属性，矩阵中的每一格表示所在行的主体对所在列的客体的访问授权。访问
控制的任务就是确保系统的操作是按照访问控制矩阵授权的访问来执行的，它是通过引用监控
器协调主体对客体的每次访问而实现的。这种方法清晰地实现了认证与访问控制的相互分离。
例如：设某一系统中S1 、S公出为3 个主体， 01 、02、03 为3 个客体，访问控制矩阵如图6-6
所示， 0 表示无访问权限， l 表示读， 2 表示写， 3 表示执行， 4 表示拥有。
卢。1 。2 。J
SI 4 3 。
S2 ·2 I 4
S3 I 4 2
图6-6 访问控制矩阵
通常，由于访问控制矩阵较大，并且会因许多主体对千大多数客体不能访问而造成矩阵
变得过于稀疏，这显然不利于执行访问控制操作。因此，现实系统中通常不使用访问控制矩
阵，但可在访问控制矩阵的基础上实现其他访问控制模型，这主要包括以下几个。
·基于访问控制表的访问控制实现技术。
·基于能力关系表的访问控制实现技术。
·基于权限关系表的访问控制实现技术。
1. 访问控制表
访问控制表(Access Control Lists, ACL) 是以文件为中心来建立访问权限表的，如图6-7
所示，表中登记了该文件的访问用户名及访问权隶属关系。利用访问控制表能轻松地对特定客
体的授权访问进行判断，以决定哪些主体具备何种访问权限执行访问操作。同样地，撤销特定
客体的授权访问也较为容易，只要将相应客体的访问控制表置空即可。
filel
UserA
rw
吕
r
图6-7 访问控制表
尽管在查询特定主体能够访问的客体时需遍历所有客体的访问控制表，但由千访问控制
表的简单、实用，使其仍不失为一种成熟且有效的访问控制实现方法，许多通用的操作系统都
159
计算机网络安全教程笫4 版
使用访问控制表来提供访问控制服务。例如， UNIX 和VMS 系统利用访问控制表的简略方
式，允许以少量工作组的形式实现访问控制表，而不允许单个主体出现，这样可以使访问控制
表很小且能够和文件存储在一起。另一种复杂的访问控制表应用是利用一些访问控制包，~过
它制定复杂的访问规则来限制何时和如何进行访问，而且这些规则将根据用户名和其~用户属
性的定义进行单个用户的匹配应用。
2. 能力关系表
能力关系表(Capabilities Lists) 则与ACL 相反，它是以用户为中心来建立访问~限表
的，表中规定了该用户可访问的文件名及访问权限，如图6-8 所示。
Useri\
file I
rw
UserB
图6-8 能力关系表
利用能力关系表可以很方便地查询一个主体的所有授权访问。相反，检索具有授权．i方问
特定客体的所有主体，则需要遍历所有主体的能力关系表。自20 世纪70 年代起，人们就；开二始
开发基于能力关系表实现访问控制的计算机系统，但最终没有获得商业上的成功，现~计复目扎
系统还是主要利用访问控制表的方法。当然可以把能力关系表和访问控制表结合起来，发：挥韦月
者的优势，在分布式系统中这种方法就很有市场，因为分布式系统中不需要主体重复认iiE, 主
体认证一次获得自己的能力关系表后，就可以根据能力关系从对应的服务器获得相应的服务-,
而各个服务器可以进一步采用访问控制表进行访问控制。
3. 权限关系表
由千访问控制表和能力关系表各有千秋，千是可以考虑从另一角度来表示访问~告柜关
系，即直接建立用户与文件的隶属关系，不需要表示主体与客体之间的多种访问关系，~~是
权限关系表(Autho血疽on Relation List) 的原理。如图6-9 所示，表中各行分别说明了用户与
文件的权限，不同的权限占据不同的行，就像典型的关系数据库表示一样。而且，通过对．主付5
进行排序，可以得到能力关系表的特性。通过对客体进行排序，可以得到访问控制表的特性~o
UserA own 、r 、W filol
UserA r Iilo2
UserA r 、W fllo3
UserB r file I
UserB w 、r file2
图6分权限关系表
160
笫6 章操作系统与数据库安全技术
6.1.5 安全访问规则（授权）的管理
授权的管理决定了谁将被授权修改允许的访问，这可能是访问控制中最重要且又不易理
解的特性之一。下面就来介绍3 种常用访问控制技术的授权管理问题。
1. 强制访问控制的授权管理
在强制访问控制中，允许的访问控制完全是根据主体和客体的安全级别来决定的。其中
主体（用户、进程）的安全级别由系统安全管理员赋予，客体的安全级别则由系统根据创建它
们的用户的安全级别决定。因此，强制访问控制的管理策略比较简单，只有安全管理员能够改
变主体和客体的安全级别。
2．自主访问控制的授权管理
自主访问控制提供了多种管理策略，主要有5 种方式： ＠集中式，仅单个管理者或组对
用户进行访问控制授权和授权撤销； ＠分层式，中心管理者把管理责任分配给其他管理员，
这些管理员再对用户进行访问授权和授权撤销，分层式管理可以根据组织结构来实行； ＠所
有式，如果一个用户是一个客体的所有者，则该用户可以对其他用户访问该客体进行授权访
问和授权撤销； ＠合作式，对千特定系统资源的访问不能由单个用户授权决定，而必须要其
他用户的合作授权决定； ＠分散式，在分散管理中，客体所有者可以把管理权限授权给其他
用户。
3. 角色访问控制的授权管理
角色访问控制提供了类似自主访问控制的许多管理策略。而且，管理权限的委托代理是
角色访问控制管理的重要特点，这在以上两种访问控制的管理策略中都不存在。在大规模分布
式系统中，实行集中管理一般是不可能的。实际上，常把由中心管理员对特定客体集合的权限
管理委托给其他管理员进行授权。例如，对千特定区域客体的管理授权可以由该区域的管理员
代理执行，而区域管理员则由中心管理员进行授权管理，这样就形成了多个子区域，在各个子
区域中可以重复进行委托代理处理，继续形成子区域。
6.2 操作系统安全技术
随着计算机技术的飞速发展和大规模应用，使得现实世界依赖计算机系统的程度越来越
高，另一方面计算机系统的安全问题也越来越突出。AT&T 实验室的S. Bellovin 博士曾对美国
CERT (Computer Emergency Response Team) 提供的安全报告进行分析，结果表明，大约有一
半的计算机网络安全问题是由软件工程中的安全缺陷引起的，而操作系统的安全脆弱性则是问
题的根源之一。
6.2.1 操作系统安全准则
1. 操作系统的安全需求
所谓安全的系统，是指系统具备安全机制并运用该机制对授权用户及其进程的读、写、
删、改信息进行控制。具体来说，操作系统共有6 个方面的安全需求。
l) 安全策略。系统必须拥有并实施明确的安全策略。对于认证的主体和客体，系统应提
供一个规则集用于决定一个特定的主体是否可以访问一个具体的客体。通常，有自主安全策略
161
计算机网络安全教程笫4 版
和强制安全策略之分。自主安全策略是指只有被选择的用户或用户组才允许存取数据。弓虽制安
全策略是指可以有效地处理敏感信息存取的规则。
2) 标记。为了根据强制安全策略的规则对存储在计算机中的信息进行存取控制，必须给
客体一个能够有效地标识其安全级别的标记。
3) 鉴别。单个主体必须能够被系统识别，在系统中应维护与身份识别认证有关的信息。
存储信息的每一次访问都应受到控制，即只有授权的用户才能访问这些信息。
4) 责任。系统中应保存和保护审计信息，以便跟踪影响系统安全的行为。一个可信的系
统应该能够将与安全相关事件的情况记录在审计日志文件中，有选择地记录审计事件对降1氐审
计开销和开展有效的安全分析都是必要的。系统要保护审计数据不受破坏，以确保违背安~的
事件在发生后可被探测到。
5) 保证。一个计算机系统应该能够具有可以被评估的各种软硬件机制，这些机制~~供
充分保证系统实现上述4 种与安全有关的需求。典型地，这些机制可以嵌在操作系统中~以安
全的方式执行指定的任务。
6) 连续保护。实现这些基本需求的可信机制必须能不断地提供保护，以防止入侵乔I]*经
授权的篡改。如果计算机系统中实现安全策略的功能组成易被未经授权而篡改，它就不~一介、
安全的系统。也就是说，连续保护需求意味着存在千计算机系统的整个生命周期。
2．可信计算机系统评价准则
从20 世纪80 年代开始，国际上很多组织开始研究并发布计算机系统的安全性，，平价并圭
则，最有影响和代表的当属美国国防部制定的可信计算机系统评价准则，即TCSEC (Trusted
Computer Syst.em Evaluation Criteria) 。
在上述6 种安全需求中，（ l ）、(2) 属于策略类，（3 ）、（4) 属千责任类，（ 5 ）、（ 6) 履i于
保证类。根据这些需求， TCSEC 将评价准则划分为4 类，每一类中又细分了不同的级别。
D 类：不细分级别。
C 类Cl 级和C2 级。
B 类Bl 级、B2 级和B3 级。
A 类： Al 级。
其中， D 类的安全级别最低， A 类最高，高级别包括低级别的所有功能，同时又实顼卜一
些新的内容。实际工作中，主要通过测试系统与安全相关的部分来确定这些系统的设i十~实冯几
是否正确与完全，一个系统与安全相关的部分通常称为可信基一一TCB (Trusted Computing
Base) 。
1) D1 级（最小保护）：几乎没有保护，如DOS 操作系统。
2) Cl 级（自主安全保护）：
＠非形式化定义安全策略模型使用了基本的DAC 控制。
＠实施在单一基础上的访问控制。
＠避免偶尔发生的操作错误与数据破坏。
＠支持同组合作的敏感资源的共享。
@c 级安全措施可以简单理解为操作系统逻辑级安全措施。
3) C2 级（可控访问保护）。
＠非形式化定义安全策略模型使用了更加完善的DAC 策略与对象重用策略。
162
第6 章操作系统与数据库安全技术
＠实施用户登录过程。
＠实施相关事件的审计。
＠实施资源隔离。
＠对一般性攻击具有一定的抵抗能力。
@C 级安全措施可以简单理解为操作系统逻辑级安全措施。
4) Bl 级（标识安全保护）。
©保留C2 级所有安全策略非形式化安全模型定义。
＠引用了安全标识。
@ TCSEC 定义的安全标识中的6 个被采用，在命名主体与客体上实施MAC 控制，实际
上引入了物理级的安全措施。
＠对一般性攻击具有较强的抵抗能力，但对渗透攻击的抵抗能力较低。
5) B2 级（结构安全保护）。
＠形式化定义安全策略模型TCB 结构化。
＠把DAC 与MAC 的控制扩展到所有的主体与客体上。
＠引入了隐蔽通道保护。
＠更彻底的安全措施。
＠强化认证机制。
＠严格系统配置管理。
＠有一定的抵抗渗透能力。
6) B3 级（安全域保护）。
＠完好的安全策略的形式化定义必须满足引用监控器的要求。
＠结构化TCB 结构继承了B2 级的安全特性。
＠支持更强化的安全管理。
＠扩展审计范围与功能。
＠具有较强的系统应急恢复能力。
＠具有较高的抵抗渗透能力。
7) Al 级（验证安全保护）。
G 功能与B3 级相同。
＠增加了形式化分析、设计与验证。
一般认为Al 级已经基本实现了各种安全需求，更完美的系统就认为是超出Al 级的系统。
6.2.2 操作系统安创明户的一般方法
1. 威胁系统资源安全的因素
威胁系统资源安全的因素除设备部件故障外，还有以下几种情况。
l) 用户的误操作或不合理地使用了系统提供的命令， 造成对资源不期望的处理。如无意
中删除了不想删除的文件，无意中停止了系统的正常处理程序等Q
2) 恶意用户设法获取非授权的资源访问权。如非法获取其他用户的信息，这些信息可以
是系统运行时内存中的信息，也可以是存储在磁盘上的信息（如文件等）．
3) 恶意破坏系统资源或系统的正常运行，如计算机病毒。
163
计算机网络安全教程笫4 版
4) 破坏资源的完整性与保密性，对用户的信息进行非法修改、复制和破坏。
5) 多用户操作系统还需要防止各用户程序执行过程中相互间的不良影响，解决用户之间
的相互干扰。计算机操作系统的安全措施主要是隔离控制和访问控制，下面分别进行介绍。
2. 操作系统隔离控制安全措施
隔离控制的方法主要有下列4 种。
l) 设备隔离。在物理设备或部件一级进行隔离，使不同的用户程序使用不同的物理对
象。如不同安全级别的用户分配不同的打印机，对特殊用户的高密级运算甚至可以在CPU -
级进行隔离，使用专用的CPU 运算。
2) 时间隔离。对不同安全要求的用户进程分配不同的运行时间段。用户在运算高密级信
息时，允许独占计算机进行运算。
3) 逻辑隔离。多个用户进程可以同时运行，但相互之间感觉不到其他用户进程的存~，
这是因为操作系统限定各进程的运行区域，不允许进程访问其他未被允许的区域。
4) 加密隔离。进程把自己的数据和计算活动隐蔽起来，使它们对千其他进程是不可．见
的，对用户的口令信息或文件数据以密码形式存储，使其他用户无法访问，这就是加密隔~控
制措施。
这几种隔离措施实现的复杂性是逐步递增的，而它们的安全性则是逐步递减的，前~种
方法的安全性是比较高的，后两种隔离方法主要依赖操作系统的功能实现。
3. 操作系统访问控制安全措施
在操作系统中为提高安全级别，通常采用一些比较好的访问控制措施来提高系统的整体；
安全性，尤其是针对多用户、多任务的网络操作系统。除了DAC 、MAC、RBAC, 常用的访
问控制措施还有域和类型执行的访问控制DTE, 是与上述访问控制完全不同的另外一种访伍l
控制方法，这种访问控制机制主要用于网络操作系统中，它通过对系统中不同的任务限定~同
的执行域和类型访问许可进行强制或自主的访问控制，可以防止由千用户有意或无意的~~而
影响其他用户对系统的使用。
6.2.3 操作系统资源防护技术
对操作系统的安全保护措施，其主要目标是保护操作系统中的各种资源，具体地讲，就
是针对操作系统的登录控制、内存管理和文件系统这3 个主要方面实施安全保护。
1. 系统登录和用户管理的安全
系统登录过程是整个操作系统安全的第一步，这一步的操作主要是要求系统有比~~全
的登录控制机制、严格的口令管理机制和良好的用户管理机制。
l) 登录控制要严格。首先应当避免用户绕过登录控制机制直接进入系统，如Linux 操作作
系统中的单用户登录模式，以及Windows 2000 操作系统默认安装时通过全拼输入法就可以进
入系统。为提高系统登录的安全性，常用的安全措施有：限制用户只能在某段时间内才自缸~登录
到系统中；减少系统登录时的提示信息；限制登录次数，如连续多次（如3 次）登录失败：，终
端与系统的连接应自动断开等措施。
2) 系统的口令管理。历史上的系统入侵事件有80％都与口令破解攻击行为有关，也~是
说，很多时候不是系统的安全性不高，而是系统的口令控制和管理给系统入侵者留下了可以利
用的空档。为了提高口令的安全性，还应当养成比较好的口令管理和使用习惯。首先必~保：证
164
第6 章操作系统与数据库安全技术
系统中的口令应当具有比较高的安全性，即口令的长度应在6 个字符以上，口令应当是数字和
字母，以及其他字符的随机组合，口令应当避免选取字典中的单词，口令应当与用户信息无关
等；其次口令应当定期更换，而且在不同的场合应当使用不同的口令； 最后注意保存密码， 密
码应该靠大脑记忆，不要将口令记录在书、本、纸张中。
3) 良好的用户管理。用户管理和控制的安全与否是整个操作系统能否安全的另一个重要
方面。首先应当注意系统中的Guest 用户和默认的网络匿名登录用户，这些用户是操作系统被
入侵者选择攻击的一个重要跳板；其次要管理好系统中的工作组，避免一般的用户与管理员用
户放在同一个组中；最后还要控制好用户的系统操作权限，禁止普通用户随意在系统中安装软
件，尤其是盗版软件。作为系统的管理员，应当定期查看系统的用户日志和审计信息，以尽快
发现和堵住系统的安全隐患。
2．内存管理的安全
常用的内存保护技术有单用户内存保护技术、多道程序的保护技术、分段与分页保护技
术和内存标记保护法。
l) 单用户内存保护问题。在单用户操作系统中，系统程序和用户程序同时运行在一个内
存空间中，若无防护措施，用户程序中的错误有可能破坏系统程序的运行。可以利用地址界限
寄存器在内存中规定一个区域边界，用户程序运行时不能跨越这个地址。
2) 多道程序的保护。对千单用户操作系统，使用一个地址界限寄存就可以保证系统区与
用户程序的安全。但对千多用户系统，需要再增加一个寄存器保存用户程序的上边界地址。程
序执行时硬件系统将自动检查程序代码所访问的地址是否在基址与上边界之间， 若不在则报
错。用这种办法可以把程序完整地封闭在上下两个边界地址空间中，可以有效地防止一个用户
程序访问甚至修改另一个用户的内存。
3) 标记保护法。为了能对每个存储单元按其内容要求进行保护，如有的单元只读、读／写
或仅执行（代码单元）等不同要求，可以在每个内存字单元中专用几个位来标记该字单元的属
性。除了标记读、写和执行等属性外，还可以标记该单元的数据类型，如数据、字符、地址、
指针或未定义等。每次指令访问这些单元时都要测试这些位，当访问操作与这些位表示的属性
一致时允许指令执行，否则就禁止或给出警告信息。
4) 分段与分页技术。在一个安全要求比较高的系统中，通常将分页与分段技术结合起来
使用，由稻字员按逻辑把程序划分为段，再由操作系统把段划分为页。操作系统同时管理段表
与页表，完成地址映射任务和页面的调进调出，并使同一段内的各页具有相同的安全访问控制
属性。系统还可以为每个物理页分配一个密码，只允许拥有相同密码的进程访问该页，该密码
由操作系统装入进程的状态字中，当进程访问某个页面时，由硬件对进程的密码进行检验，只
有密码相同且进程的访问权限与页面的读写访问属性相同时方可执行访问。
3，文件系统的安全
1) 分组保护。在分组保护方案中，可以根据某种共同性把用户划分在一个组中，例如需
要共享是一个常见的分组理由。系统中的用户一般分为3 类： （单个）用户、用户组及全部。
分组时要求每个用户只能分在一个组中，同一个组中的用户对文件有相同的需求，具有相同的
访问权。
2) 许可权保护。许可权保护是指将用户许可权与单个文件挂钩，主要有两种方法，
一是文件通行字法，二是临时许可证法。文件通行字法是为该文件设置一个通行字，当用
165
计算机网络安全教程笫4 版
户访问这个文件时必须提供正确的通行字，通过通行字来控制对文件的各种访问；临时许
可证法是利用SUID/SGID 机制来保护其专用信息和设备不受非法访问，如普通用户为了执
行某些应用程序需要修改系统的通行字文件，系统管理员可以用SUID 机制建立改变通行
字的保护程序，当普通用户执行它时，该保护程序可以按照系统管理员规定的方式修改通
行字文件。
3) 指定保护。指定保护方式是指允许用户为任何文件建立一张访问控制表ACL, 指定谁
有权访问该文件，每个人有什么样的访问权。利用ACL 也可以限定用户访问指定的设备（如打
印机），或限定哪些用户可以通过电话线进入系统，甚至可以限定用户对资源的网络访问。
除上述3 个方面的安全保护措施之外，操作系统的其他资源如各种外设、网络系统等也
需要实施安全保护措施，对这些资源的安全保护最终也可归结为操作系统资源安全保护机沛lj,
例如，外设安全保护可以归结为内存访问机制和文件系统控制机制的安全防护，网络系统的安
全防护事实上主要是操作系统的登录机制、内存管理和文件系统的综合安全防护。
6.2.4 操作系统的安全模型
1. 安全模型的作用
能否成功地获得高安全级别的操作系统，取决于对安全控制措施的设计和实施的投入。
但是，如果没有明确地了解和表述操作系统的实际安全需求，即使运用最好的软件技~投
入最大的注意力，还是达不到安全要求的最初目标。而安全模型的目的就在于明确地表达这
些需求。
安全模型有以下几个特性： ＠它是精确的、无歧义的； ＠它是简易和抽象的，所以容易
理解； ＠它是一般性的，只涉及安全性质，而不过度地抑制操作系统的功能或其实现； ＠它是
安全策略的明显表现。因此，对千高安全级别的操作系统，为了保证操作系统的安全要求完全
实现，为了验证最终的操作系统实现了最初的安全目标，必须建立一个安全操作系统的设计和
实现模型，并用形式化的数学技巧和手段对该安全模型进行分析和验证。参照给出的安全模型
对安全操作系统的安全要求进行描述；按照安全模型所给出的设计方法和步骤实现安全操作系
统中与安全相关的访问控制、认证等功能；最后用安全模型的形式化方法对已经实现的安全进
行验证，并证明所实现的安全操作系统达到了最初的安全要求和设计目标。
为此，下面介绍几种在安全操作系统的开发历史中应用范围比较广泛的安全模型， 很多
成功的安全操作系统都曾或多或少地借鉴了这些安全模型的策略和方法。
2. 监控器模型
最简单的访问控制模型是访问监控器(Reference Monitor) 。访问监控器好比目标集合的卫
士，当用户需要访问目标时，首先向监控器提出访问某个目标的请求，监控器根据用户请求，核
查访问者的权限，以便确定是否允许这次访问。访问监控器模型的优点是易于实现，但是监视器
模型不适应更复杂的安全要求，而且监控程序的频繁调用可能会成为系统性能的瓶颈。
3. 多级安全模型
为了增强对各种操作系统信息的控制，通常把信息划分为多个安全级别，从而产生了多
种多级安全模型，支持多安全级别的军用安全模型目前已经得到广泛研究与开发。
(1) 军用安全模型
在军事信息系统中，对敏感信息的使用（访问）一般遵照最小特权原理和“知其所需＂
166
第6 章操作系统与数据库安全技术
这两个原则对用户进行管理，对不同的客体信息按照安全等级和信息范围分别用敏感级别和分
隔项构成的元组（级别：分隔项〉表示，主体的访问许可权限也可用元组（级别：分隔项〉表
示允许某主体访问某些级别以下的敏感信息和需要知道某些类的敏感信息。
在军用安全模型中，需要确定每个敏感目标所属的类别，为每个主体分配许可权限，它
们都用上面的元组形式表示。用S 表示主体集合， s 表示某个主体， 0 表示客体集合， o 表示
某个客体（目标），主体对敏感目标的允许访问关系用千<表示。
尸o<S 当且仅当级别6<级别s 且分隔项。＜分隔项s
其中，符号芍乏示“蕴涵于“。
关系<用千限定＿个主体可能访问信息的敏感性和内容，它表明＿个主体可以访问＿个
目标，仅当＠该主体的许可级别至少和该信息的敏感级别一样高；＠该主体需要知道该信息片
段分类时所涉及的所有分隔项。
上述军用安全模型中，体现了信息的敏感性要求和“知其所需”的要求，敏感性要求又
称为等级性要求，“知其所需“要求则是非等级性的，它可能包括多个分隔项和多个等级的信
息段。
(2) 访问控制的格模型
对军用安全模型进行一般化推广，可以获得操作系统安全的格模型。格(Lattice) 是一种
在关系操作符< (或>)下反映论域中各元素间排序关系的数学模型。元素在格下的排序是偏
序关系冬关系<是传递的与反对称趾即对任何3 个元素a, b、°有a~b 且b~c, 则a~c
（传递关系）；若a~b 且b<a，则a=b （反对称关系）。
军用安全模型显然是一个格模型，只要主体的访问权限按递增（或递减）顺序排列，
就可以利用格模型来描述该系统的安全模型。格模型不仅适用于军事系统，也可以用千商业
系统。
4. 信息流模型
为了解决安全操作系统中的隐蔽信道问题，人们又提出了信息流模型，这类模型可分为
两类即用千实现信息保密性的Bell-LaPadula 模型和用千保证信息完整性的Biba 模型。
(I) Bell-LaPadula 模型
Bell-LaPadula 模型（简称BLP 模型）是安全操作系统中采用最为普遍、经典的安全模
型，这个模型与涉密部门中制定的书面安全条例很接近，模型定义了主体和客体的关系。这种
关系是基千书面安全条例的分级与分类思想，并引进了一个新的术语-支配。如果一个主
体的级别大于或等千客体的级别，而且主体的类别包含了客体所有从属的类别，则这个主体对
客体具有支配权。
BLP 模型考虑如下主体对客体可执行的存取方式。
·只读：读包含在客体中的信息，通常又称为“读”。
·添加：向客体中添加信息，且不读客体中信息。
·执行：执行一个客体（程序）。
·读写：向客体中写信息，且允许读客体中信息，通常又称为“写“。
下面给出BLP 模型中的系统安全定理，根据这几个定理，可以证明按简单安全性和＊－特
性进行读写操作能够保持系统的保密性。
状态序列z =(z1,..,,z,) 是安全状态序列iff, 对任意t, I~ t ~ s, z1 是安全的。
167
计算机网络安全教程笫4 版
系统表象(x,y,z) 是一个安全表象iff, z 是一个安全序列。
系统L(R,D,W,z。)是安全系统iff' 它的每个表象(x,y,z) 是安全表象。
定理Al: 系统L(R,D,W,z。)对任意满足简单安全性的初始状态勾满足简单安全性
iff ，对任意活动I [Rj,Dp(b•,M•,f•,H*),(b,M,f,H)]'w 满足以下条件。
l) 任意(s,o，五） eb•-b 相对f ＊满足简单安全性；且
2) 任意相对f ＊不满足简单安全性的(s,o,i) e b 不在b ＊中。
定理A2 ：系统L(R,D,W,z。)对千S'cS 和相对S' 满足＊－特性的初始状态勿满足＊－特性
iff ，对千每个活动： [Ri,Dj,(b*,M*,f*,H*),(b,M,f,H)], W 满足以下条件。
l) 对任意S'cS, 任何(s,o,!) e b •-b 相对S' 满足＊－特性；且
2) 对任意S'cS, 若（s,o心） eb 相对S' 不满足＊－特性，则(s,o，五）任b*-b 。
定理A3: 系统L(R,D,W,z。)满足自主安全性iff 初始状态勾满足自主安全性且对任意
活动： [Ri,Dj,(b*,M*,f*,H*),(b,M,f,H)], W 满足以下条件。
l) 若(sk,o心） eb* －b ，则互eM *ki o
2) 若(sk,oi,i) e b 且江M*k1' 则（Sk,01 ，心任b* 。
推论Al （基本安全定理）：系统L(R,D,W,z。)是安全系统iff, 初始状态动是安全状态
且W 满足定理Al 、定理A2 和定理A3 的条件。
定理Al 、定理A2 和定理A3 可用于评估分析给定系统的保密性能，推论Al 证明了扛I果
系统按照保持保密性的规则进行信息状态转移，则不会泄露信息。
根据以上的分析可知， BLP 模型完全满足信息的保密性需求。在对信息的保密性需求次
于完整性需求的系统中，应该严格按照BLP 模型的安全规则来制定安全策略。
(2) Biba 模型
B~ll-LaPadula 模型只适用千信息保密， Biba 模型是Bell-LaPadula 模型的对偶。Biba 梒皂！
重点从保护系统信息完整性的角度来研究系统的安全问题，模型给出了防止非法修改~~的描
述方法， Biba 模型是仿造Bell-LaPadula 模型构造的，在该模型中主体与目标按照“完整性垄;
级“（与Bell-LaPadula 模型中的敏感级对应）的分类方案排序，记作l(s) 和l(o) 。模型相应的
两个特性如下。
l) 简单完整性特性(Simple Integrity Property), 如果主体s 可以修改目标o~ 则
I(s) > I(o) 。
2) 完整性＊－特性(Integrity *-Property), 如果主体s 对具有完整性级I(o) 的目标有读飞方问
权，则对于目标p, 仅当l(o) > I(p) 时， s 才可以对目标p 有写访问权。
这两条性质严格防止了低完整性级别的主体对高安全级别客体信息的修改，表明了在：自
然状态下信息越传越不可信的事实。
Biba 模型提出了被Bell-LaPadula 模型忽略的完整性事实，但同时却忽略了保密性~~。
因此，最好是将保密性和完整性结合起来应用到安全系统中。
5．安全模型小结
保护操作系统的安全模型，除了上面介绍的具体模型之外，还有另外一类模型~~~象
模型，它们以一般的可计算性理论为基础，可以形式地表述一个安全系统能达到什么~的性
168
第6 章操作系统与数据库安全技术
能。这样的模型有Gral1an1-Denning 模型、Hanison-Ruzzo-U11man 模型(HRU 模型）和获取－
授予系统模型。
I) Graham-Denning 模型。Graham-Denning 模型是一·个具有一般保护性能的模型，它引
入了保护规则的形式体系的概念。在Graham-Denning 模型中，有7 个基本的保护权，这些权
利被表示成主体能够发出的命令，作用千其他主体或目标，它们分别是：创立目标权、创立主
体权、删除目标权、读访问权、授权访问权、删除访问权，以及转移访问权。
2) Harrison-Ruzzo-Ullman 模型。Harrison-Ruzzo-Ullman 模型是Graham-Denning 模型的
一种变型，这个修正模型回答了9 种有关可以确定如何保护系统的问题。该模型基千命
令，其中每个命令含有条件和基本操作。
3) 获取－授予系统模型。在该模型中，只有4 种基本操作：创立、收回、获取和授权。
创立和收回类似千Graham-Denning 模型和Harrison-Ruzzo-Ullman 模型中的操作，获取和授予
是新操作。这一组操作比前两种模型的操作都要短，但获取和授予是更复杂的权利。
通常，人们研究计算机安全模型有两个目的：一是在确定安全系统应该推行的策略时模
型是重要的，如Bell-LaPadula 模型和Biba 模型识别出为确保保密性和完整性而施加的特别条
件；二是抽象模型可以引导理解保护系统的特点，如Harrison-Ruzzo-Ullman 模型说明了抽象
保护系统可能或不能判决的某些特点。
6.3 UNIX/Linux 系统安全技术
UNIX 系统是当今著名的多用户分时操作系统，以其优越的技术和性能，得到了迅速
发展和广泛应用。鉴千UNIX 正成为操作系统的工业标准，因而其系统安全性是一个重要
的研究课题。Linux 系统千1991 年诞生千芬兰赫尔辛基大学一位名叫Linus Torvalds 的学
生手中，作为类UNIX 操作系统，它以其开放源代码、免费使用和可自由传播深受人们的
喜爱。Linux 系统涵盖UNIX 的全部功能，具有多任务、多用户和开放性等众多优秀特
性，有关部门更是将基于Linux 开发具有自主版权的操作系统提高到保卫国家信息安全的
高度来看待。
6.3.1 UNIX/Linux 安全基础
UNIX/Linux 是一种多任务多用户的操作系统，其基本功能是防止使用同一台计算机的不
同用户之间相互干扰。因此， UNIX/Linux 操作系统在设计理念上已对安全问题进行了考虑。
当然系统中仍然会不可避免地存在很多的安全问题，例如，新功能的加入、安全机制的错误配
置等都有可能带来安全问题。
UNIX/Linux 系统结构由用户、内核和硬件3 个层次组成，通过以下4 种方式为用户提供
功能．
l) 中断：内核处理外围设备的中断，外围设备通过中断机制通知内核有关1/0 的完成状
态，内核将中断视为全局事件。
2) 系统调用：用户进程通过UNIX/Linux API 的内核部分系统调用接口，显式地从内核
获取服务，内核以调用进程的身份执行这些请求。
3) 异常：进程的某些不正常操作，诸如除数为0 或用户堆栈溢出等，将产生异常事件。
内核为进程处理这些异常。
169
计算机网络安全教程笫4 版
4) 利用swapper 和page daemon 等特殊进程执行系统级的任务，如控制活动进程的数
量、维护空闲内存池等。
UNIX/Linux 操作系统具有两个执行状态：核心态和用户态。运行于内核之中的进程孜处于
核心态，运行于内核之外的进程处千用户态。系统保证用户态下的进程只能访问其自身范围内
的指令和数据，而不能访问内核或其他进程的指令和数据，并保证特权指令只能在核心态执
行，中断、异常等在用户态下都不能使用。用户可以通过系统调用进入核心态，系统调用完戙
后重新返回用户态。系统调用是用户程序进入系统内核的唯一入口。用户对系统资源信息的访
问都要通过系统调用才能完成。一旦用户通过系统调用进入内核，便完全与用户隔离， A而使
内核中的程序可对用户的访问控制请求进行不受用户干扰的操作。
由于UNIX 与Linux 操作系统在安全机制、安全措施和安全策略等方面非常相似，因此，
下面将以Linux 操作系统为例进行介绍。
6.3.2UNIX/Linux 安全机制
UNIX/Linux 操作系统的安全机制主要包括PAM 机制、入侵检测机制、文件加密机矗制、
安全日志文件机制和防火墙机制等。
1. PAM 机制
PAM (Pluggable Authentication Modules) 是一套共享库，可以提供一个框架和一套编程
接口，它将认证工作由程序员交给管理员，允许管理员在多种认证方法之间做出选择，＃能够
改变本地认证方法而不需要重新编译与认证相关的应用程序。
PAM 机制的主要功能是： ＠口令加密； ＠按照需要限制用户对系统资源的使用，可t 以防
止“拒绝服务(DoS)“ 攻击； ＠允许使用Shadow 口令；＠按照需要，限制指定的用户只能
在指定时间从指定地址登录； ＠利用Client Plug-in Agents 概念，使PAM 在C/S 结构中对·“机
器机器”认证成为可能。
2. 入侵检测机制
由千网络攻击活动日益频繁，入侵检测技术也应运而生，但目前在操作系统中预装入侵
检测工具的却很少，即使是Linux 操作系统也只是在其最新的发布版中才提供入侵检测I~°
Linux 操作系统利用自身配备或从Internet 下载的工具，可使系统具备先进的入侵检测能力。
这些能力包括： ＠记录所有可能的入侵企图，并在攻击发生时及时通知网络系统管理员；迄）对
于已知行为的攻击发生时，采取预先准备的措施应对； ＠向Internet 发送一些伪装信息，例
如，可以把Linux 服务器伪装成其他类型的服务器，误导攻击者认为正在攻击Windows 或
Solaris 系统，进而增加攻击的难度。
3. 文件加密机制
数据加密技术在计算机网络安全中的地位越来越重要。所谓文件加密机制，就是将数据
加密技术引入文件系统，从而提高计算机网络的安全性。目前Linux 系统已有多种文1牛加密
措施，典型的有TCFS (Transparent Cryptographic File System) 。TCFS 通过将数据加密技术
和文件系统紧密集成，使用户在实际操作时感觉不到文件的加密过程。利用TCFS 可使合法
拥有者以外的用户、文件系统服务器的超级用户，以及在用户和远程文件系统通信线路上的
窃听者无法读取已加密的文件；但对于该文件的合法用户，访问保密文件与访问普通文件的
感觉没有区别。
170
笫6 章操作系统与数据库安全技术
4. 安全日志文件机制
由于计算机网络系统的开放性和复杂性，使得所有网络系统都不可避免地存在安全漏
洞，黑客可以利用这些漏洞对系统进行攻击。虽然Linux 操作系统不能预测何时主机会受到攻
击，但是它既可以利用安全日志文件机制记录黑客的行踪，又可以记录时间信息和网络连接情
况，并将这些信息重定向到日志文件中备查。
安全日志文件机制是Linux 操作系统安全结构中的一个重要环节，在攻击行为发生
时，它是唯一的证据。由千现在黑客攻击系统的方法有很多种， 因此Linux 操作系统提供
了网络级、主机级和用户级的日志功能。Linux 操作系统的安全日志文件机制用来记录整个
操作系统的使用状况，包括所有系统和内核信息、每一次网络连接及其源IP 地址、长度；
有时还包括攻击者的用户名和使用的操作系统、远程用户申请访问的文件、用户可以控制
的进程，以及每个用户使用的每条命令等。Linux 网络系统管理员在调查网络入侵时，都将
充分利用这些日志文件。
5．防火墙机制
防火墙是在内部网络和因特网之间，或者在内部网络与其他网络之间，对访问进行限
制的软硬件设备的总称。Linux 中的防火墙系统提供的功能有： ＠访问控制功能。可以执
行基千地址（源地址和目标地址）、用户和时间的访问控制策略，从而可以拒绝非授权的
访问， 同时保护内部用户的合法访问不受影响； ＠安全审计功能。记录通过防火墙的网络
访问，建立完备的日志，审计和追踪网络访问记录，并可以根据管理的需要产生报表； ＠对
抗攻击功能。防火墙系统直接暴露在非信任网络中，对外界来说，受到防火墙保护的内部
网络如同一个点，所有的攻击都直接针对它，因此要求堡垒主机（运行防火墙的计算机）
具有高度的安全性和抵御各种攻击的能力；＠其他附属功能。例如，与安全审计有关的系
统报警功能和入侵检测功能、与访问控制有关的身份验证功能和数据加密功能等。
6.3.3 UNIX/Linux 安全措施
Linux 网络系统既可受到来自网络外部黑客的攻击，也可能遇到网络内部合法用户的越
权使用， Linux 网络系统管理员必须为网络系统制定有效的安全策略，才能保证网络系统的
安全。
1. Linux 系统的安全策略
Linux 网络系统必须采用清晰、明确的安全策略，只有这样系统管理员才可知道要保护
什么，才可决定系统中的哪些资源允许别人访问。安全策略必须在允许用户使用系统资源完
成工作与完全禁止用户使用受保护信息之间找到平衡点，这个平衡点就是系统安全策略的核
心。如何制定一个安全策略，完全依赖于系统管理员对安全的定义。下面7 条原则为完成这
项工作提供了一般性指导方针： ＠确定系统中哪些信息是需要保密的敏感信息； ＠确定哪些
人需要重点防范； ＠确定远程用户是否有必要访问Linux 服务器； ＠确定口令和加密技术是
否能够对系统信息提供足够的保护； ＠确定网络系统内部的用户是否需要访问Internet;
＠确定网络系统内部用户在Internet 上的访问数据量有多大： ©确定如果发现网络系统被黑客入
侵的情况，系统管理员应该采取哪些措施。这7 条原则是一个示范性的安全策略，一个真正的投
入实际运行的计算机网络系统的安全策略可能包含比这7 条原则多得多的信息，系统安全原则列
表的内容规定得越详细，安全策略的漏洞就越小。事实上，任何一个网络系统的安全策略都要有
一定的保守程度。系统管理员要做的第一件事情，就是仔细评估一个系统的保守程度，即确定到
171
计算机网络安全教程笫4 版
底在多大程度上相信别人，包括网络系统内部的人和网络系统外部的人。
2. Linux 系统安全的防范措施
Linux 网络系统管理员既要时刻警惕来自外部的黑客攻击，又要加强对内部网络用户的管
理和教育，可以采用下列安全防范措施。
l) 按“最小权限”原则设置每个内部用户账户的权限。系统管理员在给内部网络用户开
设账户时，要按“最小权限”原则仔细设置每个内部用户的权限，即仅给每个用户授予完成任
务所必需的服务器访问权限。这样做虽然会增大管理工作量，但对系统安全有利。
2) 确保用户口令文件的安全。Linux 系统的口令是比较容易出问题的地方， Linux 系~管
理员一定要妥善保护用户口令文件／etc/shadow 的安全，不要让root 以外的其他用户获得这个
文件，并应该使得口令文件难以被破解，即使黑客获取了口令文件也不能轻易破解。用户也应
防止一些别有用心的人利用安全管理上的松懈而获得系统口令。
3) 充分利用防火墙机制。如果内部网络要进入Internet, 必须利用Linux 系统的防火~机
制在内部网络与外部网络的接口处设置防护措施，以确保内部网络中的数据安全。对千内部网
络本身，为了便千管理和合理分配IP 地址资源，应该在物理上将内部网络划分成多个~网，
或利用VLAN 技术在逻辑上将内部网络划分成多个逻辑子网，这样万一黑客突破防火墙时，
可以延缓黑客对整个内部网络的入侵。
4) 定期对Linux 网络进行安全检查。Linux 网络系统的运转是动态变化的，因.llt对．它
的安全管理也必须适应这种变化。Linux 系统管理员在为系统制定安全防范策略后，~该
定期对系统进行安全检查，利用入侵检测工具随时进行检测，如果发现安全机制中的~洞
应立即采取措施补救。
5) 充分利用日志安全机制，记录所有网络访问。日志文件可以发现入侵者试图~行
的攻击。因此，保证／var/1og 目录下不同日志文件的完整性，是保证系统安全所要考虑的重
要方面。如果服务器上或网络中的其他服务器上已经安装了一个可以连续打印的打印机”
则可用syslog 把所有重要的日志文件传到/dev/lpO （打印设备），这样就可以把重要日志文
件打印出来。
6) 严格限制Telnet 服务的权限。在Linux 系统中，一般情况下不要开放Telnet 服~，
这是因为黑客可以利用Telnet 登入系统，如果他又获取了超级用户密码，将会给整个系统
带来致命的危险。如果一定要开放Telnet 服务，则应利用TCP-wrappers 技术仔细~置
/etc/xinetd.conf、/etc/host.deny 和/etc/hosts.allow 这3 个文件，只允许指定用户从指定的IP
地址进行远程登录。
7) 完全禁止finger 服务。在Linux 系统中，网络外部人员仅需简单地利用finger 命~就
能知道众多系统信息，如用户信息、管理员何时登录，以及其他有利于黑客猜测用户口~的信
息。黑客可利用这些信息增大侵入系统的机会。为确保系统安全，应通过删除lusr/bin 目录下
的finger 文件来禁止提供finger 服务，如果一定要保留finger 服务，可将finger 文件更名，或
修改其权限，只允许root 用户执行finger 命令。
8) 禁止系统对ping 命令的回应。禁止Linux 系统对ping 命令请求做出反应，可以减少
黑客利用TCP/IP 协议自身的弱点，把传输正常数据包的通道用来秘密传送其他数据的~险，
同时可迷惑网络外部的入侵者，使其认为服务器已经关闭，从而打消攻击念头。
9) 禁止1P 源路径路由。IP 源路径路由(IP Source Routing) 是指在IP 数据包中包含到达
目的地址的详细路径信息，这是非常危险的安全隐患，因为根据RFC1122 规定， 目的~~必
172
第6 章操作系统与数据库安全技术
须按源路径返回这样的IP 数据包。如果黑客能够伪造源路径路由的信息包，那么他就可能截
取返回的数据包，并且进行信任关系欺骗。
10) 禁止所有控制台程序的使用。shutdown、halt 和reboot 这些控制台命令都会使系统的服
务停止， 如果黑客侵入系统并启动这些控制台命令，就会使系统正在提供的服务立刻中断。因此
在系统配置完毕后，应该禁止使用上述控制台程序，这可以通过删除／etc/security/console.apps/ 目
标下的控制台命令文件来实现。
采用上述安全机制、安全策略和安全措施，可以极大地降低Linux 系统的安全风险。当
然，由千计算机网络系统的特殊性和网络安全环境的复杂性，不可能彻底消除网络系统的所有
安全隐患，这就要求Linux 系统管理员经常对系统进行安全检查，建立和完善Linux 系统的网
络安全运行模型。
6.4 Windows 7 系统安全技术
2009 年10 月， 微软公司推出Windows 7 操作系统，它解决了Windows Vista 中的许
多问题并得到广泛使用，相对千以往的系统， Windows 7 的错误诊断和修复机制更为强
大，能够在用户最少的干预下完成修复工作，开机和关机速度更快，改善了用户体验度。
以往Windows 操作系统多是采用历年命名方法，如Windows 98 和Windows 2000 分别表
示在1998 年和2000 年发布， Windows Server 2003 和Windows Server 2008 分别表示在
2003 年和2008 年发布，这次微软回归传统，直接采用Windows 的内核版本号，由千
Windows Vista 的版本号为6.0, 所以下一代的系统就是7, 这就是Windows 7 代号的由
来。Wmdows 7 因其创新的性能、出色的兼容性和卓越的使用体验，获得了业界的广泛好
评。该系统具有下列特点。
·更加安全。Windows 7 包括改进的安全和功能合法性，将数据保护和管理扩展到外
围设备。Windows 7 改进了基千角色的计算方案和用户账户管理，在数据保护和兼
顾协作的固有冲突之间搭建了沟通桥梁，同时也开启了企业级的数据保护和权限
许可。
·更好的连接。Wmdows 7 将进一步增强移动工作能力，无论在何时、何地，任何设备
都能访问数据和应用程序，开启坚固的特别协作体验，无线连接、管理和安全功能进
一步扩展，多设备同步、管理和数据保护功能得到增强。另外， Windows 7 还带来了
灵活计算基础设施，包括网络中心模型。
·更低的成本。Wmdows 7 将帮助企业优化其桌面基础设施，还具有无缝操作系统、应
用程序和数据移植功能，并简化PC 供应和升级，系统下载进一步向完整的应用程序
更新和补丁方面努力。
Windows 7 主要提供4 种版本，包括Windows 7 Home Basic （家庭普通版）、Windows 7
Home Premium （家庭高级版）、Windows 7 Professional （专业版）及Windows 7 illtimate （旗
舰版）。其中， Windows 7 Home Basic 主要的新特性有实时缩略图预览、增强的视觉体验、高
级网络支待、移动中心，以及支持部分Aero 特效等Windows 7 Home Premium 作为Home 的
加强版，包括Aero Glass 高级界面、高级窗口导航、改进的媒体格式支持和媒体流增强，以及
多点触摸和更好的手写识别等功能； Windows 7 Professional 代替了Vista 系统下的商业版本，
支持高级网络备份、加密文件系统等数据保护功能，同时还加强了网络功能； Windows 7
173
计算机网络安全教程笫4 版
Ultimate 是各版本中最灵活、最强大的一个版本，在家庭高级版的娱乐功能和专业版的业务功
能基础上，加强了系统的易用特性。
6.4.1 Windows 7 安全基础
在继承Windows Vista 安全技术的基础上，为应对传统的针对Windows 操作系统的攻击威
胁， Windows 7 引入了一整套的防御体系，涉及攻击者可能利用的方方面面，采用的安全防护
体系如图6-10 所示。
Windows 7
曰二三
芦尸气三可三］
Code
Integrity
Patch Guard
二二三曰三］
三二三怎下口云勹厅二二尸云。WS
j_＿二date
Firewall 尸三三霄：态
图6-10 · Windows 7 安全防护体系
内存保护模块中使用的安全技术主要有：地址空间随机化分布(Address Space Layout
Randomization, ASLR) 、安全结构化异常处理(Safe Structural Exception Handling,
SafeSEH)、数据执行防护(Data Execution Protection, DEP)、安全堆管理和GS 栈保护等。这
些技术用以阻止攻击者使用一些特殊攻击程序或恶意代码对系统进行破坏，弥补内存处理方面
的诸多安全威胁，如堆栈缓冲区溢出、堆栈函数指针覆盖及堆溢出等，有效保护操作系统内核
和Microsoft 内置应用程序的安全。其中， DEP 和ASLR 对内存保护模块较为重要， DEP 可以
禁止在内存空间数据段上执行代码， ASLR 采用特定的随机分配算法使关键的系统文件在内存
空间的加载地址变得不可预测，使得利用系统文件进行攻击活动的恶意代码无法正确获取系统
文件信息，这两项技术的结合使用将可以有效阻止绝大多数传统的攻击方法。
操作系统内核是现代操作系统的核心组件，其重要性显而易见，如果内核出现了安全问
题，那么系统底层基本架构就不再受到信赖。为提高系统内核的安全性和可信度， Windows 7
在内核完整性防护模块中使用的安全技术主要有代码完整性(Code Integrity) 验证、强制驱动
签名（M扭datory Driver Signing) 和内核保护(PatchGuard) 。代码完整性验证技术用千确定系
统内核是否因为偶然因素或恶意攻击被篡改，主要通过校验数字签名和与内核模块有关联的散
列函数来发现内核是否被篡改。强制驱动签名技术要求所有内核驱动都必须进行数字签名，未
经正确签名的任何驱动程序都无法进入内核地址空间。内核保护技术也称为Kernel Patch 保护
技术，用于防止未经许可的软件修改Windows 7 系统内核。总体来说，代码完整性验证和强
制驱动签名技术是通过静态的方式来验证被加载代码的完整性，以保证加载的代码没有被恶意
篡改，但其代码完整性只是在加载时验证，并不能提供在系统运行过程中的恶意代码防护；内
核保护技术则是在系统运行的过程中通过动态的方式来检查系统中一些关键的数据结构和关键
的内核代码的完整性，防止任何非授权软件修改Windows 7 内核。
系统和用户态防护模块的主要用途是，使程序运行时只拥有所需的最小权限，并且在已
174
笫6 章操作系统与数据库安全技术
经划分的内存空间中运行，防止所有的程序都以管理员权限运行，从而减少恶意程序自动威胁
整个劝ndows 7 系统的能力。其采用的安全技术主要有用户账户控制(UCA) 、BitLocker 技
术、Windows 防火墙、系统进程分离、Windows Defender 、限制服务和Windows 资源保护
(WRP) 等。为支撑系统和用户态防护模块进行权限控制操作， Windows 7 对先前版本中基于
访问控制列表的权限控制机制进行了改进，引入了强制完整性级别(Mandatory Integrity
Level) 的概念。强制完整性级别将用户权限划分为6 个等级，即不可信、低、中、高、系统
和安装者。不可信级别是赋予匿名登录到系统的进程的；低级别是与Internet 进行交互时的默
认级别，表现为1E 的保护模式；中级别是大多数对象所在的级别，相当千标准用户权限，这
时只能对计算机进行一些基本的操作，不能安装程序，也不能向系统文件夹等关键位置中写入
文件：高级别对应千管理员权限，这个级别允许安装程序，也可以向系统文件夹等关键位置中
写入文件，但其使用受到用户账户控制UAC 的限制：系统级别是为系统对象保留的，
Wmdows 7 内核和关键服务运行千系统级别，它比管理员权限更高一级，可以控制更多的文件
和注册表项，但关系到系统稳定性的一些关键文件还是只能读取；安装者级别是最高的完整性
级别，可以任意修改Wmdows 7 系统的关键文件，表现为Windows 资源保护W即机制，只
有受信任的安装者才能对其保护的资源进行修改。
6.4.2 Windows 7 安全机制
Wmdows 7 是基千微软的安全开发生命周期(SDL) 框架开发的，完善了审计、监控和数
据加密的功能，加强了对远程通信的支持。Windows 7 保留了Windows Vista 下所有的安全机
制以加强系统的安全防护能力，并在系统底层的实现方面进行了改进，使得Windows. 7 的内
核修复保护、服务强化、数据执行防御和地址空间随机化等可以更好地抵御攻击行为。概括起
来， Wmdows 7 主要采用内核完整性、内存保护、系统完整性及用户空间防护等安全机制对系
统进行保护。内存保护机制使得攻击代码在目标计算机上很难得到执行，用户空间的权限控制
机制让攻击代码即使执行了也只能处千比较低的权限级别，无法对目标计算机进行深入控制，
加上内核的完整性验证机制，攻击代码更难以在目标计算机上长期存在。
1．内存保护机制
Windows 7 的内存保护机制可以分为两大类一类是用千检测内存泄露的，包括GS 栈溢
出检测、结构化异常处理覆盖保护(Structured Exception Handling Overwrite Protection,
SEHOP) 和堆溢出检测，另一类是用千阻止攻击代码运行的，包括GS 变董重定位、安全结构
化异常处理SafeSEH、数据执行保护DEP 和地址空间随机化分布ASLR。
GS 栈溢出检测机制是2002 年针对传统的栈溢出攻击方法提出来的，但该机制仍然可被
攻击者利用或规避，如在系统检查Cookie 值之前的时间段里，攻击程序仍可调用被覆盖的参
数或变量。为解决这个问题， Windows 又引入了GS 变量的重定位机制，基本上阻止了直接覆
盖函数返回地址这种漏洞利用方法，但由于GS 的覆盖范围有限，并不能完全阻止栈溢出攻击
的发生。
SEH 机制是Windows 操作系统提供的针对错误或异常的一种处理机制，由于攻击者可以
通过覆盖函数异常处理句柄在函数返回之前引发异常来执行攻击代码，为此Windows 又引入
SafeSEH 机制，它在执行异常处理程序之前对该程序进行检查，判断是否安全，若不能确保该
程序没有被篡改，则拒绝执行。SafeSEH 机制衙要对应用程序进行重新编译，而大多数已有程
序都没有采用SafeSEH 机制，使得攻击代码仍然有机可乘。为了解决这个问题， Windows 7 给
175
计算机网络安全教程笫4 版
出了一种不需要重新编译程序的SEHOP 机制，它通过在SEH 链的最后插入一个确认帧的方
法来实现拒绝执行攻击代码的目的。
DEP 机制是在2004 年8 月发布的Windows XP SP2 中最先引入的，由千利用返回库函数
的方法可以绕过DEP 机制的限制，这表明单独使用DEP 机制的效果并不好，为改善这利I局
面Windows 引入DEP 的永久标记，一旦进程开始运行，其DEP 策略就不允许改变，进而提
高可执行内存段恶意代码的拒止能力。ASLR 机制是在2006 年11 月提出的，从Windows
Vista 系统开始启用。Windows 7 加强了对ASLR 机制的支持，一定程度上提升了攻击者猜测
内存空间系统文件加载地址的难度。
2. 权限控制机制
Windows 7 权限控制机制主要包括：用户账户控制机制UAC 、Windows 防火墙、
Windows Defender 反间谍软件、BitLocker 加密、限制服务和Windows Update 等。
用户账户控制机制UAC 的工作原理是调整用户账户的权限级别，其设置界面如图6-11 所
示。UAC 可以保证，无论用户是以标准用户还是管理员身份登录，在用户不知情的情况下都无
法对计算机做出更改，从而防止在计算机上安装恶意软件和间谍软件或对计算机做出任何~~。
默认的情况下，仅在程序做出改变时才会弹出UAC 提示，用户改变系统设置时不会弹出提示：。
Wmdows7 下的UAC 设置提供了一个滑块允许用户设置通知的等级，可以选择以下4 种选项。
逃通知您有关计复机一
甩白忆包煽＂一一1-
II附作叫“l,“”“',"行倡，
...l111
从勹凛阳
陬·豆-酗11日氧胤U附III嗣III
·曰蛟＂｀｀-·诅劂1-
0 _＿＿．咖劓＂膺札
霆氧．
口丘
图6-11 Windows 7 用户账户控制设置
l) 对每个系统变化进行通知。任何系统级别的变化(Windows 设置、软件安装等）都会
出现UAC 提示窗口。
2) 仅当程序试图改变计算机时发出提示。当用户更改Wmdows 设置（如控制面板和管理
员任务）时将不会出现提示信息。
3) 仅当程序试图改变计算机时发出提示，不使用安全桌面。这与前述情形有些类~但
是UAC 提示窗口仅出现在一般桌面，而不会出现在安全桌面，这对于某些视频驱动程序；~有
用的，因为这些程序让桌面转换很慢。
4) 从不提示，相当于完全关闭UAC 功能。用户可以直接对UAC 进行设置，以减小那些
自己不想看到的通知窗口出现的频率。总体来说， Windows 7 下的UAC 体验与Windows VlS也
下的相比有了重大改进，需要用户点击的次数（默认设置）明显减少。UAC 的终极目标魂尤是
让用户能够控制系统的改变，并且减少弹出通知的次数以免干扰用户的体验。
176
第6 章操作系统与数据库安全技术
Wmdows 7 自带防火墙在默认情况下就会启用，用户可以打开“开始”菜单依次选择“控制面
板”一”系统和安全”- "Wmdows 防火墙”选项，来查看当前防火墙的状态及手动设置允许出入
系统的程序。从处理防火墙配置文件角度来看， Wmdows 7 提供了一个很小但极其重要的改进，支
持用户为公共、私人和域连接设置不同的防火墙配置文件。私人网络可能是家庭无线网络，除了拥
有正确的WEP 或WPA 密钥外，用户不需要任何凭据登录，域网络要求身份验证，如通过密码、
指纹、智能卡或几种因素相组合来登录。每种配置文件类型都有自己选择的允许通过防火墙的应用
程序和连接在家庭网络或者标记为私人的小型企业网络中，人们可能会允许文件和打印机共享，
而在标记为公共的网络中，可能会禁止访问文件。所有Wmdows7 版本都允许计算机同时保持几个
防火墙配置文件开启，为可信任网络保持访问性和功能，同时阻止对不可信任网络的访问。
Windows Defender 反间谍软件可以用来实时保护和查杀计算机中的间谍软件， Windows
打开时会自动运行。使用反间谍软件能够清除间谍软件、广告软件、rootldt、键盘记录软件和
一些其他形式的恶意软件，实时监控着恶意软件可能修改的操作系统区域，如启动文件夹和
Run 注册表键值。但Windows Defender 不会对划分为蠕虫或者病毒的程序提供安全防护。此
外，微软MSE 套装软件中已包含反间谍功能，若启用MSE 则Defender 会自动停用。
BitLocker 首次出现在Wmdows Vista 中时，只能对主要的操作系统卷进行加密， Wmdows
Vista SP2 （服务包2) 扩展了这项功能的应用范围，可以加密其他卷，如主硬盘上的附加驱动
器或分区，但它还是无法让用户对便携式磁盘或可移动磁盘上的数据进行加密。Wmdows 7 带
来了BitLocker to Go, 不但可以保护便携式驱动器上的数据，同时为与合作伙伴客户或其他方
共享数据提供了一种方式。
在开始使用BitLocker 驱动器加密功能之前，磁盘卷必须经过合理配置。Wmdows 要有一
个未经加密的小容量分区来存放核心系统文件，而开启引导过程、验证用户以便访问加密卷需
要用到这个文件。大多数用户在最初建立驱动器分区时没有考虑到这一点，为此微软开发了一
款工具，可以转移数据、重新对驱动器进行分区，以便为BitLocker 加密做好准备，可以从微
软的网站搜索下载BitLocker 驱动器准备工具。一旦用户的驱动器经过了合理分区，就可以用
BitLocker 加密了。单击控制面板中的BitLocker Drive Encryption (BitLocker 驱动器加密），
BitLocker 控制台会显示所有的可用驱动器及当前状态（无论BitLocker 目前是不是在保护它
们）。由图6-12 所示可以看出， BitLocker 能够加密不同类型的驱动器，一类是用BitLocker 来
加密的硬盘驱动器，另一类是用BitLocker 来保护的可移动驱动器。
面i -一一
心飞切d印＿＿日－小的膺胄立何邕厂J瓜且厦卿访问工
倡篡机， 但戴履仅甩户兀值一”止
0或血～
.11111B风“如
.1!1J11 瓜”
0 衄血ocb,
图6一12 Windows? 驱动器加密设置
177
计算机网络安全教程笫4 版
默认情况下， BitLocker 需要可信平台模块(TPM) 芯片来存放BitLocker 加密密钥，同时
便千对BitLocker 保护的数据进行加密及解密。由千很多台式机和笔记本电脑并没有配备TPM
芯片，微软添加了没有兼容的TPM 也可以使用BitLocker 驱动器加密的选项，但其选项使用
设置过程稍显烦琐． Windows 7 的BitLocker to Go 可以支持系统管理员控制怎样使用可移动介
质，并且执行用来保护可移动驱动器上数据的策略，通过Group Policy （组策略），管理员就
能把没有受保护的存储介质设置成只读，要求系统先对任何可移动存储介质进行BitLocker 加
密，然后用户才能把数据保存到上面。
可靠的恢复方法对一个加密方案来说非常重要， BitLocker 提供了非常可靠且方便的恢复
手段。但当出现以下情况时， Windows 分区就无法解密： TPM 芯片出现故障；硬盘拆卸后被
挂接到其他计算机上；启动PIN 遗忘；启动USB 密钥损坏。此时，若尝试启动计算~计算
机会被锁定，提示用户插入密钥存储媒体或者为该驱动器输入恢复密钥，这时候只要插A保存
有恢复密码的USB 闪存或者手动输入48 位数字的恢复密码，计算机就会顺利启动。
限制服务目的在千防止服务修改注册表、访问系统文件，如果一个系统服务需要J:.述的
功能才能正常运行，它也可以设定成只能访问注册表或系统文件的特定区域，同时也可以限制
服务，使其不能执行系统设置的更改或其他可能导致攻击的行为。
Windows Update 用于接受Windows 产品或其他来自Windows Update 产品的自动更新，
可以为现有的操作系统进行漏洞修补、功能的完善和修正、软件版本升级，以及驱动~序搜
索和更新等工作，从而让Windows 7 系统和软硬件的功能更加完善，使用起来也更加安全。
其使用配置界面如图6-13 所示，用户可以根据需要设置更新下载间隔，选取合适的更游妀
装包。
,mnogy""以一一擘哥井对它们进行安羲．当一，怎也
重tl)
归"-=习|
-（N):1峡于1在（叫已三三］
德
团叫割r-士加一(R)
豪可以中着贾新
团允切清即吨此计即心尘挝睬伺
图6-13 Windows 7 更新设置
3. 内核完整性保证机制
内核完整性保证机制主要包括代码完整性验证、强制驱动签名和PatchGuard 共3 个方
面，其中PatchGuard 只应用于64 位操作系统，主要在系统运行过程中动态检查关键的数
据结构和内核代码的完整性，防止非授权软件修改系统内核，可以阻止对进程列表~~心
信息的恶意修改，这种安全保护只有操作系统能实现，其他杀毒软件是无法实现的。由千
内核完整性保证机制限制了程序对内核的修改，不仅使得恶意代码无法隐藏踪迹，也使得
传统的安全防御工具无法应用，因此安全机构和系统攻击者都非常重视对内核完整~~证
机制的研究。
178
第6 章操作系统与数据库安全技术
代码完整性验证和强制驱动签名作为两种静态的内核完整性保证机制，在实现上均以CI.dll 形
式出现， CI.dll 开始运行于系统启动的过程中。系统启动时，首先由BIOS 进行自检，然后加载启
动管理程序bootn1gr, 成功之后运行系统加载程序winload.exe, 最后才是系统内核的加载过程，这
是系统启动过程中的几个必需阶段。CI.dll 就是在bootmgr 和winload.exe 阶段进行加载的，在内核
加载阶段只是对CI.dll 的代码完整性验证函数进行调用。这里， bootmgr 是启动管理程序，位于
%Systen卸ve%\bootn1gr 文件或％SystemDrive%\Boot\EFl\bootmgr.efi 文件（对千EFI BIOS) 中，
winloadexe 是系统的装载程序，即OS Loader, 位千％SystemRoot°/4\System32\winload.exe 文件中。
winloadexe 代替了Windows 早期版本中的NILDR。
Wmdows 对代码签名进行的验证主要以两种方式进行，一是将代码的签名与代码分离保
存，将代码摘要放在一个目录文件(catalog) 中，称为签名目录；二是在程序代码中保存代码
的签名，这种方法在系统启动早期采用较多。这两种方式并不是完全独立的，可以同时应用，
大部分内核驱动程序的完整性验证都同时采用了这两种签名方式。加载启动驱动程序时的驱动
签名验证由winload.exe 完成，而其他所有驱动的签名验证由ntoskrnl.exe 完成。
6.4.3 Windows7 安全措施
为确保Windows 7 在使用过程中的系统安全，除积极采用上述安全技术和安全机制外，
用户还应根据使用环境要求针对性地做好安全配置和系统管理工作，尽可能提升Wmdows 7
的安全性能。下面就介绍一些常用的Windows 7 安全配置措施和方法。
1．设置安全密码和屏保密码
可靠的密码对于一个系统而言是非常重要的，一些网络管理员创建账户时通常使用公司
名称、计算机名等易于猜测的字符做用户名，然后又将这些账户的密码设置得比较简单，如
welcome、letmein 或123456 等，甚至密码与用户名同名等，显然，这将严重危害系统安全。
同时，设置屏幕保护密码是防止内部人员破坏系统的必要手段。一般地，可在BIOS 中设置开
机密码，将屏幕保护启动时间设为5min 以内。
2. 增加管理员用户和禁用GUEST 用户
如图6-14 所示，在“控制面板”的“用户账户和家庭安全”一“用户账户”一“管理其
他账户”一“创建一个新账户”中创建一个“标准用户”或“管理员”，对管理员及GUEST
用户设置强口令，并禁用GUEST 用户。
值名彝裨豆示在厅檀屏．们lfflflJ 草单上．
图铲名＿＿＿＿二！
．玩(S)
标准薇户甩户四” 1嘉姚伦量
e 营漫劂N
琶漫员褥计算一A犹道山刮匡的即比幌蟹配叩潼．可瞻酗眈嘈夏员江歉廿仓慰嘱
其匣汽鹤槽价宣码醴鞠认
夤－t正．
为什么匾议健用忙勹饷护？
图6-14 Windows 7 创建新账户
3. 注册表安全设置
l) 关机时清除页面文件。
179
计算机网络安全教程笫4 版
二
-- - - [HKEY_LOCAL'-MACH码YSTEM\CurrentControlSet\Control\S函on l
」血啖晌叩M皿g~el!t] "Cl呻呻μeAtSh畛叩＂寻吨过堕卿但＿＿＿＿＿＿＿＿＿l
2) 关闭DirectDraw。
阳KEY_LOCAL_ MACHINE\SYSTEM\CurrentControlSet\Control\OraphicsDrivers\DCI]
叮面的ut“ 如吨：一
3) 删除默认共享。
{HKEY LOCAL MACHINE\SYSTEM\CwrentControlSet\Services\LanmanServer\Parametets ]
"AutoShareWks"=dword:00000000
“AA巠痉坦函erv釭"=dword:00000000
4) 禁止建立空连接。
[HKEY_LocAL_MACHINE\SYSTEM\CurrentControlSet\Control\Lsa] “ restrictanonymoos
,,
5) 不让系统显示上次登录的用户名。
.
[HKEY LOCAL_MACHINE\SOFfWARE\Microsoft\Wmdows 厂N1\-tVersion\W血。严）芦LastUserName”=“1”
4. 关闭不必要的服务
首先备份服务列表，在“服务（本地）“中右击，在弹出的快捷菜单中选择“导出列表歹命·
令，将服务列表以“文本文件（制表符分隔） （．txt）“保存起来，以备查考，如图6-15 所方乏。
一—勹
·- -,....-.-.. ;,• ..
．乙：
,:：咽… 耐气：：：
王了gggg 叩ggggggg 叩
仁：石言呈恤卢＇
「：：
产
g
巨言勹
．三百三二。
． 八
k
－
从
厂
igilil
』l
”}
g悠圈58髯呢g编g
L '
』
Hi 吐
本．
，扩眉人寂食，
图6-15 Windows 7 导出服务列表
然后在“控制面板”中的“系统和安全”一“管理工具”下的“服务”中，对有｀关：月仗
务进行手动设置，如图6-16 所示。或者利用“sc config 服务名称start=空格＋启动方亏尺”
命令，创建批处理文件，以系统管理员身份运行，自动将有关服务设置为“禁用”或；“手龟
动“，命令中的启动方式可设置为“auto＝自动、demand＝手动、disabled＝禁用“,SC 命·令酝描
述如图6-17 所示。
180
笫6 章操作系统与数据库安全技术
如。鲁胄II加0
1安呤1 团IG瞬l6 目Gl1 1 b. II I卜
＂砩l~ II沧｀酝颈i
IPod 篇售
笠幻叩
匪恩舟
酴
贮dsn
公H切，心oupl血叩
知伽芯心'..心如
咸伙
妇咄tIll巩－
尺｀妇
干蚧
公如心"'而如。知4 琶务的厦3体噜计震一心· 一｀归饶11CE1心知伽p,“
众旧咄句Co.t...“ 五耳n百五豆1
I 只2众书） 亡二了 ．一－—J ，扩眉厄
贮．，气喀芒：＿＿ 工I 归II～血心1
图6一16 Windows 7 变更服务状态
图6-17 Windows 7 修改服务启动方式命令描述
5. 禁止自动播放
如果使用光盘或U 盘等设备来引导并启动Windows 7 系统时，必须禁用这些设备的自动
播放功能来保护系统启动安全，因为autorun 病毒非常喜欢通过U 盘之类的移动存储介质来传
181
计算机网络安全教程笫4 版
播和复制病毒文件；只有禁止自动播放功能，才能阻断autorun 病毒通过移动存储介质千扰
Wmdows7 系统的启动运行。
在禁止移动存储设备自动播放时，只要先打开系统”运行“窗口，执行gpedit.msc ifrr4)-,
切换到本地组策略编辑器窗口，从左侧列表的“本地计算机策略”分支下，逐一展开“计·算机
配置”一“管理模板”一“Windows 组件”一“自动播放策略”选项，在目标选项的右侧列
表中双击“关闭自动播放”组策略，从打开的“关闭自动播放”窗口中（见图6-18 ），~中
”已启用“单选按钮，同时选中“关闭自动播放”下拉列表框中的光盘或U 盘，并单击“应
用”按钮执行设置保存操作，重新启动Windows? 系统即可。
豆硕O珈黜
0 缄遭(Q 由｀
·B或(I)
eBIUI(0) - -
I .I:－漫翌(P) I I 飞—凶虾） II
_. .
透喂：
---
糟助：
导伺问钠霪愉1燭a-
除酬喟一旦帕刊跷认薰畴， 白叩酗“"纨从噩刻＂迸汀巴阳尉，
．鲨桴，匣序帕出．g件和．秉廪体上的盲乐柯立即旧动
在lCPSP2 之蔚，队螂吓．扇矗黜妞现嚷动歉蜊嘈
瞿动．，高不星CO-ltOM 凰动．冰啊泌篱动．上褫藕甩
从mSP2 开蛐． g剔酗＂龙聘媚俞歉瀛ZIP ，勇靴
薹整USII 大富凰＂匾识鲁）上启用．
＿，何以删肛O.ROM肋漏如一
自动霪敖．也可以霎帛所事逗谕隅H白问动霪皮
-价飘响霞上的目浏勘儿无法使用此设量仕弑' .，
认螂兄下巳售用价口剿圃劓伯厕苟履上R用臼动霞敖．
泗躁伽赃书劓圈·文骸和寄归．文骸
中．如鼠阿t恤凰沮生冷壳．则廿算叭配量．刊印凡瞿叱钉, .
I•
仁仁写
图6-18 Windows 7 关闭自动播放选项设置
当然，在注册表的HKEY_ CURRENT_ USER\Software\Microsoft\ Y{indows\CurrentVersion\
Policies\Explorer 分支下，将NoDriveTypeAutoRun 键值的数值设置为“十六进制”的4，~能
达到禁止磁盘自动播放的目的。不过，在修改注册表之前，为了保护系统安全，最好先对畸目标；
分支进行备份。
6. 堵住补丁漏洞
一些病毒木马程序还会利用Wmdows 7 系统的漏洞来感染该系统中的应用程序，并达到
将启动威胁项目隐藏到系统中的目的。因此，及时堵住补丁漏洞，可以在某种程度上减少痄且每
木马感染系统的可能性。在更新漏洞补丁时，可以通过系统控制面板窗口中的Wmdows
Update 图标，进入系统漏洞补丁检查更新界面，单击“检查更新”按钮，让Windows 7 系；统
自动扫描本地系统，看看是否需要安装新的漏洞补丁程序，如果发现有更新补丁可以利用， 只
要单击“安装更新”按钮就能自动堵住补丁漏洞。当然， 也有一些系统漏洞或缺陷还没有京卜丁
程序可以保护，这时可以考虑使用病毒防火墙来阻止病毒和木马的入侵。
7. 禁止运行脚本
很多病毒和木马程序都是通过网页中的活动脚本或ActiveX 控件将启动威胁项目植;A到
Wmdows 7 系统中的，如果将正浏览器的脚本执行功能暂时禁用，就能避免许多不必要的安
182
第6 章操作系统与数据库安全技术
全烦恼。在进行这种设置操作时，先打开浏览器窗口，选择“工具”- "Internet 选项”命
令，弹出“Internet 选项”对话框；再选择“安全”选项卡，单击“自定义级别”按钮，弹出
“安全设置”对话框，从中找到“脚本”设置项，将下面的“活动脚本”和“Java 小程序脚
本”都设置为“禁用“，最后单击“确定”按钮保存设置。在禁用ActiveX 控件时，只要找到
该对话框的“ActiveX 控件”设置项，并将下面的所有ActiveX 控件运行权限全部设置为“禁
用“，当然也可以设置为管理员允许。
8. 动态监控威胁
既然病毒和木马会偷偷地将启动威胁项目植入到系统注册表及服务列表中，那么就有必要对
Wmdows7 系统踩璋如溫务列表内容进1苛态剧空，以便及时发痴替在的安全威胁。
在监控Wmdows 7 系统注册表中的内容是否变化时，可防胆丈RegWorkshop 工具（该工具是
一款非常好用的注册表编辑器）的“创建本地注册表快照“命令，先为上网之前的注册表状态生成
一个快照1, 当上网结束后，再为系统注册表生成一个快照2; 接着依次选择对应程序界面中的
“工具”和“比较衵册表”命令，将之前生成的两个注册表快照分别导入到比较对话框中，再单击
“比较”按钮，这样就能在“比较结果”页面中看到系统注册表的变化了。如果看到注册表中有新
的启动项目出现则必须对它们提高警惕，如果无法辨别它们的来源应该及时将它们删除。
在监控系统服务列表中的内容时，可以利用Windows 7 系统内置的net start 命令，先将
上网之前的系统服务状态内容导出来，例如，只要在cmd 命令行窗口中执行net start>
d:\111.txt 命令，就能将所有处千启用状态的服务保存到d:\111.txt 文件中（见图6-19) ；接
着，按照同样的操作方法，将上网结束后的系统服务状态导出保存到d:\222.txt 文件中；之
后，通过fc 命令fc d:\111.txt d:\222.txt 对系统服务状态的变化进行比较，如果有新的服务选
项生成，必须立即查清它们的来源，一旦确认它们是陌生的或非法的，则应进入系统服务列
表中，将它们强行停用。
Adobe. Acrobat Update. Servic,!
Alipay payment client seouritf service
Alipay seouri ty bu吐ness_service
Apple Mobile Device Service
Application Information
Base Filtering I!叩ine
Bonjour 服务
COi(+ !!vent System
Crypto盯aphio Sex-vice,
Human Interface Device Aooess
Inte1 （罚11D Gr叩hios Control Penol Servioo
Inte1 （知id Stomge Teohnology
Inte:ractive Servioes Deteotion
,indows Driver Foundation - Use广mde Driwr Fr血盯ork
冒indows !!vent Los
冒indo...s Fire冒all
冒indo'II's Pont Cache Sex-vioe
胄indo冒s l皿ge AcquisitiO.n （胃IA)
冒ind叩8 血m屯妞ont In8tn皿entation
冒indo管; Pr~,se11~tion Poundation Pont Ciiohe 3: 0. 0. 0
冒indo冒s Se釭ch
冒indowa Update
胃ox-katation
mizsrv
主动防御
命令成功完成．
~
..
图6-19 Windows 7 已启动服务导出结果
183
计算机网络安全教程笫4 版
9．安装反病毒木马软件
对用户而言，威胁通常来自木马、恶意软件和假冒的病毒扫描程序，因此安装一~合适
的杀毒软件十分有必要，同时记住保持杀毒软件的更新，进而防范新的恶意程序攻击。~~官
方向用户推荐了IO 款Windows 7 适用的杀毒软件，它们是AVG、诺顿、卡巴斯基、
McAfee、Trend Micro 、Panda Security、F-Secure、Webroot、BullOuard 和G-Data 等。此外，
国内用户也可以安装360 杀毒系统、安全卫士等软件来防范病毒和木马攻击。
10. 及时备份数据
有时候即使采取了许多安全防护措施，当恶意病毒攻击时系统仍可能不堪一击。因此；，
及时备份重要数据非常重要，这样即使遇到极具杀伤力的病毒，也可以通过恢复数据~护公解
决。Wmdows7 数据备份操作界面如图6-20 所示。
＠妙…
选择要保存各份的位置
一酗妇一
一曲
鲁份昌耘
命O血四
命0'""' 回
令0心的
』如RW阿归．
已面函l
_
- - =-.:..._j:
竺，t.__J_1
坻570B m"吼
51.52 GB 294.92·09
117丑GB l”I..GO
， 一
l 下?的I~已
图6-20 Windows 7 数据备份操作界面
6.5 数据库安全概述
信息技术的核心是信息处理，而数据库技术正是信息处理的中流砾柱，担负着储存：和操
作信息的使命，越来越多的政府部门和商业企业都将大量有价值的信息存储于计算机娄妇居库
中，这些信息大多关系到政府职能的有效提供和企业运作的成败，保障数据库的安全就；是：伤顷K
数据库中信息的安全。
6.5.1 数据库安全的基本概念
数据库安全是指数据库的任何部分都没有受到侵害，或者没有受到未经授权的存取和l修芘文。
1. 数据库安全的内涵
数据库安全主要包括数据库系统安全和数据库数据安全两层含义。
(1) 数据库系统安全
数据库系统安全是指在系统级控制数据库的存取和使用机制，应尽可能地堵~各乔中抖替在
184
第6 章操作系统与数据库安全技术
的漏洞，防止非法用户利用这些漏洞危害数据库系统的安全；同时保证数据库系统不因软硬件
故障和灾害的影响而不能正常运行。数据库系统安全包括以下几个方面。
l) 硬件运行安全。
2) 物理控制安全。
3) 操作系统安全。
4) 用户连接数据库需授权。
5) 灾害和故障恢复等。
(2) 数据库数据安全
数据库数据安全是指在对象级控制数据库的存取和使用的机制，哪些用户可以存取指定
的模式对象及在对象上允许有哪些操作。数据库数据安全包括以下几个方面。
1) 有效的用户名／口令鉴别。
2) 用户访问权限控制。
3) 数据存取权限和方式控制。
4) 审计跟踪。
5) 数据加密等。
2. 数据库安全管理原则
一个强大的数据库系统应当能够确保其中数据信息的安全，并对其进行有效的管理控
制。对数据库系统进行安全管理规划时，一般要遵循以下原则。
1) 管理细分和委派原则。在数据库管理过程中应进行管理责任细分和任务委派，确定每
个数据库管理人员的责任和角色。
2) 最小权限原则。数据库管理应本着“最小权限”的原则，从需求和工作职能两个方面
严格限制对数据库的访问。通过角色的合理运用，“最小权限”可以确保数据库功能限制和特
定数据的访问。
3) 账号安全原则。对千每个数据库连接来说，用户账号都是必需的。账号应遵循传统的
用户账号管理方法来进行安全管理，包括密码的设定与更改、账号锁定策略和账号的生命
周期等。
4) 有效审计原则。数据库审计是数据库安全的基本要求，主要用来监视各个用户对数据库
所进行的各种操作。
6.5.2 数据库管理系统简介
数据库管理系统(DBMS) 已经发展了40 多年，人们提出了许多数据模型，其中在日常
生活中使用最多的是关系模型。在关系型数据库中，数据项保存在行中，文件就像是一个表。
关系被描述成不同数据表间的匹配关系。关系模型千1980 年随着数据库访问语言一结构化
查询语言(SQL) 的出现而广泛推行。
DBMS 是专门负责数据库管理和维护的计算机软件系统，是数据库系统的核心，不仅负
责数据库的维护工作，还负责数据库的安全性和完整性。
DBMS 是与文件系统类似的软件系统，通过DBMS 应用程序和用户可以取得所需的数
据。与文件系统不同的是， DBMS 还定义了所管理的数据之间的结构和约束关系，并提供了
一些基本的数据管理和安全功能。
185
计算机网络安全教程笫4 版
6.5.3 数据库系统的缺陷与威胁
与操作系统和其他应用软件系统类似，数据库系统也不可避免地存在着安全缺陷，同时
也会受到多种形式的安全威胁。
1. 数据库系统的缺陷
数据库系统的安全缺陷主要体现在以下几个方面。
l) 数据库系统安全通常都同操作系统安全密切相关。Oracle、SQL Server 和MySQL 等
数据库系统都涉及用户账号和密码、认证系统、授权模块、网络协议、安全补丁和服务~等，
这些方面的安全漏洞和不当配置通常会造成严重后果，并且难以发现。
2) 数据库系统安全通常被忽视。人们对操作系统和网络系统安全的重要性都有比~清醒
的认识，但是对数据库系统安全的重要性却认识不足。
3) 数据库账号和密码容易泄露。大部分数据库系统只提供基本的安全特性，没有ffl应机
制来限制用户的密码策略，弱口令密码会严重威胁数据库系统的安全。
2. 数据库系统面临的威胁
凡是能造成对数据库中所存储数据（如敏感、非敏感信息）的非授权访问（如读~或
非授权写入（如增加、删除和修改等），原则上都属千对数据库的安全威胁。另一方面，~授
权用户不能正常得到数据库的服务，也被认为是对数据库的安全威胁。
数据库系统面临的安全威胁主要来自以下几个方面。
l) 物理和环境的因素。如物理设备的损坏、设备的机械和电气故障、火灾、7K灾、地
震等。
2) 事务内部故障。数据库的“事务”是指数据操作的并发控制单位，是一个不可~割的
操作序列。数据库事务内部故障多造成数据的不一致性，主要表现有丢失、修改、不能~复贮读
和无用数据的读出等。
3) 存储介质故障。
4) 人为破坏。
5) 病毒与恶意攻击。
6) 未经授权的数据读写与修改。
7) 对数据的异常访问造成数据库系统故障。
8) 数据库权限设置错误，造成数据的越权访问。
6.6 数据库安全机制
数据库安全作为信息系统安全的一个子集，必须在遵循信息安全总体目标（即~~性认
完整性和可用性）的前提下，建立安全模型，构建体系结构，确定安全机制。
6.6.1 黜库安全的瞅分布
一般来说，数据库安全涉及5 个层次。
l) 物理层：必须物理地保护计算机系统所处的所有结点，以防入侵者强行闯入．或；暗并1
潜入。
2) 人员层进行用户授权要谨慎，以减少授权用户接受贿赂而给入侵者提供~问机岔：
186
第6 章操作系统与数据库安全技术
的可能。
3) 操作系统层：操作系统安全性方面的弱点总是可能成为对数据库进行未授权访问的
手段。
4) 网络层：几乎所有数据库系统都允许通过终端或网络进行远程访问，网络层安全性和
物理层安全性一样重要。
5) 数据库系统层：数据库中有重要程度和敏感程度不同的各种数据，并为拥有不同授权
的用户所共享，数据库系统必须遵循授权限制。
为了保证数据库安全，必须在上述所有层次上进行安全性保护。如果较低层次上（物理
层或人员层）的安全性存在缺陷，那么，即使是很严格的高层安全性措施也可能被绕过。当
然，对数据库系统安全来说，数据库系统层的安全性最重要。
6.6.2 安全DBMS 体系结构
通常所说的可信DBMS 是指MLS （多级安全） DBMS, 因其存储的数据具有不同的敏感
性（安全）级别， MLS DBMS 中的关系也称多级关系。设计可信DBMS 的目标在千满足高安
全保证需求的同时，仍保持通用DBMS 产品所能提供的功能。然而目前看来，这两个目标相
互冲突，这是因为SQL 引擎(DBMS 执行逻辑）太大、太复杂，如果将整个SQL 引擎放置千
执行安全机制的可信计算基(TCB) 中，就不可能满足较高安全级别所要求的TCB 最小化、
简单化，以及分层、抽象和数据隐藏的要求；如果将SQL 引擎放置千TCB 之外，又很难提供
目前通用产品所提供的功能。根据这些考虑，目前研究的可信DBMS 体系结构基本上分为两
大类TCB 子集DBMS 体系和可信主体DBMS 体系。
1. TCB 子集DBMS 体系结构
TCB 子集DBMS 体系结构使用位于DBMS 外部的可信计算基（通常是可信操作系统或
可信网络）执行对数据库客体的强制访问控制。该体系把多级数据库客体按安全属性分解成单
级断片（属性相同的数据库客体属千同一个断片），分别物理隔离存储在操作系统客体中。每
个操作系统客体的安全属性就是存储千其中的数据库客体的安全属性。然后， TCB 对这些隔
离的单级客体实施MAC 。
这种体系的最简单方案是把多级数据库分解成单级元素，安全属性相同的元素存储在一
个单级操作系统客体中。使用时，先初始化一个运行于用户安全级的DBMS 进程，通过操作
系统实施的强制访问控制策略， DBMS 仅访问不超过该级别的客体。然后， DBMS 从同一个
关系中把元素连接起来，重构成多级元组，返回给用户，如图6-21 所示。
高安全类用低安全类用
高安全类DBMS 进程I I 低安全类DBMS 进程
可俏操作系统
高安全类数据库断低安全类数据库断
图6-21 TCB 子集DBMS 体系结构
187
计算机网络安全教程笫4 版
使用这种体系结构的理论研究或产品有： Hinke-Schaefer Trusted DBMS 研究， Trusted
Oracle Version 7.0 DBMS 的一种变种（称为OS-MAC 模式），以及Secure Distributed Data
Views (Sea View) 研究原型等。
TCB 子集DBMS 体系结构有两个优点。一是用户并非在多级模式下操作，而是在可信操
作系统建立的会话级上操作。每个用户都与运行千用户会话级的一个DBMS 交互，而且多个
运行千不同敏感级的不同DBMS 可同时进行操作，该体系可达到较高级别的强制保证。二是
该体系结构允许TCB 位于DBMS 之外，因此可以减少TCB 的规模和复杂度，这正是高安全
等级所要求的。
TCB 子集DBMS 体系结构的缺点是，该体系使用多进程，因而不适合要求并发操作，且
并发操作又有大量敏感级的应用，因为操作系统能支持的并发进程数量及其处理能力有限，所
以该体系适合仅需要少量敏感级的应用。此外，该体系还引入了多实例，为消除其影响需要付
出较大代价。
2. 可信主体DBMS 体系结构
可信主体DBMS 体系结构与TCB 子集DBMS 体系结构大不相同，它自己执行强制i方问控
制。该体系按逻辑结构分解多级数据库，并存储在若干个单级操作系统客体中，但每个单级操净：
系统客体中可同时存储多种级别的数据库客体（如数据库、关系、视图、元组或元素），并与其中
最高级别数据库客体的敏感性级别相同。从操作系统的角度，只能看到一个个单级文件， ffii~不
知道其中含有众多的多级数据库客体，所以不能为这些数据库客体进行访问控制。然而，可有i主
体DBMSt掷识别这些数据库客体及其敏感性级别，因此能为这些数据库客体行使访问控制。
图6-22 是可信主体DBMS 体系结构的一种简单方案， DBMS 软件仍然运行千可信操作
系统之上，所有对数据库的访问都必须通过可信DBMS 。
可信主体DBMS
可信操作系统
高安全类数据库文件
图6-22 可信主体DBMS 体系结构
可信主体DBMS 体系结构的优点在千， DBMS 能同时访问所有级别的数据。它允许一个
多用户进程为所有用户请求服务，使操作系统的处理负载最小化，也允许操纵带有大量~~性
标签的数据。该体系可以操纵涉及多个访问控制级别数据、形式更为复杂的访问控制，~支：持
定义在不同敏感性级别的数据间的完整性约束，如引用完整性约束。
可信主体DBMS 体系结构的主要缺点是，缺乏扩展到高安全等级的潜力。满足较高的安
全保证级别需要通过硬件隔离的形式分隔强制性客体，而在该体系中物理客体是整个的多级关
系或多级数据库，实际的强制性数据库客体则由可信软件隔离，所以很难证明该软件能正确地
操作而不允许从高安全类到低安全类的数据流。
总之，为达到更高的强制保证，若依赖TCB 实施访问控制就会牺牲一些DBMS 功能，因
此，除了OS-MAC 模式使用了TCB 子集方案，目前主要的DBMS 产品都依赖于DBMS 自身
188
第6 章操作系统与数据库安全技术
对数据库客体实施访问控制。这些DBMS 都是定位千TCSEC 的Bl 级保证，因为这一级不要
求DBMS 小而简单，且允许适应不可信软件产品对多级数据进行操作。
6.6.3 数据库安全机制分类
下面进一步讨论数据库的安全机制，正是由这些安全机制来实现安全模型， 进而实
现数据库系统的信息安全目标。根据各安全机制主要针对的目标，表6-1 对其进行了粗
略分类。
表6一1 数据库安全机制分类
安全机制保密性完整性可用性
身份识别和认证J J J
强制访问控制J
自主访问控制J
基千角色访问控制J
推理和聚集J
多实例.J
隐蔽信道J
数据库加密J J
实体和引用完整性J J
可信恢复J J
审计J .J
1. 身份识别和认证
数据库系统要求严格的用户身份标识和认证。身份标识确保用户身份的唯一性，从而确
保用户行为的可查性，认证确保用户身份的真实性，以防假冒。安全的数据库系统应设置必要
的标识和认证机制确保相应的授权。用户在被准许访问数据库之前必须主动出示身份证据进行
认证。
鉴定过程可采用下列方法中的一种或几种：一是要求用户出示其拥有的某种东西，包括
使用磁卡、密钥、证书或其他不易仿造的设备；二是要求用户出示只有他知道或只有他拥有的
某种东西，包括口令、指纹或视网膜式样等。
2. 强制访问控制MAC
这里以SeaView 的MAC 为例来说明MLS DBMS 的强制访问控制。该强制策略遵循BellLaPadula
安全模型，访问控制粒度为数据元素，即元组中每个数据元素都有一个安全类标
签。元素级控制粒度是关系DBMS 能支持的最细控制粒度。每个元组也有一个安全类标签，
元组标签值是该元组中所有元素安全类标签的最小上界。
为了防止由较高安全数据所派生数据的外流， SeaView 要求外流数据的安全类必须支配其
所有派生源数据的安全类。因此，为元组分配一个安全类标签，该标签支配该元组中所有数据
的安全类；或者该标签支配该元组所有派生源数据的安全类，该元组中的元素个体带有存储千
数据库中元素的原始分级。
189
计算机网络安全教程笫4 版
3. 自主访问控制DAC
仅有强制访问控制还不够，如在强制访问控制下，设安全类的范畴成分最小粒度是同一
公司的一个部门，该部门的职员间不再划分范畴，且其权力级别相同，这些职员间的互相访问
强制策略井无限制，这时，就要用到自主访问控制。强制控制和自主控制犹如两道关卡，有力
地保证了访问安全， SeaView 就是同时实施这两种访问控制的。
SeaView DAC 所控制的客体包括整个数据库或整个关系，由此可见，与MAC 的精细粒
度相比， DAC 被用千较粗粒度。可应用自主控制的关系包括基表、视图等，可应用自主控制
的主体包括用户和用户组。SeaView 用访问模式来表达自主控制性质，即可授予主体对自主客
体的特定访问模式，包括insert、delete、retrieval、update、reference、null 和grant 等。
4．基千角色的访问控制RBAC
上述的MAC 和DAC 是两种基本类型的访问控制机制，相对于它们来说，基千角色在的访
问控制(RBAC) 是一个应行业需要而开发的MAC, 其基本理念是权限与角色相关联，用户
被分配以适当的角色。图6-23 所示是一个简化的RBAC 模型。
图6-23 基千角色的访问控制RBAC 的简化模型
在图6-23 中，用户是一个人，角色是一种工作岗位，权限则是访问某客体的许可~执币二
某任务的特权。通过关联权限和角色，并给用户分配角色，用户就能获得相关的权限。角色L~
据单位组织内不同工作任务而创建，执行任务所需权限则与角色相联系，当有新的应用和系~
时，可以为角色授予新的权限，并可以收回不再需要的权限。实践中根据责任和资格为用户分
配角色，还可以为用户从一个角色重新分配到另一个角色。通过这种方式，极大地简化了用户
与权限的管理， RBAC 技术适用于大规模企业系统内管理和实施安全措施。
5. 推理和聚集问题
推理和聚集是自然界人类社会中普遍存在的现象，并非DBMS 所特有。但由于数据库中
元组、属性、元素之间相互联系，所以推理和聚集问题就成了数据库安全的重要内容。~多级
安全DBMS 中这两个问题尤为突出，推理和聚集问题都会导致未授权的信息泄露。
(1) 推理问题
数据库安全中所指的推理有其特定含义，是指用户根据较低安全级别和可见的数据~~
出较高安全级别信息，它是一个非常复杂的问题。推理方法的多样化是造成推理问题复杂的首
要因素，可用的推理策略有演绎、归纳、类似、经验、语义联系、存在性和统计等。推理~息
的广泛性是造成推理问题复杂的另一因素，可用千推理的信息类型有元数据、关系中的数据！
值、统计数据、派生数据、数据的存在性、数据的改变或消失（如安全级别上升）、未存~于
数据库中但在应用域已知的数据语义、未存储于数据库中关于应用域（进程和数据）的~门信
息，以及普通知识和常识等。
如果要防止所有的未授权泄露，应遵循多级数据库的基本安全原则：数据的安全~应：~
配所有施加影响于自身的数据的安全类。即给定数据项目X、Y, 若X 受Y 影响，则X 的安
全类应支配Y 的安全类。理由很简单，如果某数据值受高级别数据影响，那么，信息就；会从｀
高级别数据流入该数据。换言之，若秘密数据受绝密数据影响，当然会泄露部分甚至~剖培色密
190
第6 章操作系统与数据库安全技术
信息。根据该安全原则，并结合实际应用仔细考虑数据内容，可以防止许多推理问题，但预测
或检测所有推理问题仍然很难，比较可行的办法是：若X 导致了Y 的泄露，则应部分或全部
对X 进行重新分级，这样，就不可能从被泄露的X 子集推导出Y 来。具体来讲有两种方法：
对数据重新分级或对约束重新分级。
(2) 聚集问题
简单地说，聚集是把分离的数据项目收集起来。但在数据库安全中，聚集策略通常是因
为敏感信息可从聚集推导出，但不能从任何个体成员推导出。因此，聚集通常与推理联系在一
起。两者的差别在千，在聚集问题中，推荐使用一种特殊的标记策略，而且在如何控制方面也
很不同。聚集问题的最普通实例是黑名单，即整个名单是有安全级的，而个体信息则不是。
在商业数据库应用中，聚集术语有更普通的用法一聚集操作，有5 个标准的聚集操
作：求和、求均值、计数、求最大值和求最小值。对关系的列进行这些操作，人们可以从数据
库存储的大董数据中得到单一数据值。
需要注意的是，此处讨论的聚集问题是指聚集数据的级别高于用于形成聚集数据的个体
数据的级别。它与统计数据库所行使的操作密切相关但又不同，统计数据库用千进行统计性研
究（求和、均值和中值等）但不泄露个体数据。统计数据库关心的是隐私意义上的安全，而不
是安全等级意义上的安全，它不是多级数据库安全的专门问题。
6. 多实例问题
多级数据库与普通单级数据库的不同点在千，在多级环境中如果提升用户的安全类，就
会出现新的实体；反过来，如果降低用户的安全类，就会隐藏一些实体。因此，不同安全类的
用户看到不同版本的现实世界，而且这些不同版本必须保待连贯性和一致性，而不能引入任何
向下的信令信道（当查询和更新数据库时，必须考虑发信号的速度和可能的木马软件。应用软
件的隐藏代码可能利用一个能多级别访问数据库的合法用户来开发信令信道，以秘密绕过机密
性措施）。
“没有向下的信令信道”为构造多级安全DBMS 带来了一个新概念一多实例，多实例显
著复杂化了多级关系的语义。有4 种方式给多级关系中的数据分配安全类，即把安全类分配给
关系、单独元组、单独属性或单独元素。
给元组或元素分配安全类时常会发生多实例的情形，这里以元组级标记为例进行说明。
当一个多级关系至少包含两个具有相同表面主键值的元组时，称该关系是多实例化。表面主键
是用户定义的主键，其值可以相同。但这些元组分属不同的安全类，这时这些元组有可能指向
同一个真实世界实体而记录了不同的事件，也有可能指的是完全不同的真实世界实体而被赋予
了相同的名称。
设计MLS DBMS 必须考虑多实例问题。当一项数据存在于多个安全类时，有可能相同的
数据在不同的安全类拥有不一致的值。有多种多实例方案，比较简单的一种是明确通知用户存
在于数据中的约束或不一致性，以便控制多实例。
7. 数据库加密
对高度敏感的数据而言，单从访问控制和数据库的完整性方面考虑安全还不够，因其存
在一个严重的不安全因素，即原始数据以可读形式存储在数据库中，对于某些计算机内行，完
全可以打入系统或从存储介质中导出数据。为此，可以借助加密措施，加密数据难以被解读，
除非读数据的人知道如何对加密数据进行解密。
加密技术应具有如下性质。
191
计算机网络安全教程笫4 版
l) 对授权用户来说，加密数据和解密数据相对简单。
2) 加密模式不应依赖于算法的保密性，而应依赖千密钥。
3) 对入侵者来说，确定密钥极其困难。
数据库系统中，对数据进行加密的单位可以是数据库、关系、元组和数据元素。加密方
法可采用DES 数据加密标准、子密钥数据库加密及秘密同态技术。加密方式有库外加密、库
内加密和硬件加密。数据库密钥管理是一个很难解决的问题，简单的办法是采用集中式密钥管
理，但权力集中有很大的安全隐患，较好的办法是采用主密钥和子密钥管理相结合的公钥密码
算法。
8. 数据完整性
数据库的数据完整性总体来说是DBMS、操作系统及计算机系统管理程序的职责。在关
系数据库管理系统RDBMS 范围内，实体完整性和引用完整性是最基本的两个完整性需求，
它们有助于防止不正确数据进入数据库。
在多级安全环境中，必须对传统的单级关系模型进行扩展。关千MLS 关系数据模型，目
前并没有明确的共识，所以对千一些基本原则（如完整性要求和更新语义）尚有争论。这里，
将对目前有代表性的数据完整性原则进行讨论。
(1) 多级关系的基本概念
一个多级关系由两部分组成： 关系模式和关系实例。关系模式是关系的逻辑设计，其
形式为： R(A1,C1,A2,C2,L,AD ,CD,TC) ， 其中， Ai 是定义在域Di 上的数据属性， Ci 是A
的等级属性； TC 是元组的安全类属性，其值是本元组内所有Ci 值的最小上界。关系实例是
关系中一个给定时刻的数据快照(snapshot) ，其形式为： Ri:(A1,C1,A2,C2,L,An,Cn, TC) 。
每个关系实例都是形如(a1,c1,a2,c2,L,a0,c0, tc) 的不同元组的集合， ai允许有空值，但Ci 不
允许为空。对千格阵中的每个安全类c, 都有这样一个实例RC O RC 中只显示那些主键安全
类受c 所支配的元组，而且这些元组中凡是安全类不受c 支配的属性都显示为空值null, 同
时安全类变成与主键安全类相等。简而言之，多级关系在不同的安全类有不同的表现，也
就是不同的实例。
(2) 核心完整性
多级关系模型中，核心完整性是单级关系模型中实体完整性的扩展，其必须满足以下4
个性质。
性质1: 实体完整性。对任一给定元组，要求表面主键AK 的所有属性值非空且等级相
同，并且该元组的表面主键AK 受非AK 属性支配。
性质2: 空值完整性。对任一给定元组，如果属性值为空，则要求该属性的等级等千表面
主键的等级。并且RC 中不存在某一元组t 小计另一元组s 的情况。所谓t 小计S, 是指
t[Ai,Ci] = s[Ai,Ci] 或者t[Ai] 凸null 且s[Ai]= null 。
性质3 ：实例间完整性。要求对千所有安全类c'~c, 实例R。，是从实例R。中“过滤”而
来。即从安全类c' 的角度只能看到实例R。中部分元组的部分属性值，且所看到数据的安全类
受c' 支配。这些被过滤过的“残缺的“元组构成了RC' 。至于那些“看不到＂的非表面主键属
性的值，则以空值null 代替。
性质4: 多实例完整性。要求多级关系中的主键是AK.UCAKUCR （而对千一个单级关系
来说，所有元组中C" 和CR 是相等的常量）。这是为了禁止同一安全类中的多实例。
192
第6 章操作系统与数据库安全技术
(3) 引用完整性
引用完整性，是指一个关系中给定属性集上的取值也应在另一个关系的某一属性集的取
值中出现。在单级关系模型中，引用完整性要求主动引用关系中的外键值或者全空，或者全非
空而且只要外键值全非空，则被引用关系中总有与该外键值相等的主键值。
朗MLS 黏裤，需要使该伤贡无论从吼叶安全类彩＂妫真对此，必须遵守以下两个规则。
规则1: 主动引用关系的外键必须统一分类，即组成FK 的所有属性的安全类相同a
规则2: 外键的安全类必须支配相应主键的安全类，即c[FK]~c[PK] 。
9. 可信恢复
可信恢复是数据库安全完整性目标的一个重要机制。数据库系统必须预先采取措施，以
保证即使发生故障，也可以保持事务的原子性和持久性。有两种不同的恢复机制：基千日志的
恢复机制和影子分页的恢复机制。单事务的恢复可以使用这两种恢复机制；并发事务可以使用
基千日志的技术，但不能使用影子分页技术。
恢复机制的有效实现要求写数据库和稳定存储器次数尽量少。具有以下两者之一情形时
日志记录必须写入稳定存储器： O在日志记录勺｀i 提交斗俞出到稳定存储器前，所有与事务Ti
有关的日志记录必须已被输出到稳定存储器中；＠在主存中的数据块输出到数据库前，所有与
该块中数据有关的日志记录必须已被输出到稳定存储器中。
为从导致非易失性存储器中数据丢失的故障中恢复，需周期性地将整个数据库的内容转
储到稳定存储器上。
10. 审计
审计作为一种事后追查手段来保证数据库系统的安全。审计的目的是检查访问模式，发
现绕过系统控制的企图，发现特权的使用，扮演监督角色，提供附加保证。记录和追查是审计
的两个主要方面。为了精确、规范地描述审计记录，审计应包括以下3 个基本对象。
l) 用户：谁初始化了一个事务？从哪个终端？什么时候？
2) 事务：被初始化的确切事务是什么？
3) 数据：事务的结果是什么？在事务初始化之前和之后的数据库状态是什么？
同时，需要对审计数据施加一个逻辑结构。比较好的模型是双时关系，用两个时间元逻
辑组织审计数据。具体地讲，就是给每个客体贴上两个时间元，一个时间元是事务时间，用于
排序对某客体的操作流水账；另一个时间元是有效时间，用千记录该客体在真实世界的有效时
间段。
除了实际记录发生在数据库系统中的所有事件之外，审计跟踪还必须提供审计的查询支
持。由千审计系统记录了数据库中全部行为的信息，所以应限制用户对数据库的访问。有两种
方法限制用户访问：给事务分配安全标记和根据用户等级对数据库进行过滤。
原则上，应当有可能审计数据库中的每一个事件，即“零信息损失＇，。但是，审计会消耗
一定的系统资源。实际被审计的事件应取决于所涉及事件的敏感性及对风险的仔细分析，应允
许用户按照各自需要选择开启不同的审计。另外，如果将审计功能与告警功能结合起来，那
么，每当发生违反数据库系统安全的事件或者涉及系统安全的重要操作，就可以向安全操作员
终端发送告警信息。
6.6.4 Oracle 的安全机制
Oracle 是关系数据库的倡导者和先驱，是标准SQL 数据库语言的产品，自1979 年推出以
193
计算机网络安全教程第4 版
来受到业界的广泛关注。Oracle 不断将先进的数据库技术融入其中，并极有预见性地领导着全
球数据库技术的发展O Oracle 在数据库管理、数据完整性检查、数据库查询性能和数据安全性
方面都具有强大的功能，而且它还在保密机制、备份与恢复、空间管理、开放式连接及开发工
具等方面提供了不同手段和方法。下面介绍Oracle 数据库提供的安全机制。
Oracle 多用户的客户／服务器体系结构的数据库管理系统中包括的安全机制可以控制
对某个数据库的访问方式。Oracle 数据库管理系统的安全机制可以防止未授权的数据库访
问，防止对具体对象的未授权访问、控制磁盘及系统资源（如CPU 时间）的分配和使
用，以及稽核用户行为等。这些机制的具体实现主要是由数据库管理员(DBA) 和开发
人员完成的。
与具体应用相关的数据库安全可划分为系统安全和数据安全两类。系统安全包括的安全
机制可以在整个系统范围内控制对数据库的访问和使用。如有效的用户名和口令、是否授~给
用户连接数据库、某用户能用的最大磁盘空间、限制资源的使用、自动数据库稽核，以~用户
能执行的系统操作等。数据安全包括的安全机制可以在对象（如表、视图等）这一级上控制对
数据库的访问和使用，例如，哪个用户可以访问某特定的对象，以及对这个对象允许执行的操
作（如允许查询和插入操作，但不允许删除操作）、需要稽核的操作等。
Oracle 数据库服务器或数据库管理系统提供了可自由决定的访问控制手段，即Oracle 根
据特权来限制对信息的访问。为了让用户访问某对象，必须把适当的特权分配给用户，拥有这
种特权的用户可以自由地给其他用户授予特权。因此，这种安全机制就称为可自由决定的。
Oracle 使用几种不同的方式管理数据库安全，即数据库用户和对象集、特权、角色、~~空间
设置和配额、资源限制、稽核等。
1. 数据库用户和对象集
每个Oracle 数据库都有一个用户名列表，为了访问某个数据库，用户必须使一个数据库
应用（如From 或Report) 利用有效的数据库用户名与数据库连接，并且每个用户必须有一个
相应的用户口令以防止未授权的访问。与每个用户紧密相关的是一个同名的对象集，即~象的
逻辑集合，在默认情况下，每个用户可以访问相应的对象集中的所有对象。Oracle 还对每个｀用
户定义了一个安全域，它决定用户拥有的行为（特权和角色）、用户的表空间配额（磁盘：空
间）和对用户的系统资源限制（如CPU 处理时间）。
2．特权
特权是执行某个特定SQL 语句的权力，如连接数据库（创建一个会话）、在相应用户的对
象集内创建一个新表，以及从其他用户的数据库中查询数列记录、执行其他用户的存储过程
等。Oracle 数据库的特权可分为两类系统特权和对象特权。
系统特权允许用户执行特定的系统操作或对某个对象执行特定的操作，如创建表空
间或删除数据库中任一个表中的记录。很多特权只有数据库管理员和应用开发人员才
有，因为这些操作功能极为强大。对象特权可以让用户对某个特定的对象执行特定的操
作，如删除某个特定表中的记录；这种特权被授予应用的最终用户，让他们能使用~据
库完成特定的任务。
特权授予用户的目的是使用户能访问和修改数据库中的数据，可以直接授给用户， 也可
以授给角色，然后角色可被授予一至多个用户。如EMP 表中插入记录的特权可授予称为
CLERK 的角色，然后再授给用户Scott 和Brian。由于角色具有易千有效地管理特权的特点，
因此特权通常授给角色而不是某个用户。
194
第6 章操作系统与数据库安全技术
3. 存储空间的设置与配额
Oracle 为限制分配给某个具体数据库的磁盘空间的使用提供了有效的手段，包括缺
省和临时表空间及表空间配额。每个用户都有一个缺省空间，如果用户具有在特定的缺
省空间中创建对象和配额的特权，而且在创建表等对象时又无其他表空间，则使用这个
缺省表空间。
每个用户都有一个临时表空间，用户执行一个需要创建临时段的SQL 语句时，使用用户
的临时表空间。通过把所有用户的临时段引导到临时表空间，可减少临时段和其他种类的段的
输入输出冲突。
Oracle 可以限制对象的可用磁盘空间，即分配配额，实现对对象占用的磁盘空间进行有选
择性的控制。
4. 稽核
Oracle 允许对用户的操作实施有选择的稽核，以帮助调查可疑的数据库使用，可在3 个层
面实施：语句稽核、特权稽核和对象稽核。语句稽核是检查特定的SQL 语句，而不涉及具体
的对象。这种稽核既可以对系统的所有用户，又可对部分用户实施。特权稽核是检查功能极其
强大的系统特权的使用情况，不涉及具体的对象。这种稽核也是既可以对系统的所有用户，又
可对部分用户实施。对象稽核是检查对特定对象的访问情况，不涉及具体的用户，是监控有对
象特权的SQL 语句，如SELECT 或DELETE 语句。
Oracle 允许各种稽核对已成功执行了的语句、未成功执行的语句或两者进行选择性稽核，
这样就可监控可疑的语句，稽核操作的结果记录在稽核跟踪表中。
6.7 数据库安全技术
数据库的安全技术主要包括口令保护、数据加密、数据库加密和数据库的访问控制。
1．口令保护
口令设置是信息系统的第一道屏障，口令保护尤其重要。对数据库的不同模块应设置不
同的口令，对访问数据库的用户应设置不同的口令级别。各种模块（如读模块、写模块和修改
模块等）的口令应彼此独立，同时应当对口令表加密，以保护数据安全。
2. 数据加密
考虑到用户可能试图旁路系统的情况，如物理地取走数据库、在通信线路上窃听等，对
于这样的安全威胁最有效的手段是数据加密，即以加密格式存储和传输敏感数据。有关数据加
密的原理与方法在第3 章已有详细介绍。
3. 数据库加密
数据库的加密方式有很多，既可以软件加密，也可以硬件加密。软件加密可以采用库外
加密，也可以采用库内加密。库外加密即采用文件加密的方法，它把数据库作为一个文件，
把每个数据块当作文件的一个记录进行加密，文件系统与数据库管理系统交换的是块号。库
内加密按加密的程度不同，可以进行记录加密，也可以进行字段加密，还可以对数据元素进
行加密。数据元素加密时，每个元素被当作一个文件进行加密。硬件加密是在物理存储器与
数据块文件之间添加一个硬件装置，使之与实际的数据库脱离，加密时只对专一磁盘上的数
据进行加密。
195
计算机网络安全教程第4 版
4. 数据库的访问控制
数据库系统可以允许数据库管理员和有特定访问权限的用户有选择地、动态地把访问权
限授予其他用户．在需要的时候，还可以回收分配的权限。
当一个新的用户需要访问数据库资源时，首先由数据库管理人员或数据库所有者对该用
户进行注册，给该用户分配一个口令，并授予其访问相应系统资源的权限。
6.8 小结
访问控制作为信息安全保障机制的核心内容和评价系统安全的主要指标，广泛应用千操
作系统、文件访问、数据库管理及物理安全等多个方面，它是实现数据保密性和完整性机｀制的
主要手段。传统访问控制技术主要有自主访问控制DAC 和强制访问控制MAC 两种，~型访
问控制技术主要有3 种，即基千角色的访问控制RBAC、基千任务的访问控制TBAC 和呾居于
组机制的访问控制。访问控制在实现方法上主要有访问控制矩阵、访问控制表、能力关系表和
权限关系表等。
操作系统在计算机系统安全中扮演着极为重要的角色，一方面它直接为用户数据提供各
种保护机制，另一方面也为应用程序提供可靠的运行环境，保证应用程序的各种安全机焦lj正常
发挥作用。操作系统的隔离控制方法主要有4 种：设备隔离、时间隔离、逻辑隔离和I力日~隔
离。访问控制安全措施也有4 种，即自主访问控制DAC、强制访问控制MAC、基千角色庄的访
问控制RBAC，以及域和类型执行的访问控制DTE 。
对操作系统的安全保护措施，其主要目标是保护操作系统中的各种资源安全，~体：地
讲，就是针对操作系统的登录控制、内存管理和文件系统这3 个主要方面实施安全保护。~作
系统的安全模型除了保证保密性和完整性的Bell-LaPadula 模型和Biba 模型之外，还有一些啪｝
象模型，如Graham-Denning 模型、Harrison-Ruzzo-Ullman 模型(HRU 模型）和获取－授予系
统模型等。以UNIX/Linux 和Wmdows 7 为例介绍了典型操作系统的安全机制，并给出了一些
相关的安全措施和安全配置方法。
数据库技术自20 世纪60 年代产生以来，已得到快速的发展和广泛的应用，数据库系统
担负着处理大量信息的重任，其安全问题日渐突出。当前，数据库安全理论在数据库安全：模
型、访问控制、数据加密、密钥管理、并发控制和审计跟踪等方面仍在不断发展，数据库安全
技术研究任重道远。
6.9 习题
l．什么是访问控制？访问控制和认证有何区别？
2. 传统的访问控制分为几类？其区别在哪里？试指出它们的优缺点。
3 . 新型访问控制技术分为几类？试指出它们的优缺点。
4. 简述访问控制的实现技术。
5. 什么是可信计算机系统评价准则？简述其基本内容。
6. 操作系统具备的一般安全防护方法有哪些？
7. 简述操作系统是如何实现对资源进行安全防护的．
8. 简述信息保密性和完整性安全模型的基本实现思想．
196
第6 章操作系统与数据库安全技术
9. Linux 系统实现安全机制的基本手段有哪些？
10. Wmdows7 系统实现安全机制的主要技术有哪些？
]]、简述数据库安全的概念内涵．
12. 简述数据库安全管理的基本原则。
13. 数据库安全的层次分布是如何划分的？
14. 数据库系统有哪些安全机制，它们主要针对信息安全的什么目标？
15. Oracle 数据库管理系统是如何考虑其安全机制的？
16. 简述数据库安全技术。
197
第7章
网络安全检测与评估技术
网络安全检测与评估是保证计算机网络信息系统安全运行的重要手段，对于准确掌~计
算机网络信息系统的安全状况具有重要意义。由千计算机网络信息系统的安全状况是动态变沿：
的，因此网络安全检测与评估也是一个动态的过程。在计算机网络信息系统的整个生命周期
内，随着网络结构的变化、新的漏洞的发现，以及管理员／用户的操作，主机的安全状况是不
断变化着的，随时都可能需要对系统的安全性进行检测与评估，只有让安全意识和安全制度：贯
穿整个过程才有可能做到尽可能相对的安全，一劳永逸的网络安全检测与评估技术是不~在
的，也是不切实际的。
7.1 网络安全漏洞
安全威胁是指所有能够对计算机网络信息系统的网络服务和网络信息的机密性、可用性
和完整性产生阻碍、破坏或中断的各种因素。安全威胁可以分为人为安全威胁和非人为安全威
胁两大类。安全威胁与安全漏洞密切相关，安全漏洞的可度量性使得人们对系统安全的潜~影
响有了更加直观的认识。
7.1.1 网络安全漏洞的威胁
漏洞分析的目的是发现目标系统中存在的安全隐患，分析所使用的安全机制是否能~保
证系统的机密性、完整性和可用性。漏洞分析通过对评估目标进行穿透测试，进而尝试从中获
取一些有价值的信息，如文本文件、口令文件和机密文档等。穿透测试可以分为两类：无先验
知识穿透测试和有先验知识穿透测试。无先验知识穿透测试通常从外部实施，测试者对被测~
网络系统的拓扑结构等信息一无所知。在有先验知识的穿透测试中，测试者通常具有被测试网
络系统的基本访问权限，并可以了解网络系统拓扑结构等信息。
对于安全漏洞，可以按照风险等级对其进行归类。例如那些具有低严重度和低影响度的
安全漏洞可以归类为低级别的安全漏洞，而那些具有高严重度和高影响度的安全漏洞可以归类
为高级别的安全漏洞。表7-1 ～表7-3 对漏洞分类方法进行了描述。
表7-1 漏洞威胁等级分类
严重度等级影响度
低严重度：漏洞难以利用，井且潜在I 低影响度：漏洞的影响较低，不会产生连带的其他安全漏洞
的损失较少
中等严重度：漏涧难以利用，但是潜
中等影响度：漏洞可能影响系统的一个或多个模块，该漏洞的利用可
在的损失较大，或者漏洞易于利用，但2
是潜在的损失较小
能会导致其他漏洞可利用
高严重度；漏洞易于利用，井且潜在
3
高影响度：漏洞影响系统的大部分模块，井且该漏洞的利用显著增加
的损失较大其他漏洞的可利用性
198
第7 章网络安全检测与评估技术
表7-2 漏洞威胁综合等级分类
严茧等级
影响等级
1 2 3
1 I 2 3
2 2 3 4
3 3 4 5
等级
2
3
4
5
表7-3 漏洞威胁等级分类描述
描述
低影响度，低严觅度
低影响度，中等严菹度：中等影响度，低严重度
低影响度，高严重度；高影响度，低严重度：中等影响度，中等严重度
中等影响度，高严重度；高影响度，中等严重度
高影响度，高严重度
7.1.2 网络安全漏洞的分类
漏洞是在硬件、软件和协议的具体实现或系统安全策略上存在的缺陷，可以使攻击者在
未授权的情况下访问或破坏系统。
漏洞的产生有其必然性，这是因为软件的正确性通常是通过检测来保障的。＂检测只能发
现错误，证明错误的存在，不能证明错误的不存在“。这一断言，被软件工程的实践证明无疑
是正确的。软件尤其像操作系统这样的大型软件不可避免地存在着设计上的缺陷，这些缺陷反
映在安全功能上便造成了系统的安全脆弱性。
在进行系统安全性评估时，需要注意的是已发现的漏洞数量并不能完全反映系统的安全
程度，它与系统的使用范围、经受检验的程度，以及是否开放源码等因素都有关系。
漏洞的分类方法主要有按漏洞可能对系统造成的直接威胁分类和按漏洞的成因分类两
类，下面分别进行说明。
1 ．按漏洞可能对系统造成的直接威胁分类
网络安全漏洞可以按照其可能对系统造成的直接威胁进行分类，具体分类方法如表7-4
所示。
表7-4 按漏洞可能对系统造成的直接威胁分类
漏洞类型漏洞描述典型漏洞
攻击者无须一个账号登录到本地直接获得远程Windows NT 中11S 4.0 的IS心l D且对输入的
系统的管理员权限，通常通过攻击以root 身份URL 未做适当的边界检查，如果构造一个超长的
远程管理员权限执行的有缺陷的系统守护进程米完成，漏洞的绝URL，可以溢出IIS (inetinfo.exe) 的缓冲区，执行
大部分来源千缓冲区溢出，少部分来自守护进程所指定的代码。由于inetinfo.exe 是以local system 身
本身的逻辑缺陷份启动，溢出后可以直接得到管理员权限
攻击者在已有一个本地账号能够登录到系统的
RedHat LinWt 的restore 是一个suid 程序，它的执
本地管理员权限情况下，通过攻击本地某些有缺陷的suid 程
行依靠一个RSH 中的环境变鱼，通过设置环境变量
序、竞争条件等手段，得到系统的管理员权限
PAlH， 可以使RSH 变量中的可执行程序以root 身
份运行，从而获得系统的root 权限
199
计算机网络安全教程笫4 版
（续）
漏涧类型漏洞描述典型漏洞
攻击者利用服务器的漏洞，取得系统的普jffiffl户
存取权限，对UNIX 类系统通常是shell 访问权限，
Windows 中的邯4.0-5.0 存在Unicode 解码涌
对Windows 系纫面常是and.e:ite 的访问权限，能够
普通用户访问权限
以一般用户的身份执行程序，存取文件。攻击者通
洞，可以使攻击者利用cmd.exe 以guest 组的权限在
常攻击以非root 身份运行的守护进程、有缺陷的cg
系统上运行程序。相当于取得了普通用户的权限
酐痄眯覜这种访问机眼
攻击者在本地通过攻击某些有缺陷的sgid 程RedHat LinUJC 6.1 所带的man 程序为sgid man, 它
权限提升
序，可以把权限提升到某个非root 用户的水平。
存在format bug, 通过对它的溢出攻击，可以使攻击
获得管理员权限可以看作是一种特殊的权限提
升，只是因为威胁的大小不同而独立出来
者得到man 组的用户权限
攻击者通过利用某些漏洞，读取系统中他本来没SunOS 5.5 的ftpd 存在漏洞，一般用户可以引起
有权限的文件，这些文件通常是安全相关的． 这些ftpd 出错而如mp 出一个全局可读的core 文件，里
读取受限文件漏洞的存在可能是文件设里权限不正确，或者是特
枙拐郢寸文件的不正确处理和意外dwnp core 使受
面有shadow 文件的片断，从而使一般用户能读到
限文件的一部分dump 到了core 文件中
shadow 的部分内容
攻击者利用这类漏洞，无须登录即可对系统发早期的Linwc 和BSD 的TCP/fP 堆栈的IP 片断
远程拒绝服务
起拒绝服务攻击，使系统或相关的应用程序崩溃重组模块存在缺陷，攻击者通过向系统发出特殊的
或失去响应能力。这类漏洞通常是系统本身或其
守护进程有缺陷或设置不正确造成的
IP 片断包可以使机器崩溃
在攻击者登录到系统后，利用这类漏洞，可以
本地拒绝服务
使系统本身或应用程序崩溃．这种漏洞主要因为RedHat 6.1 的tcpwatch 程序存在缺陷，可以使系
是程序对意外情况的处理失误，如写临时文件之统forlc 出许多进程，从而使系统失去响应能力
前不检查文件是否存在，盲目跟随链接等。
利用这类漏洞，攻击可以不经授权地从远程存
取系统的某些文件。这类漏洞主要是由一些有缺Windows 11S 5.0 存在一个漏洞， 通过向它发送一
远程非授权文件存取陷的cgi 程序引起的，它们对用户输入没有做适个特殊的head 标记，可以得到asp 源码，而不是经
当的合法性检查，使攻击者通过构造特别的输入过解释执行后的asp 页面
获得对文件的存取
因为采用了较弱的口令加密方式，使攻击者可PC Anywhere 9.0 采用非常脆弱的加密方法来加密
口令恢复以很容易地分析出口令的加密方法，从而使攻击传输中的口令，只要窃听了传输中的数据很容易解
者通过某种方法得到密码后还原出明文码出明文口令
利用这类漏洞，攻击者可以对目标系统实施某
Linux kernel 2.0.35 以下的TCP/JP 堆栈存在漏洞，
欺骗种形式的欺骗．这通常是由于系统的实现存在某
些缺陷
可以使攻击者进行1P 地址欺骗非常容易实现
Wmdows IIS 3.0-5.0 存峦翩， 当向系宪韵芍存在
的idq 文仵讨，系统可能会返回出错信息里面暴露了
服务器
利用这娼洞，攻畛可以赎蜘诺涉攻ns 的安装目录信息，如请求h11pJ/www.microsoft.com
信息泄露
击系统有用的信息。这类漏洞的产生主要是因为系/anytbing.ida ，服务器会返回Response: Toe IDQ file
统缺陷，寸阳鴃闱误的和氓处理d:\h11p\anything.ida could not be 枷吐边鳍息可能对
攻击者进行攻击带来方便，比如要进行msadc 的攻：
击，就需要知道系统的安装目录
其他漏洞
虽然以上的几在种一分类包括了绝大多数的漏洞情
况，仍可能存些上面几种类型无法描述的漏
洞，归为此类
2．按漏洞的成因分类
网络安全漏洞也可以按照其产生的原因进行分类，具体分类方法如表7-5 所示。
漏洞类型
输入验证错误
访问验证错误
竞争条件
200
表7-5 按漏洞的成因分类
漏洞描述
大多数的缓冲区溢出漏洞和001 类漏洞都是由于未对用户提供的输入数据的合法性做适当的检查
酗司的产生是由于程序的访问验证部分存在某些可禾佣的逻辑错误，使绕过这种访问控制成为可能
漏洞的产生在于程序处理文件等实体时在时序和同步方面存在问题，从而在处理过程中可能存~
一些机会窗口使攻击者能够施加外来的影响
第7 章网络安全检测与评估技术
（续）
漏洞类型漏洞描述
意外情况处置错误
设计错误
配置错误
漏洞的产生在千程序在其实现逻辑中没有考虑到一些意外情况，而这些意外情况是应该被考虑到的
严格来说，大多数的漏洞都是由于设计错误造成的，这里主要归类暂时无法放K跳财帖笣lJ的漏洞
漏洞的产生在于系统和应用的配置有误，或是软件安装在错误的地方， 或是错误的配置参数，或
是错误的访问权限、策略错误等
环境错误主要是指程序在不适当的系统环境下执行而造成的问题
7.2 网络安全检测技术
网络安全检测主要包括端口扫描、操作系统探测和安全漏洞探测。通过端口扫描可以掌
握系统都开放了哪些端口、提供了哪些网络服务；通过操作系统探测可以掌握操作系统的类型
信息；通过安全漏洞探测可以发现系统中可能存在的安全漏洞。上述信息也是网络入侵者所感
兴趣的信息，他们通常会在正式入侵前进行类似的扫描动作。网络安全检测的一个重要目的就
是要在入侵者之前发现系统中存在的安全问题，及时地采取相应的防护措施，防患于未然。
7.2.1 端口扫描技术
1. 端口扫描原理
端口扫描的原理是向目标主机的TCP 或UDP 端口发送探测数据包，并记录目标主机的响
应。通过分析响应来判断端口是打开还是关闭等状态信息。根据所使用通信协议的不同，网络
通信端口可以分为TCP 端口和UDP 端口两大类，因此端口扫描技术也可以相应地分为TCP
端口扫描技术和UDP 端口扫描技术。
2. TCP 端口扫描技术
TCP 端口扫描技术主要有全连接扫描技术、SYN （半连接）扫描技术、间接扫描技术和
秘密扫描技术等。这里主要对前两种扫描技术进行简要介绍。
(1) 全连接扫描技术
全连接扫描是TCP 端口扫描的基础，现有的全连接扫描主要指TCP connect( ）扫描。其实
现原理如下所述。
扫描主机通过TCP/IP 的三次握手与目标主机的指定端口建立一次完整的TCP 连接。连接由
系统调用connect 开始。如果端口开放，则连接将建立成功；否则，若返回－1 则表示端口关闭。
建立连接成功表示响应扫描主机的SYN/ACK 连接请求，这一响应表明目标端口处千监听（打
开）的状态。如果目标端口处千关闭状态，则目标主机会向扫描主机发送RST 的响应。
(2) 半连接(SYN) 端口扫描技术
半连接(SYN) 端口扫描的原理是端口扫描没有完成一个完整的TCP 连接，在扫描主机
和目标主机的指定端口建立连接时只完成了前两次握手，在第三步时，扫描主机中断了本次连
接，使连接没有完全建立起来。
半连接(SYN) 扫描的优点在千即使日志中对扫描有所记录，但是尝试进行连接的记录
也要比全连接扫描少得多。缺点是在大部分操作系统中，发送主机需要构造适用于这种扫描的
IP 包，通常情况下，构造SYN 数据包需要超级用户或者授权用户访问专门的系统调用。
201
计算机网络安全教程笫4 版
3. UDP 端口扫描技术
UDP 端口扫描主要用来确定在目标主机上有哪些UDP 端口是开放的。其实现思想是发送
零字节的UDP 信息包到目标主机的各个端口，若收到一个ICMP 端口不可达的回应，则表示
该端口是关闭的，否则该端口就是开放的。
7.2.2 操作系统探测技术
由千操作系统的漏洞信息总是与操作系统的类型和版本相联系的，因此操作系统的类型
信息是网络安全检测的一个重要内容。操作系统探测技术主要包括：获取标识信息探测技术：、
TCP 分段响应分析探测技术和ICMP 响应分析探测技术。
1. 获取标识信息探测技术
获取标识信息探测技术主要是指借助操作系统本身提供的命令和程序进行操作系统~型
探测的技术。通常，可以利用telnet 这个简单命令得到主机操作系统的类型。
例如，对于一个默认安装的SunOS 操作系统，执行“telnet IP 地址”命令，可以~到类
似以下返回信息。
厂SunOS 5.8
lo血勹
可以看出，返回信息中包含了操作系统的版本信息。即使关闭了标志，利用telnet 命·令会连
接到其他端口，仍然有可能获得相关信息。
例如，若该系统同时开放了FfP 服务，当登录到其FfP 服务器端口（使用命令"telnet
IP 地址21”) 时，会得到以下响应信息。
....、:.. _ : 龙叩七函江珈nOS5少81\ •
同样包含了操作系统的版本信息。
2. TCP 分段响应分析探测技术
TCP 分段响应分析探测技术是依靠不同操作系统对特定分段的TCP 数据报文的不同反应i
来区分不同的操作系统及其版本信息。NMAP (http://insecure.org/nmap) 是一个典型的~千该
探测技术的操作系统探测工具。
3. ICMP 响应分析探测技术
ICMP 响应分析探测技术是一种较新的操作系统探测技术。该技术通过发送UDP 或
ICMP 的请求报文，然后分析各种ICMP 应答信息来判断操作系统的类型及其版＊~息。
XProbe (http://sourceforge.net/projects/xprobe) 就是采用该技术的操作系统探测工具。
7.2.3 安全漏洞探测技术
安全漏洞探测是采用各种方法对目标可能存在的已知安全漏洞进行逐项检查。~淮］拚漳l
可以分为两种：从系统内部探测一系统管理员做安全检查；从外部进行探测一一一~似吁二攻
击者的漏洞扫描。本节主要介绍从外部进行漏洞探测。
按照网络安全漏洞的可利用方式来划分，漏洞探测技术可以分为信息型漏洞探测和攻：击
型漏洞探测两种。按照漏洞探测的技术特征，又可以划分为基于应用的探测技术、基千.±.析庄的
探测技术、基千目标的探测技术和基千网络的探测技术等。
1. 信息型漏洞探测
大部分的网络安全漏洞都与特定的目标状态，如目标设备的型号、目标运行的操作系统
202
第7 章网络安全检测与评估技术
版本及补丁安装情况、目标的配置情况，以及运行服务及其服务程序版本等因素直接相关，因
此只要对目标的此类信息进行准确探测就可以在很大程度上确定目标存在的安全漏洞。该技术
具有实现方便、对目标不产生破坏性影响的特点，广泛应用千各类网络安全漏洞扫描软件。其
不足之处是对某个具体漏洞存在与否难以做出确定性的结论，这主要是因为该技术在本质上是
一种间接探测技术，探测过程中某些不确定因素的影响无法完全消除。
为了进一步提高漏洞探测的准确率和效率，许多改进措施也不断地被引入。
顺序扫描技术可以将收集到的漏洞和信息用于另一个扫描过程，以进行更深层次的扫
描，即以并行方式收集漏洞信息，然后在多个组件之间共享这些信息。此扫描方式可以实现边
扫描边学习的扫描过程，可进行更为彻底的探测，更为深入地发现网络中的漏洞，从而真正做
到了对安全漏洞的“先知先觉”。
多重服务检测技术，即不按照RFC 所指定的端口号来区分目标主机所运行的服务（即不
认为80 端口”一定”运行http 服务），而是按照服务本身的真实响应来做识别服务类型的标
准。例如，当在一台Web 服务器上运行两个http 服务（一个监听80 端口，另一个监听8080
端口）时，探测过程将能够识别出两个端口，并执行相同的安全扫描过程。
2. 攻击型漏洞探测
模拟攻击是最直接的漏洞探测技术，其探测结果的准确率也是最高的。该探测技术的主
要思想是模拟网络入侵的一般过程，对目标系统进行无恶意攻击尝试，若攻击成功则表明相应
的安全漏洞必然存在。
模拟攻击技术也有其局限性。首先模拟攻击行为难以做到面面俱到，因此就有可能存在
一些漏洞无法探测到；其次模拟攻击过程不可能做到完全没有破坏性，对目标系统不可避免地
会带来一定负面影响。
模拟攻击主要通过专用攻击脚本语言、通用程序设计语言和成形的攻击工具来进行。
3. 漏洞探测技术特征分类
1) 基于应用的检测技术，它采用被动的、非破坏性的方法检查应用软件包的设置，发现
安全漏洞。
2) 基千主机的检测技术，它采用被动的、非破坏性的方法对系统进行检测。通常，它涉
及系统的内核、文件的属性及操作系统的补丁等问题。这种技术还包括口令解密，把一些简单
的口令剔除。因此，这种技术可以非常准确地定位系统的问题，发现系统的漏洞。它的缺点是
与平台相关，升级复杂。
3) 基千目标的漏涧检测技术，它采用被动的、非破坏性的方法检查系统属性和文件属
性，如数据库、注册号等。通过消息文摘算法，对文件的加密数进行检验。这种技术的实现是
运行在一个闭环上，不断地处理文件、系统目标和系统目标属性，然后产生检验数，把这些检
验数同原来的检验数比较。一旦发现改变就通知管理员。
4) 基于网络的检测技术，它采用积极的、非破坏性的方法来检验系统是否有可能被攻击
崩溃。它利用了一系列的脚本模拟对系统进行攻击的行为，然后对结果进行分析。它还针对已
知的网络漏洞进行检验。网络检测技术常被用来进行穿透实验和安全审计。这种技术可以发现
一系列平台的漏洞，也容易安装。但是，它可能会影响网络的性能。
在实际进行网络安全漏洞探测时，通常需要综合以上4 种探测技术的优点，才能够最大
限度地增强漏洞识别的精度。
203
计算机网络安全教程第4 版
7.3 网络安全评估标准
7.3.1 网络安全评估标准的发展历程
标准是评估的灵魂，作为一种依据和尺度，没有标准就没有准确可靠的评估。在信息安
全这一特殊的高技术领域，没有标准，国家有关的立法执法就会因缺乏相应的技术尺度而失之
偏颇，最终会给国家信息安全的管理带来严重后果。一般说来，完整的评估标准应涵盖方法、
手段和途径。
国际上信息安全测评标准的发展经历了以下几个阶段。
1. 首创而孤立的阶段
根据国防信息系统的保密需要，美国国防部首次于1983 年开发了《可信计算机系统安全
评估准则》，简称为TCSEC (Trusted Computer System Evaluation Criteria) 。1985 年TCSEC 经
修改后正式发布，由千采用了橘色书皮，人们通常称其为橘皮书。后来在美国国防部国家计算
机安全中心CNCSC) 的主持下制定出了一系列相关准则，每本书使用不同颜色的书皮，称之
为彩虹系列。
这些准则从用户登录、授权管理、访问控制、审计踪迹、隐通道分析、可信通道建~、
安全检测、生命周期保障、文本写作和用户指南等方面均提出了规范性要求。而且，准则根
据所采用的安全策略和系统所具备的安全功能将系统分为4 类7 个安全级别。这7 个级别如
表7-6 所示。
表7-6 TCSEC 的安全级别
类别级别名称主要特征
A A 验证设计级
形式化的最高级描述和验证，形式化的隐蔽通道分析，非形式
化的代码一致性证明
B3 安全域级安全内核，访问控制具有高抗渗透能力
面向安全的体系结构，遵循最小授权原则，有较好的抗渗透能
B B2 结构化安全保护级力，对所有的主体和客体提供访问控制保护，对系统进行隐蔽通
道分析
B1 标记安全保护级在C2 安全级的基础上增加安全策略模型，对数据进行标ia
C2 访问控制环境保护级以用户为单位进行广泛的审计
C 有选择的访问控制，用户与数据分离，数据以用户组为单位进
Cl 选择性安全保护级
行保护
D D 最低安全保护级保护措施很少，相当千没有安全功能的个人计算机
TCSEC 第一次采用了公正的第三方，利用技术分析和测试手段，获取证据来证明开发者
正确有效地实现了标准要求的安全功能。它运用的主要安全策略是访问控制机制，考虑的安全
问题大体上局限于信息的保密性，所依据的安全模型则是Bell & Lapadula 模型，该模型所制
定的最重要的安全准则严禁上读下写所针对的就是信息的保密要求。
TCSEC 最主要的不足是其仅针对操作系统的评估，而且只考虑了保密性需求，但它极大
推动了国际计算机安全的评估研究，使安全信息系统评估准则的研究进入了第二个阶段。
2. 普及而分散的阶段
欧洲各国不甘落后于美国，曾纷纷模仿TCSEC, 先后制定了各国自己的评估标准。德国
204
笫7 章网络安全检测与评估技术
信息安全局在1990 年发出号召，与英、法、荷一起迈开了联合制定评估标准的步伐。终于推
出了《信息技术安全评估标准》，简称ITSEC 。除了吸取TCSEC 的成功经验外， ITSEC 首次
提出了信息安全的保密性、完整性、可用性的概念，把可信计算机的概念提高到可信信息技术
的高度上认识。他们的工作成为欧共体信息安全计划的基础，并对国际信息安全的研究实施带
来了深刻的影响。
ITSEC 也定义了7 个安全级别，即E6: 形式化验证； E5 ：形式化分析； E4: 半形式
化分析； E3: 数字化测试分析； E2: 数字化测试； El: 功能测试； EO: 不能充分满足
保证。
加拿大也在同期制定了《加拿大计算机产品评估准则》的第一版，称为CTCPEC 。其第
三版千1993 年公布，吸取了ITSEC 和TCSEC 的长处，并将安全清晰地分为功能性要求和保
证性要求两部分。
上述这两个安全性测评准则不仅包含了对计算机操作系统的评估，还包含了现代信息网
络系统所包含的通信网络和数据库方面的安全性评估准则。
美国政府在此期间并没有停止对评估准则的研究，于1993 年公开发布了《联邦准则》的
1.0 版草案，简称FC 。在FC 中首次引入了保护轮廓(PP) 的重要概念，每一保护轮廓都包括
功能部分、开发保证部分和测评部分。其分级方式与TCSEC 不同，而是充分吸取了ITSEC 和
CTCPEC 的优点，供民用及政府商业使用。
总的来说，这一阶段的安全性评估准则不仅全面包含了现代信息网络系统的整体安全
性，而且内容也有了很大的扩展，不再局限千安全功能要求，增加了开发保证要求和评估（分
析、测试）要求。但这些标准分散于各国，度量标准也不尽相同，这客观上阻碍了信息安全保
障的国际合作和交流。统一的安全评估准则呼之欲出。
3. 集中统一阶段
为了能集中世界各国安全评估准则的优点，集合成单一的、能被广泛接受的信息技
术评估准则，国际标准化组织在1990 年就开始着手编写国际性评估准则，但由于任务庞
大及协调困难，该工作一度进展缓慢。直到1993 年6 月，在6 国7 方（英、加、法、
德、荷、美国国家安全局及国家标准技术研究所）的合作下，前述的几个评估标准终千
走到了一起，形成了《信息技术安全通用评估准则》，简称CC 。CC 的0.9 版千1994 年
问世，而1.0 版则千1996 年出版。1997 年有关方面提交了CC 的2.0 版的草案版， 1998
年正式发行， 1999 年发行了现在的CC2.l 版，后者于1999 年12 月被ISO 批准为国际标
准编号1S0/IEC 15408 。至此，国际上统一度量安全性的评估准则宣告形成。CC 吸收了
各先进国家对现代信息系统安全的经验和知识，对信息安全的研究与应用带来了深刻
影响。
CC 的评估等级共分7 级： EAL1,...., EAL 7, 分别为功能测试，结构测试，系统测试和检
验，系统设计、测试和评审，半形式化设计和测试，半形式化验证的设计和测试，以及形式化
验证的设计和测试。
图7-1 描述了安全信息系统评估准则的发展史，包括各准则的衍生关系。表7-7 对
上述各标准的等级对照关系做了说明。为了便千参照，同时对比了我国于1999 年发布，
2001 年1 月1 日开始执行的国家标准《计算机信息系统安全保护等级划分准则》，简称
GB 17859 。
205
1985 年美国可信计
算机系统评估准则
(TCSEC)
计算机网络安全教程笫4 版
1991 年欧洲信息技
术安全评估准则
(ITSEC)
1990 年加拿大可信
计算机产品评估准则
CTCPEC
1991 年美国联邦
准则(FC)
图7-1 评估标准的发展
1996 年国际通用准
则(CC)
1 999 年国际标准
ISO 15408
需要指出的是，对千这样的一个对照关系，只能认为是大致和模糊的，有很多专~对此
有不同的意见。主要原因在千TCSEC 只关注保密性，因此与其他标准对安全性的要~＊~寸月
同，不可在一起对比。但该表确实可以使人们对各标准的等级对照形成基本的认识，可以fi=为
重要的参考。
表7-7 各标准的等级划分对照
CC TCSEC FC ITSEC
... D EO
EALl ... ...
EAL2 Cl El
EAL3 C2 Tl E2
EAIA Bl 'T2 E3
... ... T3 ...
... ... T4 ...
EALS B2 TS 囡
EAL6 B3 T6 E5
EAL7 A T7 E6
7.3.2 TCSEC 、ITSEC 和CC 的基本构成
1. TCSEC
CTCPEC
TO
Tl
T2
T3
T4
...
...
T5
T6
T7
0B17859-1999
...
1 : 用户自主保护
2: 系统审计保护
3：安全标记保护
4: 邮变化铝
...
...
5: 访问验证保护
...
...
TCSEC 可以从安全策略模型、可追究性(Accountability ）、保证(Assurance) 和文档
(Documentation) 4 个方面进行描述。
l) 安全策略模型一一Bl 级与Bl 级以下的安全测评级别，其安全策略模型是非形~化；定
义的。从B2 级开始，其安全策略模型是更加严格的形式化定义，甚至引用形式化验证方沼;o
最早的形式化安全模型是BELL-LAPADULA 状态转移模型。安全策略制定的基础是所~的可
信计算机基(TCB) 结构。TCSEC 在测评标准上给出了11 个安全策略内容。其中以自主~问
控制(DAC) （在C 级及以上级别采用的）、客体重用、标识（有8 个）和强制访问控制
(MAC) (B 级及以上级别采用）作为主要特征。
206
第7 章网络安全检测与评估技术
2) 可追究性一－在TCSEC 测评标准上给出了3 个可追究性特性，分别是识别与授权、
审计和可信通路。
3) 保证一在TCSEC 测评标准上给出了9 个安全保证特性，主要解决安全测试验证分
析等特性。
4) 文档一在TCSEC 测评标准上还给出了对文档的要求。
应当说明的是， C2 级对千一般意义上的攻击具有一定的抵抗能力， Bl 级对于一般意义上
的攻击有较高的抵抗能力，而对千抵抗高威胁的渗透侵入能力还是较低的， B2 级有一定的抵
抗高威胁的渗透侵入能力， B3 级有较高的抵抗高威胁的渗透侵入能力。
TCSEC 是第一代的安全评估标准，它有其不足，但这并不是意味着人们不去继承它。目
前，不止我国，即使在世界上也都存在着对TCSEC 与CC 优劣的争论，有很多还未达成一致
性意见。以下是当前已得到公认的对TCSEC 的局限性的认识。
1) TCSEC 是针对建立无漏洞和非侵入系统制定的分级标准。TCSEC 的安全模型不是基
千时间的，而是基千功能、角色和规则等空间与功能概念意义上的安全模型。安全概念仅仅是
为了防护，对防护的安全功能如何检查，以及检查出的安全漏洞又如何弥补和反应等问题没有
讨论和研究。
2) TCSEC 是针对单一计算机，特别是针对小型计算机和主机结构的大型计算机制定的测
评标准。TCSEC 的网络解释目前缺少成功的实践支持，尤其对于互连网络和商用网络很少有
成功的实例支持。
3) TCSEC 主要用千军事和政府信息系统，对于个人和商用系统采用这个方案是有困难
的。也就是说其安全性主要是针对保密性而制定的，而对完整性和可用性研究得不够，忽略了
不同行业的计算机应用的安全性的差别。
4) 安全的本质之一是管理，而TCSEC 缺少对管理的讨论。
5) TCSEC 的安全策略也是固定的，缺少安全威胁的针对性，其安全策略不能针对不同的
安全威胁实施相应的组合。
6) TCSEC 的安全概念脱离了对1T 和非1T 环境的讨论，如果不能把安全功能与安全环境
相结合，那么安全建设就是抽象的和非实际的。
7) 美国NSA 测评一个安全操作系统需要花费1~2 年以上的时间，这个时间已经超过目
前一代信息技术的发展时间，也就是说TCSEC 测评的可操作性较差，缺少测评方法框架和具
体标准的支持。
2. ITSEC
以ITSEC 为代表的20 世纪90 年代初的一批评估标准对后来的CC 产生了重要影响。
ITSEC 千1991 年得到批准发布，在此之后，进一步的细则仍不断制定。在相当长的时间内，
它是欧洲信息安全评估的主要依据。
ITSEC 的安全功能分类为：标识与鉴别、访问控制、可追究性、审计、客体重用、精确
性、服务可靠性和数据交换。其保证准则分为；有效性(Effectiveness) 和正确性
(Co盯ectness) 。有效性准则从结构(Cons皿ction) 和操作(Operation) 两方面体现。结构准则
要求中，包括功能的适用性、功能捆绑、机制强度和结构脆弱性评估。操作准则可划分成两个
方面：易用性和操作脆弱性评估。
欧盟曾在1997 年发布了ITSEC 评估互认可协定，并在1999 年4 月协定修改后发布了新
的互认可协定第二版。目前，签署双方承担义务井相互承认的是英国、法国和德国，接受这3
207
计算机网络安全教程笫4 版
个国家的评估结果的有芬兰、希腊、荷兰、挪威、西班牙、瑞典及瑞士。
ITSEC 的生命力很强，其系列文档（细则）一直在以UKSPXX (United Kingdom ITSEC
Scheme Publication) 为编号不断制定。甚至其1996 年发布的基础性文件UKSPOl 《框架描
述》在2000 年2 月又重新进行了第4 版修订，最大的改动是增加了对CC 最新动态的反应。
3. cc
CC 最早引入中国时，由千当时与国外相比起步晚，对CC 早期版本的消化历经了较漫长
的过程。如今，作为ISO/IEC 15408 的CC 已经被引为国家标准GB厅18336, 并已成为国家信
息安全测评认证中心的测评依据。
CC 分为3 部分，相互依存，缺一不可。第1 部分介绍CC 的基本概念和基本原理，第2
部分提出了安全功能要求，第3 部分提出了非技术的安全保证要求。CC 将安全要求~~了安
全功能要求，以及用来解决如何正确有效地实施这些功能的保证要求，这是从ITSEC 和
CTCPEC 中吸收的，同时CC 也还从FC 中吸收了保护轮廓(pp) 的概念。
CC 的功能要求和保证要求均以类－族－组件（ Class-Family-Component) 的结构表述。功能
要求包括12 个功能类（安全审计、通信、密码支持、用户数据保护、标识和鉴别、安全：管
理、隐秘、TSF 保护、资源利用、TOE 访问、可信路径、信道），保证要求包括7 个保证类
（配置管理、交付和运行、开发、指导性文件、生命周期支持、测试、脆弱性评定）。
CC 将通过对安全保证功能的评估划分安全等级，每一等级对保证功能的要求各不柱i 同。
安全等级增强时，对保证功能组件的数目或者同一保证功能的强度的要求会增加。CC 的结i构
关系如图7-2 所示。
保证要求
评估保证级l
评估保证级2
评估保证级3
...
评估保证级n
选择性扩充（非CC) 安全要求
图7-2 cc 结构关系图
保护轮廓(PP)
基于一类TOE 的应用环境规定一组
安全要求，井提出应达到哪一评估
保证级要求
安全目标(ST)
基于某一特定TOE 的实现，提出一
组安全要求及其具体实现，以及可以
达到的评估保证级。可以满足一个或
多个PP 提出的要求，也可以在PP
的基础上增加CC 要求或其他非CC
要求
评估保证级是评估保证要求的一种特定组合一－保证包，是度量保证措施的一~尺匾度5
208
笫7 章网络安全检测与评估技术
这种尺度的确定权衡了所获得的保证级，以及达到该保证级所需的代价和可能性。
在CC 中定义了7 个递增的评估保证级，这种递增靠替换成同一保证子类中的一个更高级
别的保证组件（即增加严格性、范围或深度）和添加另外一个保证子类的保证组件（如添加新
的要求）来实现。
以下是7 个评估保证级别的介绍。
(1) EALl —功能测试
EALl 适用于对正确运行需要一定信任的场合，但在该场合中对安全的威胁应视为并不严
重；还适用于需要独立的保证来支持“认为在人员或信息的保护方面已经给予足够的重视“ 这
一情形。
该级依据一个规范的独立性测试和对所提供指导性文档的检查来为用户评估TOE （评估
对象）。在该级上， 没有TOE 开发者的帮助也能成功地进行评估，并且所需费用也最少。通过
该级的一个评估，可以确信TOE 的功能与其文档在形式上是一致的，并且对已标识的威胁提
供了有效的保护。
(2) EAL2 —结构测试
EAL2 要求开发者递交设计信息和测试结果，但不需要开发者增加过多的费用或时间的
投入。
EAL2 适用千以下这种情况： 在缺乏现成可用的完整的开发记录时，开发者或用户需要一
种低到中等级别的独立保证的安全性，例如对传统的保密系统进行评估或者不便千对开发者进
行现场核查时。
(3) EAL3 一系统测试和检查
在不需要对现有的合理的开发规则进行实质改进的情况下， EAL3 可使开发者在设计阶段
能从正确的安全工程中获得最大限度的保证。
EAL3 适用于以下这些情况：开发者或用户需要一个中等级别的独立保证的安全性，并在
不带来大董的再构建费用的情况下，对TOE 及其开发过程进行彻底审查。
开展该级的评估，需要分析基千“灰盒子”的测试结果、开发者测试结果的选择性独立
确认，以及开发者搜索已知脆弱性的证据等。还要求使用开发环境控制措施、TOE 的配置管
理和安全交付程序。
(4) EAIA 一系统设计、测试和复查
基千良好而严格的商业开发规则，在无须额外增加大量专业知识、技巧和其他资源的情
况下，开发者从正确的安全工程中所获得的保证级别最高可达到EAIA。在现有条件下，只对
一个已经存在的生产线进行改进时， EAIA 是所能达到的最高级别。
EAIA 适用于以下这种情况：开发者或用户对传统的商品化的TOE 需要一个中等到高等
级别的独立保证的安全性，并准备负担额外的安全专用工程费用。
开展该级的评估，需要分析TOE 模块的底层设计和实现的子集。在测试方面将侧重千对
已知的脆弱性进行独立搜索。在开发控制方面涉及生命周期模型、开发工具标识和自动化配置
管理等方面。
(5) EALS —半形式化设计和测试
适当应用一些专业性的安全工程技术，并基于严格的商业开发实践， EAL5 可使开发者从
安全工程中获得最大限度的保证。如果某个TOE 要想达到EAL5 的要求，开发者需要在设计
和开发方面下一定的工夫，但如果具备一些相关的专业技术，也许额外的开销不会很大。
209
计算机网络安全教程笫4 版
EAL5 适用于以下这种情况：开发者和使用者在有计划的开发中，采用严格的开发手~，
以获得一个高级别的独立保证的安全性需要，但不会因采取专业性安全工程技术而增加一些不
合理的开销。
开展该级的评估，需要分析所有的实现。还需要额外分析功能规范和高层设计的形式化
模型和半形式化表示，以及它们之间对应性的半形式化论证。在对已知脆弱性的搜索方面，必
须确保TOE 可抵御中等攻击潜力的穿透性攻击者。还要求采取隐蔽信道分析和模块化的TOE
设计。
(6) E心一半形式化验证的设计和测试
EAL6 可使开发者通过把专业性安全工程技术应用到严格的开发环境中，而获得高级别的
保证，以便生产一个昂贵的TOE (TCP 卸载引擎）来保护高价值的资产以对抗重大的风险。
因此EAL6 适用千将用在高风险环境下的特定安全产品或系统的开发，且要保护的资源
值得花费一些额外的人力、物力和财力。
开展该级的评估，需要分析设计的模块和层次化方法，以及实现的机构化表示。在对·己
知脆弱性的独立搜索方面，必须确保TOE 可抵御高等级攻击潜力的穿透性攻击者。对隐蔽信
道的搜索也必须是系统性的，且开发环境和配置管理的控制也应进一步增强。
(7) EAL7 晒—形式化验证的设计和测试
EAL7 适用于安全性要求很高的TOE 开发，这些TOE 将应用在风险非常高的地方或者所
保护资产价值很高的地方。目前，该级别的TOE 比较少，一方面是对安全功能全面的形式化
分析难以实现，另一方面在实际应用中也很少有这类需求。
开展该级的评估，需要分析TOE 的形式化模型，包括功能规范和高层设计的形式化表
示。要求开发者提供基千“白盒子”测试的证据，在评估时必须对这些测试结果全部进行独~立
确认，并且设计的复杂程度必须是最小的。
CC 的先进性体现在以下几个方面。
l) 适用于各类1T 产品的评估，并且全面考虑了信息安全中的保密性、完整性、可用性
及不可否认性概念，突出了安全保证的重要性，与信息保障概念的发展一致。
2) 开放性。安全功能要求和安全保证要求都可以在具体的“保护轮廓”和“安全目~＂
中进一步细化和扩展。比如，在基于CC 制定防火墙的评估标准时，就可以加入对VPN 功能
的要求。这便增加了CC 的适用性，同时保证了CC 能够与时俱进。
3) 语言的通用性。所有的目标读者都可以理解和接受CC 的语言，使得互认成为可能。
当然，这种通用性是靠高度精练的对安全的描述来实现的，如果没有保护轮廓，则有可能适得
其反，通用性也会导致晦涩性。
4) 保护轮廓和安全目标的引入在通用安全要求与具体的安全要求之间架起了桥梁，以用
户需求为中心的保护轮廓突出体现了安全以需求为目的的宗旨。
7.4 网络安全评估方法
7A.1 基千通用评估方法(CEM) 的网络安创忏谦型
CC 作为通用评估准则，本身并不涉及具体的评估方法，信息技术的评估方法论主要由CEM
给出。CEM 主要包括评估的一般原则I pp 评估、ST 评估和EALl~EAIA 的评估。CEM 与CC
中的保证要求相对应，但CEM 不涉及互认方面的有关安排。目前CEM 中还不包括与通用准则
210
第7 章网络安全检测与评估技术
(CC) 中评估保证级别EAL5,....,EAL7、ALC 、FLR 和AMA 类相关的评估活动。
CEM 是实施信息技术安全评估工作的评估人员在评估时遵循的工作方面，但对从事信息
安全产品或系统集成的开发人员、评估申请者，以及评估认证机构的相关工作人员也有很重要
的参考价值。
CEM 由两部分组成：第一部分为简介与一般模型，包括评估的一般原则、评估过程中的
角色、评估全过程概况和相关术语解释；第二部分为评估方法，详细介绍适千所有评估的通用
评估任务、PP 评估、ST 评估、EALI,....,EAIA 评估及评估过程中使用的一般技术。第二部分按
照EAL 来组织，只涉及保证要求对应的评估活动，以工作单元的形式进行描述，即评估人员
在评估时应执行什么动作。
按CEM 进行评估，在评估过程中至少有4 种角色值得重视。这4 种角色分别是：评估申
请者、开发人员、评估人员和评估认证机构。评估申请者申请评估，是评估任务的来源，在评
估过程中负责收集评估所需的评估证据。开发人员可能是TOE 的开发制造者或系统集成商，
也可能是PP 的制定者。开发人员可能参与评估活动，但评估证据最终由开发人员提供。评估
人员的责任是接收来自评估申请者的评估证据，执行具体的评估动作，确定每层次的裁决结
果，整理评估结论并证明其正确性。评估认证机构在评估过程中扮演监督和管理者的角色，其
任务是建立评估体制，监督评估过程。
1. CEM 评估的一般原则
CEM 评估应该遵循适当、公正、客观的原则，要求评估结果满足可重复和可再现的特
点，且评估结果是可靠的。CEM 假定代价合理，方法可以不断演进，评估结果可重用。
2. 评估模型
采用CEM 进行的评估，都可用图7-3 中的模型来表示。
图7-3 通用评估模型
从该模型可以看出，评估员按CEM 执行任何一项信息技术安全产品或系统（也可以是
PP) 的评估任务，都包括3 个环节，即评估输入任务、一组评估活动和评估输出任务（即两
项任务、一组活动）。
3. 评估任务
CEM 中所有的评估都具备的评估任务是评估输入任务和评估输出任务（如上述评估模型
中所述）。CC 中没有对这些任务的要求，是CEM 为确保评估的一致性及代价的合理而增加的
要求。评估输入任务和评估输出任务都进一步细分有子任务。对这些任务和子任务，在评估时
没有也不需要做出“通过”或“失败”这样的裁决结论。
评估输入任务主要是针对评估证据的管理，而评估输出任务主要是面向报告的生成。
评估输入任务包括配置控制、证据的保护、处置和保密4 个任务，其中CEM 对后两个任
务无要求，留给评估体制解决。评估输入任务的目的是确保评估员拥有正确版本的评估证据，
确保评估证据得到适当的保护。
211
计算机网络安全教程笫4 版
评估输出任务包括编写观察报告(OR) 和编写评估技术报告(ETR) 两个子任务，其目
的是报告与评估结果，用来在评估过程中所涉及的各个角色间交流信息。
编写观察报告(OR) 子任务的目的是报告评估中的问题，如裁决失败、缺少评估证据或
评估证据不明确或不正确等，也可用千请求澄清问题， 如请求澄消准则要求、PP 或TOE 某；方
面的内容等。
编写评估技术报告(ETR) 子任务的目的是报告评估结果，证明裁决结论的正确性。编写
评估技术报告(ETR) 子任务产生的报告(ETR) 有两种类型： PP 或TOE ( ST 评估作为
TOE 评估的一部分，无独立的对应千ST 的ETR) 。ETR 作为对总的评估结果的系统概括，其
包含的内容一般有： ETR 自身的介绍、TOE 结构描述、评估、评估结果、结论和建议、i平~甘
证据清单、缩略语，以及词汇表和观察报告。
4. 评估活动
CEM 的核心是围绕CEM 进行评估活动，任何一个信息技术安全产品或系统（也可以
是PP) 的评估，其核心是评估人员展开的一组评估活动。每一项评估活动可进一步~分另3
子活动，子活动又进一步细分为动作，而每一个动作又由一个或多个确定的工作单.jc组．
成，如图7-4 所示。
TOE 评估评估活动
@
＠—-4@ 子活动
@
@——@ 动作
@
＠－~工作单元
@——@--@
@--@
@--@
图7-4 评估活动的分解
由千评估对象(pp 或TOE) 和评估保证级别EALl~EAIA 的不同，评估活动也会有所不同。
CEM 中的评估活动、子活动、动作和工作单元与CC 中保证类、组件和元素间的对应关
系如图7--5 所示。
212
通用准则(CC)
保证类
保证组件
评估员动作元素
证据的内容与
表示元素
通用评估方法(CEM )
r
活动
子活动
动作
工作单元
图7-5 CEM 评估活动与CC 保障要求的对应关系
笫7 章网络安全检测与评估技术
5．评估结果
评估人员在评估过程中，需要做出不同层次的裁决，评估人员的裁决可以有3 种的结
果，分别为不确定、通过和失败。评估人员做出裁决的原则是：对每个明确的或导出的评
估人员动作元素提出不确定、通过或失败裁决；所有裁决最初都是“不确定”的；如果评
估人员动作组成部分的任何一个未完成，则总的裁决就是不确定的；如果评估人员动作的
所有组成部分都完成且所有要求都得到满足，则总的裁决就是通过；如果评估人员动作的
所有组成部分都完成且有一个或多个要求不满足，则总的裁决就是失败。简单地说，也就
是评估人员的裁决是在从下到上，即工作单元、动作元素、子活动和活动4 个层次上进行
的，高层裁决取决千低层裁决，相当千一票否决，即低层裁决若有一个失败，则对应的高
层裁决结论也是失败的。
7.4.2 基千指标分析的网络安全综合评估模型
1. 综合评估概要
现实中的目标网络系统，其安全性涉及多方面的因素。为了全面了解目标网络系统的
安全性能的状况，需要对各个方面的指标或项目进行测试或评估，每个项目都从一定的侧
面反映目标系统的安全性能或对目标系统安全性能的影响，但任何一个项目都无法完全反
映目标系统的整体安全性能。对实际的计算机网络信息系统进行安全评估时，必须将全体
评估项目的评估结果进行综合，才能得到关千目标网络信息系统的安全性能的最终评价。
为达到最终的评估目标，除需要合理地选取评估项目和评估指标、准确地评估每个项目
外，还必须仔细考察项目间的关系，从而确定综合评估结果。综合评价必须尽可能客观，
尽可能减少主观判断造成的影响。
假设计算机网络信息系统安全评估工作开始于一个选定的评估预案，评估预案的制定由
计算机网络安全评估系统提供，这里设为C1,C2, …， Ck 。若C1(l~s~k) 为选定的评估预案，
则对千该次具体的安全评估行为，计算机网络安全评估系统将依据cs 所指定的评估项目执行
相应的评估动作。对于每一个具体选定的安全评估预案，其评估效果分别对应千被评估目标系
统的一系列评估项。计算机网络安全评估系统经过具体的评估活动，对每个评估项都将得出一
个评估结论。每一个具体的评估项都是对被评估目标网络系统局部特征的反映，这些评估项可
能具有不同的特点，有的评估是定量的，如系统的某些性能指标方面的项目，有的评估项是定
性的，如反映系统的功能特性和运行管理特性方面的项目。评估的目的是为了得到对被评估的
目标网络系统的整体安全情况的综合认识，因此需要对这些评估项进行综合，综合的结果将真
实反映评估预案Cs 的评估效果。
为完成网络系统安全状况的综合评估，首先要从最低层的项目入手，确定每个评估项的
状况，然后由低到高，确定每个层次项目的评估结果，最后将第一层项目的评估结果综合在
一起，得出目标网络系统安全状况的综合评估结果。为进行每个层次的评估，评估系统可以
通过各种方式获取各个评估项目的测试结果数据，并最终以定性或定量的形式给出对各个具
体评估项的评价结果。对同一层次上的（局部的）评估项的评估结果的综合，可以有多种方
法，如采用加权平均、模糊综合评价等。加权平均方法比较适合千处理定量评估项，而模糊
评价比较适合千定性评估项。为了使用加权平均进行结果综合，需要对不同性质的各个定量
213
计算机网络安全教程笫4 版
评估项预先进行归一化处理。对千同一层次上既有定性评估项又有定量评估项的情况，评估
结果的综合可以视具体情况决定采用什么样的综合方法。若采用加权平均，则需要把定性评
估项的评估结果进行量化和归一化；若采用模糊综合评价，则需把定量评估项的评估结果转
换为模糊评价的隶属度。
2｀ 归一化处理
(1) 定量指标的归一化
某些评估项的评估结果是一个数值，如系统的性能特征。对这些评估项的结果需要进行
归一化处理，以便结果综合时使用。下面以一个简单实例说明定量指标的归一化问题，但~归
一化方法的研究不是本课题的重点。
在一个网络环境中，支持网络互联的路由器对网络的整体性能起着关键的作用。如何评
价路由器的性能是一个值得研究的课题。RFC1242 和RFC1544 中定义了一组测试，用来亥l画
路由器的性能特点，这些测试项包括吞吐量、丢包率、延时、背靠背、系统恢复时间和复~时
间等。许多因素，如广播帧、管理帧和路由更新帧等都会影响到这些参数的测试结果。除~~
各种各样的帧外，其他如过滤器、NAT、M九］不匹配、链路速率不匹配和网络攻击等也~~
响到路由器的性能。所以使用个别描述路由器在一种条件下的性能的参数描述路由器的总体：~
能是不合适的。为将这些指标进行综合，以描述路由器的整体性能，首先要对单个项目做归一
化处理。
有许多方法可对定量测试结果进行归一化处理，这些方法大致可分成3 类： ＠线段：；
＠折线； ＠曲线。使用哪一种方法做归一化处理取决千具体的测试项的特点，适用千~一·
测试项的归一化方法不一定适用于其他项目。下面仅举例说明路由器的吞吐量、延迟、~
包率和背靠背这些指标的归一化处理方法。
l) 吞吐量的归一化：路由器的网络接口速率范围很宽，最典型的是10/IOOM 自适应以太
网接口。为简便起见，设Tm表示接口可达到的最大速率，则一种归一化方法如下。
T一亡
t = (7-1)
其中， T 是测得的吞吐量， t 是T 的归一化表示。式(7-1) 展示的是T 和t 间的线性~
系，吞吐量越大，归一化值就越大。
为了更好地展示吞吐量的实际值的含义，便用曲线方法将测得的吞吐量加以归一化可能
更好一些，即：
t=l-e -kT2 (7-2)
其中， k>O 是一个适当选择的常数， O~T~Tm, 且O~t<l 。
图7-6 显示出从T 到t 的变换，其中图7-6a 是采用线段的变换，图7-6b 表示使用曲线的
变换。从图7-6b 可知，当吞吐量的实测值在较小（接近千0) 或很大（接近T心附~~~
时，从式（7-2) 得到的归一化值将比落在曲线中间附近时的吞吐量实测值得到的归一~~变：
化慢。也就是说，当吞吐量位于接口速率的中间值附近时，吞吐量的增加或减少将比吞吐~~
在高端或低端的同样数量的增加或减少导致更多的评价意义。因此使用曲线归一化处理~~~
更能反映实际情况。
214
笫7 章网络安全检测与评估技术
t
。
Tm
T
。
b)
Tm
T
a)
图7-6 吞吐鱼的归一化
2) 延迟的归一化：与吞吐量的归一化类似，延迟的归一化也可采用两种方法。一种是采
用折线， 一种是采用曲线，归一化公式见式(7-3) 和式(7-4)。图7-7a 和图7-7b 分别显示
了两种不同的归一化变换。
'L,< LL>oLo
尸
-- (7-3)
或
丛古）L 飞L。,L~L。
(7-4)
,L>L。
。
T
。
T
a)
Lo Lo 切
图7-7 延迟的归一化
其中1 表示延迟的归一化值， L 是实际测得的延迟。式(7-3) 中， Lo 的确定，应使得当
实际延迟大于Lo 时，对路由器来说延迟就太长了，仅靠延迟一项就可以说该路由器很糟糕，
所以当测得的延迟数据超过Lo 时，归一化延迟的值定为0。式(7-4) 使用线段和曲线完成变
换。从图7-7b 可看出，当延迟的实测值L 大于Lo （这时的归一化值为¾>)时，随着L 的增
加，归一化的值1 逐渐接近0。
3) 丢包率的归一化：丢包率可使用式(7-5) 和式(7-6) 归一化。图7-8a 和图7-8b 分别
描述了两种变换方法。这里不再做更多的解释。
p= 100-P
100
(7-5)
或
215
计算机网络安全教程第4 版
p=e-kP'(k>O) (7-6)
p p
。
100
p
。
100
p
a)
切
图7-8 丢包率的归一化
其中， P 是实际测得的丢包率， p 是丢包率的归一化值， k (k>O) 是一个适当选非圣的
常数。
4) 背靠背的归一化：背靠背的归一化可使用式(7-7) 和式(7-8) 计算。图7-9 给管出了
描述。
b=｛飞＇，职B。
B>B。
(7-7)
或
b=l-e -kB2 ( 7-8)
b b
a)
B。
B 。
B
切
B。
图7-9 背靠背的归一化
其中， B 表示实际测试得到的背靠背值， b 是背靠背的归一化值， B。和k (>O) ~适：当
选择的常数。
5) 其他参数（测试项）的归一化：除反映系统某一方面性能的关键路由器外，系统性育它还；
可能涉及其他网络设备及反映系统整体性能的不同性能指标。这些指标的归一化处理应~拒抹目
应测试项的性质而定。
(2) 定性评估项的量化和归一化
定性评估项的结果通常以等级的形式给出，最简单的定性评估结果是“是＂或“否“， 最：
常见的定性指标结果表示方式通常是一个有序的名称集，如很差、较差、一般、较好和很女子。
在系统安全状况的评估上，对于定性的评估项，就可以采用这些表示方式。
对千定性评估项的最简单的定性评估结果， 即评估结果为“是”或“否”的情况，量才七
和归一化可采用直截了当法，即“是”指定为1, ＂否”指定为0。
当定性指标采用“很差、较差、一般、较好、很好”的方式描述时，可根据它们的沙守年
216
第7 章网络安全检测与评估技术
粗略地分别分配一个整数来实现结果的昼化，如使用“1 、2 、3 、4、5" 与之对应。这些量化
后的结果”1 、2 、3 、4 、5" 可分别采用“0. 1 、0.3 、0.5 、0.7 、0.9" 或“a、b 、c 、d 、e" 作
为它们的归一化值，其中O~a~0.2, 0.2~b~0.4, 0.4~c~0.6, 0.6~d~0.8, 0.8~e~l 。a、
b 、c 、d、e 具体取什么样的值应根据指标的评估结果而定。这种归一化方法是线性的，某些
情况也可能不合适，例如当指标的评估结果是非线性时。
3. 综合评估方法
所有评估项的评估结果经过综合便可得到对系统的总的评价。对千同一个层次上的评估
项（指标），综合评估过程是一个从多维空间到一个线段中的点或评价等级论域中的等级的映
射过程即：
f:(Ii,I“ 山） ➔ A(或f :(11,12,…， In) ➔ L)
其中， Ik(k=l,2, …， n) 表示评估项，一般是结果的归一化值（若为定量的话）， A 是综合
结果的取值区间，一般设为[O, 1]，适合千定量表示的综合评估。L={L1,L2, …,Lm} 表示等
级论域适合千定性评估结果的综合。
如果评估项之间是层次关系，则综合评估的任务就是将该层次结构中的全部评估项映射
到上面的线段A, 或等级论域L。即：
f:(H)-+A（或f:(H)--+L)
其中， H 表示评估项之间的层次结构，一般如图7-10 所示。
图7-10 评估项之间的层次关系
上述映射必须在线段（一维空间）或等级论域中保持多维空间或层次结构中的序，从而
才能得到与实际情况相符的综合评估结果。
有一些成熟的综合评价方法可以使用，下面简要介绍几种典型的综合评估方法，目的是
强调可能的综合评估解决办法。
(I) 加权算术平均
加权算术平均是综合评价领域最常用的方法，也是最简单的方法。
设I1 表示第i 个评估项的评估结果值（归一化后的，下同）， wj 是其对应的权。即wi 表
示第i 个评估项的重要程度， W1 越大，对应的评估项就越重要。Q 表示综合的结果，则加权
算术平均如下。
n
Q=2MIi (7-9)
1.. 1
217
计算机网络安全教程第4 版
n
其中， i = 1,2,…,n, W1 ~0，区wi =1 。
l=I
加权算术平均易受个别极端评估项的影响，当某些评估项之间的相关性较大时， ~的意
义就不是很大了。
(2) 加权几何平均
在某种意义上，加权几何平均比加权算术平均可能更有用。
设l表示第i 个评估项的评估结果值， wi 是其对应的权，则综合评估结果值Q 为：
n
Q =nriw,
i=I
(7-10)
D
其中， i=l,2,…，n, wi ;:::o,I:wi =1 。
i=I
与加权算术平均相比，加权几何平均能更进一步反映全体评估项的作用，所以使用:m:it"l
几何平均的综合评估效果比使用算术平均要好。
(3) 混合平均
在综合评估过程中，对某些评估项来说，使用加权算术平均对其进行综合比较*适: ，
而对另一些评估项来说，使用加权几何平均可能更好。这种情况是由评估项的固有性质决
定的。某一评估项的评估值可能是决定性的，以至千基本上主要依靠它做出最终评价飞~
可能不那么重要。当对各评估项使用合适的不同平均方法后，经过进一步综合就得到了最
终评估结果值。
7.4.3 基千模糊评价的网络安全状况评估模型
模糊评价用千系统安全保障评估，是一种非常好的综合评价方法。模糊综合评价的~研i
是模糊数学理论。在评估实践中，经常遇到一些评估项，它们的评估结果很难以定量的~~~
达。模糊数学特别适合于用来处理定性的评估项目。例如，系统评估中的大部分项目基＊者5~
定性的。模糊数学可用来处理这些评估结果，并形成总的评价。
假设I ＝仕， l2, …,ID} 是全体评估项的集合， IJc{k=l,2,… ,n) 表示第K 个评估项。
L={L1,L2,…，Lm} 表示每个评估项It{k=l,2,…， n) 的各种可能的定性评估结果。则对每一个
L』{i=l,2,…，m) 可建立一个模糊子集＼。设did=~ I Ik 表示Ik 对u 的隶属度，即第k 个评~项
可以被指定评估结果L1 的程度。
有几种方法可以用来确定did 的值。当评估项目Ik 是定性的情况下，可采用模糊统计实验
的方法来确定，为了使评估人员做出的评估结果断言Ll 所占的比例趋近于隶属度d1a, ffi糊统
计实验法需要足够的评估专家。当评估项Ik 是定量的情况下， dki 可以使用隶属度函数μki(x)
计算得到，这里x 是Ik 的测量值。dk.i 也可以采用频率法获得。
当所有did {k = 1,2,…,n;i = 1,2, …， m) 经评估确定后，可以建立模糊关系矩阵。
218
笫7 章网络安全检测与评估技术
dll d12 … dlm
R =(dki)=|. d21d22 ... d2m
. .
dnl dn2 ··• dnm
(7-11)
一般来说， n 个评估项l1,l2 , … ， ID 并非同等重要，它们对综合评价结果的影响是不同
的，所以在进行综合评价前， 必须先确定模糊权向量。设W=(W1,W2, …， WD) 表示模糊权
向量， P ＝｛对评价有意义的评估项｝，是一个模糊子集， 则Wj (j=l,2, …， n) 代表评估项Ij 对
P 的隶属度。
模糊权向量的确定可以采用专家估计的办法。专家的估值需要经平均和归一化处理。也
就是说，如果W；是评估项Ij 对P 的平均隶属度，则归一化的模糊权向量计算如下。
wJ=WJI沪＇
一旦确定了模糊权向量w, 便可得到模糊综合评估结果E 。
du d12 ··· dim
E=WoR=(w1,W2,…,W n) oI d ~l d~2 … d2~mm I= (al'a2'..．心）
d nl dn2 ... d DID
(7-12)
(7-13 )
其中“0,, 是模糊综合运算符，可表示为F(*,O) ，它包含两个操作“*”和气9“ 。
ai (i = 1,2, · ·•,m) 是通过W 和R 的第i 列元素运算得到的一个值，其含义是总的评估结果对模
糊子集l1 的隶属度，也就是对总的评估结果可指定Li 的程度。
ai =(w1 •dli傩(w2 ＊屯） EB · ··EB(w0 ＊屯） i = 1,2,-·•,m (7-14)
模糊综合运算符F(*， e) 中的两个操作可能有多种变化方式。例如，一种情况是F(x , v)
运算符，其中“x” 代表两个数的积， “v” 代表在几个数值中选择最大的。使用该运算符
ai {i = 1,2, … ， m) 计算如下。
ai =v(wj xdji)=max{ wjdjt |j=l,2,…,n} (7-15)
至于模糊综合运算符F(＊， O) 中的运算如何定义，可以参考相关的模糊数学专业书籍，
这里不做详细讨论，如果采用这种方法进行实际的系统安全评估，可在评估方法中专门研究
和定义。
模糊评价的结果E 是一个向量，为了能够比较多个系统的总的评估结果，或者为了其他
某些目的，还应对E 进行分析和单值化。可采用最大隶属度原则或加权平均方法。例如，加
权平均计算如下。
219
计算机网络安全教程笫4 版
呤骨叶(7-16)
其中， Q 表示总的综合评价结果，常数K 对较大的ai 有影响。当k-+-oo, Q 的值将与最大
隶属度原则得到的值相同。
7.5 网络安全检测评估系统简介
计算机网络信息系统安全检测评估系统的发展非常迅速，现在已经成为计算机网络信息
系统安全解决方案的重要组成部分。下面以Tenable 公司的Nessus 和IBM 公司的AppScan 为
例来介绍网络安全检测评估系统。
7.5.1 N岱SUS
1. Nessus 简介
Nessus 是一套功能强大的网络安全检测工具，被认为是目前使用人数最多的系统漏派l扫
描与分析软件。很多机构使用Nessus 作为扫描机构内部网络系统的软件。Nessus 2.x 以前的版胪
本都是以开放源代码的形式发布的，而Nessus 3 以后的版本已经不再开放源代码， 当前
Nessus 的最新版本是Nessus 6.x 系列。Nessus 对个人用户是免费的，只需要在官方网站J:.通i过：
邮箱申请注册序列号就可以使用，但对商业用户是收费的。
Nessus 的主要特点包括：
l) 支持多种操作系统。Nessus 支持在Microsoft Wmdows、Linux、Mac OS X 和FreeBSD
等多种类型的操作系统上运行，用户可以根据需要选择相应的版本。
2) 采用BIS 架构。新版Nessus 采用BIS 架构来进行扫描检测。Nessus 服务器包括一个｀扫
描引擎和一个Web 服务器，客户端只需要通过一个Web 浏览器就可以对Nessus 进行操作控
制。如果使用微软的IE 浏览器，则要求IE 10.0 以上的版本。
3) 采用plugin 技术。Nessus 通过plugin 技术不断扩展自身的扫描能力，每个plugin 只~
成特定漏洞的检测或其他特定的功能。Nessus 的plugin 常常都在更新，官方每天都有~的
plugin 弱点检测项目公布，使得Nessus 可以及时检测出更新和更多的漏洞。这种利用漏洞~
件的扫描技术极大地方便了漏洞数据的维护与更新，也是Nessus 之所以强大的主要原因。
4) 调用外部程序增强测试能力。Nessus 在扫描时可以通过调用一些外部程序来额外增弓虽
检测能力，如调用Nmap 来扫描端口和操作系统类型、调用Hydra 来测试系统上的脆弱密~，
以及调用Nik.to 来检测Web 程序的弱点等。
5) 生成详细报告。Nessus 可以生成多种格式的扫描结果报告，包括HfML 、CSV 、
PDF、.nessus 和DB Nessus 等。报告的内容包括扫描目标的安全漏洞、修补漏洞的建议和危恶t
级别等。
Nessus 的特色功能包括；
• Pat.chM血agement Integration （补丁管理一体化）。
•M咖are/Botnet Detection （检测恶意软件、僵尸网络）。
• Mobile Device Auditing （移动设备审计）。
• Configuration & Compliance Auditing （配置与符合审计）。
220
第7 章网络安全检测与评估技术
• Scanning & Auditing Vutualiz.ation & Cloud Platfonns （扫描和审计虚拟化和云平台支持）。
2. Nessus 的安装
(1) 在Linux 系统上的安装步骤
l) 通过网址http://www.nessus.org/products/nessus 下载最新版本nessus。这里假设下载的
文件为Nessus-6.2.0-ubuntul110 _i386.deb。
2) 下载成功后，把文件置千home 目录中。
3) 在Tenninal 终端中执行以下命令，启动安装过程。
sudo 屯kg 丑＼咚輿＄－6立9世狸血旦lo＿瓣b
4) 安装后出现以下提示，表示安装成功。这里假设Linux 计算机的名称为ubuntu。
Processing the Nessus plugins...
[IIIIIIIIIIIIIIII/IIIII/IIIIIIIIIII/IIIIIIIII/I/IIIIIIIIIII/I/I/I/I/I/I/l/I/I/IIIIIIIII/III/IIIII##]
All plugins loaded
-You can start nessusd by typing /e闷init.d/nessusd start
__-_T he_ngo tohttps://ubu＿nt＿u:＿88＿34＿/一t一oc一on一fig．u＿＿rey_our_的血_er . －－＿＿．一
5) 根据提示，先启动nessus 服务器，命令为： sudo /etc/init.d/nessusd start。
6) 通过浏览器打开https://1ocalhost:8834/，根据提示来配置Nessus 扫描器，如图7-11
和图7-12 所示。
Welcome to Nessus~ 6 ~Nessus
Thank you for instaDing Nessus. the world leader in wlnerability scaMers. Nessus will anow you to perform:
• High-speed vulnerabHity discovery, to determine 咄ich hosts are running which services
• Agentless auditing. to make sure no host on your netwo众is missing security patches
• Compriance che屯to verify that every host on your netwo六adheres to your securily
policy
• Scan sdleduling. to automatically run scans at 血freq旧ncyyou se如
• And morel
During this process. you wffl ere血如．dminlstrativt ICCO叩八吵田your scanner, and download血血”一
_plugins.
图7-11 Ne88Us 欢迎界面
7) 在http://www.nessus.o咽register 注册获得激活码。
8) 更新插件包，时间较长。
(2) 在Wmdows 系统上的安装步骤
在Wmdows 系统上的安装步骤较简单，直接下载相应版本的安装软件，然后安装即
可。安装完成后打开浏览器，输入https:／八ocalhost:8834/，后续过程和Linux 平台上的步骤
相同。
221
计算机网络安全教程笫4 版
Initial Account Setup ~ Nessus
Rrst. 泗n蚴to create a Syst如Administrator for the
scanner. This user has tun control of the scanner. with the
ability to aeate/delete users. stop running scans. and
血nge the scanner configuration.
u"叩m•
片－rd
Confirm 内血喇0rd
Since this user con change the scanner con{igurotion, lt
also has the ability to execute commands on remote
hos比乃f!re(ore, it should bf! noted that this user has the
same privileges at the •root·(0r administrator) Usflr on
remote hosts.
图7-12 设置Nessus 管理员账户和密码
3. Nessus 的使用
(1) 登录
Nessus 安装好后，在Web 浏览器中输入https:I/[server IP]:88~4, 就可以进入Nessus 登谔t
界面，如图7-13 所示。需要注意的是， Nessus 只支持通过SSL 加密保护https 协议ijj 问， 不
支持未加密的http 协议。
亥i· 一｀ ． 、．巧． . 一一一_
\、l /
0Nessus · I
l . ...ldmln-
[ 8 Password
日印mm归枷_
/
I / ,iJ It几e，研n·ab立le1«i
I_ _＼辽二＿ 巳
图7-13 Nessus 登录界面
使用安装阶段创建的管理账户和密码通过身份验证，就可以进入如图7-14 所示的~操计乍
界面，主要包括管理策略(Policies) 和扫描任务(Scans) 菜单。
222
第7 章网络安全检测与评估枝术
I ·压ssus - 0 ,`七-叩～n . 息1
& I—云云］ 5 ．“｀-尸，· .-_ J
- SOlln9 心y玩e
畴伽- •
1冒，h
障袋谴m
NR蜘
日
1 1 ,-,嗡羲咖
拘如一"__ °“一
0 谝枷卿喊UnII咖咖喊血啊伽归咖叫
口一一啊匐心01-- C111D呻咖叫
l.a1....,.
J ，印，贼
0 ，盒傩向，
0 句印
· 又
” “
► X
图7-14 Nessus 主操作界面
(2) 基本设置
在界面中单击当前的登录用户admin, 可以对该用户的配置文件User Profile 进行设置，也可
以对Nessus 系统配置Setting 进行设置。用户配置文件设置界面如图7-15 所示。
User Profile
/
、
、
,、
/
• Settings
一妇
°``.“d
""9ln RIies
User Profile ／杠count Settings
u........ 心1如
FulNme 1-
酝喊I shtclowOema,ple.叩
”“匀m叩＂皿U山u....
onc ..
图7-15 用户配置文件设置界面
在用户配置文件设置界面中可以设置账户信息、修改账户密码，以及设置Plugin 插件规
则等。其中，“插件规则”选项可以创建一套规则，规定插件的执行行为。一个规则可以基千
主机、插件ID、可选的到期日期和危险程度等进行设置。如图7-16 所示。
＆叩
« ＆叩Settings / c:>wrwiw
。
一·咖I
--.
吓n叩
u“m
l=i
血Il.
8.0.0
Ml权Fl1-
血8“四
M
片
丘山
心一
门
匕叩118d· _
内旺
－1& 句14
归12, 幻17
201妞161416
图7-16 参数设置界面
在Setting 设置菜单下，可以进行Scanners （扫描引擎）、Mail Server （邮件服务器）、
223
计算机网络安全教程第4 版
Multi Scanner （多扫描器）和Proxy （代理）等设置，如图7-16 所示。
(3) 制定扫描策略
Nessus 扫描策略包括了与漏洞任务相关的各种配置选项。主要包括以下几个。
·控制类参数，如超时、主机数目、端口类型和扫描方式等。
·本地扫描的身份验证凭据，如Wmdows 、SSH 、数据库扫描、H1TP 、FTP、POP 、
IMAP 或基千Kerberos 身份验证。
·扫描插件选择。
·法规遵从性策略检查、报告的详细程度和服务检测扫描设置。
·对于网络设备，允许网络设备的安全检查，而无须直接扫描设备的脱机配置审核。
• Wmdows 恶意软件扫描所比较的文件，已知良性和恶意文件的MD5 校验和。
Nessus 策略分为两大类：默认策略和用户创建策略。默认策略存储在策略库中，主~~
略模板如图7-17 所示。
nl > U
.. 一. . . 多. ..一.• ---· 一．． ． 一－
Oo ii. 匹I !
Adwll!Clall.., I I Auc1t Cloud加一1111h勤蛐由“一-m-=叩叩心I品=== II=？云=E71帘I
····-··-···-·- ·----·-·- --·- - -- -
人a
啊
的
N
臧
W"仗
詹
om
“4叩加中加1血心缸啊
心L
ii
I 三
g 宁－ h ,'
一、
lp Ilor-
-
@ll--
-
g
gi"
-I
iPCI
的一
-
l
二ii.
－
｀ i＿·三
ii
_
-- =口
lntaNIPCIN咖吐歇咖｀ Mob..D氐
~伽mm-POlDS8(11.2.1J I I ,......moblod…邓心以lcrotlDII
｀酌loon... I ' Exchange...an MD以． a
80APOum“mo 压dlt
儿可伽m 切LIi“SCAP
一
0 II 0
铡＂叩伽酬加T... Win中mM..酝
歇如幻．一霾d- -红”-mWg呱
晌讥旬．动圈见叩缸正
图7-17 Nessus 默认策略库
各策略模板的基本功能如表7-8 所示。
策略模板
A吐t Cloud lnfraslrulllre
B屾SheU止ockDet磁on
Buie Network Scan
表7-8 Nessus 默认策略模板功能简介
功能描述
对第三方提供的云基础设施服务进行审计
Bash Sbcllshock 漏洞远程和本地检查
对网络主机进行系统的扫描
224
第7 章网络安全检测与评估技术
（续）
策略模板功能描述
Oodootlalod Patch Audit 枚举缺少的软件更新
Ho只Di900Vory 探测活跃的主机及其开放的端口
lnmmalPCIN咖o六Senn 对内部网络进行PCIDSS 漏洞扫描
Mobile Device Scan 对移动终端设备进行扫描
Offiinc Config Audit 离线配置审计
PCI Quarterly E如mal Scan 对PCIDSS 漏洞进行外部扫描
Policy Compience Audit 策略一致性审计
SCAP Compiance Audit SCAP 合规性审计
Web Application ~啦对Web 应用进行扫描测试
Wmdo哪Malware Scan 对Windows 系统上的恶意软件进行扫描
Advanc.ed Scan 高级扫描，用千完全控制策略配置
Nessus 的策略设置包括5 个部分： BASIC （基本）、DISCOVERY （发现） 、
ASSESSMENT （评估）、REPORT （报告）和ADVANCED （高级）。提供这些部分的参数
设置可以调整用户的策略设置。
其中， BASIC （基本）部分主要设置策略名称及其描述信息，如图7-18 所示。
N咕IBasicNScan
、I
曰晌儿酝“'》一。
．良藕0 、， Settings/晌le
0
"_ N_盲请 I -| | 良腿嗣了
胄r
叩儿嗽逾＂ 雪I·■ C咖叨
图7-18 扫描策略基本设置
DISCOVERY （发现）部分主要设置主机发现、端口扫描和服务发现机制的策略。
ASSESSMENT （评估）部分主要配置Web 应用的扫描设置和Wmdows 的扫描设置。
REPORT （报告）部分主要配置报告输出的显示方式。
ADVANCED （高级）部分主要配置更高级的功能，如性能设置、额外的检查和日志记
录功能等。
如果不想用策略向导来创建用户扫描策略，可以通过（高级扫描） ADVANCED Scan 选
项自主地创建自己的策略，在此模式下用户拥有对所有选项的完全控制权，但同时也需要用户
对各选项的功能和用途有较深入的了解，否则不仅不能提高扫描质量和效率，甚至还可能会给
目标网络带来一些负面的影响。
(4) 创建、启动和调度扫描任务
在创建或配置一个新的扫描策略之后，将显示New Scan （新的扫描）界面，如图7-19 所示。
225
计算机网络安全教程第4 版
衵_
吻叙
T呻
凡ISc叩
N纲， Folder
霾
Scam I My Scans
I N.,,.
“`s“'n
....J “”一
0 Pa此hAu叩
0 Local Hoat llttXNelf'f
图7-19 建立新的扫描任务界面
通过单击New Scan 按钮，将进入如图7-20 所示的任务配置界面。
NewScen ／收过DSXNarY
哑-· 一， ． ．．， ． ， ． ．彝·•·-一，-·-．一
歉潭＂ unrr ) 暴鹹宣咖
．劓瞿0 ` Settings/ Basic
°
a木轼扣袖N.m I =1
巳呵INIIIHIIIII缸谒
口赋功喝“'
I I'llI1山111l1
_R蜘 I岭妇 ·I I I.OCIII ScllUw ... I
Tm声巳192.168s:.21.眨168.1 小192.188.1255,
皎4．叩叩oJlosLoom
图7-20 扫描任务配置界面
其中， Scanner （扫描引擎）部分用来选择要使用的扫描引擎，默认使用本机的扫~引
擎，也可以使用已经配置过的其他扫描引擎。
Targets （扫描目标）部分用来设置要扫描的目标主机范围。Nessus 支持多种形式表~的
目标地址，包括单个IP 地址（如192. 168.0.1) 、IP 范围（如192.168.0.1,.._, 192.168.0.255) 、
CIDR 表示子网地址段（如192.168.0.0/24) 、可解析主机名（如www.nessus.org) 或一~~＿
的1Pv6 地址（如fe80::2120d:17ff:fe57:333b) 等。
Schedule （日程安排）部分用来设定扫描任务的执行时机，可以是立即执行、请求执｀
行． 执行一次、每日执行、每周执行、每月执行和每年执行。一个扫描任务的执行计戈脰斥
例如图7-21 所示。
226
第7 章网络安全检测与评估技术
歉U旨雪， > ．喊鞠晌
1- - ------ '-·--- -·- -
黜叩` Settln鹦/Basic
° - e呻， NOllfl哑叩I
门血呻lonI
U山呻
句叩On
T1-
| Wtlldy ~ I
三三
[Arna一邮YOik .. l
~-三
~_ on| 8 卫 1 T | w | T | F | s |
吻叩呱on Mondavlll血叽咖廿nIIonMon娜如血礁2014
- ClnOII
图7-21 扫描任务执行计划
扫描任务配置完成后，单击Save （保存）按钮提交扫描任务。任务提交后，如果选择了
立即执行选项，扫描任务将开始立即执行。在Scans （扫描列表）下将显示出各扫描任务的状
态，包括正在执行、暂停和停止等。用户可以通过相应的按钮对扫描任务进行控制， 包括启动
任务、暂停任务和停止任务，如图7-22 所示。
Scans I My Scans
口汕mo lllltSoan ..
0 I爪啊n鹹P臧中知dll
D DMZNetw咄Soan
O 叩哉闺
O 忱47 田
4
J
图7-22 扫描任务控制
(5) 查看扫描结果
单击列表中的一份扫描结果报告，即可对扫描结果进行浏览查看。扫描结果可以按照主
机、漏洞和端口等方式进行组织。默认的结果显示视图为主机漏洞摘要，通过一个彩色编码条
来汇总每个主机的漏洞分布情况，如图7-23 所示。
HomeN充妞
"...,.""'＇，价1ll”“'. ” “ 罕芦10. ~ 1 ... 、厂,I
＿，一· 归咖－ 1Il 归』一. l!ll 归叮臼
＾一一·一
O K咖｀小酗- · --
IJ ，巨嘈" μ - X - -- - HIA
r, 1吐I幛Io 1- 入-- 酗一。n帕妇,0,,20.. 10:1 ....
rJ ，鲍I鹹心o 1-1 彝
f 1 I”丛1
1 -- 头I ' I........,ao llJ I1,,' . ., x
价血咖呻咖l.
·归....
.• ..II..... m
•o．一
图7-23 扫描结果展示
227
计算机网络安全教程笫4 版
选择一个具体的主机，还可以进一步查看详细的结果信息，如漏洞的详细描述、危害等
级和修补建议等．
(6) 导出扫描结果
从Scans （扫描）界面中选择一个扫描任务。在扫描结果报告界面中单击Export 下拉按
钮，选择扫描结果报告的格式。确定报告格式后，还可以进一步选择报告中要包含的内~如
图7-24 所示．
叩L Chapter Selection x
I Avalllllll en.nt
I 归111 丘叩应IOUllv., iii |
1 -lltl髓ByHoet iii|
1 0ompliance～心…四）三l
1 -Ramedlat1ons 三1
＿晌叩中引
|…，11ance~（三1
AlportOontent
Drag and organize oontent 叩．
C富四
图7-24 选择扫描结果报告内容
7.5.2AppScan
1. AppScan 简介
AppScan 的全称为田M Security AppScan, 是IBM 公司面向Web 应用的商用安全检测工
具。AppScan 早期的名称为田M Rational AppScan, 现在已改为IBM Security AppScan, 最新
版本为AppScan9.x 系列。
AppScan 是业界领先的Web 应用安全检测工具，提供了扫描、报告和修复建议等功能，
能够在Web 应用开发、测试、维护及运营的整个生命周期中，帮助用户高效地发现和处理安
全漏洞，最大限度地保证Web 应用的安全性。
AppScan 采用3 种彼此互补和增强的不同测试方法。
l) 动态分析(“黑盒扫描“)。动态分析是AppScan 的主要方法，用于测试和评估运：行下时
的应用程序响应。因此， AppScan 有时也被称为黑盒测试工具。
2) 静态分析（“白盒扫描＂）。静态分析是用于在完整Web 页面上下文中分析JavaScript
代码的独特技术。
3) 交互分析("glass box 扫描＂）。动态测试引擎可与驻留在Web 服务器的专用glass-box
代理程序交互，从而使AppScan 能够比仅通过传统动态测试时识别更多问题，并具有~~的
准确性。
228
第7 章网络安全检测与评估技术
2. AppScan 安装
AppScan 的安装过程比较简单，通过运行安装程序，然后根据向导提示就可以完成安装过程。
需要注意的是， AppScan9.x 系列对运行环境的要求较高，安装前一定要检查环境是否满足要求。
AppScan 9.x 的基本环境要求如下。
1) 操作系统要求Microsoft Windows Server 2008 或劝ndows 7 以上。
2) 浏览器要求Microsoft Internet Explorer 8 以上。
3).NET 框架要求Microsoft.NET Framework 4.5 。
AppScan 安装中包含一个默认许可证，此许可证允许扫描田M 定制设计的AppScan 测试
Web 站点(demo.testfire.net) ，但不允许扫描其他站点。为了扫描其他站点，必须安装mM 提
供的有效许可证。
从7.8 版开始， AppScan 许可证需要从Rational 许可证密钥中心下载。AppScan 有3 种类
型的许可证。
I)“浮动”许可证。该类许可证安装到田M Rational License Server （可与运行AppScan
的计算机相同）。在其上使用AppScan 的任何服务器均必须具有与许可证服务器的网络连接。
用户每次打开AppScan 时，都会检出一个许可证，而关闭AppScan 时，会重新检入该许
可证。
2)“令牌”许可证。该类许可证也安装到田M Rational License Server （可与运行AppScan
的计算机相同）。在其上使用AppScan 的任何服务器均必须具有与许可证服务器的网络连接。
用户每次打开AppScan 时，都会检出所需数量的令牌，而关闭AppScan 时，会重新检入这些
令牌。
3)“结点锁定”许可证。该类许可证安装到运行AppScan 的机器上。每个许可证被分配
到单个计算机。
3. AppScan 的使用
(1) 创建扫描任务
在默认配置情况下，启动AppScan 会打开如图7-25 所示的扫描任务创建向导界面。在此
界面下，可以查看最近执行过的扫描任务，也可以创建新的扫描任务，同时还可以查看一些与
AppScan 有关的知识。
在如图7-25 所示的界面中，单击“创建新的扫描”按钮，将弹出如图7-26 所示的“新
建扫描“对话框。
色打开～ 。欢迎使用心P沁n
Q 铺重廊闷卫，＿
最逐的扫疵
- App5can的嘘知识
凸d叩0.t01I印re血
衄下氪扩展版
笣） 入门（l'OF)
因IllMAp咄collo凡知叩归1d”
叨扁幼岭沁0衄时豆尔该厨藤(II) 1 关闭C) |
图1-2s 创建扫描任务
229
计算机网络安全教程笫4 版
豁-下~,．可·也'J易； 勹',.....了
最远的模板
gJ Parameter书ased Navigation
~ Regular 如n
iJ demo.testflre.n吐
合浏览．＂
回启动扫据出际泻(L)
'.. -“4工了.. "\•~·,O.• -了-.
怪定义的模板
勾常规扫揖
幻快速且筒便的扫描
幻基千参数的导航
iJ WebSphere Commerce
幻WebSphere Portal
i} demo.testflre.n吐
沮HaaneBank
臼WebGoatvS
OWorkl19比
-．，八百可
F
[ ＂响应． I l 归@ -JI
图7-26 “新建扫描“对话框
在该对话框中，显示了最近的模板和预定义的模板，用户可以根据需要选择模~启动
相应类型扫描任务的扫描配置向导，如图7-27 所示。
Ir~ , . __.._ 莹I
「| 完= 茸 租翻｀配置向导“ =圈己乙=z ===•=•
．团·福黜组旺一个以挝眼妃湿础谦缅：信战踵
载忽夏妇以洹叩点：
@A',Sc也（．自动威手动）
0 外俸设旮几户机( Ap沁o 作为记录代理）
O 却胀丹客户机NSOL)
鞍僖CiSC 仇b·strd ··6 记录召· 1 吓，霍
评鹉毯膺个画？
巨匠口
图1-21 扫描配置向导
在“扫描配置向导“对话框中选择想要使用的探测方法， 通常使用默认设置的AppScan, 单
击“下一步”按钮，进入如图7-28 所示的',URL 和服务器”配置向导界面。
230
笫7 章网络安全检测与评估技术
扫幅配■阿愕苍
琶配蚧Ulll
从该111lL 启幼扫福：
192.1 的． 1 ．边
例如：人ll,t: ／Ia.”“'”“｀••I
巳仅扫揭此目景中或目录下的阴搂(S)
钞区分＊小写荆碌
回将所有路径作为区分大小写来处理(U`｀ U- 等) (ty
也并伯雁务器和烽
在该扫揭中包含以下抖伯黑丹器和1!11 :
• @
巳．
团
6l
竺夏王一缸霞、古西（广
酰巨lA卯CtI
图7-28 "URL 和服务器”配置向导
在图7-28 所示的界面中设置”起始URL ＇，，可以是完整URL 地址，也可以是IP 地址或
域名等，然后根据需要设置其他选项，单击“下一步”按钮，进入如图7-29 所示的“登录管
理”配置向导界面。
＂酐，偏向马
．纱登录方法
使用以下方法，以望录应月程序·
＠记录（指存〉(I)
©拦示(P)
©自动认）
©无OO
严
姨己颈暧却殊觐搬畴贮
苍
枉肖粒录妇：
芢扭戛骂贵＂颈吨测＇，颈飞
声巨I 归(C) 1
图7-29“登录智理”配置向导
在图7-29 所示的界面中设置希望使用的登录目标服务器的方法，包括“记录”“提示“和
“自动”等，每种方法的含义在选择后都在界面中有相应的介绍。单击“下一步”按钮，进入如
图7-30 所示的“测试策略”配置向导界面。
231
计算机网络安全教程笫4 版
日糯配重向彝
纱割”“'孰..
慢室火钠镶嚷
＠缺僧值
O 的诵llJJ
O 切肛炽构
8妇
幻情入式
O諒
ti)w中如c..
F
kk
,m
团发送登录扣注饷页诬且闭酝(t)
包请勿在删以登录页酌H沁出会话钜只(D).
面
骠…呻叮心亟逻可7
E巴王竺］ 1 环(C) |
图7-30”测试策略”配置向导
AppScan 预先定义了多种测试策略，每种策略的含义在选择后都在界面中有相应1 的介
绍。确定测试策略后，单击“下一步”按钮，进入如图7-31 所示的“完成“配置庐］导
界面。_
@完虞扫鬟霆灼芯；
怠已阮功完成寸刊祖透向导“·
您想畏如何启动？
＠启动全面自动扫倡仄
0 仅使用自动“探索“启动(I)
0 使用．手动探赏“启动(I)
0 裂符稍后酝呻(L)
回完成“扫撮侃灼句导“后启动“扫量专京”(S)
苍
酰巳I m(C) l
图7-31 “完成“配置向导
在图7-31 所示的界面中选择希望的启动方式，单击“完成“按钮，完成扫描任务仓收荎，
如果选择了“完成｀扫描配置向导＇后启动＇扫描专家'“复选框，将立即启动扫描任~。
如果希望对扫描参数进行深入的自主配置，也可以在如图7-28 所示的界面中，单击． 6勹芜
全扫描配置”选项，进入完全自主的任务配置界面，如图7-32 所示。
232
第7 章网络安全检测与评估技术
石莹呻
霉雷卿备翰UII.
登嗅晕扣管．慢扇从潦吭Lg坊门昌I
以1>://1亿1胸1跤
,. -—- - - 汗 . il
惭仅扣文件例如： h“” “”和人”“”“ 卞蠡tI
仅心1, 口仅13瞿仗冒景中吹圉景下的创IllO
便＂句o白e
．从蛐谓亢
＠区分大小望的纂侵
情厅蜀
乡忙霉梅忭叨将所祠倡位作为区分大小耳贴饲（，山心四，等J (TJ
．千内枣市“'
韧其俺．仔霾和侵O瞩”“`
霞仓中包含以下其他扈昏售和培： ＠团巨｝ 鲁信和代豐
叩认还
铡试
删
嘛
村钗升伪
是重妞
霄佩
扫．睿窜
信佩睿覃
晶
',..,
0孛
雹氧入攫皈
动还鼠坛偶
口卫二荨
图7-32 完全自主任务配置
(2) 执行扫描任务
扫描任务创建好后，如果任务没有立即启动，可以在AppScan 主界面上单击“扫描“工
具栏菜单项启动任务，如图7-33 所示。区嗖！ —-叩畴归口晒哑庇丈』翌i 匕． 长片妇
文侧暨扫匾0 工具O 翰灼们｝
5＠句固闷I PII O .
曰·，阜谓如曙翩赃蠲归沁啊打呻
匣一巴~-．四迦归迦，一泗丿_`pt
中一」
..爷皿动1”面1 初
t·~/
屯氏
”。1n1oT,p
"U .. --·涵-衄-_.. _,_ . ，位岫叨9?111111m/ GET
--..一·哱,·.一．～． ． ．－- ~
氐已可＿＿＿，一GET
囚田，应161.U22/WoT；邧冲"... 一·血·凶呤16&- GET 叩·立·四动如一～o/硒啤....,
O血ma__ ,“叫“'户GET
图9,
“七巾
.0一叶3山
协hop-//19ll61.口切氏，＂叩p_ _VIEWSTATii•/wfPO灿N冗”“`Mil扑剩2GQe-FhNZq.SPnc归
丘如叫心l奶口刀瓜e... 汕m如加过如Inl印加叩？ 1机1,?？?I叩叩－ r,FT R的叫丛山＂己心2从贝及2-,.,压
舫四叩旰酝l加过切饼如1111 认亭龙郧工l I侦N印， ， 凡•I
I G I IITffI` • `
儿肛霉lt．一....... -: ....: m｀..u.｀,.'1缸.已m， ．＂u”““'心“”一i,“”“”m八已1... ，,..,.,....,
0..,．一r ..`"..八.. ,..呵'......』..江,.., ......., W ,,” ““``” “” “1..“'`... . Hrt cu ,.....,,,, “CC.11 ,lln CUI J.1.mm .区盯
口I.O.J07UI KoOJ.• C..“z 沁，．.. t心1.c llC 3..I
懋腔胚冶瞿昌也后，睬刑噬果，井酗啪1111书叩泣·作曲巳饮，以筏富过压氪
冥鼠Im ［一一＂m"“'l,＿＿＿位立一 霹食，以V/I1亿田1, 1.ZZZ/压田Jbp..“” 立一一一＿＿＿三］
冤叩妇一10/a '八勤叩情如11 下一一·一．一一－-- ，。出调l..,0 令0 问0 叩酮｀ 0... 口踵句透
图7-33 启动扫描任务
233
计算机网络安全教程笫4 版
(3) 查看扫描结果
在扫描任务执行过程中，就可以查看扫描发现的问题，如图7-34 所示。
. _ _ _ . ｀ '.r 书＿＿．－ - · ·,
如m • ..“ SIi1$1 工配Tl .酗
0顽 @“m订肛1!11J吽8R I田tPaIiss,叩Omook . ... －－一，IIm 啊·叨
匣一气性. I 妇. 11 ．仁个下一页,.
g
了g
g二三亏还
G.
吏，严重坟邑｀
8 ．出呾旺·“”0 付泗噢(`1 竹饶）
，甸－m
卜他一l)
，匐E贰贾U皿夏口
，鲍巳械窦的」mw汀八E 衄rII
卜＠在咄啊过疗内鄱＂公开郎2OI
,O 口陨吓＂田衄肘心叩鞠＂m丸霾仕(I)
卜翻置置丙鄱P 坟．檐穴(4
,雹“一(I)
| :E骂霍(00切；；1心吁1响如·1年年产SI"叩1仁芒任l
可能原因
柬“l11户价入za仇行句勘拿万渭胃
技术措述
于““l!i”“：月户可的顶谭入王a进行无冒化处哩·蚊朽其攸双沺3Wob 页高价噙
出·这可槽胃帖山筒本II J攻击村胃·
在以下僵又下0去生河沾贞剩太壤., 0(S$) 眉召性：
田不可II售播沮入W中日月霄序·己常蹙ew.bill术·
口W心的印归江7包念仗不可信H&'lw心页面·
m 页瓦生”几应霄11序不会月止散霎包含可售Web 匀召a快行的Pl-· 例知沁口Scpt 、Hm孔撑
巳、＂辽胃仅、R悼事件．由中扣比血X•
I4J 妥冒．ii过W心讯召a访l牲｀的Wtb 页玉，进页孤包含巳使网不可倌价葛注入的巴五问本·
151 雹干J11本秉B Wtbll钤11次｀价W心石玉· l!IIt齐盲名价W1b;tl货a石W.b1B书a的国的上下
又中执行巫夏剿芯·
161 这买停1t反7Wtb 书田a们同谭憾国的llil!I, 女镶蜀页听一个沔中的I易本不丘议氐呫访l'l其伶1寅巾
彷贝谭票邑行其传付中们代仍·
ll- 测试t 、.o:／/1巴1匐． I.如“l---...
一！
ll
二L
I
．生习足，打1厅覆Tmr_＿石霖丰「一I 。1,1 ：如心3,1 芦古：nt. ??1J 3VF I
立·
呫盂竺竺E叩妇一~'-－竺叩…l- - 亡ll
一！扣饮础哪OT'i'·一心09 叩丽玩IIQ.“b" 函：社
图7-34 查看扫描结果
7.6 小结
网络安全检测与评估是保证计算机网络系统安全的有效手段，在计算机网络系统安全：斛启
决方案中占有重要地位。网络安全检测与评估的目的是通过一定的技术手段先于攻击者发现土卜
算机网络系统存在的安全漏洞，并对计算机网络系统的安全状况做出正确的评价。网络安全书注
测与评估的主要概念包括网络安全漏洞、网络安全评估标准、网络安全评估方法和网络安全：枪t
测评估系统等。
7.7 习题
1. 简述网络安全检测与评估对保障计算机网络信息系统安全的作用。
2. 什么是安全涌洞，安全漏洞产生的内在原因是什么？
3. 网络安全涌洞的分类方法有哪些？
4. 简述网络安全漏洞的探测技术的分类，各种探测技术的特征是什么？
5. 网络安全评估的相关标准有哪些？比较它们之间的相互关系？
6. 简述CC 评估标准的7 个评估保证级的评估要求。
234
第7 章网络安全检测与评估技术
7. 简述CEM 评估模型的评估流程。
8． 简述基千指标分析的网络安全综合评估模型的基本思想。
9. 定性指标与定量指标的归一化的方法主要有哪些？ 比较其异同。
10. 综合评价的主要方法有哪些？
11. 简述基于模糊评价的网络安全评估模型的基本思想。
12. 模糊评价与传统评价方法相比有哪些优越性？
235
第8 章
计算机病毒与恶意代码防范技术
计算机病毒与恶意代码的防范对计算机使用者来说是一个令人望而生畏的任务。目前，
成于上万种病毒和恶意代码不时地对计算机和网络的安全构成严重威胁。了解和控制病毒~肋，
的需要显得格外重要，任何有关网络数据完整性和安全的讨论都应考虑到病毒。
本章介绍计算机病毒的产生及发展历史，并对病毒和恶意代码的作用机理、防范措~和I
根治策略进行详尽的阐述，分析了计算机病毒的发展趋势，并对一些影响大且有代表性的病~
举例进行剖析。
8.1 计算机病毒概述
计算机病毒只是一段可执行的程序代码，它们附着在各种类型的文件上，随着文件~＿
个用户复制给另一个用户时，计算机病毒也就蔓延开来。计算机病毒的历史贯穿着计算机挂材之
的发展，几乎每一个阶段都有一些代表性的病毒产生。而对每一个使用计算机的人来说，病毒；
是一个无法回避的问题，它常常给那些粗心的用户带来难以承受的损失。
8.1.1 计算机病毒的定义
关于什么是计算机病毒，我国1994 年2 月18 日颁布实施的《中华人民共和国计算机信i
息系统安全保护条例》第二十八条中有明确的定义：计算机病毒是指编制或者在计算机程序中
插入的破坏计算机功能或者毁坏数据，影响计算机使用，并能自我复制的一组计算机指令~者·
程序代码。
第一次真正从学术上对计算机病毒进行描述的是美国计算机安全专家Fred Cohen 博士，
他认为：计算机病毒是一种能传染其他程序的程序，病毒是靠修改其他程序，并把自身的副本；
嵌入其他程序而实现的。这段话有以下几层含义。
·计算机病毒是一个程序。
·计算机病毒具有传染性，可以传染其他程序。
·计算机病毒的传染方式是修改其他程序，把自身副本嵌入到其他程序中而实现的。
计算机病毒并不是自然界中发展起来的生命体，它们不过是某些人专门做出来的、具有一
一些特殊功能的程序或者程序代码片段。
病毒既然是计算机程序，它的运行就需要消耗计算机的CPU 资源。当然，病毒并不一~
都具有破坏力，有些病毒可能只是恶作剧，例如计算机感染病毒后，只是显示一条有趣的消息
和一幅恶作剧的画面，但是大多数病毒的目的都是设法毁坏数据。
可以从下面几个方面来理解计算机病毒的定义。首先，病毒是通过磁盘、磁带和网络~
作为媒介传播扩散且能“传染”其他程序的程序。其次，病毒能够实现自身复制且借助一定的
载体存在，具有潜伏性、传染性和破坏性。再者，计算机病毒是一种人为制造的程序，它不~
自然产生，是精通编程的人精心编制的，通过不同的途径寄生在存储介质中， 当某种条件成熟:
236
笫8 章计算机病毒与恶意代码防范技术
时，才会复制、传播，甚至变异后传播，使计算机的资源受到不同程度的破坏。
计算机病毒的定义在很多方面借用了生物学病毒的概念，因为它们有着诸多相似的特
征，例如能够自我复制，能够快速“传染”，且都能够危害“病原体”，当然，计算机病毒危害
的“病原体”是正常工作的计算机系统和网络。
随着计算机网络技术的飞速发展，计算机病毒逐渐融合木马、网络蠕虫和网络攻击等技
术， 形成了以普通病毒、木马、网络蠕虫、移动代码和复合型病毒等形态存在的恶意代码，造
成更大的社会危害。
8.1.2 计算机病毒简史
早在1949 年，距离第一部商用计算机的出现还有好几年时，计算机的先驱冯·诺依曼在他
的一篇论文《复杂自动机组织论》中，提出了计算机程序能够在内存中自我复制，即已把病毒
程序的蓝图勾勒出来。但当时，绝大部分计算机专家都无法想象这种会自我繁殖的程序是可能
的，只有少数几个科学家默默地研究冯诺依曼所提出的概念。
1977 年夏无托马斯捷瑞安的科幻小说《P-1 的青春》成为美国的畅销书，轰动了科普
界。作者幻想了世界上第一个计算机病毒，可以从一台计算机传染到另一台计算机，最终控制
了7000 台计算机，酿成了一场灾难，这实际上是计算机病毒的思想基础。
1983 年11 月3 日，弗雷德科恩博士研制出一种在运行过程中可以复制自身的破坏性
程序，伦艾德勒曼将它命名为计算机病毒(Virus) ，并在每周一次的计算机安全讨论会上
正式提出， 8 小时后专家们在VAXll/750 计算机系统上运行，第一个病毒实验成功，一周
后又获准进行5 个实验的演示，从而在实验上验证了计算机病毒的存在。20 世纪80 年代
起，田M 公司的PC 系列微机因为性能良好，价格便宜，逐步成为世界微型计算机市场上
的主要机型。但是由千田M 的PC 系列微型计算机自身的弱点，尤其是DOS 操作系统的开
放性，给计算机病毒的制造者提供了可乘之机。因此，装有DOS 操作系统的微型计算机成
为其攻击的主要对象。
1987 年10 月，美国第一例计算机病毒(Brain) 被发现。此后，病毒就迅速蔓延开来，
世界各地的计算机用户几乎同时发现了形形色色的计算机病毒，如大麻、田M 圣诞树和黑色
星期五等。
1988 年11 月3 日，美国6000 台计算机被病毒感染，造成Internet 不能正常运行。这是一
次非常典型的计算机病毒入侵计算机网络的事件，迫使美国政府立即做出反应，国防部成立了
计算机应急行动小组，更引起了世界范围的轰动。此病毒的作者为罗伯特·莫里斯，当年23
岁，是在康奈尔大学攻读学位的研究生。
1991 年，在“海湾战争”中，美军第一次将计算机病毒用千实战，在空袭巴格达的战斗
中，成功地破坏了对方的指挥系统，使之瘫痪，保证了战斗顺利进行，直至最后胜利。
1996 年，出现针对微软公司Office 的“宏病毒”。1997 年被公认为计算机反病毒界的
“宏病毒年“。
1998 年，首例破坏计算机硬件的C田病毒出现，引起人们的恐慌。1999 年4 月26 日，
C田病毒在我国大规模爆发，造成巨大损失。
2000 年5 月4 日，一种被称为“我爱你”（又称爱虫）的计算机病毒开始在全球各地迅速
传播。该病毒通过Microsoft Outlook 电子邮件系统传播，邮件的主题为I LOVE YOU, 并且包
含一个附件。一旦在Microsoft Outlook 里打开这个邮件，系统就会自动复制并向地址簿中的所
237
计算机网络安全教程第4 版
有邮件地址发送这个病毒。“我爱你”病毒属千一种蠕虫病毒，它与1999 年的Melissa 病毒非
常相似。此后在网络上又接连出现40 多种变种，比如SOUI'HPARK、“母亲节”等，不~使
反病毒专家头痛不已，也使全球为此损失100 亿美元。
2001 年完全可以被称为“蠕虫之年“。出现的蠕虫病毒不仅数量众多，而且危害极大，感
染了数百万台计算机，其中典型的蠕虫包括Nirnda （尼姆达）、CodeRed （红色代码）和
Badtrans （坏透了）等。
在2002 年新生的计算机病毒中，木马和黑客病毒以61％的绝对数董占据头名。网络病~
越来越成为病毒的主流。
2003 年8 月12 日，名为“冲击波”的病毒在全球袭击了Wmdows 操作系统，据估计可
能感染了全球1 亿～2 亿台计算机，在国内导致上千个局域网瘫痪。
2005 年由国内作者编写的“灰鸽子“木马成为当年的头号病毒，它危害极大，变种~多
（共有4257 个变种），是国内非常罕见的恶性木马病毒。
2006 年11 月至今，我国又连续出现“熊猫烧香”“艾妮”等盗取网上用户密码账号的~
毒和木马，病毒的趋利性进一步增强，网上制作和贩卖病毒、木马的活动日益猖獗，利用病~
木马技术进行网络盗窃、诈骗的网络犯罪活动呈快速上升趋势。
2010 年6 月，＂震网”病毒成为第一个专门定向攻击真实世界中基础能源设施的“蠕虫”
病毒，该病毒能够干扰位千伊朗铀浓缩工厂中的离心机保护系统，通过提高离心机转速达到破：
坏离心机的效果，最终导致伊朗Natanz 铀浓缩基地至少有20％的离心机因感染该病毒而被迫．
关闭。
2012 年5 月，俄罗斯安全专家发现了“火焰“病毒，全名为Worm.Wi呾2.Flame, 它是—
种后门程序和木马病毒，同时又具有蠕虫病毒的特点。只要控制者发出指令，它就能在网~和］
移动设备中进行自我复制。一旦计算机系统被感染，病毒将开始一系列复杂的行动，包括~淉l
网络流量、获取截屏画面、记录音频对话和截获键盘输入等。被感染系统中所有的数据都能通i
过链接传到病毒指定的服务器。”火焰“病毒是迄今为止代码最多的病毒程序，其设计结构佷:
其几乎无法被追查到。
“震网”病毒和“火焰“病毒的问世表明计算机病毒已发展成为具备情报获取、基础~施i
摧毁等作战效果的网络攻击武器，这些病毒打击目标明确，结构设计复杂，隐蔽性极强，~现L
了计算机病毒新的发展趋势。
8.1.3 计算机病毒的特征
要防范计算机病毒，首先需要了解计算机病毒的特征和破坏机理，为防范和清除计算机丛
病毒提供充实、可靠的依据。根据计算机病毒的产生、传染和破坏行为的分析，计算机病毒一
般具有以下特征：非授权可执行性、隐蔽性、传染性、潜伏性、表现性或破坏性和可触发j性。
1. 非授权可执行性
用户通常调用执行一个程序时，把系统控制交给这个程序，并分配给它相应的系统资
源，如内存，从而使之能够运行完成用户的需求。因此程序执行的过程对用户是透明的。
而计算机病毒是非法程序，正常用户是不会明知是病毒程序而故意调用执行。但计算机护；
毒具有正常程序的一切特性：可存储性和可执行性。它隐藏在合法的程序或数据中，当用
户运行正常程序时，病毒伺机窃取到系统的控制权，得以抢先运行，然而此时用户还~~
在执行正常程序。
238
第8 章计算机病毒与恶意代码防范技术
2. 隐蔽性
计算机病毒是一种具有很高的编程技巧、短小精悍的可执行程序。它通常粘附在正常程
序或磁盘引导扇区中，或者磁盘上标为坏簇的扇区中，以及一些空闲概率较大的扇区中，也有
个别的以隐含文件的形式出现，这是它的非法可存储性。病毒想方设法地隐藏自身，就是为了
防止被用户察觉。
3. 传染性
传染性是计算机病毒最重要的特征，是判断一段程序代码是否为计算机病毒的依据。病
毒程序一旦侵入计算机系统，就开始搜索可以传染的程序或者磁介质，然后通过自我复制迅速
传播。只要一台计算机染毒，如不及时处理，那么病毒会在这台计算机上迅速扩散，其中的大
量文件（一般是可执行文件）会被感染。由千目前计算机网络日益发达，计算机病毒可以在极
短的时间内通过像Internet 这样的网络传遍世界。
4. 潜伏性
计算机病毒具有依附千其他媒体而寄生的能力，这种媒体称为计算机病毒的宿主。依靠
病毒的寄生能力，病毒传染给合法的程序和系统后，一般不会马上发作，而是悄悄隐藏起来，
然后在用户不察觉的情况下进行传染。这样，病毒的潜伏性越好，它在系统中存在的时间也就
越长，病毒传染的范围也越广，其危害性也越大。
5．表现性或破坏性
无论何种病毒程序，一旦侵入系统都会对操作系统的运行造成不同程度的影响。即使是
不直接产生破坏作用的病毒程序，也要占用系统资源（如占用内存空间、占用磁盘存储空间及
系统运行时间等）。而绝大多数病毒程序要显示一些文字或图像，影响系统的正常运行，还有
一些病毒程序删除文件，加密磁盘中的数据，甚至摧毁整个系统和数据，使之无法恢复，造成
无可挽回的损失。因此，病毒程序的副作用轻则降低系统工作效率，重则导致系统崩溃、数据
丢失。病毒程序的表现性或破坏性体现了病毒设计者的真正意图。
6. 可触发性
计算机病毒一般都有一个或者几个触发条件。满足其触发条件或者激活病毒的传染机
制，使之进行传染，或者激活病毒的表现部分或破坏部分。触发的实质是一种条件的控制，病一
毒程序可以依据设计者的要求，在一定条件下实施攻击。这个条件可以是输入特定字符，使用
特定文件、某个特定日期或特定时刻，或者是病毒内置的计数器达到一定次数等。
8.1.4 计算机病毒的危害
在计算机病毒出现的初期，提到计算机病毒的危害，往往注重于病毒对信息系统的直接
破坏作用，例如格式化硬盘、删除文件数据等，并以此来区分恶性病毒和良性病毒。其实这些
只是病毒劣迹的一部分。随着计算机应用的发展，人们深刻地认识到凡是病毒都可能对计算机
信息系统造成严重的破坏。
计算机病毒的主要危害有以下几个方面。
1. 直接破坏计算机数据信息
大部分病毒在激发时直接破坏计算机的重要信息数据，所利用的手段有格式化磁盘、改
写文件分配表和目录区、删除重要文件或者用无意义的“垃圾“数据、改写文件，以及破坏
CMOS 设置等。
“磁盘杀手”病毒(DISK KILLER) 内含计数器，在硬盘染毒后累计开机时间48 小时内
239
计算机网络安全教程第4 版
激发，激发的时候屏幕上显示Warning!I Don't tum off power or remove diskette w压le
Disk Killer is Processing I （警告I Disk Killer 正在工作，不要关闭电源或取出磁盘），并改写硬
盘数据。
2. 占用磁盘空间和对信息的破坏
寄生在磁盘上的病毒总要非法占用一部分磁盘空间。
引导型病毒的一般侵占方式是由病毒本身占据磁盘引导扇区，而把原来的引导区转~
到其他扇区，也就是引导型病毒要覆盖一个磁盘扇区。被覆盖的扇区数据永久性丢失，~
法恢复。
一些操作系统功能能够检测出磁盘的未用空间，文件型病毒就利用这些功能进行传染，
把传染部分写到磁盘的未用部位去。所以在传染过程中一般不破坏磁盘上的原有数据，但非~
侵占了磁盘空间。一些文件型病毒传染速度很快， 在短时间内感染大量文件，每个文件都不同
程度地加长了，就造成磁盘空间的严重浪费。
3. 抢占系统资源
除VIENNA、CASPER 等少数病毒外，其他大多数病毒在活动时都是常驻内存的，~
就必然抢占一部分系统资源。病毒所占用的基本内存长度大致与病毒本身的长度相当。~
毒抢占内存，导致可用内存减少，一部分软件不能运行。除占用内存外，病毒还抢占中
断，干扰系统的运行。计算机操作系统的许多功能是通过中断调用技术来实现的。病毒关I
了传染激发，总是修改一些有关的中断地址，在正常中断过程中加入病毒的“私货“，从W
干扰系统的正常运行。
4. 影响计算机运行速度
病毒进驻内存后不但干扰系统运行，还影响计算机速度，主要表现在以下几点。
l) 病毒为了判断传染激发条件，总要对计算机的工作状态进行监视，这相对千计算~的
正常运行状态既多余又有害。
2) 有些病毒为了保护自己，不但对磁盘上的静态病毒加密，而且进驻内存后的动态病毒
也处在加密状态， CPU 每次寻址到病毒处时，都要运行一段解密程序把加密的病毒解密成合·
法的CPU 指令再执行；而病毒运行结束时，再用一段程序对病毒重新进行加密。这样CPUW!
外执行数于条以至上万条指令。
3) 病毒在进行传染时，同样要插入非法的额外操作，特别是传染外部存储介质时，不但．
计算机速度明显变慢，而且正常的读写顺序被打乱。
5．计算机病毒错误与不可预见的危害
计算机病毒与其他计算机软件的一大差别是病毒的无责任性。编制一个完善的计算~~
件，需要耗费大量的人力和物力，经过长时间调试完善，软件才能推出。但在病毒编制者~
来既没有必要这样做，也不可能这样做。很多计算机病毒都是个别人在一台计算机上匆匆编
制调试后就向外抛出。反病毒专家在分析大量病毒后发现绝大部分病毒都存在不同程~的
错误。
错误病毒的另一个主要来源是变种病毒。有些计算机初学者尚不具备独立编制软件的能
力，出于好奇或其他原因修改别人的病毒，造成错误。
计算机病毒错误所产生的后果往往是不可预见的，反病毒工作者曾经详细指出“黑色~星
期五”病毒存在9 处错误、“乒乓病毒”有5 处错误等。但是人们不可能花费大量时间去分~
数万种病毒的错误所在。大量含有未知错误的病毒扩散传播，其后果是难以预料的。
240
第8 章计算机病毒与恶意代码防范技术
6．计算机病毒的兼容性对系统运行的影响
兼容性是计算机软件的一项重要指标，兼容性好的软件可以在各种计算机环境下运
行，反之兼容性差的软件则对运行条件“挑肥拣瘦＇，，要求机型和操作系统版本等。病毒
的编制者一般不会在各种计算机环境下对病毒进行测试，因此病毒的兼容性较差，常常导
致死机。
7. 攻击移动智能终端系统
由千移动终端设备承载的功能日益增多和处理信息的敏感性增强，病毒对移动终端设备
的危害也呈现出多样性和高威胁性，如恶意扣费、隐私窃取（聊天记录、各种支付密码等）、
远程控制和诱骗欺诈等，能给用户造成经济损失等多方面危害。
8. 摧毁工业控制系统和工业基础设施
由千工业控制系统具有数据采集、设备控制和参数调节等功能，因此通过病毒攻击工业
控制系统可以造成除了上述危害以外的一些攻击效果，例如，扰乱上位机监控、拒绝服务攻击
控制设备，以及程序块删除与下载等，从而直接或间接对工业控制系统和工业基础设施进行损
伤或摧毁。
9. 给用户造成严重的心理压力
据有关计算机销售部门统计，计算机售后用户怀疑”计算机有病毒”而提出咨询约占售
后服务工作量的60 ％以上。经检测确实存在病毒的约占70% ，另有30％的情况只是用户怀
疑，而实际上计算机并没有病毒。大多数用户对病毒采取宁可信其有的态度，这对千保护计
算机安全无疑是十分必要的，然而往往要付出时间、金钱等方面的代价。仅仅怀疑病毒而贸
然重装系统或格式化硬盘所带来的损失更是难以弥补。不仅是个人用户，在一些大型网络系
统中也难免为甄别病毒而停机。总之，计算机病毒像“幽灵”一样笼罩在广大计算机用户心
头，给人们造成巨大的心理压力，极大地影响了现代计算机的使用效率，由此带来的无形损
失是难以估量的。
8.2 计算机病毒的工作原理和分类
8立1 计算机病毒的工作原理
了解计算机病毒的结构及其作用机制，才能从原理上剖析计算机病毒，为计算机病毒的
防范技术提供理论依据和技术支撑。
1．计算机病毒的结构
计算机病毒与生物病毒一样，不能独立存活，而是通过寄生在其他合法程序上进行传播
的。而感染有病毒的程序即称为病毒的寄生体，或宿主程序。
(1) 病毒的逻辑结构
尽管病毒的种类繁多、形式各异，但是它们作为一类特殊的计算机程序，从宏观上来划
分，都具有相同的逻辑结构，分别列举如下。
·病毒的引导模块。
·病毒的传染模块。
·病毒的发作（表现和破坏）模块。
241
计算机网络安全教程笫4 版
l) 引导模块。计算机病毒要对系统进行破坏，争夺系统控制权是至关重要的，一般的病
毒都是由引导模块从系统获取控制权，引导病毒的其他部分工作。
当用户使用带毒的U 盘、光盘或硬盘启动系统，或加载执行带毒程序时，操作系统
将控制权交给该程序井被病毒载入模块截取，病毒由静态变为动态。引导模块把整个病毒
程序读入内存安装好，并使其后面的两个模块处千激活状态，再按照不同病毒的设计思想
完成其他工作。
2) 传染模块。计算机病毒的传染是病毒由一个系统扩散到另一个系统，由一个存~
介质传入另一个存储介质，由一个系统传入到存储介质，由一个网络传播至另一个网络的
过程。计算机病毒的传染模块担负着计算机病毒的扩散传染任务，它是判断一个程序是否
为病毒的首要条件，是各种病毒必不可少的模块。各种病毒传染模块大同小异，区别主~
在千传染条件。
3) 发作模块。计算机病毒潜伏在系统中处千发作就绪状态，一旦病毒发作，就执行病毒
设计者的目的操作。病毒发作时一般都有一定的表现。表现是病毒的主要目的之一，有时:et:fJf
幕上显示出来，有时则表现为破坏系统数据。发作模块主要完成病毒的表现和破坏，所以该模；
块也称之为表现或破坏模块。
图8-1 所示是计算机病毒的模块结构。从图中可以看出，计
算机病毒的各模块是相辅相成的。传染模块是发作模块的携带
者，发作模块依赖千传染模块侵入系统。如果没有传染模块，则
发作模块只能称为一种破坏程序。但如果没有发作模块，传染模
引导模块
传染条件判断模块
-------------
实施传染模块
块侵入系统后也不能对系统起到一定的破坏作用。而如果没有引I-一一一一一一一一一一一一一一
导模块完成病毒的驻留内存，获得控制权的操作，传染模块和发
作模块也就根本没有执行的机会。
当然，并不是所有的病毒都是由这三大模块组成的，有的病
毒可能没有引导模块，如“维也纳“病毒，有的则可能没有破坏
触发条件判断模块
实施表现或破坏模块
模块，如“巴基斯坦“病毒，而有的可能在这三大模块之间没有图8-1 计算机病毒的模块结构
一个明显的界限。
(2) 病毒的磁盘存储结构
计算机病毒感染磁盘后，它在磁盘上是如何存放的呢？不同类型的病毒在磁盘上的存~
结构是不同的。
l) 磁盘空间结构。经过格式化后的磁盘应包括主引导记录区（硬盘）、引导记录区、X
件分配表(FAT) 、目录区和数据区。
·主引导记录区和引导记录区存放DOS 系统启动时所用的信息。
• FAT 是反映当前磁盘扇区使用状况的表。每张DOS 盘含有两个完全相同的FAT
表，即FATI 和FAT2, FAT2 是一张备份表。FAT 与目录一起对磁盘数据区进行
管理。
·目录区存放磁盘上现有的文件目录及其大小、存放时间等信息。
·数据区存储与文件名对应的文件内容数据。
2) 系统型病毒的磁盘存储结构。系统型（引导型）病毒是指专门传染操作系统的启动扇
区的病毒，它一般传染硬盘主引导扇区和磁盘DOS 引导扇区。它的存储结构是：病毒的一剖5
分存放在磁盘的引导扇区中，而另一部分则存放在磁盘的其他扇区中。
242
第8 章计算机病毒与恶意代码防范技术
病毒程序在感染一个磁盘时，首先根据FAT 表在磁盘上找到一个空白簇（如果病毒程
序的第二部分要占用多个簇，则需要找到一个连续的空白簇），然后将病毒程序的第二部
分及磁盘原引导扇区的内容写入该空白簇，接着将病毒程序的第一部分写入磁盘引导
扇区。
当系统型病毒占用这些簇后，随即将在FAT 表中登记项的内容标记为坏簇(FF7H) ，这
避免磁盘在建立文件时将病毒覆盖，因为引导型病毒没有对应的文件名称。
3) 文件型病毒的磁盘存储结构。文件型病毒是指专门感染系统中可执行文件，即扩展名
为com 和exe 的文件。对千文件型的病毒，其程序依附在被感染文件的首部、尾部、中部或
空闲部位，病毒程序并没有独立占用磁盘上的空白簇。即病毒程序所占用的磁盘空间依赖于其
宿主程序所占用的磁盘空间，但是，病毒入侵后一定会使宿主程序占用的磁盘空间增加。绝大
多数文件型病毒都属千外壳型病毒。
(3) 病毒的内存驻留结构
目前，计算机病毒一般都驻留在常规内存中，相对来讲，人们检测计算机病毒也比较方
便，但随着病毒技术的发展，病毒同样也可以驻留在高端内存区，甚至是扩展或扩充内存区，
因此，这给计算机病毒的防范技术提出了更高的要求。
l) 系统型病毒的内存驻留结构。系统型病毒是在系统启动时被装入的，此时，系统中断
INT 21H 还未设定，病毒程序要使自身驻留内存，不能采用系统功能调用的方法。为此，病毒
程序将自身移动到适当的内存高端，采用修改内存向量描述字的方法，将0000:0413 处的内存
容董描述字减少适当的长度（该长度一般等于病毒程序的长度），使得存放在内存高端的病毒
程序不会被其他程序所覆盖。
但高端基本内存并不是唯一的选择，内存中有些小块内存系统没有使用，计算机病毒无
孔不入，把小块空闲内存作为自己的栖身之地， BASIC 病毒就是一例。
2) 文件型病毒的内存驻留结构。对千文件型病毒来说，病毒程序是在运行其宿主程序时
被装入内存的，此时系统中断调用功能已设定，所以病毒程序一般将自身指令代码与宿主程序
进行分离，并将病毒程序移动到内存高端或当前用户程序区最低的内存地址，然后调用系统功
能，将病毒程序常驻千内存。以后即使宿主程序运行结束，病毒程序也驻留在内存而不被任何
应用程序所覆盖。
文件型病毒按其驻留内存方式可分为以下几种。
·高端驻留型：病毒是通过申请一个与病毒体大小相同的内存块来获得内存控制块链最
后一个区域头，并通过减少一个区域头的分配块数来减少内存容量，而使病毒驻留高
端可用区。典型的病毒有Yankee 。
·常规驻留型：病毒是采用DOS 功能调用中的常驻退出的调用方式，将病毒驻留
在需要分配给宿主程序的空间中。为了避免与宿主程序的合法驻留冲突，这一
类病毒通常采用二次创建进程的方式，把宿主程序分离开，并将病毒体放在宿
主程序的物理位置的前面，从而使得病毒只驻留病毒体本身。典型的病毒有
“黑色星期五”。
·内存控制链驻留型：将病毒驻留在系统分配给宿主程序的位置，并为宿主程序重建一
个内存块，通过修改内存控制块链，使得宿主程序结束后只收回宿主程序的内存空
间，从而达到病毒驻留内存的目的。典型的病毒有1701 。
·设备程序补丁驻留型：将病毒作为补丁驻留到设备驱动程序区，并获得优先执行权。
243
计算机网络安全教程笫4 版
这类病毒一般跟DOS 版本有关系。典型的病毒有DIR2 。
·不驻留内存型：它是一种立即传染的病毒，每执行一次带毒程序，就主动在当前路径
中搜索，查到满足要求的可执行文件即进行传染。该类病毒不修改中断向量，不改动
系统的任何状态，因而很难区分当前运行的程序是一个病毒还是一个正常的程序。典
型的病毒有Vienna/648 。
不驻留内存型病毒与驻留内存型病毒的区别在千前者是带毒宿主程序执行时立即传染其
他程序，而后者在带毒宿主程序驻留内存的过程中，一般是不进行传染的，它驻留在系统内，
监视和传染其他程序。
2. 计算机病毒的作用机制
计算机病毒从结构上可以分为三大模块，每一模块各有其自己的工作原理，称之为作用
机制。计算机病毒的作用机制分别称为引导机制、传染机制和破坏机制。
(1) 中断与计算机病毒
中断是CPU 处理外部突发事件的一个重要技术。它能使CPU 在运行过程中对外部事件：
发出的中断请求及时地进行处理，处理完成后又立即返回断点，继续进行CPU 原来的工作。
中断类型的划分如下所示。
硬件中断
｛外部中断：由外设发出的中断
中断｛ 内部中断：因硬件出错或运算出错所引起
软件中断：并不是真正的中断，系统功能调用
CPU 处理中断，规定了中断的优先权，由高到低分别如下。
·除法错。
·不可屏蔽中断。
·可屏蔽中断。
·单步中断。
由千操作系统的开放性，用户可以修改、扩充操作系统，使计算机实现新的功能。｛疹~
操作系统的主要方式之一就是扩充中断功能。计算机提供很多中断，合理合法地修改中断会给
计算机增加非常有用的新功能。如INT IOH 是屏幕显示中断，原来只能显示英文，而在各种
汉字系统中都可以通过修改该中断使其能显示汉字。而在另一方面，计算机病毒则篡改中断为
其达到传染、激发等目的服务。与病毒有关的重要中断有以下几个。
• INT 08H 和INT ICH 的定时中断，每秒调用18.2 次，有些病毒就是利用它们的计时判
断激发条件。
• INT09H 键盘输入中断，病毒用于监视用户击键情况。
• INT IOH 屏幕输入啡拙中断，一些病毒用千在屏幕上显示信息来表现自己。
• INT 13H 磁盘输入／输出中断，引导型病毒用千传染病毒和格式化磁盘。
• INT21HDOS 功能调用，包含了DOS 的大部分功能，已发现的绝大多数文件型病毒修
改该中断，因此也成为防病毒的重点监视部位。
• INT 24H DOS 的严重错误处理中断，文件型病毒经常进行修改，以防止传染写保护磁
盘时被发现。
244
第8 章计算机病毒与恶意代码防范技术
中断程序的入口地址存放在计算机内存的最低端，病毒窃取和修改中断的入口地址获得
中断的控制权，在中断服务过程中插入病毒体，如图8-2 所示。
盗用前：
盗用后1
图8-2 病毒盗用中断示意图
总之，中断可以被用户程序所修改，从而使得中断服务程序被用户指定的程序所替代。
这样虽然大大地方便了用户，但也给计算机病毒制造者以可乘之机。病毒正是通过修改中断以
使该中断指向病毒自身来进行发作和传染的。
(2) 计算机病毒的传染机制
计算机病毒是不能独立存在的，它必须寄生千一个特定的寄生宿主（或称载体）之上。
所谓传染，是指计算机病毒由一个载体传播到另一载体，由一个系统进入另一个系统的过程。
传染性是计算机病毒的主要特性。
计算机病毒的传染均需要中间媒介。对于计算机网络系统来说，计算机病毒的传染是指
从一个染有病毒的计算机系统或工作站系统进入网络后，传染给网络中的另一个计算机系统。
对千单机运行的计算机系统指的是计算机病毒从一个存储介质扩散到另一个存储介质之中，
这些存储介质如软磁盘、硬磁盘、磁带和光盘等；或者指计算机病毒从一个文件扩散到另一个
文件中。计算机病毒的传染方式主要如下。
·病毒程序利用操作系统的引导机制或加载机制进入内存。当计算机系统用一个已感染
病毒的磁盘启动或者运行一个感染了病毒的文件时，病毒就进入内存。
·从内存的病毒传染新的存储介质或程序文件是利用操作系统的读写磁盘的中断或加载
机制来实现的。位于内存中的病毒时刻监视着系统的每一个操作，只要当前的操作满
足病毒所要求的传染条件，如读写一个没有感染过该种病毒的磁盘，或者执行一个没
有感染过的程序文件，病毒程序就立即把自身复制或变异加到被攻击的目标上去，完
成病毒的传染过程。
(3) 计算机病毒的破坏机制
破坏机制在设计原则和工作原理上与传染机制基本相同。它也是通过修改某一中断向量入口
地址，使该中断向量指向病毒程序的破坏模块。这样当系统或被加载的程序访问该中断向量
时，病毒破坏模块被激活，在判断设定条件满足的情况下，对系统或磁盘上的文件进行破坏活
动。计算机病毒的破坏行为体现了病毒的杀伤力。病毒破坏行为的激烈程度取决千病毒作者的
主观愿望和他所具有的技术能量。其主要破坏部位有系统数据区、文件、内存、系统运行、运
行速度、磁盘、屏幕显示、键盘、打印机、CMOS 和主板等。
8.2.2 计算机病毒的分类
按照计算机病毒的特点及特性，计算机病毒的分类方法有许多种。因此，同一种病毒可
能有多种不同的分法。
1．按照病毒攻击的系统分类
l) 攻击DOS 系统的病毒。这类病毒出现最早、最多，变种也最多， 20 世纪出现的计算
245
计算机网络安全教程第4 版
机病毒基本上都是这类病毒。
2) 攻击Windows 系统的病毒。由千Windows 的图形用户界面(GUI) 和多任务操作系统
深受用户的欢迎， Windows 已成为病毒攻击的主要对象。1998 年，出现的CIlI 病毒就是一个
Windows 95/98 病毒。
3) 攻击UNIX 系统的病毒。当前， UNIX 系统应用非常广泛，并且许多大型计算机系统
均采用UNIX 作为其主要的操作系统，所以UNIX 病毒的出现对人类的信息处理也是一个严
重的威胁。
4) 攻击移动终端系统的病毒。常见的移动终端系统有iOS 、Android 和Symbian 等，针
对每种系统现在都有多种病毒，隐私窃取和远程控制是其主要攻击目的。
5) 攻击工业控制系统的病毒。SCADA、PLC 等都是工业控制系统中常见的可攻击对
象，这些担负着数据采集、设备控制等功能的系统一旦被攻击，可能会对工业设备造成严
重损伤。
2．按照病毒的攻击机型分类
l) 攻击微型计算机的病毒。这是世界上传染最为广泛的一种病毒。
2) 攻击小型机的计算机病毒。小型机的应用范围是极为广泛的，它既可以作为网络
的一个结点机，也可以作为小的计算机网络的主机。起初，人们认为计算机病毒只有在微
型计算机上才能发生而小型机则不会受到病毒的侵扰，但自1988 年11 月Internet 网络受
到蠕虫(Worm) 程序的攻击后，使得人们认识到小型机也同样不能免遭计算机病毒的
攻击。
3) 攻击工作站的计算机病毒。近几年，计算机工作站有了较大的进展，并且应用范围
也有了较大的拓展，所以不难想象，攻击计算机工作站的病毒的出现也是对信息系统的一大
威胁。
4) 攻击移动终端设备的病毒。随着移动终端设备的普及，目前其数量已经达到数十亿，
如此庞大的数量一且被攻击将会造成巨大的损失。
5) 攻击工业设备的病毒。＂震网”病毒的出现，使通过计算机病毒攻击工业设备成为现
实，而工业设备对安全性考虑不足这一普遍现象给此类病毒提供了较大生存空间。
3．按照病毒的链结方式分类
由千计算机病毒本身必须有一个攻击对象以实现对计算机系统的攻击，计算机病毒所攻
击的对象是计算机系统可执行的部分。
l) 源码型病毒。该病毒攻击高级语言编写的程序，该病毒在高级语言所编写的程序编译
前插入到源程序中，经编译成为合法程序的一部分。
2) 嵌入型病毒。这种病毒是将自身嵌入到现有程序中，把计算机病毒的主体程序与其攻
，击的对象以插入的方式链接。这种计算机病毒是难以编写的，一旦侵入程序体后也较难消除。
如果同时采用多态性病毒技术、超级病毒技术和隐蔽性病毒技术，将给当前的反病毒技术带来
严峻的挑战。
3) 外壳型病毒。外壳型病毒将其自身包围在主程序的四周，对原来的程序不做修改。这
种病毒最为常见，既易于编写，也易千发现，一般测试文件的大小即可得知。
4) 操作系统型病毒。这种病毒试图把它自己的程序加入或取代部分操作系统进行工作，
具有很强的破坏力，可以导致整个系统的瘫痪。圆点病毒和大麻病毒就是典型的操作系统型
病毒。这种病毒在运行时用自己的逻辑部分取代操作系统的合法程序模块，根据病毒自身的
246
第8 章计算机病毒与恶意代码防范技术
特点和被替代的操作系统中合法程序模块在操作系统中运行的地位与作用，以及病毒取代操作
系统的取代方式等，对操作系统进行破坏。
4. 按照病毒的破坏情况分类
按照计算机病毒的破坏情况可分为良性和恶性两类。
(1) 良性计算机病毒
良性计算机病毒是指其不包含立即对计算机系统产生直接破坏作用的代码。这类病毒
为了表现其存在，只是不停地进行扩散，从一台计算机传染到另一台，并不破坏计算机内
的数据。这种病毒多数是恶作剧者的产物，他们的目的不是为了破坏系统和数据，而是为
了让使用染有病毒的计算机用户通过显示器或扬声器看到或听到病毒设计者的编程技术。
这类病毒有小球病毒、1575/1591 病毒、救护车病毒、扬基病毒和Dabi 病毒等。还有一些
人利用病毒的这些特点宣传自己的政治观点和主张。也有一些病毒设计者在其编制的病毒
发作时进行人身攻击。
有些人对这类计算机病毒的传染不以为然，认为这只是恶作剧，没什么关系。其实良性
和恶性都是相对而言的。良性病毒取得系统控制权后，会导致整个系统和应用程序争抢CPU
的控制权，可能会导致整个系统死锁，给正常操作带来麻烦。有时系统内还会出现几种病毒交
叉感染的现象，一个文件不停地反复被几种病毒所感染。因此也不能轻视良性病毒对计算机系
统造成的损害。
(2) 恶性计算机病毒
恶性计算机病毒是指在其代码中包含损伤和破坏计算机系统的操作，在其传染或发作时
会对系统产生直接的破坏作用。这类病毒有很多，如黑色星期五病毒、火炬病毒和米开朗基罗
病毒等。当米氏病毒发作时，硬盘的前17 个扇区将被彻底破坏，使整个硬盘上的数据无法被
恢复，造成的损失是无法挽回的。有的病毒还会对硬盘做格式化等破坏性操作。因此这类恶性
病毒是很危险的，应当注意防范。防病毒系统可以通过监控系统内的这类异常动作识别出计算
机病毒的存在与否，或至少发出警报提醒用户注意。
5．按照病毒的寄生方式分类
传染性是计算机病毒的本质属性，根据寄生部位或传染对象分类，即根据计算机病毒的
寄生方式进行分类，有以下几种。
(1) 引导型病毒
引导型病毒是指寄生在磁盘引导区或主引导区的计算机病毒。这种病毒主要是用病毒的
全部或部分逻辑取代正常的引导记录，而将正常的引导记录隐藏在磁盘的其他地方。这种病毒
利用系统引导时不对主引导区的内容正确与否进行判别的缺点，在引导型系统的过程中侵入系
统，驻留内存，监视系统运行，伺机传染和破坏。按照引导型病毒在硬盘上的寄生位置又可细
分为主引导记录病毒和分区引导记录病毒。主引导记录病毒感染硬盘的主引导区，如大麻病
毒、2708 病毒和火炬病毒等；分区引导记录病毒感染硬盘的活动分区引导记录，如小球病
毒、Girl 病毒等。
(2) 文件型病毒
文件型病毒是指能够寄生在文件中的计算机病毒。这类病毒程序感染可执行文件或数据
文件。寄生在可执行程序中的病毒，一且程序被执行，病毒也就被激活，病毒程序首先被执
行，并将自身驻留内存，然后设置触发条件进行传染。如果这些可执行程序是操作系统的一部
分，只要计算机开始工作，病毒就处在随时被触发的状态。文件型病毒感染．com 和．exe 等可
247
计算机网络安全教程第4 版
执行文件，如1575/1591 病毒、848 病毒等，以及Macro/Concept、Macro/Atoms 等宏病毒感染
DOC 文件。
(3) 复合型病毒
复合型病毒是指具有引导型病毒和文件型病毒寄生方式的计算机病毒。这种病毒扩大了
病毒程序的传染途径， 它既感染磁盘的引导记录，又感染可执行文件。当染有此种病毒的磁盘
用千引导系统或调用执行染毒文件时，病毒都会被激活。因此在检测和消除复合型病毒时，必
须全面、彻底地根治，如果只发现该病毒的一个特性，把它只当作引导型或文件型病毒进行清
除。虽然好像是清除了，但还留有隐患，这种经过消毒后的“洁净”系统更具有攻击性。这~
病毒有Flip 病毒、新世纪病毒和One-half病毒等。
6. 按照病毒的传播媒介分类
按照计算机病毒的传播媒介来分类，可分为单机病毒和网络病毒。
l) 单机病毒。单机病毒的载体是磁盘，常见的是病毒从U 盘或光盘传入硬盘，感~系
统然后再传染其他U 盘， U 盘又传染其他系统。
2) 网络病毒。网络病毒的传播媒介不再是移动式载体，而是网络通道，这种病毒的~~
能力更强，破坏力更大。
8.2.3 病毒实例分析
I. C田病毒
1999 年4 月26 日， CIH 病毒大爆发，全球超过6000 万台计算机被破坏， 2000 年CIlI~
度爆发，全球损失超过10 亿美元， 2001 年仅北京就有超过6000 台计算机遭破坏， 2002 年：
CIH 病毒使数于台计算机遭破坏，瑞星公司修复硬盘数量一天接近200 块。据有关报道， ~~
有6000 万台计算机受到破坏，大量重要资料无法复原，灾情严重者，连计算机主板也不f辱~
更换。仅一天，由千CIH 病毒发作，我国受损的计算机总数约有36 万台，所造成的直接、间
接经济损失超过10 亿元人民币。
(I) CIH 病毒的表现形式
CIH 病毒是一种文件型病毒，又称Wm95.CIH、Wm32.CIH 或PE_CIH, 是第一例感染
Wmdows95/98 环境下PE 格式(Portable Executable Fonnat) exe 文件的病毒，就其表现形式及
症状而言，具有以下特点。
·受感染的．exe 文件的文件长度没有改变。
• DOS 及WIN 3.1 格式(NE 格式）的可执行文件不受感染，并且在Windows NT 中无
效。
·用资源管理器中“工具”-“查找“一“文件或文件夹＂的“高级一包含文字“查
找exe 特征字符串—-C田V, 在查找过程中，显示出一大堆符合查找特征的可执行
文件。
·若4 月26 日开机，显示器突然黑屏，硬盘指示灯闪烁不停，重新开机后，计算机无法
启动。
(2) Crn: 病毒的行为机制
同传统的DOS 型病毒相比，无论是在内存的驻留方式还是传染的方式，以及病毒攻
击的对象， CII-I 病毒都与众不同。病毒的代码不长， CII-Ivl.2 只有1003B, 其他版本也大
小差不多。它绕过了微软提供的应用程序界面，绕过了ActiveX、C+ ＋甚至C 语言，使
248
第8 章计算机病毒与恶意代码防范技术
用汇编语言，利用VxD （虚拟设备驱动程序）接口编程，直接进入Windows 内核。它没
有改变宿主文件的大小，而是采用了一种新的文件感染机制，即碎洞攻击(Fragmented
Cavity Attack) ，将病毒化整为零，拆分成若干块，插入宿主文件中去；最引人注目的是它
利用目前许多BIOS 芯片开放了可重写的特性，向计算机主板的BIOS 端口写入乱码，开
创了病毒直接进攻计算机主板芯片的先例。可以说CIH 病毒提供了一种全新的病毒程序方
式和病毒发展方向。
该病毒是通过文件进行传播的。计算机开机以后，如果运行了带病毒的文件，其病毒就
驻留在Wmdows 的系统内存里了。此后，只要运行了PE 格式的exe 文件，这些文件就会感染
上该病毒。
(3) CIH 病毒的危害
CRN 病毒有多个版本，典型的有： CIHvl.2: 4 月26 日发作，长度为1003B, 包含字符：
Cillvl.2TIIT; CIHvl.3: 6 月26 日发作，长度为1010B, 包含字符： CIHvl.3TTIT;
Cillvl.4：每月26 日发作，长度为1019B, 包含字符： CIHvl.4TATUNG。其中，最流行的是
Cillvl.2 版本。
病毒的危害主要表现在病毒发作后，硬盘数据全部丢失，甚至主板上BIOS 中的原内容会
被彻底破坏，主机无法启动。只有更换BIOS, 或向BIOS 中重新写入原来版本的程序， 才能
解决问题。
2. 宏病毒
所谓宏，就是软件设计者为了在使用软件工作时避免一再地重复相同动作而设计出来的
一种工具。它利用简单的语法，把常用的动作编写成宏，当再工作时，就可以直接利用事先写
好的宏自动运行，完成某项特定的任务，而不必再重复相同的动作。在Microsoft Word 中，对
宏的定义为“宏就是能组织到一起作为一个独立的命令使用的一系列Word 命令，它能使日常
工作变得更容易。”宏是使用Word Basic 语言来编写的。
所谓宏病毒，是利用软件所支持的宏命令编写成的具有复制和传染能力的宏。宏病毒是
一种新形态的计算机病毒，也是一种跨平台的计算机病毒，可以在Wmdows 9X、Windows
NT/2000、OS/2 和M砒intosh System 7 等操作系统上执行。
(1) 宏病毒的行为机制
Word 模式定义了一种文件格式，将文档资料及该文档所需要的宏混在一起放在扩展名
为．doc 的文件之中，这种做法已经不同千以往的软件将资料和宏分开存储的方法。正因为这种
宏也是文档资料，便产生了宏感染的可能性。因为文档资料的携带性极高，如果宏随着文档而
被分派到不同的工作平台，只要能被执行，它也就类似千计算机病毒的传染过程，不过这种形
式的传染有源代码被公开的特点。
Word 的工作模式是当载入文件时，就先执行起始的宏，接着载入文件内容。因此， Word
便为大众事先定义一个共用的模板文档(Nonnal.dot) ，里面包含了基本的宏。只要一启动
Word, 就会自动运行Normal.dot 文件。类似的电子表格软件Exce) 也支持宏，但它的模板文
件是Personal.xis。这样做等于是为宏病毒大开方便之门，只要编写了有问题的宏，再去感染
这个共用模板(Normal.dot 或Personal.xis)，那么只要执行Word 和Excel, 这个受感染的共用
模板即被载入，计算机病毒便随之传播到之后所编辑的文档中去。当然这只是宏病毒传播的一
个基本途径，一些更厉害的宏病毒还有其他的传播途径。
249
计算机网络安全教程第4 版
Word 宏病毒通过doc 文件和．dot 模板进行自我复制及传播。Word 文件是交流最广的文
件类型。这就为Word 宏病毒传播带来了很多便利，特别是Internet 网络的普及和E-mail 的大
量应用更为Word 宏病毒的传播“拓展”了道路。
鉴于宏病毒用Word Basic 语言编写， Word Basic 语言提供了许多系统低层调用，如直接
使用DOS 系统命令，调用Windows API 函数、DLL 等。这些操作均可能对系统造成直接威
胁，而Word 在指令安全性和完整性上的检测能力很弱，破坏系统的指令很容易被执行，因此
破坏可能极大。宏病毒Nuclear 就是破坏操作系统的典型实例。
(2) Word 宏病毒特征
I) Word 宏病毒会感染．doc 文件和dot 模板文件。被它感染的．doc 文件会被改为模板文件
而不是文档文件，而用户在另存文件时，就无法将该文件转换为其他形式，而只能用模板方式
存盘。
2) Word 宏病毒的传染通常是Word 在打开一个带宏病毒的文件或模板时，激活宏病毒。
病毒宏将自身复制到Word 通用(Normal) 模板中，以后在打开或关闭文件时，宏病毒就会把
病毒复制到该文件中。
3) 多数Word 宏病毒包含AutoOpen、AutoClose、AutoNew 和AutoExit 等自动宏，通过
这些自动宏病毒取得文件（模板）操作权。有些宏病毒通过这些自动宏控制文件操作。
4) Word 宏病毒中总是含有对文件读写操作的宏命令。
5) Word 宏病毒在．doc 文件和dot 模板中以BFF (Binary File Format) 格式存放，这是一
种加密压缩格式，不同Word 版本格式可能不兼容。,
3. 网络病毒
网络病毒实际上是一个笼统的概念。一种情况是，网络病毒专指在网络传播、并对网络
进行破坏的病毒；另一种情况是，网络病毒指的是HTML 病毒、E-mail 病毒及Java 病毒等与
因特网有关的病毒。
(1) 网络病毒的特点
计算机网络的主要特点是资源共享。一旦共享资源感染病毒，网络各节点间信息的频繁
传输会把病毒传染到所共享的计算机上，从而形成多种共享资源的交叉感染。病毒的迅速传
播、再生和发作将造成比单机病毒更大的危害。对千金融等系统的敏感数据，一旦遭到破坏后
果就不堪设想。因此，网络环境下病毒的防范就显得更加重要了。
因特网的飞速发展给反病毒工作带来了新的挑战。因特网上有众多的软件供下载，有
大量的数据交换，这给病毒的大范围传播提供了可能。因特网衍生出一些新一代病毒，即
Java 及ActiveX 病毒。它们不需要宿主程序，因为因特网就是带着它们到处肆虐的宿主。
它们不需要停留在硬盘中，且可以与传统病毒混杂在一起，不被人们察觉。更厉害的是它
们可以跨越操作系统平台，一旦遭受感染，便毁坏所有操作系统。网络病毒一旦突破网络
安全系统，传播到网络服务器，进而在整个网络上感染、再生，就会使网络系统资源遭到
严重破坏。
在网络环境中，计算机病毒具有如下一些新的特点。
l) 传染方式多。病毒入侵网络的主要途径是通过工作站传播到服务器硬盘，再由服务器
的共享目录传播到其他工作站，病毒传染方式多且复杂。
2) 传播速度比较快。在单机上，病毒只可能通过U 盘或光盘从一台计算机传染到另一台
计算机，而在网络中病毒则可以通过网络通信机制，借助通信链路进行迅速扩散。由千病毒在
250
第8 章计算机病毒与恶意代码防范技术
网络中的传染速度非常快，故其传染范围很大，不但能迅速传染局域网内的计算机，还能通过
远程工作站瞬间传播到千里之外。
3) 清除难度大。在单机上，再顽固的病毒也可通过删除带毒文件、低级格式化硬盘等措
施将病毒清除，而在网络中只要有一台工作站未消毒干净就可使整个网络全部被病毒感染，甚
至刚刚完成消毒的一台工作站也有可能被网络上另一台工作站的带病毒程序所传染。因此，仅
对工作站进行杀毒处理并不能彻底解决问题。
4) 破坏性强。网络上的病毒将直接影响网络的正常工作，轻则降低速度、影响工作效
率，重则造成网络系统的瘫痪、破坏服务器系统资源，使多年工作毁于一旦。
5) 潜在性深。网络一旦感染了病毒，即使病毒已被消除，其潜在危险仍然巨大。根据研
究发现，病毒在网络上被消除后，约85％的网络在30 天内会再次被感染。
(2) 病毒在网络上的传播与表现
大多数公司使用局域网文件服务器，用户直接从文件服务器复制己感染的文件。用户在
工作站上执行一个带毒操作系统文件，这种病毒就会感染网络上的其他可执行文件。
因为文件和目录级保护只在文件服务器中出现，而不在工作站中出现，所以可执行文件
病毒无法破坏基于网络的文件保护。然而，一般文件服务器中的许多文件并未得到保护，而且
非常容易成为感染的有效目标。文件服务器作为可执行文件病毒的载体，病毒感染的程序可能
驻留在网络中，但是除非这些病毒经过特别设计与网络软件集成在一起，否则它们只能从客户
的计算机上被激活。
使用网络的另一种方式是对等网络，在端到端网络上，用户可以读出和写入每个连接的
工作站上本地硬盘中的文件。因此，每个工作站都可以有效地成为另一个工作站的客户和服务
器。而且，端到端网络的安全性很可能比专门维护的文件服务器的安全性更差。这些特点使得
端到端网络对基于文件的病毒的攻击尤其敏感。如果一台己感染病毒的计算机可以执行另一台
计算机中的文件，那么这台感染病毒计算机中的活动的内存驻留病毒能够立即感染另一台计算
机硬盘上的可执行文件。
4. 电子邮件病毒
电子邮件病毒其实和普通的计算机病毒一样，只不过它们的传播途径主要是通过电子邮
件，所以才被称为“电子邮件病毒”。如今电子邮件已被广泛使用， 也成为病毒传播的主要途
径之一。由千可同时向一群用户或整个计算机系统发送电子邮件，一旦一个信息点被感染，整
个系统在很短时间内就可能被感染。
电子邮件系统的一个特点是不同的邮件系统使用不同的格式存储文件和文档，传统的杀
毒软件对检测此类格式的文件无能为力。另外，通常用户并不能访问邮件数据库，因为它们往
往在远程服务器上。
传播速度快、传播范围广和破坏力大是电子邮件系统病毒的又一特点。绝大多数通过
E-mail 传播的病毒都有自我复制的能力，这正是电子邮件病毒的危险之处。电子邮件病毒能够
主动选择用户邮箱地址簿中的地址发送邮件，或者在用户发送邮件时，将被病毒感染的文件附
到邮件上一起发送。这种呈指数增长的传播速度可以使病毒在很短的时间内遍布整个
Int.em.et。2000 年5 月4 日，“爱虫”病毒爆发的第一天便有6 万台以上机器被感染，在短短不
到一个月内就已造成超过67 亿美元的损失。当电子邮件病毒发作时，往往会导致整个网络的
瘫痪，而网络瘫痪造成的损失往往是难以估计的。
251
计算机网络安全教程笫4 版
8.3 计算机病毒的检测与防范
由千计算机病毒具有相当的复杂性和行为不确定性，计算机病毒的检测与防范需要多~
技术综合应用。
8.3.1 计算机病毒的检测
计算机病毒对系统的破坏离不开当前计算机的资源和技术水平。对病毒的检测主要~~
查系统资源的异常情况入手，逐步深入。
1. 异常情况判断
计算机工作时，如出现下列异常现象，则有可能感染了病毒。
l) 屏幕出现异常图形或画面，这些画面可能是一些鬼怪，也可能是一些下落的雨点、字：
符或树叶等，并且系统很难退出或恢复。
2) 扬声器发出与正常操作无关的声音，如演奏乐曲或是随意组合的、杂乱的声音。
3) 磁盘可用空间减少，出现大量坏簇，且坏簇数目不断增多，直到无法继续工作。
4) 硬盘不能引导系统。
5) 磁盘上的文件或程序丢失。
6) 磁盘读／写文件明显变慢，访问的时间加长。
7) 系统引导变慢或出现问题，有的出现“写保护错”提示。
8) 系统经常死机或出现异常的重启动现象。
9) 原来运行的程序突然不能运行，总是出现出错提示。
10) 连接的打印机不能正常启动。
观察到上述异常情况后，可初步判断系统的哪部分资源受到了病毒侵袭，为进一步~断
和清除做好准备。
2. 检测的主要依据
(1) 检查磁盘主引导扇区
硬盘的主引导扇区、分区表，以及文件分配表、文件目录区是病毒攻击的主要目标。
引导病毒主要攻击磁盘上的引导扇区。硬盘存放主引导记录的主引导扇区一般位千0 柱：
面0 磁道1 扇区。该扇区的前3 个字节是跳转指令(DOS 下），接下来的8 个字节是厂商、版龟
本信息，再向下的18 个字节均是BIOS 参数，记录有磁盘空间、FAT 表和文件目录的相对咖位：
置等，其余字节是引导程序代码。病毒侵犯引导扇区的重点是前面的几十个字节。
当发现系统有异常现象时，特别是当发现与系统引导信息有关的异常现象时，可通~检：
查主引导扇区的内容来诊断故障。方法是采用工具软件，将当前主引导扇区的内容与干净的备·
份相比较，如发现有异常，则很可能是感染了病毒。
(2) 检查FAT 表
病毒隐藏在磁盘上，一般要对存放的位置做出“坏簇“信息标志反映在FAT 表中。因
此，可通过检查FAT 表，看有无意外坏簇，来判断是否感染了病毒。
(3) 检查中断向量
计算机病毒平时隐藏在磁盘上，在系统启动后，随系统或随调用的可执行文件进入内＃
并驻留下来，一旦时机成熟，它就开始发起攻击。病毒隐藏和激活一般是采用中断的方法， 即
252
第8 章计算机病毒与恶意代码防范技术
修改中断向量，使系统在适当时转向执行病毒代码。病毒代码执行完后，再转回到原中断处理
程序执行。因此，可通过检查中断向量有无变化来确定是否感染了病毒。
检查中断向量的变化主要是查看系统的中断向蜇表，其备份文件一般为INT.DAT。病毒
最常攻击的中断有：磁盘输入溜讲丹1 断(13H) ，绝对读、写中断(25H、26H) ，以及时钟中
断(08H) 等。
(4) 检查可执行文件
检查．com 或exe 可执行文件的内容、长度和属性等，可判断是否感染了病毒。检查可执
行文件的重点是在这些程序的头部即前面的20 个字节左右。因为病毒主要改变文件的起始部
分。对于前附式com 文件型病毒，主要感染文件的起始部分，一开始就是病毒代码。对于后
附式com 文件型病毒，虽然病毒代码在文件后部，但文件开始必有一条跳转指令，以使程序
跳转到后部的病毒代码。对千．exe 文件型病毒，文件头部的程序入口指针一定会被改变。因
此，对可执行文件的检查主要查看这些可疑文件的头部。
(5) 检查内存空间
计算机病毒在传染或执行时，必然要占据一定的内存空间，并驻留在内存中，等待时机
再进行传染或攻击。病毒占用的内存空间一般是用户不能覆盖的。因此，可通过检查内存的大
小和内存中的数据来判断是否有病毒。
通常采用一些简单的工具软件，如PCTOOLS 、DEBUG 等进行检查。病毒驻留到内存
后，为防止DOS 系统将其覆盖，一般都要修改系统数据区记录的系统内存数或内存控制块中
的数据。如检查出来的内存可用空间为635KB, 而计算机真正配置的内存空间为640KB, 则
说明有5KB 内存空间被病毒侵占。
虽然内存空间很大，但有些重要数据存放在固定的地点，可首先检查这些地方，如DOS
系统启动后， BIOS 、变量和设备驱动程序等是放在内存中的固定区域内(0:4000H,_,
0:4FFOH) 。根据出现的故障，可检查对应的内存区以发现病毒的踪迹。如打印、通信和绘图
等出的故障，很可能在检查相应的驱动程序时能发现问题。
(6) 检查特征串
一些经常出现的病毒都具有明显的特征，即有特殊的字符串。根据它们的特征，可通过
工具软件检查和搜索，以确定病毒的存在和种类。例如，磁盘杀手病毒程序中就有ASCII 码
disk killer，这就是该病毒的特征字符串。杀病毒软件一般都收集了各种已知病毒的特征字符
串，并构造出病毒特征数据库，这样，在检查和搜索可疑文件时，就可用特征数据库中的病毒
特征字符串逐一比较，确定被检测文件感染了何种病毒。
这种方法不仅可检查文件是否感染了病毒，并且可确定感染病毒的种类，从而能有效地
清除病毒。但缺点是只能检查和发现已知的病毒，不能检查新出现的病毒，而且由于病毒不断
变形与更新，老病毒也会以新面孔出现。因此，病毒特征数据库和检查软件也要不断更新版
本，才能满足使用需要。
3. 计算机病毒的检测手段
(1) 特征代码法
特征代码法被早期应用千SCAN 、CPAV 等著名病毒检测工具中。国外专家认为特征代码
法是检测已知病毒的最简单、开销最小的方法。
特征代码法的实现步骤如下。
253
计算机网络安全教程笫4 版
1) 采集已知病毒样本，病毒如果既感染com 文件，又感染exe 文件，对这种病毒要同时
采集com 型病毒样本和exe 型病毒样本。
2) 在病毒样本中，抽取特征代码。依据如下原则：抽取的代码比较特殊，不大可能与普
通正常程序代码吻合。抽取的代码要有适当长度，一方面维持特征代码的唯一性，另一方面又．
不要有太大的空间与时间的开销。如果一种病毒的特征代码增长lB, 要检测3000 种病毒，增
加的空间就是3000B。在保持唯一性的前提下，尽量使特征代码长度短些，以减少空间与时间
开销。在既感染com 文件又感染exe 文件的病毒样本中，要抽取两种样本共有的代码。将特：
征代码纳入病毒数据库。
3) 打开被检测文件，在文件中搜索和检查文件中是否含有病毒数据库中的病毒特~代：
码。如果发现病毒特征代码，由于特征代码与病毒一一对应，便可以断定，被查文件中患有在I
种病毒。
检测准确、可识别病毒的名称和误报警率低是特征代码法的优点，可依据检测结~，
进行解毒处理。但是，采用病毒特征代码法的检测工具，面对不断出现的新病毒，必~不；
断更新版本，否则检测工具便会老化，逐渐失去实用价值。病毒特征代码法对从未~过：的
新病毒，自然无法知道其特征代码，因而无法检测这些新病毒。另外，搜集已知病毒的特；
征代码，费用开销大，在网络上效率低（在网络服务器上，因长时间检索会使整个网~性：
能变坏）。
因此，特征代码法有以下的特点。
·速度慢。随着病毒种类的增多，检索时间变长。如果检索5000 种病毒，必须逐一检：查:
5000 个病毒特征代码。如果病毒种数再增加，检测病毒的时间开销就变得十分可观七
此类工具检测的高速性，将变得日益困难。
·误报警率低。
·不能检查多态性病毒。特征代码法是不可能检测多态性病毒的。国外专家认为多~性t生
病毒是病毒特征代码法的终结者。
·不能对付隐蔽性病毒。隐蔽性病毒如果先进驻内存，后运行病毒检测工具，隐蔽十生~
毒能先千检测工具，将被查文件中的病毒代码剥去，检测工具其实是在检查一个虚假t
的“好文件”，而不能报警，被隐蔽性病毒蒙骗。
(2) 校验和法
将正常文件的内容，计算其校验和，将该校验和写入文件中或写入别的文件中保存。在：
文件使用过程中，定期地或每次使用文件前，检查文件现在内容算出的校验和与原来保存的校：
验和是否一致，因而可以发现文件是否感染，这种方法称为校验和法，它既可发现已知病毒又．
可发现未知病毒。在SCAN 和CPAV 工具的后期版本中除了病毒特征代码法之外，也纳A校：
验和法，以提高其检测能力。
运用校验和法查病毒采用以下3 种方式。
l) 在检测病毒工具中纳入校验和法，对被查的对象文件计算其正常状态的校验和，~校：
验和值写入被查文件中或检测工具中，之后进行比较。
2) 在应用程序中，放入校验和法自我检查功能，将文件正常状态的校验和写入文件＊身
中，每当应用程序启动时，比较现行校验和与原校验和值，实现应用程序的自检测。
3) 用校验和检查程序常驻内存，每当应用程序开始运行时，自动比较检查应用程序内剖；
或别的文件中预先保存的校验和。
254
第8 章计算机病毒与恶意代码防范技术
但是，这种方法不能识别病毒类，不能报出病毒名称。由千病毒感染并非文件内容改变
的唯一原因，文件内容的改变有可能是正常程序引起的，所以校验和法常常误报警。而且此方
法也会影响文件的运行速度。
病毒感染的确会引起文件内容变化，但是校验和法对文件内容的变化太敏感，又不
能区分正常程序引起的变动，而频繁报警。用监视文件的校验和来检测病毒，不是最好
的方法。
这种方法遇到已有软件版本更新、变更口令和修改运行参数等，都会发生误报警。
校验和法对隐蔽性病毒无效。隐蔽性病毒进驻内存后，会自动剥去染毒程序中的病毒代
码，使校验和法受骗，对一个有毒文件算出正常校验和。
因此，校验和法的优点是：方法简单能发现未知病毒，被查文件的细微变化也能发现。
其缺点是：会误报警，不能识别病毒名称，不能对付隐蔽型病毒。
(3) 行为监测法
利用病毒的特有行为特征来监测病毒的方法，称为行为监测法。通过对病毒多年的观察
与研究，有一些行为是病毒的共同行为，而且比较特殊。在正常程序中，这些行为比较罕见。
当程序运行时，监视其行为，如果发现了病毒行为，立即报警。
这些能够作为监测病毒的行为特征如下。
·占有INT 13H。所有的引导型病毒，都攻击BOOT 扇区或主引导扇区。系统启动时，
当BOOT 扇区或主引导扇区获得执行权时，系统刚刚开始工作。一般引导型病毒都会
占用INT 13H 功能，因为其他系统功能未设置好，无法利用。引导型病毒占据1NT
13H 功能，在其中放置病毒所需的代码。
·修改DOS 系统内存总量。病毒常驻内存后，为了防止DOS 系统将其覆盖，必须修改
系统内存总量。
·对com、.exe 文件做写入动作。病毒要感染com、.exe 文件，必须对它们进行写操作。
·病毒程序与宿主程序的切换。染毒程序运行中，先运行病毒，而后执行宿主程序。在
两者切换时，有许多特征行为。
行为监测法的优点：可发现未知病毒，可相当准确地预报未知的多数病毒。行为监测法
的缺点：可能误报警，不能识别病毒名称，实现时有一定难度。
(4) 软件模拟法
多态性病毒每次感染都改变其病毒密码，对付这种病毒，特征代码法失效。因为多态性
病毒代码实施密码化，而且每次所用密钥不同，把染毒的病毒代码相互比较，也无法找出相同
的可能作为特征的稳定代码。虽然行为检测法可以检测多态性病毒，但是在检测出病毒后，因
为不知病毒的种类，难以做消毒处理。
为了检测多态性病毒，可应用新的检测方法一一软件模拟法。它使用一种软件分析器，
用软件方法来模拟和分析程序的运行。该类工具开始运行时，使用特征代码法检测病毒，如果
发现隐蔽病毒或多态性病毒嫌疑时，启动软件模拟模块，监视病毒的运行，待病毒自身的密码
译码以后，再运用特征代码法来识别病毒的种类。
8.3.2 计算机病毒的防范
俗话说“防患于未然“，杀毒不如防毒。由于在计算机病毒的处理过程中，只能是发现一
种病毒以后，才可以找到相应的治疗方法，因此具有很大的被动性。而防范计算机病毒，则可
255
计算机网络安全教程第4 版
掌握工作的主动权，重点应放在计算机病毒的预防上。防范计算机病毒主要从管理和技术两方
面着手。
1 ．严格的管理
制定相应的管理制度，避免蓄意制造、传播病毒的事件发生。例如，对接触重要计算机
系统的人员进行选择和审查；对系统的工作人员和资源进行访问权限划分；对外来人员上机或
外来磁盘的使用严格限制，特别是不准用外来系统盘启动系统；不准随意玩游戏；规定下载的
文件要经过严格检查，有时还规定下载文件、接收E-mail 等需要使用专门的终端和账号，接
收到的程序要严格限制执行等。及早发现、及早清除、建立安全管理制度，提高包括系统管理
员和用户在内的技术素质和职业道德素质。
2. 有效的技术
除管理方面的措施外，采取有效的技术措施防止计算机病毒的感染和蔓延也是十分重要
的。针对病毒的特点，利用现有的技术，开发出新的技术，使防御病毒软件在与计算机病毒的
对抗中不断得到完善，更好地发挥保护计算机的作用。
计算机病毒预防是指在病毒尚未入侵或刚刚入侵时，就拦截和阻击病毒的入侵或立即~
警。目前在预防病毒工具中采用的技术主要有以下几个。
1) 将大量的消毒／杀毒软件汇集一体，检查是否存在已知病毒，如在开机时或在执行每一
个可执行文件前执行扫描程序。这种工具的缺点是：对变种或未知病毒无效；系统开销大，~
驻内存，每次扫描都要花费一定的时间，已知病毒越多，扫描时间越长。
2) 检测一些病毒经常要改变的系统信息，如引导区、中断向量表和可用内存空间等， 以
确定是否存在病毒行为。其缺点是：无法准确识别正常程序与病毒程序的行为，常常报警，而．
频频误报警的结果是使用户失去对病毒的戒心。
3) 监测写盘操作， 对引导区或主引导区的写操作报警。若有一个程序对可执行文件进~
写操作，就认为该程序可能是病毒，阻击其写操作并报警。其缺点是：一些正常程序同样有写
操作，因而被误报警。
4) 对计算机系统中的文件形成一个密码检验码和实现对程序完整性的验证，在程序执行
前或定期对程序进行密码校验，如有不匹配现象即报警。其优点是：易于早发现病毒，对已知
和未知病毒都有防止和抑制能力。
5) 智能判断型：设计病毒行为过程判定知识库，应用人工智能技术，有效区分正常程序：
与病毒程序行为，是否误报警取决千知识库选取的合理性。其缺点是：单一的知识库无法覆盖｀
所有的病毒行为，如对不驻留内存的新病毒，就会漏报。
6) 智能监察型：设计病毒特征库（静态）、病毒行为知识库（动态）和受保护程序存~
行为知识库（动态）等多个知识库及相应的可变推理机。通过调整推理机，能够对付新类型~
毒，误报和漏报较少。这是未来预防病毒技术发展的方向。
3. 宏病毒的防范
通过Word 来防止宏病毒的感染和传播，但是对大多数人来说，反宏病毒主要还是依赖各
种反宏病毒软件。当前，处理宏病毒的反病毒软件主要分为两类：常规反病毒扫描器和基千
Word 或者Excel 宏的专门处理宏病毒的反病毒软件。两类软件各有优势，一般来说，前者的
适应能力强于后者。因为基于Word 或者Excel 的反病毒软件只能适应于特定版本的Office 应
用系统，换为另一种语言的版本可能就无能为力了，而且，在应用系统频频升级的今天，升级
后的版本对现有软件是否兼容是难以预料的。
256
第8 章计算机病毒与恶意代码防范技术
4. 电子邮件病毒的防范
对电子邮件系统进行病毒防护可从以下几个方面着手。
l) 思想上高度重视，不要轻易打开来信中的附件，尤其对千一些．exe 之类的可执行程序
文件，就更要谨慎。
2) 不断完善“网关“软件及病毒防火墙软件，加强对整个网络入口点的防范。
3) 使用优秀的防毒软件，同时保护客户机和服务器。
使用优秀的防毒软件定期扫描客户机和服务器上所有的文件夹，无论病毒是隐藏在邮件
文本内，还是躲在附件或OLE 文档内，防毒软件都有能力发现。防毒软件还应有能力扫描压
缩文件。只有客户机上的防毒软件才能访问个人目录，防止病毒从客户机外部入侵。服务器上
的防毒软件可进行全局监测和查杀病毒，防止病毒在整个系统中扩散，阻止病毒入侵本地邮件
系统；同时，也可以防止病毒通过邮件系统中扩散。
4) 使用特定的SMTP 杀毒软件。
SMTP 杀毒软件具有独特的功能，它能在那些从因特网上下载的受感染邮件到达本地邮件
服务器之前拦截它们，从而保持本地网络处于无毒状态。
8.3.3 计算机病毒的发展方向和趋势
1. 计算机病毒的新特性
自“快乐时光”(Happytirne) 病毒开始，世界上流行的病毒就开始体现出与以往病毒截
然不同的特征和发展方向，它们无一例外地与网络结合，并都同时具有多种攻击手段。尤其是
SiICam 之后的病毒，往往同时具有两个以上的传播方法和攻击手段，一旦爆发即在网络上快
速传播，难以遏制，加之与黑客技术的融合，潜在的威胁和损失更加巨大。通过分析对照，这
些病毒有如下一些新特性。
l) 利用微软漏洞主动传播。CodeRed、Nirnda、WantJob 和BinLaden 都是通过微软漏洞
进行主动传播的。特别是2007 年以来，利用微软系统AUTORUN 自动播放功能的病毒一直居
高不下，几乎所有新的木马病毒都具备了这一传播特征。U 盘已经成为最大的计算机病毒
载体。
2) 局域网内快速传播。虽然2001 年初的FunLove 病毒就初具局域网传播的特性，但
是Nimda 和WantJob 才算让人们真正见识到局域网的方便快捷被用在病毒传播上会更“有
效“。Nimda 不仅能通过局域网向其他计算机写入大量具有迷惑性的带毒文件，还会让已中
毒的计算机完全共享所有资源，造成交叉感染。一旦在局域网中有一台计算机染上了
Nimda 病毒，那么这种攻击会无穷无尽。
3) 以多种方式传播。过去的病毒想方设法地隐藏自己，生怕被发现后无处可逃。而现在
计算机与外面的联系四通八达，一般都有两种以上的传播方式，如Nimda, 可以通过文件传
染，也可以通过邮件传播， 还可以通过局域网传播，甚至可以利用IIS 的Unicode 后门进
行传播。
4) 大量消耗系统与网络资源。计算机感染了Nimda、WantJob 和BinLaden 等病毒后， 病
毒会不断遍历磁盘，分配内存，导致系统资源很快被消耗殆尽。最明显的特点是计算机速度变
慢，硬盘有高速转动的震动声，硬盘空间减少。而且，像CodeRed、Nimda 和WantJob 等病毒
还会疯狂地利用网络散播自己，往往会造成网络阻塞。
257
计算机网络安全教程第4 版
5) 双程序结构。如WantJob 和BinLaden 都是双程序结构，运行后分成两部分，一个负
责远程传播（包括E-mail 和局域网传播），另一个负责本地传播，各司其职，大大增强了病毒
的传染性。
6) 用即时工具传播病毒。Goner 能利用ICQ 传文件的功能向别的计算机散播病毒体，这
也许会是继邮件病毒之后的又一个大量散播病毒的途径。现在即时通信工具用户群很广，而且
人们在聊天时往往戒心更低，一不小心就会中了病毒的圈套。
7) 病毒与黑客技术的融合。包括RedCodelI 、Nimda 等都与黑客技术相结合，从而能远
程调用染毒计算机上的数据，使病毒的危害剧增。
8) 脚本攻击日益盛行。随着采用脚本编写的应用逐渐增多，脚本攻击日益增多，包~
Samy 蠕虫、百度空间蠕虫等，感染主机的速度快、数量大，危害很大。
9) 应用软件漏洞成为网页挂马的新宠。2007 年下半年以来，最新的监测结果显示，越＊
越多的病毒开始绕开微软系统漏洞，转而利用国产应用软件的漏洞传播。
2．计算机病毒发展的趋势及对策
现在流行的病毒在很多地方改变了人们对病毒的看法，而且，它还改变了人们对病毒预i
防的看法。过去总是说，只要不用盗版软件，不随便使用别人的U 盘，不乱运行程序，就不：
会染毒。而现在由千有了互联网和操作系统的漏洞，就算坐着不动，病毒也会找上门来，~可·
谓防不胜防。因此，互联网上的信息安全成为整个业界关注的重点。
从由Happytime 到“熊猫烧香”的发展趋势来看，现在的病毒已经由从前的单一传~、
单种行为，变成依赖互联网传播，集电子邮件、文件传染等多种传播方式，融黑客、木马等多
种攻击手段为一身的广义的“新病毒”一一恶意代码。通过分析这些病毒的“进化”之路，
大致可以预见今后病毒的一些特点。
l) 变形病毒成为下一代病毒首要的特点。病毒传染到目标后，病毒自身代码和结构在~
间和时间上具有不同的变化，以此对抗反病毒手段。
2) 与Internet 和Intranet 更加紧密地结合，利用一切可以利用的方式（如邮件、局域网、
远程管理、即时通信工具、社交网络和移动终端应用等）进行传播。
3) 病毒往往具有混合型特征，集文件传染、蠕虫、木马和黑客程序的特点千一身，破切；
性大大增强，病毒编写者不再单纯炫耀技术，获取经济利益开始成为编写病毒的主要目的。
4) 因为其扩散极快，不再追求隐藏性，而更加注重欺骗性。
5) 利用系统和应用程序漏洞将成为病毒有力的传播方式。
6) 结合社会工程学知识，组合利用多个漏洞（包含Oday 漏洞），使病毒的攻击成本大＊
提高。
由千病毒的快速发展，势必要求反病毒技术跟上时代的步伐，以保证互联网时代的信息
系统安全。所以，新一代反病毒软件必须做到以下几点。
l) 全面地与互联网结合，不仅有传统的手动查杀与文件监控，还必须对网络层和邮1牛~
户端进行实时监控，防止病毒入侵。
2) 快速反应的病毒检测网，在病毒爆发的第一时间即能提供解决方案。
3) 完善的在线升级服务，使用户随时拥有最新的防病毒能力。
4) 对病毒经常攻击的应用程序提供重点保护（如MS Office、Outlook、IE 和QQ 等），如
Norton 的Script Blocking 和金山毒霸的“嵌入式”技术。
5) 对系统日志和网络访问日志采用机器学习等算法进行分析，发现异常操作和异常网络·
258
第8 章计算机病毒与恶意代码防范技术
访问，及时分析原因。
6) 提供完整、即时的反病毒咨询，提高用户的反病毒意识与警觉性，尽快让用户了解新
病毒的特点和解决方案。
8.4 恶意代码
8.4.1 恶意代码概述
恶意代码是一种程序，通常在人们没有察觉的情况下把代码寄宿到另一段程序中，从而
达到破坏被感染计算机的数据、运行具有入侵性或破坏性的程序、破坏被感染系统数据的安全
性和完整性的目的。
8.4.2 恶意代码的特征与分类
1. 恶意代码的特征
恶意代码的特征主要体现在以下3 个方面。
l) 恶意的目的。
2) 本身是程序。
3) 通过执行发生作用。
2. 恶意代码的分类
按照工作原理和传输方式划分，恶意代码可以分为普通病毒、木马、网络蠕虫、移动代
码和复合型病毒等类型。本章前面所介绍的病毒即属于普通病毒的范畴，下面主要介绍其他类
型的恶意代码。
(I) 木马
木马（全称特洛伊木马）是根据古希腊神话中的木马来命名的。黑客程序以此命名有
“一经潜入，后患无穷”之意。木马程序表面上没有任何异常，但实际上却隐含着恶意企图。
一些木马程序会通过覆盖系统文件的方式潜伏千系统中，还有一些木马以正常软件的形式出
现。木马类的恶意代码不容易被发现，这主要是因为它们通常以正常应用程序的身份在系统中
运行。
(2) 网络蠕虫
网络蠕虫是一种可以自我复制的完全独立的程序，其传播过程不需要借助于被感染主机
中的其他程序。网络蠕虫的自我复制不像其他病毒，它可以自动创建与其功能完全相同的副
本，并在不需要人工干涉的情况下自动运行。网络蠕虫通常利用系统中的安全漏洞和设置缺陷
进行自动传播，因此可以以非常快的速度传播。
(3) 移动代码
移动代码是能够从主机传输到客户端计算机上并执行的代码，它通常是作为病毒、蠕虫
或木马等的一部分被传送到目标计算机。此外，移动代码可以利用系统的安全漏洞进行入侵，
如窃取系统账户密码或非法访问系统资源等。移动代码通常利用Java Applets、ActiveX、Java
Script 和VB Script 等技术来实现。
(4) 复合型病毒
恶意代码通过多种方式传播就形成了复合型病毒，著名的网络蠕虫Nimda 实际上就是复
259
计算机网络安全教程第4 版
合型病毒的一个实例，它可以同时通过E-mail 、网络共享、Web 服务器和Web 终端4 种方式
进行传播。除上述方式外，复合型病毒还可以通过点对点文件共享、直接信息传送等方式进行
传播。
8.4.3 恶意代码的关键技术
恶意代码的关键技术有生存技术、攻击技术和隐藏技术。
1. 生存技术
生存技术主要包括4 个方面：反跟踪技术、加密技术、模糊变换技术和自动生产技~。
反跟踪技术可以减小被发现的可能性，加密技术是恶意代码自身保护的重要机制。
(1) 反跟踪技术
反跟踪技术可以使恶意代码提高自身的伪装能力和防破译能力，增加其被检测与清除的
难度。目前常用的反跟踪技术有两类：反动态跟踪技术和反静态跟踪技术。
反动态跟踪技术主要包括四大类。
l) 禁止跟踪中断。
2) 封锁键盘输入和屏幕显示，破坏各类跟踪调试软件的运行环境。
3) 检测跟踪。
4) 其他反跟踪技术。如指令流队列和逆指令流等。
反静态跟踪技术主要包括两大类。
l) 对程序代码分块加密执行。
2) 伪指令法。
(2) 加密技术
加密技术是恶意代码自我保护的一种有效手段，通过与反跟踪技术配合，可以使分析者
无法正常调试和阅读恶意代码，不能掌握恶意代码的工作原理，也无法抽取恶意代码的特征
串。按加密内容划分，加密手段分为信息加密、数据加密和程序代码加密3 种。
(3) 模糊变换技术
利用模糊变换技术，恶意代码程序每次感染一个对象时，恶意代码体均不相同。同一种
恶意代码具有多个不同的样本，几乎没有稳定的代码，从而使得基千特征的检测工具难以识别
它们。目前模糊变换技术主要包括以下几个。
l) 指令替换法。
2) 指令压缩法。
3) 指令扩展法。
4) 伪指令技术。
5) 重编译技术。
(4) 自动生产技术
恶意代码的自动生产技术主要包括计算机病毒生成器技术和多态性发生器技术。多态性
发生器可以使恶意程序代码本身发生变化，并保持原有功能。
2. 攻击技术
常见的恶意代码攻击技术包括：进程注入技术、三线程技术、端口复用技术、对抗检测
技术、端口反向连接技术和缓冲区溢出攻击技术等。
260
第8 章计算机病毒与恶意代码防范技术
(I) 进程注入技术
当前操作系统中都提供系统服务和网络服务，它们都在系统启动时自动加载。进程注入
技术就是以上述服务程序的可执行代码作为载体，将恶意代码程序自身嵌入到其中，实现自身
隐藏和启动的目的。
采用该技术的恶意代码只需要安装一次，以后就会随载体程序的启动而自动加载到其进
程中。通常要选择系统正常运行所必需的程序作为载体，从而可以使恶意代码在系统运行时始
终保持激活状态。
(2) 三线程技术
Wmdows 系统引入了线程的概念，一个进程可以同时拥有多个并发线程。所谓三线程技
术，就是指一个恶意代码进程同时开启3 个线程，其中一个是主线程，负责具体的恶意功能，
另外两个线程分别是监视线程和守护线程。监视线程负责检查恶意代码的状态。守护线程注入
其他可执行文件内，与恶意代码进程同步，一且恶意代码线程停止，守护线程会重新启动该线
程，从而保证恶意代码执行的持续性。
(3) 端口复用技术
端口复用技术是指重复利用系统已打开的服务器端口传送数据，从而可以躲避防火墙对
端口的过滤。端口复用一般情况下不影响原有服务的正常工作，因此具有很强的隐蔽性。
(4) 对抗检测技术
有些恶意代码具有攻击反恶意代码软件的能力。采用的技术手段主要有：终止反恶意代
码软件的运行、绕过反恶意代码软件的检测等。
(5) 端口反向连接技术
通常情况下，防火墙对进入内部网络的网络数据包具有严格的过滤策略，但对从内部发
起的网络数据包却疏千管理。端口反向连接技术就是利用防火墙的这种特性从被控制端主动发
起向控制端的连接。
(6) 缓冲区溢出攻击技术
缓冲区溢出攻击主要是向存在溢出漏洞的服务程序发出精心构造的攻击代码，是获取远
程目标主机管理权限的主要手段，是恶意代码进行主动传播的主要途径。
3. 隐藏技术
恶意代码的隐藏通常包括本地隐藏和通信隐藏。本地隐藏主要有文件隐藏、进程隐藏、
网络连接隐藏和内核模块隐藏等；通信隐藏主要包括通信内容隐藏和传输通道隐藏。
(I) 本地隐藏技术
本地隐藏是指为了防止本地系统管理人员察觉而采取的隐蔽手段。本地系统管理人员
通常使用“查看进程列表”“查看文件系统”“查看内核模块”和“查看系统网络连接状
态”等命令来检测系统是否被植入恶意代码。本地隐藏主要就是针对上述安全管理命令进
行相应的隐藏。
本地隐藏的技术手段可以分为3 类。第一类是将恶意代码隐藏千合法程序中。该类方法
可以躲过简单管理命令的检查。第二类是修改或替换某些系统管理命令或其依赖的系统调用。
该类方法能够使管理命令的输出信息经过处理以后再显示给用户，可以方便地欺骗系统管理人
员。第三类方法是分析管理命令的执行机制和弱点，然后利用发现的弱点避过管理命令的检
查，可以达到不修改管理命令而实现隐藏的目的。
261
计算机网络安全教程笫4 版
(2) 通信隐藏
随着网络安全意识逐步深入人心，防火墙、入侵检测等网络安全防护设备在网络中广泛
使用，使得使用传统通信模式的恶意代码难以正常运行。因此，恶意代码发展出了更加隐蔽的
网络通信模式．
使用加密算法对所传输的内容进行加密能够隐蔽通信内容。隐蔽通信内容虽然可以保护
通信内容，但无法隐蔽通信状态，因此传输信道的隐蔽同样具有重要的意义。对传输信道：的隐
蔽主要采用隐蔽通道技术。美国国防部可信操作系统评测标准对隐蔽通道进行了如下定义：隐
蔽通道是允许进程违反系统安全策略传输信息的通道。
在TCP/IP 协议中，有许多冗余信息可以用来建立隐蔽信道。攻击者可以利用这些隐蔽信
道绕过网络安全机制秘密地传输数据。TCP/IP 数据包格式在实现时为了能够适应复杂多变在的
网络环境，有些信息可以使用多种方式来表示，恶意代码可以利用这些冗余信息来实现通信的
隐蔽。
常见的网络通信隐蔽技术有http tunnel 和icmp tunnel 等。http tunnel 是一种将网络通信内
容用HTfP 协议进行二次封装的通信技术，可以有效穿透防火墙，躲避入侵检测系统~溃l 。
icmp tunnel 则是一种将网络通信内容用icmp 协议进行封装，模拟成常规的网络管理报文，也
可以躲避入侵检测系统的检测。
8.4.4 网络蠕虫
随着Internet 网络应用的普及，网络蠕虫对计算机网络系统安全的威胁日益增加。在~放：
互通的网络环境下，多样化的传播途径和复杂的应用环境使网络蠕虫的发生频率增高，~伏：~
变强，覆盖面更广，造成的损失也更大。1988 年，著名的Morris 蠕虫事件成为网络蠕虫攻击
的先例，从此网络蠕虫成为研究人员关注的一个重要课题。2001 年7 月， CodeRed 爆发后，
蠕虫研究再度引起人们的广泛关注。
1. 网络蠕虫的定义
网络蠕虫是一种智能化、自动化，综合网络攻击、密码学和计算机病毒技术，不需要计－
算机使用者干预即可运行的攻击程序或代码。它能够扫描和攻击网络上存在系统漏洞的结点~
机，通过局域网或者国际互联网从一个结点传播到另外一个结点。
网络蠕虫具有主动攻击、行踪隐蔽、利用漏洞、造成网络拥塞、降低系统性能、产~~
全隐患、反复性和破坏性等特征，网络蠕虫无须计算机用户干预即可自主运行，通过不断~~
得网络中存在特定漏洞的计算机的控制权限来进行传播。
2．网络蠕虫的功能结构
网络蠕虫的功能模块可以分为主体功能模块和辅助功能模块。实现了主体功能模块的蠕
虫能够完成复制传播流程，而包含辅助功能模块的蠕虫程序则具有更强的生存能力和破~能
力。网络蠕虫功能结构如图8-3 所示。
(I) 主体功能模块
主体功能模块由4 个模块构成： ＠信息搜集模块决定采用何种搜索算法对本地或者目标
网络进行信息搜集，包括本机系统信息、用户信息、邮件列表、对本机的信任或授权的主机八
本机所处网络的拓扑结构，以及边界路由信息等，所有这些信息可以单独使用或被其他个~~
享； ＠扫描探测模块完成对特定主机的脆弱性检测，决定采用何种攻击渗透方式。＠攻击~~
模块利用扫描探测模块获得的安全漏洞，建立传播途径； ＠自我推进模块可以采用各种形~生
262
第8 章计算机病毒与恶意代码防范技术
成各种形态的蠕虫副本，井在不同主机间完成蠕虫副本传递。
(2) 辅助功能模块
网络蠕虫功能结构
信息搜集揆块
扫描探测摸块主体功能模块｛攻击渗透模块
自我推进模块
辅助功能模块［巨巨
自动升级模块
图8-3 网络蠕虫的功能结构
辅助功能模块是对除主体功能模块以外的其他模块的总称，主要由5 个功能模块构成：
G)实体隐藏模块包括对蠕虫各个实体组成部分的隐藏、变形、加密，以及进程的隐藏，其主要
目的是提高蠕虫的生存能力； ＠宿主破坏模块用千摧毁或破坏被感染主机，破坏网络正常运
行，在被感染主机上留下后门等； ©信息通信模块能使蠕虫间、蠕虫同攻击者之间进行交流，
这是当前蠕虫发展的重点； ＠远程控制模块的功能是调整蠕虫行为，控制被感染主机，执行蠕
虫控制者下达的指令；＠自动升级模块可以使蠕虫控制者随时更新其他模块的功能，从而实现
不同的攻击目的。
3．网络蠕虫的扫描策略
良好的扫描策略能够加速蠕虫传播，并可以提高自身的安全性和隐蔽性，因此网络蠕虫
扫描策略是网络蠕虫研究的一项重要内容。按照蠕虫对目标地址空间的选择方式来分类，扫描
策略可以分为选择性随机扫描、顺序扫描、基于目标列表的扫描、分治扫描、基于路由的扫描
和基于DNS 扫描等。
8.4.S Rootkit 技术
1. Rootkit 技术简介
Rootkit 作为一个名词最早出现于20 世纪90 年代初。1994 年2 月， CERT-CC 在其编号为
CA-1994-01 的一篇安全咨询报告（题目为Ongoing Network Monitoring Attacks) 中首先使用了
Rootkit 这个名词。从出现至今， Rootkit 的技术发展非常迅速，应用越来越广泛，检测难度也
越来越大。早期针对UNIX 和Linux 两种操作系统的Rootkit 居多，当前针对Wmdows 类操作
系统的Rootkit 也开始大量涌现。
Rootkit 是攻击者用来隐藏自己的踪迹和维持远程管理员访问权限的工具，而不是用来获
得系统管理员访问权限的工具。早期的Rootkit 基本上都是由几个独立的程序组成的，一个典
型Rootkit 通常包括以下几个方面。
l) 以太网嗅探器程序，用于获得网络上传输的用户名和密码等信息。
2) 木马程序，如inetd 或者login, 为攻击者提供后门。
3) 隐藏攻击者的目录和进程的程序，如ps、netstat、rshd 和ls 等。
4) 日志清理工具，如zap、zap2 或者z2 等，攻击者使用这些消理工具删除wtmp、utmp
263
计算机网络安全教程笫4 版
和lastlog 等日志文件中有关自己行踪的记录。
攻击者使用Rootkit 中的相关程序替代系统原来的ps 、ls 、netstat 和df 等程序，使系
统管理员无法通过这些工具发现自己的踪迹。接着使用日志清理工具清理系统日志，消除
自己的踪迹。然后，攻击者可以通过安装的后门进入系统查看嗅探器的日志，以发起其他
的攻击。
相较千早期的Rootkit, 当前Rootkit 技术有了长足发展，逐渐向短小精悍、深入内核、功
能完善的方向发展。
2. Wmdows 系统下的Rootkit 关键技术
Wmdows 系统下的Rootkit 关键技术有进程隐藏技术和文件隐藏技术两种。
(1) 进程隐藏技术
Windows 系统下的进程隐藏技术主要有五大类： ＠远程线程注入技术；＠基千SPI 的
进程隐藏技术； ＠基于svchost 服务的进程隐藏技术； ＠基千修改活动进程链表的进程隐
藏技术； ＠基于Hook SSDT 的进程隐藏技术。前3 种隐藏技术有许多共同点：＠都属于
不直接使用进程的隐藏，其基础是DLL; ＠欺骗性强，能够利用社会工程学方法；定）在
进程查看工具中根本不存在，但在目标进程的加载模块中能够找到其DLL 文件。前3 种
技术也有不同之处： ＠远程线程注入在系统重启时不能自动运行，而后两种则能做到；
＠远程线程中同一个DLL 可以注入到多个进程中，而后两种的依附进程已限定为
svchost。后两种技术都是对内核进行操作的，前一种是通过在用户态操作内核的方法来实
现的，不需要编写和安装驱动程序，因此带来的副作用较少。Hook SSDT 是通过编写驱
动来实现的，必须安装驱动，隐藏驱动程序文件和驱动在注册表中建立的项和内核~~，
但是这种方法相对稳定。
这5 种进程隐藏技术各有特点，都有适合自己的应用场合。5 种技术被检测的难易度不
同，前3 种相对较容易， HookSSDT 次之，修改活动进程链表最难。
(2) 文件隐藏技术
文件隐藏技术主要包括用户态文件隐藏技术和内核态文件隐藏技术。用户态隐藏技术
主要通过API Hook 方法来实现，基本思想是把要hook 的函数封装在一个DLL 文件中，然
后将该DLL 文件以远程线程的方式插入到需要进行API Hook 的进程中。由千AP! Hook 是
针对进程而言的，而系统中的进程在各个时刻又是在变化的，因此，为了实现彻底隐藏，
必须对系统中的进程进行监视。当监视到新的进程时，需要将DLL 文件插入到新进程中，
完成隐藏功能。
内核态文件隐藏技术则是通过驱动程序拦截枚举一个目录里面所有的文件和它的子目
录下所有文件的函数NtQueryDirectoryFileO 。如果想要隐藏一个文件，在驱动程序中的步骤
如下。
l) 关闭内核写保护。
2) 通过SSDT 找到NtQueryDirectoryFile 函数的入口地址，并保存。
3) 把SSDT 中NtQueryDirectoryFile 函数的入口地址换成自定义的hook 函数地址。
4) 打开内核写保护。
5) 在自定义的hook 函数中实现文件的隐藏。
3. Linux 系统下的Rootkit 关键技术
Linux 系统下的Rootkit 关键技术是LKMs 技术。LKMs 即可卸载的内核模块(Loadable
264
第8 章计算机病毒与恶意代码防范技术
Kernel Modules) 。LKMs 技术本来是Linux 系统用于扩展自身功能的，但是同样可以应用千
Rootkit 技术。使用LKMs 的优点是LKMs 模块可以被动态地加载，而且不需要重新编译
内核。
在Rootkit 中通常要用到的LKMs 技术主要包括以下几个。
1) 隐藏文件。ls、du 等命令都是通过sys_getdents(）来获得目录信息的。所以LKM 程序
必须过滤该函数的输出来达到隐藏文件的目的。
2) 隐藏进程。在Linux 的实现中，进程的信息被映射到／proc 文件系统中。因此需要捕获
sys_getdentsQ调用在进程链表中标记为不可见。通常的方法是设置任务的信号标志位为一些未
用的信号量。
3) 隐藏网络连接。和隐藏进程相似，隐藏乍roc/net/tcp 和／proc/net/udp 文件。无论何时读
包含匹配字符串的这两个文件，系统调用都不会声明在使用它。
4) 重定向可执行文件。某些情况下，攻击者可能会需要替换系统的二进制文件，例如
login，但不想改变原文件。此时攻击者可以截获sys_execveQ, 使得系统无论何时尝试执行
login 程序，它都会被重定向到攻击者给定的其他程序。
5) 隐藏sniffer。隐藏sniffer 主要是指隐藏网络接口的混杂模式，可以通过替换sys_ioctlO
实现。
6) 隐藏LKMs 本身。一个优秀的LKMs 程序必须很好地隐藏自己。系统里的LKMs 是用
单向链表连接起来的，为了隐藏LKMs 本身必须把它从链表中移除。
8.4.6 恶意代码的防范
恶意代码与传统型的计算机病毒有许多相似的特征，因此在恶意代码防范方面，传统的
反病毒技术依然可以发挥重要作用，事实上，许多杀毒软件都直接将恶意代码当作普通病毒来
对待。此外，恶意代码又有其自身的一些特点，针对恶意代码的自身特点又发展出了一些新的
防范方法。
1. 及时更新系统，修补安全漏洞
许多恶意代码的入侵和传播都是利用系统（包括操作系统和应用系统）的特定安全漏
洞进行的。通常情况下，在恶意代码大规模泛滥之前，其入侵和传播所依赖的安全漏洞的
修补程序就已经发布，只是有许多用户没有及时安装这些修补程序而成为恶意代码的攻击
对象。
如果能够在恶意代码入侵之前发现并修补系统的安全漏洞，就可以避免攻击。因此，及
时更新系统，修补安全漏洞，对于防范恶意代码具有重要意义。
2. 设置安全策略，限制脚本程序的运行
通过网页浏览器传播的恶意代码，即利用Java Applets、ActiveX、Java Script 和VB
Script 等技术来实现的移动代码已经成为恶意代码传播的一个主要途径，是普通上网用户
的主要安全隐患。但是该类恶意代码必须在浏览器允许执行脚本程序的条件下才可运行。
因此，只要设置适当的安全策略，限制相应脚本程序的运行，就可以在很大程度上避免移
动代码的危害。
对千常用的Microsoft Internet Explorer (IE) 浏览器，可以按照如图8-4 所示的方法进行
安全设置。
265
计算机网络安全教程笫4 版
t”“ 赡蛔勺,心..,, ... 、， i 食，、卿l'.t ,,,
b 屈I. ,.). 巳1 l9 6 H畛．娅真e ` ' ：. 户-. ， 九九丛■-
虹叫如…｀忐' , ll, • l l 可口叩l 寅．幛1 兔.-益 1111斗，一- .11丛
o n In I'内曹1111 I u I 缅1 匿
帽炉「毗咖”“甫富叟盒会1a》“'Gi
°“`
•',, ,.°.....I I•`况J ，颓尸赠俨 出的灿心阳印衄
O 曾慢员ti.Ill ？二心一—卢＿ ..J 1
I
谓加，，平贮. ~ ，立卢，
IE=:~~二玉至」＇，I -二一中一工1:
--- -巴马已1土一I —一动1
图8-4 自定义浏览器的安全级别
3. 启用防火墙，过滤不必要的服务和系统信息
众所周知，计算机系统暴露到互联网上的信息越多，就越容易受到攻击。因此通过防火
墙过滤不必要的服务和系统信息可以降低系统遭受恶意代码攻击的风险。
4. 养成良好的上网习惯
以目前的技术水平， 单靠技术手段还难以从根本上杜绝恶意代码的危害，因此良~的J:.
网习惯就显得非常重要。良好的上网习惯主要包括以下几个。
l) 不随意打开来历不明的电子邮件。
2) 不随意下载来历不明的软件。
3) 不随意浏览来历不明的网站。
4) 不随意使用移动终端设备连接不可信的无线热点。
5. 警惕恶意代码的新传播方式
互联网技术的发展催生了许多新的技术，尤其是移动终端的软硬件技术发展更为迅速，
但这些技术在给用户带来方便的同时也给恶意代码传播提供了新的隐蔽途径， 例如通过制~商
预装、刷机助手、第三方市场、Wap Push、二维码和微博等方式可以更加隐蔽地传播恶意代
码。因此在使用新技术时也要注意提高安全意识，不可以麻痹大意。
8.5 小结
计算机病毒是指编制或者在计算机程序中插入的破坏计算机功能或者毁坏数据，影响计
算机使用，并能自我复制的一组计算机指令或者程序代码。计算机病毒的特征主要有：非授权
可执行性、隐蔽性、传染性、潜伏性、破坏性及可触发性。
计算机病毒的主要危害包括：病毒激发对计算机数据信息的直接破坏作用、占用磁
盘空间和对信息的破坏、抢占系统资源、影响计算机运行速度、计算机病毒错误与不可
预见的危害、计算机病毒的兼容性对系统运行的影响，以及计算机病毒给用户造成严重
的心理压力。
计算机病毒一般包括三大功能模块，即引导模块、传染模块和破坏／表现模块。从不同的
266
第8 章计算机病毒与恶意代码防范技术
角度，计算机病毒有不同的分类方法。
计算机病毒的检测要从检查系统资源的异常情况入手。防范感染病毒的途径可概括为两
类一是用户遵守和加强安全操作控制措施，二是使用防病毒工具。
计算机病毒的发展趋势将是更加智能化的，其破坏力和影响力将不断增强，计算机病毒
防范工作将成为信息系统安全的重要因素。
恶意代码是普通计算机病毒概念的扩展和延伸，主要包括普通病毒、木马、网络蠕虫、
移动代码和复合型病毒等类型，其主要技术有生存技术、攻击技术和隐藏技术。
8.6 习题
1. 简述计算机病毒的定义和特征。
2. 结合自己的经历说明病毒的危害。
3. 简述计算机病毒的分类。
4. 试述计算机病毒的一般构成，各个功能模块的作用和作用机制。
5. 目前计算机病毒预防采用的技术有哪些？
6. 对千计算机病毒有哪些检测技术？
7. C田病毒一般破坏哪些部位？它发作时有哪些现象？
8. 简要回答宏病毒的特征。
9. 简述计算机病毒的发展趋势。
10. 什么是恶意代码，防范恶意代码的措施有哪些？
II. 简述恶意代码所使用的关键技术。
267
9章
数据备份技术
在以信息为基础的商业时代，对大多数计算机的使用者来说，保持关键数据和应用系统
始终处于正常运行状态，是最起码的要求。例如人们对千电信、金融和社会公共事业等领域信
息的需求就是每天24 小时不间断的。但是，无论对硬件和软件采取什么样的监控和改善措
施，一场灾难的降临还是可能使数据中心毁千一旦。供电故障、地震、火灾、洪水、雷电、隄
风、飞机坠毁、列车出轨、火山爆发和网络攻击等，都可能导致信息系统的瘫痪。实际上根据
统计，在致使信息系统瘫痪的各种原因之中，上述自然灾害只占3％左右，而硬件故障占
44％，人为原因占32%，软件故障占14%，病毒侵入占7%。所以说，信息系统所面临的灾难：
是多方面的，而且在这些灾难面前信息系统也是非常脆弱的。因此，信息系统必须制定适当的
备份和灾难恢复策略。
随着信息化建设的深入，网络上的信息将越来越丰富，数据对领导决策及企事业发展~
起到越来越重要的作用，一且由千意外而丢失数据，将会造成巨大的经济损失。
9.1 数据备份概述
数据的灾难恢复是保证系统安全可靠不可或缺的基础。网络的高可靠性和高可用性是~
基本的要求，重要业务数据都存储在网络中，一且丢失，后果不堪设想，因此，建立一套行Z
有效的灾难恢复方案就显得尤为重要。在实际网络环境中，由于数据量大，且常常需要跨平台
操作，数据出错或丢失是难免的，如果没有事先对数据进行备份，要想恢复数据不仅难度大而
且很不可靠，有时甚至根本不可能进行恢复。如果定期对重要数据进行备份，那么在系统出现L
故障时，仍然能保证重要数据准确无误。
随着存储介质成本的下降，传统的磁带备份技术正面临巨大的挑战，光纤信道技术将逐
步取代SCSI 接口技术。此外，随着Internet/Intranet 的大量使用，网络也日趋复杂，许多内部
网络都不是单一平台，而是包括了多种操作系统平台的异构环境。存储备份解决方案就必须~
有平台独立特性，能适应异构的分布式网络环境，同时还要易千实施和掌握，产生了能够适~
异构网络环境存储备份需求的SAN （存储区域网）技术。使用光纤信道的SAN 技术已成为~
具发展潜力的一种存储备份技术。
9.1.1 数据失效的主要原因
造成数据失效的原因大致可以分为4 类。
1. 计算机软硬件故障
发生概率：发生可能性最大，也最频繁， 是经常发生的一类故障。
预防方法：本地双机热备份，实现系统冗余，增强业务系统的可用性。
2．人为操作故障
发生概率：如果管理较严、人员素质较高，则偶尔发生；如果管理较松、人员培训不
268
第9 章数据备份技术
足，则会经常发生。
预防方法：提高系统自动化运行管理水平，做好本地数据冷备份，减少人员的操作与干
预，或制定严格的管理规范，避免误操作。
3. 资源不足引起的计划性停机
发生概率：随着业务的快速增长，一般每年均会发生如软、硬件升级、系统资源扩充等
事件，业务增长越快的网络，发生越频繁。
预防方法：本地双机热备份，系统冗余。
4. 生产地点的灾难
发生概率：对千局部地区，发生概率较小；对千全国范围，有偶然发生的必然性。
预防方法：建立灾难恢复中心。
数据失效的因果关系如表9-1 所示。
表千1 数据失效的因果关系
三自然灾害硬件故障软件故障人为原因
破坏性很大中等无法估计无法估计
影响范围整个网络单台计算机无法估计无法估计
发生可能性很小小中等较大
失效种类物理损坏物理损坏逻辑损坏逻辑损坏
平均破坏性中等中等较大大
可见，数据失效的概率还是相当高的，随时随地可能发生，其后果是灾难性的，应及早
建立科学、有效的数据备份措施和观念，防患千未然。否则，重建失效数据的代价和数据失效
的影响及损失是不可估量的。根据统计，全球每年因数据毁损造成的损失超过30 亿美元。
例如， 40MB 的磁盘数据可能包括电子图表、账目、客户记录和商务文件等不能失效的重
要信息，数据失效后，必须花费大量的金钱和时间才能恢复，这将严重影响业务进程。20MB
磁盘的数据容量相当于10000 页纸(A4 幅面）的文字数据。20GB 磁盘的数据容量相当千
1000 万页纸(A4 幅面）的文字数据。
数据失效可分为两种，一种是失效后的数据彻底无法使用，这种失效称为物理损坏
(Physical Damage) ；另一种是失效的数据仍可以部分使用，但从整体上看， 数据之间的关系是
错误的，这种失效称为逻辑损坏(Logical Damage) 。逻辑损坏其实比物理损坏更为严重，因
为逻辑损坏不易被发现，潜伏期长，当发现数据有错误时可能已经无法挽回。
常见的几种物理损坏包括以下几种。
·电源故障：由于电源故障造成设备无法使用。
·存储设备故障：安装时的无意磕碰、掉电、电流突然波动和机械自然老化等原因都有
可能造成存储设备故障。
·网络设备故障：传输距离过长、设备添加与移动、传输介质的质量问题和老化都有可
能造成故障。
·自然灾害：由水灾、火灾和地震等造成设备损坏，无法使用。
·操作系统故障：非法指令造成的系统崩溃，系统文件被破坏导致无法启动操作系统等。
·数据丢失：缺少文件或程序本身的不完善导致程序无法运行。
物理损坏造成的后果比较明显，容易发现，相对来说容易排除。但是如果不能及时排
269
计算机网络安全教程笫4 版
除，也会造成极大的损失。
常见的逻辑损坏包括以下几种。
·数据不完整：系统缺少完成业务所必需的数据。
·数据不一致：系统数据是完全的，但不符合逻辑关系。
·数据错误：系统数据是完全的，也符合逻辑关系，但数据是错误的，与实际不符。
逻辑损坏隐蔽性强，往往带有巨大的破坏性，是造成损失的主要原因。如果发生逻~损
坏，损失将无法估算，因为输入计算机中的都是很重要的数据。根据统计，恢复10MB （约
5000 页纸）的数据最少也要花费将近20 天时间，成本在万元以上。
9.1.2 备份及其相关概念
要防止数据失效的发生，有多种途径。例如：加强建筑物安全措施、提高员工操作＊~
和购买品质优良的设备等。但最根本的方法还是建立完善的备份制度。
数据备份是指将计算机磁盘上的原始数据复制到可移动存储介质上，如磁带、光盘~。
在出现数据丢失或系统灾难时将复制在可移动存储介质上的数据恢复到磁盘上，从而保护计·算：
机的系统数据和应用数据。备份的概念大家都不会陌生。在日常生活中，人们都在不自觉~付巴
用备份。例如，银行卡密码记在脑子里怕遗忘，就会写下来记在纸上；门钥匙和抽屉钥匙总~
去配一份。其实备份的概念说起来很简单，就是保留一套后备系统。这套后备系统或者与王见有．
系统一模一样，或者能够替代现有系统的功能。
与备份对应的概念是恢复，恢复是备份的逆过程。在发生数据失效时， 计算机系统X沼:
使用，但由于保存了一套备份数据，利用恢复措施就能够很快将损坏的数据重新建立起＊。
为了便于理解，下面介绍一些与备份相关的概念。
1) 数据恢复是数据备份的逆过程，就是利用保存的备份数据还原出原始数据的过~。
2) 热备份其实是计算机容错技术的一个概念，是实现计算机系统高可用性的主要方·
式，避免因系统单点故障（如磁盘损伤）导致整个计算机系统无法运行，从而实现计算机系
统的高可用性。最典型的实现方式是双机热备份，即双机容错。该项技术的最新发展是~用
多机热备份，即cluster 的概念，多机相互镜像，负载均衡，并能自动诊断系统故障，失~i;JJ
.. 换，使一些对实时性要求很高的业务得以保障。然而，热备份方式并不能解决像操作人员误：
删除造成数据丢失这样的问题，因为热备份系统为保证数据的一致性，会同时将这个文件的
镜像文件删除。
3) 在线备份：对正在运行的数据库或应用进行备份，通常对打开的数据库和应用是~.Lt
备份的，因此要求数据存储管理软件能够对在线的数据库和应用进行备份。
4) 离线备份：指在数据库或应用关闭后对其数据进行备份，离线备份通常只采用全：
备份。
5) 备份工具：指为操作系统或数据库提供的简单备份软件模块，如UNIX 系统的
T扭Dump 、NetWare 的Sbackup, 以及Oracle 的Export/hnport 等，在传统的备份方式下配合
单个磁带机能够完成基本的备份工作，但对千企业级分布式网络的数据存储管理来讲，备~I
具不能实现网络的、跨平台的、自动的、高效率的和高可靠性的存储管理，这部分工作最~~
交给专门的数据存储管理软件完成。
6) 数据存储管理：指对与计算机系统数据存储相关的一系列操作（如备份、归档和，恢
复）进行的统一管理，是计算机系统管理的一个重要组成部分。对千一个完备的计算机系统而
270
笫9 章数据备份技术
言，数据存储管理是必不可少的。
7) 数据归档：是将磁盘数据复制到可移动存储介质上。与数据备份不同的是，数据归档
在完成复制工作后将原始数据从磁盘上删除，释放磁盘空间。数据归档一般是对与年度或某一
项目相关的数据进行操作，在一年结束或某一项目完成时将其相关数据迁移至可移动存储介质
上，以备日后查询和统计，同时释放宝贵的磁盘空间。
9.1.3 备份的误区
对计算机系统进行全面的备份，并不只是复制文件那么简单。一个完整的系统备份方案
应包括硬件备份、软件备份、日常备份制度(Backup Routines) 和灾难恢复制度(DRP:
Disaster Recovery Plan) 4 部分。人们对备份存在着很多误区，具体体现在以下几个方面。
l) 用人工操作进行简单的数据备份代替专业备份工具的完整解决方案。采用人工操作的
方法操作数据备份，带来了许多管理和数据安全方面的问题，如人工操作将人的疏忽引入，备
份管理人员的更换交接不清可能造成备份数据的混乱，造成恢复时的错误，人工操作恢复使恢
复可能不完全且恢复的时间无法保证，也可能造成重要的数据备份遗漏，无法保证数据恢复的
准确和高效率。
2) 忽视数据备份介质管理的统一通用性。忽视数据备份介质的统一通用性会造成恢
复时由千介质不统一的问题，包括磁带或光盘的标识命名混乱，也给恢复工作带来不必要
的麻烦。
3) 用硬件冗余容错设备代替对系统的全面数据备份。这种做法完全与数据备份的宗旨相
悖，在管理上有巨大的漏洞且很不完善。用户应该认识到任何程度的硬件冗余也无法百分之百
地保证单点的数据安全性，磁盘阵列(RAID) 技术不能，镜像技术也不能，甚至双机备份也
无法替代数据备份。
4) 忽视数据异地备份的重要性。数据异地备份在客户计算机应用系统遭遇单点突发事件
或自然灾难时非常有效和重要。
5) 用用户应用数据备份替代系统全备份。这种错误会极大地影响恢复时的时间和效
率，而且很可能由于系统无法恢复到原程度而造成应用无法恢复，数据无法再次使用。而
且还会因为客户不能真正了解应用数据存放的位置而使用户应用数据备份不完整，造成恢-
复时的问题。
6) 忽视制定完整的备份和恢复计划，以及维护计划并测试的重要性。忽视制定测试、维
护数据备份和恢复计划会造成实施上的无章可循和混乱。
7) 忽视对系统备份恢复人员的理论培训。
9.1.4 选择理想的备份介质
作为经典的电子信息存储技术，磁带已经使用了几十年。近几年来，随着信息存储技术
的飞速发展，各种曾经是高不可攀的存储设备，如高容量磁盘、可擦写CD 等，价格都在大幅
度下降。现在是不是也可以用磁盘、CD 来代替传统的磁带备份呢？
总体来讲，备份有3 个主要的特点。
l) 备份最忌讳在备份过程中因介质容量不足而更换介质。因此，存储介质的容量有很高
的重要性。
2) 由于各种意外并不会经常发生，使用备份数据的频率不会很高，因此对备份的速度并
271
计算机网络安全教程笫4 版
无太高要求，没有必要为了追求高速度而增加对存储介质的投资。
3) 所选择的备份技术必须有好的可管理性。
在众多可选的外部存储设备中，磁带是最可靠的数据备份介质， 它的主要优点如下。
l) 存储容量大。由千磁带库中有多盘磁带，所以磁带库的在线容量为n 倍的单盘磁带容
量。这对一个或多个备份作业数据鱼大千单盘磁带容量的情况来说，可以实现自动换带，不需
要系统管理员来人工更换磁带；同时磁带库的大容量加上磁带的轮换使用，使用户在几个月甚
至一年内不需要打开磁带库的门来更换磁带。
2) 速度快。由千磁带库中有多台磁带机，所以数据备份、恢复和查询速度相应提高了数
倍。同时多台磁带机可互为冗余，提高磁带库的可用性。
3) 全自动操作。结合专业备份软件，根据系统管理员的设置，可以完成定时、定文｛牛、
定目录和定数据库的自动备份任务，做到无人值守。通常把备份作业时间设定在系统网络负荷
最轻的深夜或凌晨来进行。全自动操作还包括磁带库的自动诊断、感应、识别、恢复或报~，
以及磁带库自动日常维护和磁带机自动清洗等。
4) 备份数据更安全。由千磁带库有机械锁和软件锁双重保护，使不相关的人员根＊~~
接触到磁带，从而确保备份磁带的安全性。同时由于减少了人工磁带的管理工作，避免了~带
搞混、丢失或错误处置。
而其他备份介质明显存在不足，具体情况如下。
l) 磁盘备份：数据存储成本昂贵，磁盘无法从系统中脱离，而且当遇到火灾或其~~害
发生时，数据会失效。
2) 双机“热”备份系统：双机备份方式主要提供“在线“数据的保护，存储成本高昂。
无法避免人为错误、硬件损坏和病毒的破坏。一旦操作系统崩溃，数据将难以得到有效保~。
3) 可写一次光盘(CD-Recordable) ：容量和可靠性有限，改错方法不够可靠，传输~率
低，而且不允许无人值守和定时备份。
9.1.S 备份技术和备份方法
当灾难发生时，留给恢复的时间往往相当短。但以往的备份措施没有任何一种能够使系
统从大的灾难中迅速恢复过来。一般需要下列步骤进行恢复。
l) 恢复硬件。
2) 重新装入操作系统。
3) 设置操作系统（驱动程序设置、系统和用户设置等）。
4) 重新装入应用程序，进行系统设置。
5) 用最新的备份恢复系统数据。
即使一切顺利，这一过程也至少需要2~3 天时间，这么漫长的恢复时间几乎是不可忍受
的，同时也会严重损害企业信誉。
如果采用系统备份措施，灾难恢复将变得相当简单和迅速。
系统备份与普通数据备份的不同在于，它不仅备份系统中的数据，还备份系统中安装的
应用程序、数据库系统、用户设置和系统参数等信息，以便迅速恢复整个系统飞
与系统备份对应的概念是灾难恢复。灾难恢复同普通数据恢复的最大区别在千，在整~
系统都失效时，用灾难恢复措施能够迅速恢复系统。而普通数据恢复则不行，如果系统也~生
了失效，在开始数据恢复之前，必须重新装入系统。也就是说，数据恢复只能处理狭义的数据
272
第9 章数据备份技术
失效，而灾难恢复则可以处理广义的数据失效。对系统数据进行安全有效的备份，具有非常重
要的意义。
1. 复制＊系统备份
备份不等于单纯的复制，因为系统的重要信息无法用复制的方式备份下来，而且管理也
是备份的重要组成部分。管理包括自动备份计划、历史记录保存、日志管理和报表生成等，
没有管理功能的备份，不能算是真正意义上的备份，因为单纯的复制并不能减轻繁重的备份
任务。
2. 硬件备份＊系统备份
硬件备份属于系统备份的一个层次，可以有效地防止物理故障。但对于那些由千人为错
误或故意破坏而引起的数据丢失，硬件备份则无能为力。因此，硬件备份不能完全保证系统数
据的安全，只有系统备份才能提供真正的数据保护。
3. 数据文件备份＊系统备份
有很多人认为备份只是对数据文件的备份，系统文件与应用程序无须进行备份，因为它
们可以通过安装盘重新进行安装。实际上这是对备份的误解。在网络环境中，系统和应用程序
安装起来并不是那么简单：人们必须找出所有的安装盘和原来的安装记录进行安装，然后重新
设置各种参数、用户信息和权限等，这个过程可能要持续好几天。因此，最有效的方法是对整
个网络系统进行备份。这样，无论系统遇到多大的灾难，都能够应付自如。
9.2 数据备份方案
为保证关键数据和应用系统的正常运行，根据数据和应用系统的特点，制定数据备份方
案是至关重要的。目前的数据备份方案主要有磁盘备份、双机备份和网络备份。
9.2.1 磁盘备份
磁盘备份，顾名思义就是用磁盘备份数据，就是把重要的数据备份到磁盘上，它的主要
方式是磁盘阵列和磁盘镜像。
1. 磁盘阵列
1987 年，加州大学伯克利分校的一位人员发表了名为“磁盘阵列研究”的论文，正式提
到了RAID，也就是磁盘阵列，论文提出廉价的5.25 英寸(in) 及3.5 英寸的磁盘也能如8 英
寸盘那样提供大容量、高性能和数据的一致性，并详述了RAIDI~RAID5 的技术。
磁盘阵列针对不同应用使用的不同技术，称为RAID level, RAID 是Redundant Array of
Inexpensive Disks 的缩写，而每一个level 代表一种技术，目前业界公认的标准是RAIDO~
RAID5 。这个level 并不代表技术的高低， level5 并不高千level3, levell 也不低千level4, 至
于要选择哪一种RAID level 的产品，完全视用户的操作环境(Operating Environment) 及应用
(Application) 而定，与level 的高低没有必然的关系。RAIDO 没有安全的保障，但其快速，所
以适合高速1/0 的系统； RAIDl 适用千需要安全性又要兼顾速度的系统， RAID2 及RAID3 适
用千大型计算机及影像、CAD/CAM 等处理； RAID5 多用千联机交易处理(OLTP) ，因有金
融机构及大型数据处理中心的迫切需要，故使用较多而较有名气，但也因此形成很多人对磁盘
阵列的误解，以为磁盘阵列非要RAID5 不可； RAID4 较少使用，和RAID5 有共同之处，但
RAID4 适合大量数据的存取。
273
计算机网络安全教程第4 版
在介绍各个RAID level 之前，先看看形成磁盘阵列的两个基本技术：磁盘延伸、磁盘~
数据分段。
(1) 磁盘延伸
磁盘延伸(Disk Spanning) 能确切地表示
Disk Spanning 这种技术的含义。图9-1 所示是磁
盘阵列控制器连接了4 个磁盘。
这4 个磁盘形成一个阵列(Array) ，而磁盘
阵列的控制器(RAID Controller) 是将此4 个磁
盘视为单一的磁盘，如DOS 环境下的C 盘。这
是Disk Spanning 的意义，因为把小容量的磁盘延
伸为大容量的单一磁盘，用户不必规划数据在各
磁盘的分布，而且提高了磁盘空间的使用率。图9-1 磁盘延伸结构图
SCSI 磁盘阵列更可连接几十个磁盘，形成数百GB 到数TB 的阵列，使磁盘容量几乎可~行二
无限的延伸；而各个磁盘一起做取存的动作，比单一磁盘更为快捷。很明显的，由此阵列~
形成而产生了RAID 的各种技术。从图9-1 也可看出价格的优势，因为4 个250GBytes B<:I
磁盘比一个ITBytes 的磁盘要便宜，尤其以前大磁盘的价格非常昂贵，但在磁盘越＊赶狂更
宜的今天，价格已非磁盘阵列的重点，虽然对千需要大磁盘容量的系统，价格仍是~~仗I
要点。
(2) 磁盘或数据分段(Disk Striping 或Data Striping)
因为磁盘阵列是将同一阵列的多个磁盘视为单一的虚拟磁盘(Vutual Disk) ，所以~数：拒；
是以分段(Block 或Segment) 的方式顺序存放在磁盘阵列中的，如表9-2 所示。
磁盘阵列D控制器
磁盘1 磁盘2 磁盘3 磁盘4
磁盘0 磁盘） 磁盘2 磁盘3
AO-Al A2-A3 A4-A5 A6-A7
BO-Bl B2-B3 B4-BS B6-B7
Q沁l C2-C3 C4-C5 C6-C7
DO-DI 02-03 D牛D5 D6-D7
表9-2 数据分段
数据按需要分段，从第一个磁盘开始放，放到最后一个磁盘再回到第一个磁盘放起，直：
到数据分布完毕。至于分段的大小视系统而定，有的系统或以1KB 最有效率，或以4KB, 或：
以6KB，甚至是4MB 或8MB 的，但除非数据小千一个扇区(Sector, 即521B) ，否则其分皂t
应是512B 的倍数。因为磁盘的读写是以一个扇区为单位，若数据小千512B, 系统读取该扇｝
区后，还要做组合或分组（视读或写而定）的动作，浪费时间。从表9-2 可以看出，数据以分｀
段分布在不同的磁盘，整个阵列的各个磁盘可同时做读写，故数据分段使数据的存取有最~~
效率，理论上本来读一个包含4 个分段的数据所需要的时间约＝ （磁盘的Access Time ＋数挂号
的Transfer Time) X 4 次，现在只要一次就可以完成。
若以N 表示磁盘的数目， R 表示读取， W 表示写入， S 表示可使用空间，则数据分段的
性能如下。
R=N （可同时读取所有磁盘）
W=N （可同时写入所有磁盘）
274
笫9 章数据备份技术
S=N （可利用所有的磁盘，井有最佳的使用率）
介绍完以上两种基本技术， RAID 的几种标准就非常容易理解了。
(3) RAID 0
Disk Striping 也称为RAID 0, 很多人以为RAIDO 没有什么，其实这是非常错误的观念，
因为RAID 0 使磁盘的输出输入有最高的效率。而磁盘阵列有更好效率的原因除数据分段外，
它可以同时执行多个输出输入的要求，因为阵列中的每一个磁盘都能独立动作，分段放在不同
的磁盘，不同的磁盘可同时进行读写操作，而且能在Cache 及磁盘进行并行存取(Parallel
Access) 的动作，但只有硬件的磁盘阵列才有此性能表现。
从上述两点可以看出， Disk Spanning 定义了RAID 的基本形式，提供了一个便宜、灵
活、高性能的系统结构，而Disk Striping 解决了数据的存取效率和磁盘的利用率问题，
RAID I 至RAID5 是在此基础上提供磁盘安全的方案。
(4) RA江） 1
RAID 1 是使用磁盘镜像(Disk M虹oring) 的技术。磁盘镜像应用在RAID 1 之前就在很
多系统中使用，它的方式是在工作磁盘(Working Disk) 之外再加一个额外的备份磁盘
C Backup Disk) ，两个磁盘所储存的数据完全一样，数据写入工作磁盘的同时亦写入备份磁
盘。磁盘镜像不见得就是RAID 1, 如Novell NetWare 也有提供磁盘镜像的功能，但并不表示
NetWare 有了RAID 1 的功能。一般磁盘镜像和RAID 1 有两点最大的不同。
RAID 1 无工作磁盘和备份磁盘之分，多个磁盘可同时动作而有重叠(Overlapping) 读取
的功能，甚至不同的镜像磁盘可同时做写入的动作，这是一种最佳化的方式，称为负载平衡
(Load-Balance) 。例如有多个用户在同一时间要读取数据，系统能同时驱动互相镜像的磁盘，
同时读取数据，以减轻系统的负载，增加I/0 的性能。
RAID 1 的磁盘是以磁盘延伸的方式形成阵列，而数据是以数据分段的方式进行储存，因
而在读取时，它几乎和RAID 0 有同样的性能。从RAID 的结构就可以很清楚地看出RAID 1
和一般磁盘镜像的不同。
表9-3 为RAID 1 数据存储结构，每一条数据都储存两份。
从表9-3 中可以看出：
R=N （可同时读取所有磁盘）
W=N/2 （同时写入磁盘数）
S=N/2 （利用率）·
读取数据时可用到所有的磁盘，充分发挥数据分段的优点；写入数据时，因为有备份，
所以要写入两个磁盘，其效率是N/2, 磁盘空间的使用率也只有全部磁盘的一半。
表9-3 RAIDl 数据存储结构
磁盘0 磁盘0 磁盘1 磁盘1
AO Al AO Al
A2 A3 A2 A3
A4 BO A4 BO
Bl B2 Bl B2
很多人以为RAID 1 要加一个额外的磁盘，形成浪费，而不看好RAID 1, 事实上磁盘越
来越便宜，并不见得造成负担，况且RAID 1 有最好的容错(Fault Tolerance) 能力，其效率也
275
计算机网络安全教程第4 版
是除RAID 0 之外最高的。可以根据应用的不同，在同一磁盘阵列中使用不同的RAID level,
如可在同一磁盘阵列中定义8 个逻辑磁盘(Logic Disk)，分别使用不同的RAID level, 分为
C: 、D: 及E: 共3 个逻辑磁盘。
RAID 1 完全做到了不停机(Non-stop) ，当某一磁盘发生故障，可将此磁盘拆下来而不影
响其他磁盘的操作；待新的磁盘换上去之后，系统即时做镜像，将数据重新恢复上去，
RAID 1 在容错及存取的性能上是所有RAID level 之冠。
在磁盘阵列的技术上，从RAID 1~RAID5 ，不停机的意思表示在工作时如发生磁盘故
障，系统能持续工作而不停顿，仍然可做磁盘的存取及正常读写数据；而容错则表示即使~盘：
故障，数据仍能保持完整，可让系统存取到正确的数据，而SCSI 的磁盘阵列更可在工作中抽
换磁盘，并可自动重建故障磁盘的数据。磁盘阵列之所以能做到容错及不停机，是因为它有冗
余的磁盘空间可供利用，这也就是冗余(Redundant) 的意义。
(5) RAID 2
RAID 2 是把数据分散为位(bit) 或块(Block) ，加入海明码(Hamming Code), ti:
磁盘阵列中做间隔写入(Interleaving) 到每个磁盘中，而且地址(Address) 都一样，~
就是在各个磁盘中，其数据都在相同的磁道(Cylinder 或Track) 及扇区中。RAID 2 的
设计是使用共轴同步(Spindle Synchronize) 的技术，存取数据时，整个磁盘阵列一~~
作，在各自磁盘的相同位置进行并行存取，所以有最快的存取时间，其总线是特别的~
计，以大带宽并行传输所存取的数据，所以有最快的传输时间(Transfer Time ）。在＊~
档案的存取应用， RAID 2 有最好的性能，但如果文件太小，会将其性能拉下来，因~磋炙
盘的存取是以扇区为单位的，而RAID2 的存取是所有磁盘平行动作，而且是做单位的存：
取，故小于一个扇区的数据量会使其性能大打折扣。RAID 2 是设计给需要连续且大量数
据的计算机使用的，如大型计算机、做影像处理或CAD/CAM 的工作站等，并不适用千
一般的多用户环境、网络服务器、小型机或PC 。
RAID 2 的安全采用内存阵列(Memory Array) 的技术，使用多个额外的磁盘做单位错误
校正(Sing比bit Correction) 及双位错误检测(Double.bit Detection) ；至千需要多少个额外的
磁盘，则根据其所采用的方法及结构而定，例如8 个数据磁盘的阵列可能需要3 个额外的磁
盘有32 个数据磁盘的高档阵列可能需要7 个额外的磁盘。
(6) RAID 3
RAID 3 的数据储存及存取方式都和RAID 2 一样，但在安全方面以奇偶校验(Parity
Check) 取代海明码做错误校正及检测，所以只需要一个额外的校验磁盘(Parity Disk) 。奇｛禺
校验值的计算是以各个磁盘的对应位做XOR 的逻辑运算，然后将结果写入奇偶校验磁盘，~
何数据的修改都要做奇偶校验计算，如表9-4 所示。
表9-4 RAID3 的数据存储
磁盘0 磁盘l 磁盘2 磁盘3 磁盘4
AO Al A2 A3 p
A4 BO Bl B2 p
B3 B4 co Cl p
C2 C3 C4 DO p
如某一磁盘故障，换上新的磁盘后，整个磁盘阵列（包括奇偶校验磁盘）需重新计算一
276
第9 章数据备份技术
次，将故障磁盘的数据恢复并写入新磁盘中；如奇偶校验磁盘故障，则重新计算奇偶校验值，
以达容错的要求。
与RAID 1 、RAID 2 相比， RAID 3 有85％的磁盘空间利用率，其性能比RAID 2 稍差，
因为要做奇偶校验计算共轴同步的井行存取在读文件时有很好的性能，但在写入时较慢，需
要重新计算及修改奇偶校验磁盘的内容。RAID 3 和RAID 2 有同样的应用方式，适用千大文
件及大量数据输出输入的应用，并不适用千PC 及网络服务器。
(7) RA江） 4
R血4 也使用一个校验磁盘，但和RAID3 不一样，如表9-5 所示。
表9-5 RAID4 的数据存储
磁盘0 磁盘1 磁盘2 磁盘3 磁盘4
AO-Al A2-A3 A牛BO B1-B2 p
B3-B4 C此l C2-C3 C4-DO p
D1-D2 D3-D4 EO-El E2-E3 p
E4-FO Fl-F2 F3-F4 G的1 p
RAID4 是以扇区进行数据分段的，各磁盘相同位置的分段形成一个校验磁盘分段(Parity
Block) ，放在校验磁盘。这种方式可在不同的磁盘并行执行不同的读取命令，大幅提高磁盘阵
列的读取性能；但写入数据时，因受限千校验磁盘，同一时间只能进行一次，启动所有磁盘读
取数据形成同一校验分段的所有数据分段，与要写入的数据做好校验计算再写入。即使如此，
小型文件的写入仍然比RAID 3 快，因其校验计算较简单而不是做位(Bit Level) 的计算；但
校验磁盘形成RAID4 的瓶颈，降低了性能，因此有了RAID5 而使得RAID4 较少使用。
(8) RA江） 5
R砌5 避免了RAID4 的瓶颈，方法是不用校验磁盘而将校验数据以循环的方式放在每一
个磁盘中，如表9-6 所示。
磁盘阵列的第一个磁盘分段是校验值，第二个磁盘至后一个磁盘再折回第一个磁盘的分
段是数据，然后第二个磁盘的分段是校验值，从第三个磁盘再折回第二个磁盘的分段是数据，
以此类推，直到放完为止。第一个Parity Block 是由AO、Al 、…、Bl 、B2 计算出来，第二个
Parity Block 是由B3 、B4、…、C4、DO 计算出来，也就是校验值是由各磁盘同一位置的分段
的数据所计算出来。这种方式能大幅增加小文件的存取性能，不但可同时读取，甚至有可能同
时执行多个写入的动作，如可写入数据到磁盘1, 而其Parity Block 在磁盘2, 同时写入数据到
磁盘4, 而其Parity Block 在磁盘1, 这为联机交易处理(On-line Transaction Processing,
OLTP)，如银行系统、证券等大型数据库的处理提供了最佳的解决方案，因为这些应用的每一
笔数据量小，磁盘输出输入频繁而且必须容错。
表9-6 RAID5 的数据存储
磁盘0 磁盘1 磁盘2 磁盘3 磁盘4
p AO-Al A2-B3 A4-BO Bl-B2
B3-84 p CO-Cl C2-C3 C4-DO
DI-D2 D3工D4 p EO-El E2-E3
胚FO Fl-F2 F3-F4 p G0Gl
事实上RAID 5 的性能并不如此理想，因为任何数据的修改，都要把同一奇偶校验块的所
有数据读出来修改后，做完校验计算再写回去，也就是RMW cycle (Read-Modify-Write
277
计算机网络安全教程笫4 版
cycle, 这个cycle 没有包括校验计算）；正因为牵一发而动全身，所以：
R=N （可同时读取所有磁盘）
W=l （可同时写入磁盘数）
S=N-1 （利用率）
RAID 5 的控制比较复杂，尤其是利用硬件对磁盘阵列的控制，因为这种方式的应用比~
他的RAID level 要掌握更多的事情，有更多的输出输入需求，既要速度快，又要处理数据、
计算校验值和进行错误校正等，所以价格较高；其最好应用是OLTP, 至千用千PC 等，不见L
得有最佳的性能。
(9) RAID 的对比
表9-7 和表9-8 所示是RAID 的一些性质。
表9-7 RAID 磁盘需求和容量
操作工作模式最少磁盘需求量可用容量
RAIDO 磁盘延伸和数据分布2 T
RAID I 数据分布和镜像2 T/2
RAID2 共轴同步，井行传输， ECC 3 Tx(n-1)/n
RAID3 共轴同步，并行传输， Parity 3 Tx(n一1)/n
RAID4 数据分布，固定Parity 3 Tx(n-1)/o
RAIDS 数据分布，分布Parity 3 Tx(n-1)/n
表9-8 RAID 性能与可用性
RAID Level 用户数据利用率带宽性能传输性能数据可用性
RAIDO 1 0.2S I 0.0005
RAIDl O. 5 0.25 0.85 1
RA江） 2 0.67 1 0.25 0.9999
RAID3 0.75 I 0.25 0.9999
RA江） 4 0.75 0.25 0.61 0.9999
RAIDS 0.15 0.25 0.61 0.9999
以上数据基千4 个磁盘，传输块大小为1KB, 75％的读概率，数据可用性的计算基千同
样的损坏概率。
2. 磁盘镜像
简单地讲，磁盘镜像就是一个原始的设备虚拟技术，它的原理是：系统产生的每个J/0~
作都在两个磁盘上执行，而这一对磁盘看起来就像一个磁盘一样。
当镜像磁盘对中一个磁盘失败时，就需要替换它。一旦新的磁盘被安装，就要把另一I
作磁盘上的数据复制过来，这可以是一个自动的过程，但如果拥有了娴熟的镜像技术，也可鱼以
手工操作。假如使用的是一个具有热插拔特性的磁盘子系统，当安装替换组件时，不必关~~
统。假如系统不具有热插拔特性，为了撤走和替换故障磁盘，必须关掉系统， 或者关掉磁盘子
系统。当系统正在运行时， 如果不能保证不影响系统运行，千万不要草率地撤去或插入磁~，
这样很可能导致系统崩溃或者数据损坏。
但是，镜像也可能带来一些问题，如无用数据占据存储空间。由千从属驱动器是主~动
器的镜像，保存了所有主驱动器的内容，假如主磁盘包含引导记录，那么，从属磁盘也~~引
278
第9 章数据备份技术
导记录；假如主磁盘中包含一组Wmdows 回收站文件，则从属磁盘中也包含一组Wmdows 回
收站文件，这些数据和文件可能都是无用的，浪费了磁盘资源。
有三种方式可以实现磁盘镜像，分别是：运行在主机系统的软件、外部磁盘子系统和主
机J/0 控制器。第一种方式是软件方式，而后两种主要是硬件实现方式。
在这3 种方法的优劣比较中，很重要的一项衡量指标是，对失败磁盘驱动器进行更换的
难易程度。对千磁盘驱动器来说，服务器一般不考虑用做即插即用系统。当服务器负荷很重
时，它所产生的结果并不完全是所希望的。但支持热插拔的外部磁盘子系统例外，它能提供安
全的磁盘即插即用功能。
(1) 软件镜像
大多数主流服务器操作系统和文件系统都提供基本的磁盘镜像功能，为了易千安装，一
般都省略了性能、远程管理和配置灵活性等，因此，操作系统的镜像功能提供了一个既廉价又
方便的选择。
软件磁盘镜像既可以使用内部驱动器（位千服务器机柜中），也可以使用外部磁盘组
(JBOD) 机柜中的磁盘。珀OD 是一个简单的磁盘子系统，能为外部机柜中的多个磁盘驱动器
提供电源和1/0 连接。采用JBOD 不仅可以方便地更换和扩展磁盘，同时，它具有较好的电
源、风扇等配套外设来保证磁盘组拥有更好的工作环境。
软件镜像是一个系统的管理应用，它运行在主机系统上，并利用主机的处理器周期和内
存资源执行自己的作业。因此，软件镜像将影响服务器的性能。
然而，由千它是运行在主机上的一个应用，因而，比起控制器和子系统镜像，软件镜像
更容易集成到各种服务器和网络存储环境中。此外，修改和更新镜像软件也相当容易，相比而
言，修改硬件和主机J/0 控制器或磁盘子系统中固件镜像方案困难得多。
假如使用软件磁盘镜像，那么在更换故障驱动器时，应该关掉服务器。最好不要从正在
运行的服务器上撤去磁盘驱动器。
(2) 外部磁盘子系统中的镜像
第二种磁盘镜像位千外部RAID 子系统， RAID 包含着一个智能处理器，能够提供高级的
磁盘操作和管理，这也就是通常所说的RAID 1 。由于镜像运行在RAID 机柜中，主机操作系
统和主机J/0 控制器只感觉到一个虚拟磁盘，而不是两个镜像磁盘的存在，这种镜像方法对主
机CPU 影响最小。许多公司能够提供镜像磁盘驱动器的RAID 子系统，也能提供更为高级的
磁盘管理功能，这些公司包括EMC、IBM、HP 、StorageTek 和MTI 等。
虽然外部磁盘子系统的镜像性能不错，但管理方面却有待进一步完善，难以提供基千服
务器的配置和错误报告的管理方案，这类系统很难集成到现存的管理系统中。
置换磁盘驱动器的方便性与性能的优势是外部磁盘子系统真正吸引人之处。在提供统一
存储管理方面，其他方法都存在缺陷，唯有外部磁盘子系统具有及时替换故障磁盘的能力。如
果用户有7X24 小时持续工作的需求，那么，外部磁盘子系统是仅有的选择。
(3) 主机J/0 控制器镜像
最后一种磁盘镜像的实现位于主机J/0 控制器中，简单地说，就是通过主机中的RAID 卡
来实现磁盘镜像。像软盘镜像一样，主机J/0 控制器镜像既可以与内部磁盘控制器一起工作，
也可以与JBOD 机柜中的磁盘驱动器一起工作。一般地说，主机1/0 控制器并不提供镜像功
能，但也有一些特别的例外情况，如Adaptec、DPT 和CMD 等制造的主机J/0 控制器，都提
供RAIDI 的镜像功能。
279
计算机网络安全教程第4 版
主机1/0 控制器镜像集中了软盘镜像和外部子系统镜像的许多优点，提供了较好的性能。
当与外部磁盘子系统一起工作时，镜像功能可以在专门的芯片上实现，不仅提供最好的性能，
而且不占用服务器的CPU 周期，节省的CPU 周期可用于其他任务。
双机备份
所谓双机热备份(Hot Standby) ，就是一台主机为工作机(Primary Server) ，另一台主机上
为备份机(Standby Server) ，在系统正常情况下，工作机为信息系统提供支持，备份机监视工
作机的运行情况（工作机也同时监视备份机是否正常，有时备份机因某种原因出现异常，工~
机应尽早通知系统管理员解决，确保下一次切换的可靠性）。当工作机出现异常，不能支M=1言
息系统运营时，备份机主动接管(Take Over) 工作机的工作，继续支持信息的运营，从而保：
证信息系统能够不间断的运行(Non-Stop) 。待工作机经过修复正常后，系统管理员通过管~
命令或经由以人工或自动的方式将备份机的工作切换回工作机；也可以激活监视程序，监视备
份机的运行情况，此时，原来的备份机就成了工作机，而原来的工作机就成了备份机。
双机热备份目前运用比较广泛，它可以保证信息系统能够不间断地运行，目前普遍的船:
决方案有5 种。
1. 纯软件方案
该方案不使用任何附加硬件，完全通过软件的方法来实现双机备份，如图9-2 所示。在：
此方案中，数据通过镜像专用网络将数据实时备份到备机，使主机系统有了一个完全一样的备·
份系统。与常规的双机系统相比，纯软件双机热备份系统的两台服务器之间少了公共的存储设：
备（通常是磁盘阵列）。
在这个方案中，主机系统所需的软硬件配置如下。
• PC 服务器两台（可以是不同配置）。
·操作系统两套。
·数据库系统一套。
·备份软件一套。
·以太网卡两块（每台服务器应内置一块）。
• RS232 串口线和CAT5 类直连(NO Hub) 网线各一根。
这个纯软件的方案相对其他方案的优点如下。
·风险平均分散到主、备两个系统上，真正提高了系统的可靠性。
·双机通过以太网连接，可以在线撤离修复，并允许远程备份。
·纯软件实现双机容错，没有挪动、受潮、被盗和折旧等带来的忧虑。
·产品升级方便，重复投资小。
·对最终用户来说投资小，可靠性高。
2. 灾难备份方案
该方案主要是一种异地容灾方案，如图9-3 所示。主站点
的内容采用异步传输的方式同时镜像到其他镜像站点，再通过
自动的定时同步保证各站点间数据变化过程中的一致性。这样
客户将在多个站点同时拥有相同的备份数据，确保关键业务数
据的安全可靠。当主站点发生不可预测的灾难性事故，如地
震、洪水或失火等后，可以迅速切换任一数据备份站点作为主站点，保证关键业务不间断运
9.2.2
I 串口监控线
机
l, 备
一网
芷
＿像
一镜
图9-2 纯软件方案
镜像专用光纤网络
·一一一一一
光纤交换机
灾难备份方案
光纤交换机
图9-3
280
第9 章数据备份技术
行。同时可以通过高速光纤网络，在最短的时间内利用异地备份数据恢复客户主站点数据
系统。
由于这种方案的主备机采用TCP/IP 协议的网络连接，因此任何能够运行TCP/IP 协议的网络
都可以使用这种方案来备份主机系统。在这个方案中，主机系统所需的软硬件配置如下。
• PC 服务器两台（可以是不同配置）。
·操作系统两套。
·数据库系统一套。
·备份软件一套。
• FDDI 网卡4 块（如为节省投资考虑，镜像专用光纤可以省去，通过一个光纤网络来实
现数据镜像和连接客户端，此时只需两块网卡）。
·光纤交换机或其他光纤设备两台。
这个方案相对其他方案的优点如下。
·风险平均分散到主备两个系统上，真正提高系统的可靠性。
·双机通过光纤网络连接，数据备份到异地，实现了容灾备份。
·纯软件实现双机容错，没有挪动、受潮、被盗和折旧等带来的忧虑。
·产品升级方便，重复投资小。
这个方案的缺点是：由于主备机通过光纤网络连接，所以对这个网络连接质量和速度要
求较高。
3. 共享磁盘阵列方案
由两台服务器和共享磁盘阵列构成高可用系统，如图9-4 所示，双机通过共享独立的存
储子系统来保证故障切换后数据的一致性。在两台服务器中安装所有的服务模块。通过系统的
服务监测模块来互相监测对方的状态及服务，服务监测模块通过网络和串口来定时监测对方状
态。该系统具有3 种运行状态。
l) 主机运行服务1, 且在工作时使用磁盘阵列， 备
机运行服务2 。
2) Fail Over。
·当主机出现故障时：备机监测到主机出现故障，
串口监控线
接管主机的IP 地址，然后Mount 磁盘阵列，最----., ___________________._ ____ _
后启动服务l 。图9-4 共享磁盘阵列方案
·当备机出现故障时：主机监测到备机出现故障，监管备机的IP 地址，然后启动服务2 。
3) TakeOver。故障服务器恢复后，两台服务器又开始工作，回到状态l 。
在这个方案中，主机系统所需的软硬件配置如下。
• PC 服务器两台。
·磁盘阵列柜一套，要注意选择支持HA 的产品。
·操作系统两套。
·数据库系统一套。
·备份软件一套。
• RS232 串口线一根。
相对第一个方案而言，由于磁盘阵列柜能加快系统I/0 速度，这个方案对千I/0 要求较高
的系统运行效率高。但是这个方案的缺点也较其他几个方案突出。
28I
计算机网络安全教程第4 版
双机通过共享数据来达到高可用目的，风险集中到磁盘阵列上面。这种风险一方面是由
千磁盘阵列最多只对磁盘、电源、控制器和风扇进行冗余备份，而其他像主板、内存和连线
（如SCSI 线）等大多数设备不进行冗余备份，导致这些部件损坏后双机无法工作。尤其是目
前众多厂家的价格竞争使产品的质量控制在较低的水平，当磁盘阵列子系统的可靠性不如主机｀
时，整个系统的可靠性甚至不如单台主机独立运行。另一个风险是数据只有一份，如果软件故
障导致数据损坏，那么即使磁盘阵列本身完好数据也会受到严重破坏，如主机工作时主备机若~
信全部丢失，备机会自动启动应用工作，备机在主机对数据进行访问的同时对数据进行访问会造成
文件系统崩溃或数据库的系统库不一致等严重故障而数据全部不可恢复。这两类故障在我国已出现
很多次，其中不乏金融等关键行业，给集成商和用户带来了很多不必要的损失。因此建议采用此方
案时，该用户的应用不能太重要，最好是MIS 等系统而且要特别重视数据的日常备份。
相对第一种方案，由于双机和磁盘阵列采用SCSI 连接，所以连接之间不可带电拔插，否
则容易烧坏设备。所以故障系统不能在线地拆离修复。
4. 双机单柜方案
磁盘阵列子系统单独连接到主机，磁盘阵列中的数据只给主机专用，数据通过专用的数据网
完整且实时备份到备机上，风险完全分散到双机上。双机单柜方案的连接结构如图9-5 所示。
在这个方案中，主机系统所需的软硬件配置如下。丘二d 串口监控线
• PC 服务器两台。
·磁盘阵列柜一套。
脤邑1,1 镜像专用网
·操作系统两套。
·数据库系统一套。［主机磁盘阵列子系统
·备份软件一套。---- －－－－－－－－－－－－－－－－－一－－－－－
·以太网卡两块（每台服务器应内置一块）。图9-5 双机单柜方案
• RS232 串口线、CAT5 类直连(NO HUB) 网线一根。
这个方案相对第一种和第二种方案的优点如下。
·在主用机上使用了磁盘阵列子系统，加快了应用系统I/0 的速度，有独立存储子系统
的各种优点。
·通过备份软件将数据完整且实时地备份到备机上，风险完全分散到双机上。
·双机通过以太网连接，可以在线撤离修复，并允许远程备份。
·方案没有磁盘阵列系统损坏后丢失数据的风险，同时又很好地满足了应用系统对高可赈
靠性和高可用性的需求。
s. 双机双柜方案
主备机各连接一台磁盘阵列子系统，其上的数据通过镜像专用网实时镜像到备机，备用~~
与主机完全相同的系统和数据环境，主备机运行效率也
完全相同。这个方案的系统连接结构如图9-6 所示。
在这个方案中，主机系统所需的软硬件配置如下。
• PC 服务器两台。
·磁盘阵列柜两套。
·操作系统两套。
·数据库系统一套。
·备份软件一套。
282
串口监控线
镜像专用网
胆邑
洼，
___LU一·巴
磁盘阵列
子系统子系统
图9-6 双机双柜方案
笫9 章数据备份技术
·以太网卡两块（每台服务器应内置一块）。
• RS232 串口线、CAT5 类直连(NO HUB) 网线各一根。
这个方案具有第三个方案的全部优点，同时由于在备机上使用了单独的存储子系统，大
大加快了整个系统的1/0 速度。相对地，这个方案的成本也是最高的。
9.2.3 网络备份
I. 网络备份系统的作用
采用主机内置或外置的磁带机对数据进行冷备份，这种备份方式在数据量不大、操作系
统种类单一、服务器数量有限的情况下，可以说是一种既经济又简单的备份手段。但随着现代
企业计算机规模的扩大，数据量爆炸性的增长，以及分布式网络环境的兴起，企业将越来越多
的业务分布在不同的计算机、不同的操作平台甚至不同的地点上，这种单机的人工冷备份方式
越来越不适应当今分布式网络环境，存在以下种种弊端。
·数据管理工作难以形成制度化，数据丢失现象难以避免。
·数据分散在不同的计算机、不同的应用上，管理分散， 安全性得不到保障。
·难以实现数据库数据的高效在线备份。
·运行着的系统使得维护人员寸步难离，业务人员工作效率下降。
·存储介质管理困难，如今，用来存储数据的介质越来越多，不同系统下存储产生的磁
盘、磁带和光盘将给管理带来很大的困难。
·历史数据保留比较困难。
·来自非计算机系统因素的隐患，如火灾、地震等灾难后的系统重建和业务数据运作。
理想的备份系统应该是全方位、多层次的。首先，要使用硬件备份来防止硬件故障；如
果由于软件故障或人为误操作造成了数据的逻辑损坏，则使用网络存储备份系统和硬件容错相
结合的方式来恢复。这种结合方式构成了对系统软硬件的多级防护，不仅能够有效地防止物理
损坏，还能够比较好地防止逻辑损坏。
在网络系统安全建设中必不可少的一个环节就是数据的常规备份和历史保存。一般生产
本地备份的目的主要有两个：一是生产系统的业务数据由千系统或人为误操作造成损坏或丢失
后，可及时在生产本地实现数据的恢复；二是在发生地域性灾难（如地震、火灾和机器毁坏
等）时，可及时在本地或异地实现数据及整个系统的灾难恢复。
考虑到生产本地环境安全性原因，常规数据备份一般要求一份数据至少应该复制两份，
一份放在生产中心以保证数据的正常恢复和数据查询恢复，另一份则要移到异地保存，以保证
在生产本地出现灾难后最低限度的数据恢复。此外，更应建立历史归档数据的异地存放制度，
从而确保对历史业务数据的可靠恢复与有效审核的实现。
由此可见，比较理想的网络备份系统应该具备以下功能。
·集中式管理：网络存储备份管理系统对整个网络的数据进行管理。利用集中式管理工
具的帮助，系统管理员可对整个网络的备份策略进行统一管理，备份服务器可以监控
所有计算机的备份作业，也可以及时地修改备份策略，而且可即时浏览所有目录。所
有的数据可以备份到同备份服务器或应用服务器相连的任意一个磁带库内，这样就有
了最大的可管理性。
·全自动的备份：对于大多数机房管理人员来说，备份是一项繁重且枯燥的工作，小企业
还好，大企业的数据量十分庞大，这就要求相干的人员每天都要小心翼翼，不敢有半点
283
计算机网络安全教程第4 版
闪失，生怕一个错误就带来不可挽回的损失。所以，一旦网络备份能够实现定时自动备
份，就可以大大减轻管理员的压力。备份系统可以根据用户的实际需求，合理地定义需
要备份的数据，然后以图形界面的方式根据需要设置备份时间表，备份系统将自动启动
备份作业，无须人工干预。这个自动备份作业是可自定的，包括一次备份作业、每周的
某几日、每月的第几天等项目。设定好计划后，备份作业就会按计划自动进行。
·数据库备份和恢复：在许多人的观念里，数据库和文件还是同一个概念。当然，如果
用户的数据库系统是基千文件系统的，确实可以用备份文件的方法备份数据库。但发
展至今，数据库系统已经相当复杂和庞大，再用文件的备份方式来备份数据库已不~
用。是否能够将需要的数据从庞大的数据库文件中抽取出来进行备份，是网络备份系
统是否先进的标志之一。
·在线式的索引：备份系统应为每天的备份在服务器中建立在线式的索引，当用户需要恢复
时，只需点取在线式索引中需要恢复的文件或数据，该系统就会自动进行文件的恢复。
·归档管理：用户可以按项目和时间定期对所有数据进行有效的归档处理。提供统一的
数据存储格式，从而保证所有的应用数据由一个统一的数据格式来做永久的保存，保：
证数据的永久可利用性。
·有效的存储介质管理：备份系统对每一个用千作备份的磁带自动加入一个电子标签，
同时在软件中提供了识别标签的功能，如果磁带外面的标签脱落，只需执行这一J:}J
能，就会迅速知道该磁带的内容。
·分级存储管理：对出版业、制造业等易产生大量资料数据的行业而言，资料多属千~
占空间的图形影像，且每张设计底稿及文件资料又常需随时保持在线状态。基于管理及·
成本的考虑，分级存储管理(Hierarchical Storage Management, HSM) 系统是一个合适
的在线备份解决方案。它利用磁盘、可擦写磁光盘和磁带进行三层式存储管理。所谓~
级存储管理系统，是一套自动化的网络存储管理设备，会自动判断磁盘中资料的使用步页
率，自动将不常用的资料移至速度较慢的光盘，而最不常用的资料则移到磁带中，这些
都由系统管理员自行设定。在线的资料经过一段时间的搬移后，即可达到最优化。
·系统灾难恢复：网络备份的最终目的是保障网络系统的顺利运行。所以优秀的网络备
份方案应能够备份系统的关键数据，在网络出现故障甚至损坏时，能够迅速地恢复网
络系统。从发现故障到完全恢复系统，理想的备份方案耗时不应超过半个工作日。
·满足系统不断增加的需求：备份软件必须能支持多平台系统，当网络上连接其他的应
用服务器时，对千网络存储管理系统来说，只需在其上安装支持这种服务器的客户端
软件，即可将数据备份到磁带库或光盘库中。
2．网络备份系统的工作原理
网络备份系统是指在分布式网络环境下，通过专业的数据存储管理软件，结合相应的~
件和存储设备，来对全网络的数据备份进行集中管理，从而实现自动化的备份、文件归档、~
据分级存储及灾难恢复等。
网络备份系统的工作原理是在网络上选择一台应用服务器（当然也可以在网络中另配一
台服务器作为专用的备份服务器）作为网络数据存储管理服务器，安装网络数据存储管理服务
器端软件，作为整个网络的备份服务器。在备份服务器上连接一台大容量存储设备（如磁带
库、光盘库等）。在网络中其他需要进行数据备份管理的服务器上安装备份客户端软件，通过
局域网将数据集中备份管理到与备份服务器连接的存储设备上。
284
第9 章数据备份技术
网络备份系统的核心是备份管理软件，通过备份软件的计划功能，可为整个企业建立一
个完善的备份计划及策略，井可借助备份时的呼叫功能，让所有的服务器备份都能在同一时间
进行。备份软件也提供完善的灾难恢复手段，能够将备份硬件的优良特性完全发挥出来，使备
份和灾难恢复时间大大缩短，实现网络数据备份的全自动智能化管理。
目前在数据存储领域可以完成网络数据备份管理的软件产品主要有Legato Networker、
IBMADSM 和Veritas NetBackup 等。
3．相关技术介绍
(1) 分级存储管理(HSM) 技术
在单机运行环境中，由千数据量有限，因而数据的存储备份也相对简单。但随着网络的
普及和数据量的剧增，简单的备份已经无法满足需求，分级存储管理(HSM) 也就应运而
生。HSM 主要是用于对海量数据的存储备份，当系统中有很多数据，以至于不能经济有效地
将它们都存放在磁盘上时，就需要使用分级存储备份技术。
通常， HSM 是一个将硬驱、磁带驱动器和光驱组合起来的自动存储系统。其基本原则是
把绝大部分最常用到的数据保留在磁盘上，而将很少使用的数据存储到数据库中或磁带和光盘
上。系统随时监视文件和数据的使用情况，并且根据卷和目录对其进行实时跟踪。当数据使用
率较低时，系统自动将其转移到中间存储媒介，然后存放到专用的存储介质中进行长期保存。
一般情况下， 直接访问磁盘上的数据文件所需时间不超过几微秒，而从磁盘或磁带库中读取数
据大约需要lmin。HSM 系统不仅使数据的存储备份更加容易，而且也将数据检索的时间减少
到最低限度。
(2) 存储区域网(SAN) 技术
SAN 是随着光纤通道技术的出现而产生的新一代磁盘共享系统。实际上， SAN 就是通过交
换机把两个或更多的存储系统连接到两个或更多的服务器上。这一定义对使用什么样的互联技
术、软件的功能和网络结点间必须使用什么样的协议没有进行规定。一般说来， SAN 拥有3 种
主要部件：接口（包括SCSI、光纤通道等）、互连设备（如路由器、交换机等）和交换光纤。
SAN 的诱人之处在于它能够对一个存储网络设备中的带宽进行集中、多路复用和分散使
用，并且将对这个数据的访问扩展到多个平台。在SAN 环境中， SAN 将取代服务器实施对整
个存储过程的管理和控制，服务器仅负责监督工作。SAN 的前端设备只进行文件传输，从而
使用户能获得更高的传输速率。例如，通过光纤通道可获得远高千100Mbit/s 的速率，而通过
传统的SCSI 连接只能得到40Mbit/s 的速率。
9.3 数据备份与灾难恢复策略
前面介绍的都是全方位、多层次的备份方案，那么是不是所有的情况下都要用这种备份
方案呢？答案是否定的，因为有些应用只需要将重要数据进行备份，就算是系统备份也可能把
重要数据的备份作为补充。广义上的数据备份包括整个系统的备份和系统中重要数据（特别是
数据库）的备份，这里所要介绍的数据备份主要是指系统中重要数据的备份。
通常数据备份的核心是数据库的备份，目前市场流行数据库，如Oracle 、MS-SQL 和
MySQL 等均有自己的数据库备份工具，但它们不能实现自动备份，而且只能将数据备份到磁
带机或磁盘上，不能驱动磁带库等自动加载设备。显然利用数据库本身的备份工具远远达不到
客户的要求，必须采用具有自动加载功能的磁带库硬件产品与数据库在线备份功能的自动备份
285
计算机网络安全教程笫4 版
软件。目前流行的备份软件有多种，如Legato NetWorker 、CA ARCseiver 、HP OpenView
Omnibackll、IBM ADSM 及Veritas 公司的NetBackup 等。各家软件在备份管理方式上各有千
秋。它们都具有自动定时备份管理、备份介质自动管理和数据库在线备份管理等功能。其中，
Legato 、Veritas 和CA 是独立软件开发商，注重对各种操作系统和数据库平台的支持，而惠普
和田M 等更注重对本公司软／硬件产品的支持。
在惠普小型机或工作站设备占主流的应用环境中，以及在多平台操作系统和拥有不同数
据库的用户环境中， HP OmnibackII 拥有绝大部分的用户市场。在微软操作系统平台上CA 公
司的ARCSeiver IT 备份软件具有一定的竞争优势，但其只适合千单一平台下的数据在线备
份，而无法实现异构平台上的数据库在线备份。Legato 和Veritas 是美国专业从事企业数据安
全管理软件开发的公司，他们均能够提供跨平台网络数据的自动备份管理，可实现备份系统的
分布处理、集中管理、备份机器分组管理、备份介质分组管理、备份数据分类、分组管理及备
份介质自动重复使用等多项功能，备份的数据可在每个备份客户机上按需恢复。也可在同平台
上按用户权限交叉恢复，而备份操作可采用集中自动执行或手动执行。因此，对千跨平台多业
务的系统，可以考虑选择Veritas 或Legato 。
9.3.1 数据备份策略
选择了存储备份软件和存储备份技术（包括存储备份硬件及存储备份介质）后，首先需
要确定数据备份的策略。备份策略是指确定需备份的内容、备份时间及备份方式。各个单~要
根据自己的实际情况来制定不同的备份策略。目前采用最多的备份策略主要有以下3 种。
1. 完全备份
完全备份就是每天对自己的系统进行完全备份(Full Backup) 。例如，星期一用一盘~带
对整个系统进行备份，星期二再用另一盘磁带对整个系统进行备份，以此类推。这种备份策略
的好处是：当发生数据丢失的灾难时，只要用一盘磁带（即灾难发生前一天的备份磁带），就：
可以恢复丢失的数据。然而它亦有不足之处，首先，由于每天都对整个系统进行完全备份，~
成备份的数据大量重复。这些重复的数据占用了大量的磁带空间，这对用户来说就意味着增加
成本。其次，由千需要备份的数据量较大，因此备份所需的时间也就较长。对于那些业务繁
忙、备份时间有限的单位来说，选择这种备份策略是不明智的。
2. 增量备份
增量备份(Incremental Backup) 就是在星期天进行一次完全备份，然后在接下来的6 ;R:..
里只对当天新的或被修改过的数据进行备份。这种备份策略的优点是节省了磁带空间，缩~了
备份时间。但它的缺点在于，当灾难发生时，数据的恢复比较麻烦。例如，系统在星期三的早｀
晨发生了故障，丢失了大量的数据，那么现在就要将系统恢复到星期二晚上时的状态。这时系
统管理员就要首先找出星期天的那盘完全备份磁带进行系统恢复，然后再找出星期一的磁带来：
恢复星期一的数据，然后找出星期二的磁带来恢复星期二的数据。很明显，这种方式很烦琐。
另外，这种备份的可靠性也很差。在这种备份方式下，各盘磁带间的关系就像链子一样，一牙；
套一环，其中任何一盘磁带出了问题都会导致整条链子脱节。比如在上例中，若星期二的~~
出了故障，那么管理员最多只能将系统恢复到星期一晚上时的状态。
3. 差分备份
差分备份(Differential Backup) 就是管理员先在星期天进行一次系统完全备份，然后~
接下来的几天里，管理员再将当天所有与星期天不同的数据（新的或修改过的）备份到~带
286
第9 章数据备份技术
上。差分备份策略在避免了以上两种策略的缺陷的同时，又具有了它们的所有优点。首先，
它无须每天都对系统做完全备份，因此备份所需时间短，并节省了磁带空间。其次，它的灾
难恢复也很方便。系统管理员只需两盘磁带，即星期一的磁带与灾难发生前一天的磁带，就
可以将系统恢复。
完全备份所需时间最长，但恢复时间最短，操作最方便，当系统中的数据鱼不大时，采
用完全备份最可靠；但是随着数据昼的不断增大，将无法每天做完全备份，而只能在周末进行
完全备份，其他时间采用耗时更少的增量备份或介千两者之间的差分备份。各种备份的数据量
不同：全备份＞差分备份＞增量备份。在备份时要根据它们的特点灵活使用。在实际应用中，
备份策略通常是以上3 种的结合。例如每周一至周六进行一次增量备份或差分备份，每周日进
行完全备份，每月底进行一次完全备份，每年底进行一次完全备份。
备份过程中要求保存长期的历史数据，这些数据不可能保存在同一盘磁带上，每天都使
用新磁带备份显然也不可取。如何灵活使用备份方法，有效分配磁带，用较少的磁带有效地备
份长期数据，是备份制度要解决的问题。
磁带轮换策略就可以解决以上问题。它为每天的备份分配备份介质， 制定备份方法， 可
以最有效地利用备份介质。
常见的磁带轮换策略有以下几种。
(1) 三带轮换策略
三带轮换策略只需要3 盘磁带。用户每星期都用一盘磁带对整个网络系统进行增量备
份。备份过程如表9-9 所示。
表9-9 三带轮换策略
周一周二周三周四周五周六周日
第一周磁带1, 增鱼
第二周磁带2, 增鱼
第三周磁带3 , 增量
这种策略可以保存系统3 个星期内的数据，适用于数据量小、变化速度较慢的网络环境。
但这种策略有一个明显的缺点，就是周一到周四更新的数据没有得到有效的保护。如果周四的
时候系统发生故障，就只能用上周五的备份恢复数据，那么周一到周四所做的工作就丢失了。
(2) 六带轮换策略
六带轮换策略需要6 盘磁带。用户从星期一到星期四的每天都分别使用一盘磁带进行增量备
份，然后星期五使用第五盘磁衔进行完全备份。第二个星期的星期一到星期四重复使用第一个星期
的4 盘磁带，到了第二个星期五使用第六盘磁带进行完全备份。备份过程如表9-10 所示。
表9-10 六带轮换策略
周一周二1 周三1 周四周五周六1 周日
:二:| ：：：工1 ::::: 1 ::：工1 ::::: 1:::::
这种轮换策略能够备份两周的数据。如果本周三系统出现故障，只需上周五的完全备份
加上周一和上周二的增昼备份就可以恢复系统。但这种策略无法保存长期的历史数据，两周前
的数据就无法保存了。
(3) 祖今之一子轮换策略
祖－父－子(Grandfather-Father-Son, GFS) 轮换策略将六带轮换策略扩展到一个月以上。
287
计算机网络安全教程笫4 版
这种策略由三级备份组成：日备份、周备份和月备份。日备份为增量备份，周备份和月备份为
完全备份。日带共4 盘，用于周一至周四的增鱼备份，每周轮换使用；周带一般不少千4 ffi:,
顺序轮换使用；月带数量视情况而定，用千每月最后一次完全备份，备份后将数据留档保存。
备份过程如表9-11 所示。
表9-11 祖－父子轮换策略
周一周二周三周四周五周六周日
第一周日带1 增量日带2 增量日带3 增量日带4 增量周带1 完全
第二周日带1 增量日带2 增量日带3 增量日带4 增量周带2 完全
第三周日带）增量日带2 增量日带3 增量日带4 增量周带3 完全
第四周日带1 增量日带2 增量日带3 增量日带4 增盘月带x 完全(I)
根据周带和月带的数量不同，常见的祖－父－子轮换策略有21 盘制、20 盘制和15 盘制等。
下面以20 盘制为例进行介绍。
每日增量备份(4 盘）：周一至周四，每周轮换使用。
每周完全备份(4 盘）：每周五使用一盘，每月轮换一次。
每月完全备份(l2 盘）：每个月的最后一个周五，每年结束后可存档或重新使用。
9.3.2 灾难恢复策略
数据备份的最终目的是灾难恢复，灾难恢复措施在整个备份制度中占有相当重要的地；
位。因为它关系到系统在经历灾难后能否迅速恢复。灾难恢复操作通常可以分为两类。第—~
是全盘恢复，第二类是个别文件恢复，还有一种值得一提的是重定向恢复。
1．全盘恢复
全盘恢复一般应用在服务器发生意外灾难导致数据全部丢失、系统崩溃或是有计划的系
统升级、系统重组时，也称为系统恢复。
2．个别文件恢复
由千操作人员的水平不高，个别文件恢复可能要比全盘恢复常见得多，利用网络备~系
统的恢复功能，很容易恢复受损的个别文件。只需浏览备份数据库或目录，找到该文件，启~
恢复功能， 软件将自动驱动存储设备，加载相应的存储介质，然后恢复指定文件。
3. 重定向恢复
重定向恢复是将备份的文件恢复到另一个不同的位置或系统上去，而不是进行备份~~
时它们当时所在的位置。重定向恢复可以是整个系统恢复，也可以是个别文件恢复。重定向，恢
复时需要慎重考虑，要确保系统或文件恢复后的可用性。
9.4 备份软件简介
前面介绍的备份技术与方法在关键领域应用非常广泛，但是对于小型的应用或者个人用
户来说，这些技术和方法的应用成本比较高。对千非关键领域或个人用户，目前也有非常适用
的备份软件， Ghost 就是其中最为常见的一种，下面对它的使用方法进行简单介绍。
0x 为月份号，若当月有五个星期，则需使用周带4.
288
笫9 章数据备份技术
9.4.1 Ghost 软件基本信息
Ghost 软件是美国赛门铁克公司推出的一款出色的硬盘备份还原工具，俗称克隆软件，可
以实现FAT16 、FAT32 、NTFS 和0S2 等多种硬盘分区格式的分区及硬盘的备份还原。
Ghost 的备份还原是以硬盘的分区为单位进行的，也就是说可以将一个硬盘上的物理
信息完整复制，而不仅仅是数据的简单复制； Ghost 支持将分区或硬盘直接备份到一个扩
展名为gho 的文件里（赛门铁克把这种文件称为镜像文件），也支持直接备份到另一个分
区或硬盘里。
由千Ghost 的备份还原是按分区来进行复制的，所以在操作时一定要小心，不要把目标盘
（分区）弄错了，如果不慎将目标盘（分区）的数据全部抹掉就基本没有恢复机会了。
Ghost 只支持DOS 的运行环境。通常把Ghost 软件文件复制到启动U 盘里，也可将其刻
录进启动光盘，用启动盘进入DOS 环境后，在提示符下输入Ghost, 按（Enter〉键即可运行
Ghost, 首先出现的是关千界面，如图9-7 所示。
图9-7 Ghost 的关千界面
按任意键进入Ghost 操作界面，出现Ghost 菜单，主菜单共有4 项，从下至上分别为Quit
（退出）、Options （选项）、Peer to Peer （点对点，主要用千网络中）和Local （本地）。一般情
况下只用到Local 菜单项，其下有3 个子项： Disk （硬盘备份与还原）、Partition （磁盘分区备
份与还原）和Check （硬盘检测）。前两项功能是用得最多的，下面的操作介绍就是围绕这两
项展开的。
9.4.2 分区备份
1. Partition 菜单简介
选择Ghost 操作主界面Local 选项中的Partition 选项，其中有3 个子菜单。
I) To Partition: 将一个分区（称源分区）直接复制到另一个分区（目标分区），注意操作
时，目标分区空间不能小千源分区。
2) To Image: 将一个分区备份为一个镜像文件，注意存放镜像文件的分区不能比源分区
小，最好是比源分区大。
3) From Image：从镜像文件中恢复分区（将备份的分区还原）。
2. 分区镜像文件的制作
l) 运行Ghost 后，用光标方向键选择Local一Partition一To hnage 命令，如图9-8 所示，
289
计算机网络安全教程笫4 版
然后按(Enter〉键。
图9-8 选择To Image 命令
2) 出现选择本地硬盘窗口，若只有一个硬盘直接按(Enter〉键；若有多个硬盘，选~桂目
应的硬盘后，再按(Enter〉键。
3) 出现选择源分区窗口（源分区就是要把它制作成镜像文件的那个分区），如图9-9 所~。
图9-9 选择源分区窗口
用上下光标键将蓝色光条定位到要制作镜像文件的分区上，按(Enter〉键确认要选~的
源分区，再按(Tab〉键将光标定位到OK 按钮上（此时OK 按钮变为白色），如图9-10 ~斤
示，再按(Enter〉键。
JII
·; 了一， 气-.; irll 芯叩7 _ 1
-· · ．一T—心 _i83＿8.3 ＿订．iJ
』=L_ _ i二三二．J
图9-10 确认要选择的源分区
4) 进入镜像文件存储目录，默认存储目录是Ghost 文件所在的目录，在File name 文本框：
中输入镜像文件的文件名，也可带路径输入文件名（此时要保证输入的路径是存在的，否则会·
提示非法路径），如输入D:\sysbak\cwin98, 表示将镜像文件cwin98.gho 保存到D:\sysbak 目录：
下，如图9-11 所示，输好文件名后，再按(Enter〉键。
5) 接着出现“是否要压缩镜像文件”窗口，有No （不压缩）、Fast （快速压缩）和High
（高压缩比压缩）共3 个选项，压缩比越低，保存速度越快。一般选择Fast 即可，用向右光泼卞
方向键移动到Fast 选项上，按(Enter〉键确定。
6) 接着又出现一个提示窗口，用光标方向键移动到Yes 按钮上，按(Enter〉键确定。
290
第9 章数据备份技术
图9-ll 为镜像文件命名
7) Ghost 开始制作镜像文件，如图9-12 所示。
图9-12 开始制作镜像文件
8) 建立镜像文件成功后，会出现提示创建成功窗口，按(Enter〉键即可回到Ghost 界
面。至此，分区镜像文件制作完毕。
9.4.3 从镜像文件还原分区
制作好镜像文件后，就可以在系统崩溃后还原，这样便又能恢复到制作镜像文件时的系
统状态。下面介绍镜像文件的还原。
l) 运行Ghost 出现主菜单后，用光标方向键选择Local-Partition-From Image 命令，如
图9-8 所示，然后按(Enter〉键。
2) 出现镜像文件还原位置窗口， 如图9-13 所示， 在File name 文本框中输入镜像文件的
完整路径及文件名，如d:\sysbak\cwin98.gho, 再按(Enter〉键。
·· ·-= 玉.,, 1 1
国II1l ，广IIlI －ii， 可，
图9-13 设置镜像文件属性
291
计算机网络安全教程笫4 版
3) 又出现选择本地硬盘窗口，选择硬盘后，用光标方向键移动到OK 按钮上，按
(Enter〉键即可。
4) 出现选择从硬盘选择目标分区窗口，用光标键选择目标分区（即要还原到哪个~
区），按(Enter〉键。
5) 出现提问窗口，如图9-14 所示，用光标方向键移动到Yes 按钮上，按(Enter〉~硝i
定， Ghost 开始还原分区信息。
图9-14 确认窗口
6) 很快即可还原完毕，出现还原完成窗口，如图9-15 所示，用光标方向键移动到Reset
Computer 按钮上，按(Enter〉键重启计算机，至此分区恢复完成。
-. ..
', • ·1
沁心． . . ．，沈
·· :,:'. "
、.<. ·':i. · ， ． ．．一． ． ．
图9-15 选择Reset Computer 并按(Enter〉键重启计算机
9.4.4 硬盘的备份及还原
Ghost 的Disk 菜单下的子菜单项可以实现硬盘到硬盘的直接对拷(DiskTo Disk）、~盘至U
镜像文件(Disk To Image) ，以及从镜像文件还原硬盘内容(Disk From Image) 。
在多台计算机的配置完全相同的情况下，可以先在一台计算机上安装好操作系统及．轿：
件，然后用Ghost 的硬盘对拷功能将系统完整地“复制”一份到其他计算机，这样安装操作~
统可比传统方法快很多。
Ghost 的Disk 菜单各项的使用与Partition 大同小异，在此就不赘述了。
9.4.5 Ghost 使用方案
l) 最佳方案完成操作系统及各种驱动的安装后，将常用的软件（如杀毒、媒体播~够：
件和Office 办公软件等）安装到系统所在盘，接着安装操作系统和常用软件的各种升~衣卜
丁，然后优化系统，最后就可以用启动盘启动到DOS 下做系统盘的克隆备份了，注意备份岱i
的大小不能小于系统盘。
2) 如果因疏忽，在安装好系统一段时间后才想起要克隆备份，则备份前应先将系统盘：里占
的垃圾文件清除，并将注册表里的垃圾信息清除（推荐用Windows 优化大师），然后整理系统；
盘磁盘碎片，整理完成后到DOS 下进行克隆备份。
292
第9 章数据备份技术
3) 什么情况下该恢复克隆备份？当感觉系统运行缓慢时（此时多半是由千经常安装卸载
软件，残留或误删了一些文件，导致系统紊乱）、系统崩溃时，以及系统中了比较难杀除的病
毒时，就可以进行克隆还原了。有时如果长时间没整理磁盘碎片，又不想花上半个小时甚至更
长的时间整理时，也可以直接恢复克隆备份，这样比单纯整理磁盘碎片效果要好得多。需要注
意的是，在备份还原时一定要注意选对目标硬盘或分区。
9.5 小结
保证数据的有效性具有非常重要的作用；目前造成数据失效的原因大致可以分为4 类：计
算机软硬件故障，人为操作故障，资源不足引起的计划性停机，以及生产地点的灾难；备份是
提高系统可靠性的重要手段，其目的是防止数据失效的发生；一个完整的系统备份方案应包
括：硬件备份、备份软件、日常备份制度和灾难恢复制度4 个部分；目前最常用的备份介质是
磁带。
备份技术包括磁盘备份、双机备份、网络备份技术和数据备份。磁盘备份包括磁盘阵列
和磁盘镜像。双机备份有多种解决方案，主要包括纯软件方案、灾难备份方案、共享磁盘阵列
方案、双机单柜方案和双机双柜方案。数据备份的策略包括完全备份、增量备份和差分备份。
常见的磁带轮换策略包括三带轮换策略、六带轮换策略和祖－父－子轮换策略；灾难恢复策略包
括全盘恢复、个别文件恢复及重定向恢复。
对千非关键的应用领域和个人用户，可以采用Ghost 等软件工具进行系统和数据备份。
9.6 习题
1. 产生数据失效的原因有哪些？
2. 结合自己的经历说明备份的重要性。
3. 什么是热备份？
4. 磁带作为数据备份介质，优点有哪些？
5. 简述磁盘延伸技术和数据分段技术。
6. 简述RAID1~RAID5 各自的技术特点。
7. 简述磁盘镜像的工作原理。
8．分别叙述实现磁盘镜像的3 种方式。
9. 双机备份有哪5 种方案？各有哪些优缺点？
10. 简述网络备份系统的意义及其工作原理。
11. 什么是HSM 技术？什么是SAN 技术？
12. 数据备份主要有哪几种策略？各在何种情况下应用？
13. 尝试在自己的个人计算机上应用Ghost 备份软件。
293
第10 章
无线网络安全
计算机和无线通信的结合，使得移动通信无所不在。移动设备可以通过无线链路接入·
Internet, 能够随时随地访问Internet 资源。无线局域网作为无线网络的一种接入方式，以其频i
带免费、组网灵活及易于移动等特点，得到了广泛应用。但与此同时，无线网络的信息安全问
题已经成为目前最重要的，也是最富有挑战性的问题之一。本章主要介绍无线网络安全的特：
点，分析Wi-Fi 和无线局域网所面临的安全问题，讨论针对基千iOS 与Android 系统的移动终
端安全，并探讨无线网络安全的主要技术。
10.1 无线网络安全的特点
10.1.1 无线网络概述
简单地说，无线通信技术就是在没有物理连接的情况下使多个设备之间能够互相通信的
技术。无线通信采用无线电传送数据，而有线通信采用的是线缆。无线通信技术的应用范围很．
广，从复杂的系统（如无线局域网和蜂窝电话）到简单的设备（如无线耳机、送话器）都能看·
到无线通信技术的应用。无线通信技术的目标是给用户提供在移动中随处可以访问信息的~
能。主要的无线技术包括无线网络、无线设备、无线标准和无线网络安全。
无线网络是无线设备之间，以及无线设备与有线网络之间的一种网络结构。无线网~的
发展可谓日新月异，新的标准和技术不断涌现。总的来说，根据覆盖范围、传输速率和用途的
不同，无线网络可以分为4 类：无线广域网、无线城域网、无线局域网和无线个人网。
1．无线广域网
无线广域网(Wi江eless Wide Area Network, WWAN) 主要是通过移动通信卫星进行数据
通信的网络，其覆盖范围最大。代表技术有3G 和4G 等，数据传输速率在2Mbit/s 以上。
2．无线城域网
无线城域网(Wireless Metropolitan Area Network, WM心）主要是通过移动电话或车载
装置进行的移动数据通信，可以覆盖城市中大部分的地区。代表技术是IEEE 802.20。
3. 无线局域网
无线局域网(Wireless Local Area Network, WLAN) 一般用于区域间的无线通信，其覆盖
范围较小。代表技术是IEEE 802.11 系列。数据传输速率为l 1,_, 56Mbit/s, 甚至更高。
4. 无线个人网
无线个人网(Wireless Personal Area Network, WPAN) 的无线传输距离在10m 左右，典
型的技术是IEEE 802.15 和BlueTooth, 数据传输速率在10Mbit/s 以上。
10.1.2 无线网络的特点
虽然无线网络的普及应用扩展了网络用户的活动空间，具有安装时间短，增加用户或~
294
笫10 章无线网络安全
改网络结构方便、灵活和经济的特点，还可以提供无线覆盖范围内的全功能漫游服务。但是，
这种自由也同时带来了新的挑战，其中最重要的问题就是安全。
无线网络通过无线电波在空中传输数据，在无线电波覆盖范围内的任何一个无线网络用
户都能接收到这些电波信号，进而有可能从中解析出传输的数据。由千无线设备在存储能力、
计算能力和电源供电时间方面的局限性，使得原来在有线环境下的许多安全方案和安全技术不
能直接应用千无线环境。例如，防火墙对无线网络通信不起作用，任何人在区域范围内都可以
截获和插入数据。
与有线网络相比，无线网络有其自身的特点，这些特点往往也是威胁无线网络安全的重
要因素。综合而言，无线网络主要具有以下3 个方面的特点。
l) 使用无线介质。无线网络的传输方式主要有微波和红外等，它们均使用无线传输信
道，而无线信道是开放的公共资源，所以任何人都可以利用它来发送和接收信息，这本身即对
无线网络的安全构成重大威胁。
2) 有限的带宽。由于可用来通信的无线频谱资源是有限的，因此，如何合理利用现有的
频谱资源就显得异常突出。通常，对某项无线应用要占用的频谱都限定在一定的带宽之内，这
在一定程度上降低了攻击者对网络攻击的难度。
3) 电源管理。作为移动的无线网络中的设备，其能源均来自轻型的电池。由千这类电池
的供电时间是有限的，一旦供电不足，则往往导致系统的崩溃。所以在进行系统设计时，必须
考虑到网络的能耗问题，这对网络安全机制的设计无疑是一个限制。
除上述安全缺陷外，无线网络也同样面临许多与有线网络类似的安全威胁，特别是对那
些采用了TCP/IP 协议的无线网络而言，由于协议在设计之初本身存在的安全漏洞，所以很容
易被攻击者引用。
10.1.3 无线网络面临的安全威胁
无线网络面临的威胁主要来自5 方面：一是无线电信号干扰；二是非法接入；三是网络
欺骗和会话拦截；四是网络监听；五是网络阻塞攻击。
1. 无线电信号干扰
由于无线网络通信链路的开放暴露特性，其所使用的无线电波信号很容易受到相同频率
无线电磁信号的干扰。当干扰信号足够强时，将严重影响无线网络的通信质量。
2．非法接入
对于无线网络来说，不需要与目标网络建立物理的连接就可以建立起逻辑链路，这为非
法接入目标网络创造了良好的条件。
3. 网络欺骗和会话拦截
在无线网络通信体系中，通信结点的身份容易被伪装，恶意结点可以冒充合法网络结点
甚至关键网络设施，并参与网络通信，从而可以实现网络欺骗和会话拦截。
4. 网络监听
由千无线信号传播的遍布性，在其传播范围内的任何位置都可以接收到无线信号，从而
为实现无线网络监听创造了良好条件。
5．网络阻塞攻击
网络通信链路的带宽相对于有线网络通常较低，因此更容易受到拒绝服务攻击的影响，
导致网络服务异常。
295
计算机网络安全教程笫4 版
10.2 Wi-Fi 和无线局域网安全
10.2.1 Wi-Fi 和无线局域网即尨
无线局域网(WLAN) 是指在一个局部区域内计算机之间通过无线链路进行通信的网
络，是计算机网络与无线通信技术相结合的产物。无线局域网解决方案为无线通信网络结点提
供了与有线局域网资源对接的方法。随着笔记本电脑和PAD、手机等移动终端设备的广泛使
用，以及无线通信技术的快速发展，无线局域网在社会生活中的作用越来越重要。
与有线局域网相比， WLAN 具有一定的移动性和灵活性高、建网迅速、管理方便、网络
造价低以及扩展能力强等特点。这些特点使得WLAN 迅速应用千需要在移动中联网和在网
间漫游的场合。
WLAN 由无线网卡、无线接入点(Access Point, AP) 、计算机和有关设备组成，如
图10-1 所示。WLAN 中的工作站是指能够发送和接收无线网络数据的终端设备，如内置无线
网卡的PC、笔记本电脑和手机等。AP 类似千LAN 中的集线器，是一种特殊的无线工作站，
其作用是接收无线信号发送到有线网络。通常，一个AP 能够在几十米至上百米的范围内连接
多个用户。在同时具有有线和无线网络的情况下， AP 可以通过标准的以太网电缆与传统的有
线网络相连，作为无线网络和有线网络的连接点。
图10-1 WLAN 的基本构成
在WLAN 标准中，应用最广泛的是IEEE 802.11 系列标准。常用的标准主要有IEEE
802.llb、IEEE 802.11 a、IEEE 802.llg 和IEEE 802.lln 等。
其中， 802.llb 是IEEE 于1999 年批准的标准，也称为Wi-Fi, 其最高通信速率为
11Mbit/s, 室内传送距离为15,....,45m, 室外可达300m。802.llb 在802.11 的基础上增加了两种
更高的通信速率5.5Mbit/s· 和11Mbit/s 。当射频情况变差时，可将数据传输速率降低为
5.5Mbit/s、2Mbit/s 和lMbit/s 。
Wi-Fi 是Wireless Fidelity 的缩写，即无线保真。Wi-Fi 是由Wi-Fi 联盟持有的无线局域网
实现方式的标识，即遵循IEEE802.11 系列协议的无线局域网实现方式。Wi-Fi 联盟是一个非营
利性的国际组织。该组织成立于1999 年，其使命是对不同厂商根据IEEE 802.11 规范生产的
WLAN 产品进行兼容性测试与认证，确保通过其认证的产品可以实现互连互通。与Wi-Fi 对
应的国内无线局域网标准是我国提出的WAPI 标准。
296
笫10 章无线网络安全
10.2.2 无线局域网安全机制
IEEE 802.11 工作组(Working Group) 最初安排802.lle 任务组(Task Group) 承担制定在
WLAN 上支持QoS 需求和加强安全等方面的标准。由千人们对WLAN 安全问题的关注不断升
级， 2001 年5 月， 802.11 工作组成立了802.lli 任务组，专门负责制定WLAN 的安全标准。
与WLAN 有关的安全机制主要包括WEP 、WPA 和WPA2 等协议标准。
1. WEP
WEP (Wrred Equivalent Privacy) 即有线等价保密。WEP 协议的设计目标是保护传输数据
的机密性和完整性，并提供对WLAN 的访问控制，但是由千协议设计者对于RC4 加密算法的
不正确使用，使得WEP 实际上无法达到其期望目标。
WEP 对千接入网络的控制有两种形式：开放式接入和共享密钥接入。所谓开放式接入，
顾名思义，即无须任何认证就可以接入网络。共享密钥接入只需要提供预留的验证密码就可以
接入网络。
WEP 对千传输加密采取用一个初始向量(Initial Vector, IV) 和密钥(KEY) 生成一个中
间密钥，然后采用RC4 加密算法，用该中间密钥加密信息。RC4 是一种流式加密算法，对于
包的顺序没有要求，不同顺序的包加密后不能辨识出包的原顺序，因此不能防止重播攻击。
WEP 加密采用的密钥长度为40bit, IV 的长度为24bit。
美国UC Berkley 大学的研究人员揭示了一系列针对WEP 协议可行的攻击方式，密码学家
从理论上指出在WEP 协议中的RC4 算法会产生弱密钥，密钥的脆弱性将导致生成具有易识别
格式化前缀的密钥流。经统计分析，由这些具有格式化前缀的密钥流就可以反推出WEP 加密密
钥。AT&T 实验室的工作人员利用该原理编制的软件在PC 上成功地破译了WEP 加密数据。目
前已经有多种公开的工具软件能够破解WEP 密钥，著名的有AirSnort、WEPCrack 等。
2. WPA
W即协议在设计上的缺陷引起了IEEE 的重视，它委托802.lli 任务组制定新的标准来加强
WL心的安全性。IEEE 标准委员会千2004 年6 月批准了802.lli 标准。802.lli 采用高级加密标
准(Advanced Encryption Standard, AES) 算法替代RC4 算法，使用802.lx 协议进行用户认证。
Wi-Fi 联盟从2004 年9 月开始对产品进行802.lli 认证。在802.lli 批准之前，为使安全
问题不至于成为制约WLAN 市场发展的瓶颈，给广大WLAN 用户提供一个临时性的解决方
案， Wi-Fi 联盟提出了Wi-Fi 网络安全存取(Wi-Fi Protected Access, WPA) 标准。
WPA 标准是Wi-Fi 联盟联合IEEE 802.l li 任务组的专家共同提出的，在该标准中数据加密
使用临时密钥完整性协议(Temporary Key Integrity Protocol, TK1P) ，认证有两种可选模式：一
种是使用802.lx 协议进行认证，适用于企业用户；另一种称为预先共享密钥（际恣hared Key,
PSK) 模式，采取用户在WLAN 的所有设备中手工输入共享密钥的办法来进行认证，适用千家
庭用户。WPA 标准专门对WEP 协议的不足之处进行了有针对性的改进，对于802.lli 标准和
WEP 都具有兼容性。该标准允许用户通过软件升级的方法，使早期的Wi-Fi 认证产品支持
WPA，这就为用户节省了投资。Wi-Fi 组织宣布从2003 年2 月开始对支持WPA 标准的WLAN
产品进行兼容性认证， WPA 标准是802.lli 标准正式实施以前WLAN 安全采用的过渡方案。
WPA 依然采用RC4 算法对数据进行加密，为了增强数据安全性，将密钥长度增加到
128bit, 且IV 长度增加到48bit。此外，为了增加密钥的安全性，通过TKIP 协议随着会话的
不同产生动态密钥。为了增加数据完整性保护， WPA 还在每一个报文末尾增加一个消息完整
297
计算机网络安全教程第4 版
性检查(Message Integration Check, MIC) 字段，对报文进行检查。
3. WPAl
WPA2 是对WPA 的增强，实际上是802.lli 的完整实现。802.lli 标准包括一组健壮性很
强的安全标准集，包括802.lx 身份验证和基千端口的访问控制，以及AES 加密模块和
CCMP，用来保持关联性的跟踪，并提供保密、完整性和源身份验证。
WPA2 与WPA 的对比如表10--,1 所示。
表10--1 WPA2 与WPA 的对比
应用模式WPA WPA2
企业应用模式
身份认证： IEEE 802.lx/EAP 身份认证： IEEE 802. lx/EAP
加密t TKJP/MIC 加密， AES-CCMP
个人应用模式
身份认证： PSK 身份认证： PSK
加密： TKIP/MlC 加密： AES-CCMP
在WPA2 中，采用了加密性能更好、安全性更高的加密技术AES-CCMP (Advanced
Encryption 岛ndard-Co\lllter mode with Cipher-block chaining Message authentication code Protocol,
高级加密标准一计数器模式密码区块链接消息身份验证代码协议），取代了原WPA 中的
TKIP/MIC 加密协议。虽然WPA 中的TKIP 针对WEP 的弱点做了重大改进，但保留了RC4J享~
和基本架构，也就是说， TKIP 也存在着RC4 本身所隐含的一些弱点。CCMP 采用的是AES 力u密：
模块， AES 既可以实现数据的机密性，又可以实现数据的完整性。AES-CCMP 提供了比TKIP 更：
强的加密保障，是目前面向大众的最高级无线安全协议。总体来说， CCMP 提供了加密、认i.iE、
完整性检查和重放保护四重功能。CCMP 使用128 位AES 加密算法实现机密性。
10.3 移动终端安全
10.3.1 iOS 安全
1. iOS 简介
iOS 是苹果公司为移动设备开发的操作系统，主要用于iPhone 、iPod Touch 、iPad 和1l
Apple TV。iOS 是从Mac OS X 衍生而来的类UNIX 操作系统，而Mac OS X 主要用于苹果推
出的台式机(iMac 、M砒Pro) 及笔记本（ MacBook) 。iOS 最吸引用户的就是其电子市场
(App Store)，集中管理应用程序以供用户下载。
2. iOS 安全机制
为了保证用户的安全，苹果为iOS 设计了一套安全机制。主要由下面几部分构成。
l) 可信引导。系统的启动从引导程序开始，载入固件，由固件再启动系统。固件~过：
RSA 签名，只有验证通过才能进行下一步，系统又经过固件验证。这样，系统以引导程＊关1
根建立起了一条信任链。
2) 程序签名。iOS 中的应用程序都是Mach-0 格式的文件，这种文件格式支持加密和签名，
而目录结构通过SHA-I 散列存储在内存之中，目录及App Store 中的软件都经过数字签名。
3) 沙盒和权限管理。用沙盒的方法来限制文件系统的访问和隔离应用程序，同时让用户
程序执行在普通用户的权限上。
298
笫10 章无线网络安全
4) 密钥链和数据保护。用户密码、证书及密钥通过SQLite 存储，数据再通过这些密钥加
密存储，数据库有严格的访问控制。
3. iOS 安全隐患
在iOS 系统安全体制之下，仍然存在很多安全隐患和问题，主要包括以下几个。
l) 利用引导过程的缺陷对设备进行“越狱“。用户使用这种技术及软件可以获得iOS 的
最高访问权限，甚至可以解开运营商对手机网络的限制。2010 年7 月26 日，美国国会修改千
禧年数字版权法案中的豁免条款，正式认可iOS 越狱的合法性。目前为止可以对iPad、iPod
Touch 和iPhone 全部设备越狱。目前广泛使用的越狱工具有红雪(redsnow) 、黑雨
(blackrain)、绿雨(limerain) 和JailbreakMe 等。普通用户利用这些工具就可以对其设备进行
越狱，获得管理员权限，然后就能访问文件系统，执行非官方签名的应用程序。
用户对iOS 设备进行越狱，主动破坏iOS 系统的安全保护机制，实际上是对iOS 系统数
据安全最大的威胁。相比使用App Store, 用户更加容易受到恶意软件的影响，同时恶意软件
也可以获得最高权限，从而对系统进行全面的控制，窃取用户的隐私和数据。
表10-2 列出了在越狱前后， iOS 应用程序所能实现的一些功能对比，可以看出，一个在
越狱iOS 设备上运行的软件可以不受拘束地访问各种个人秘密资料，甚至可以对用户进行跟
踪和窃听。
表1~2 越狱前后iOS 应用程序能力对比
功能未越狱越狱
自启动运行无法实现可以实现
获取联系人可以实现可以实现
获取短信和通话记录无法实现可以实现
破解邮件和网络密码无法实现可以实现
GPS 后台追踪带要用户授权不带要用户授权
通话和短信拦截无法实现可以实现
后台录音无法实现可以实现
2) 手机隐私泄露问题。不同于其他平台，手机操作系统需要保护手机中存储的手机号
码、通讯录、短信和地址之类的隐私信息。Android 主要通过公开系统源代码，让系统对用户
透明，这样研究者通过直接检查代码就能发现其中的问题。苹果公司则主要依靠自己的软件审
查机制来保证iOS 平台上软件的安全性，只有经过审查的应用程序才能发布到App Store 上，
严格的检查将恶意程序阻止在系统之外。但是，由千这个审查过程和方法的细节并未公开，用
户无法完全信任苹果的这套机制能够确保用户数据的安全。2009 年在App Store 上就出现过泄
露用户信息的游戏。
3) 安全漏洞和恶意程序。在Black Hat USA 2009 上研究者演示了如何用短信来得到
iPhone 的控制权。而iPhone 中的Safari 漏洞也是黑客一直用来攻击的对象。lkee 是第一个
iPhone 病毒，它在未经过用户允许的情况下修改iPhone 墙纸。iPhone/Privacy.A 是一个偷取用
户数据的病毒。
越狱工具JailbreakMe 利用iOS 处理Adobe Type l 字体存在的一个缓冲区溢出漏洞，使得用
户只需通过浏览器访问一个加载利用该漏洞的PDF 文件网页就可完成越狱。虽然单纯利用该漏
洞进行越狱对用户不会造成很大影响，但是由于该漏洞利用了已公布的源代码，已经有攻击者
用其构造出了一个恶意网页，如果iOS 用户访问了恶意网页，系统就会被植入恶意程序。
299
计算机网络安全教程笫4 版
4. iOS 安全加固
由千在未越狱iOS 系统中的应用不能对系统进行深层次的操作，因此正常的应用软件
不能实现一般安全软件系统的扫描、拦截和监控等功能。目前在App Store 上销售的安全
软件多是以通信录备份、电池管理等功能为主的手机管理软件。而在越狱过的iOS 系统
中，虽然iOS 系统本身的安全机制受到破坏，但应用程序却有能力实现对iOS 系统更深
入的安全防护。
360 安全卫士(iPhone 版）是专门针对iOS 系统的管理软件，但是需要先对iOS 进行越狱
才能全面地发挥作用。其主要功能包括流量监控、安全备份、系统信息查询、号码归属地查
询、照片保险箱和密码保险箱等。
5. iPhone 及iPad 安全使用指南
美国家安全局2012 年发布了《iPhone 及iPad 安全使用指南》，该指南提供了在iOS 下运
行的iPhone 及iPad 的安全管理基本知识，提出了保持物理安全、及时升级iOS 系统、不要越
狱、开启自动锁屏及密码功能、不要加入到不熟悉的无线网络、在不需要时关闭蓝牙，以及关
闭地点设置等10 项安全建议。
(1) 保持物理安全
应该时刻保持苹果设备不离开自己的身边。所有的信息设备都有被攻击的可能，但是由
于iPhone 及iPad 具有很强的可移动性，其被攻击的可能性更是大大提高。目前，市场上已有
大量的窃密工具能够使窃密者通过物理接触移动设备的方式获取信息。最好的保护方式是确~
移动设备不被别人接触到，并谨慎存储敏感信息。
(2) 及时升级iOS 系统
每次的iOS 系统升级都可能包含很多安全系统的升级，因此应及时升级iOS 系统，以确
保移动设备安全。
(3) 不要越狱
越狱行为将大大降低iOS 系统抵御攻击的能力，因为它降低了系统对软件签名的保护功
能，而这一功能是iPhone 上最主要的安全保护功能。越狱后的设备能够使黑客攻击更加容
易，目前市场上对iOS 系统的大部分攻击软件都要求手机已经处于越狱状态。
(4) 开启自动锁屏及密码功能
自动锁屏功能是指屏幕自动上锁，但其并不能独自保护信息安全，需要与密码相结合来
对一般攻击起到防护作用。
简单加密模式需要使用4 位数字密码解锁iOS 系统。如果关闭该模式，就可以设置比4
位密码更加复杂的密码。需要注意的是，当密码设置成功后，只有自带加密功能的App 才能
对数据进行保护。
(5) 不要加入到不熟悉的无线网络
尽量不要使用无线网络，不使用时应关闭无线网络，不要使用免费的Wi-Fi 网络接入设
备，因为这些网络大多不进行安全加密，任何人都有可能在该范围内截获信息。如必须使用，
应尽董使用熟悉的网络并确保该网络已加密，推荐使用WPA 网络。建议关闭“邀请加入网络
(Ask to Join Networks)” 选项，该操作不能避免移动设备连接到曾经访问过的网络。
另一个需要注意的是，每次连接到无线网络后，使用完建议开启“忘记该网络(Forget
this Network)" 选项，这将避免移动设备自动接入到有相同用户名的无线网络。另外，只
有在该网络的覆盖范围内，该操作才有效，离开该网络的覆盖范围，则无法从Wi-Fi 网络中
300
笫10 章无线网络安全
将其去除。
(6) 在不需要时关闭蓝牙
当不使用蓝牙时，建议关闭蓝牙设备，以免其他移动设备接入自己的手机。
(7) 关闭地点设置
iOS 系统中包含了地点设置功能，除非有必要，否则建议关闭该选项，以防止其他人可以
随时跟踪自己的位置信息。
(8) 上网浏览器的设置
建议在上网浏览器中关闭自动填写功能，这将防止上网浏览器储存用户名及密码等敏感
信息。应该关闭JavaScript 选项，但关闭后，很多网页将无法浏览。
Cookie 可以泄露个人信息及上网习惯，建议在iOS 系统中设置为“只接受浏览过的网站
的Cookie”。
(9) 电子邮件的设置
确保所有电子邮件往来的连接都是加密的， 这要求邮件的服务器具有加密功能，否则邮件
将有可能被截获并直接阅读。当用浏览器接入到网络邮件时，应确保登录网页是加密的。
关闭邮件的图片下载功能，这可以确保不通过图片传输恶意程序，并确保网络地址安全。
(10) 使用iPhone 的设置软件
iPhone 设置软件具有关闭照相机、网络浏览器等功能。而对千其他重要的设置（如加密
备份文件、设置更高级密码和开启无线清除系统等功能）可以通过iPhone 网站实现。
10.3.2 Android 安全
1. Android 简介
2007 年11 月5 日， Google 公司正式发布了基于Linux 内核的开源操作系统Android。自
发布以来， Android 系统以其开放、自由的特性嬴得了各大厂商、开发人员及用户的青眯。已
成为全球市场占有份额最高的智能手机操作系统。Android 的流行使其已成为众多恶意软件的
攻击目标，针对Android 的木马、Rootkit 和应用层特权提升攻击等安全威胁不断出现。
2. Android 组件模型
Android 是一个移动设备软件栈，其系统架构包含多个层次，主要有应用层、应用框架
层、Android 运行时系统库， 以及Linux 内核。Android 中的应用都是用Java 语言编写的，然
后生成Dalvik 虚拟机可执行的．apk 文件。
通常情况下， Android 应用由一个或多个不同的组件构成，这些组件主要包括4 种类型：
Activity、Service、Broadcast Receiver 和Content Provider。Activity 是用户接口的容器，表现为可
视化的用户接口。Service 在后台运行，它没有可视化的用户接口，通常完成一些无须用户于预
的操作。Broadcast Receiver 用千接收和响应应用关心的广播消息。Content Provider 提供了一种
应用间共享数据的方法，这些数据可以存放在文件中，也可以存放在SQLite 数据库中。
3. Android 安全机制
(1) 权限机制
Android 应用框架层提供了限制组件间访问的强制访问控制机制，系统中定义了一系列安
全操作相关的权限标签，应用需要在配置文件(Manifest.xml) 中利用这些标签声明自己所需
的权限，当用户同意授权后，该应用下属的所有组件将会继承应用声明的所有权限。同时，组
件也可以利用权限标签限制能够与其交互的组件范围。如图10-2 所示，组件CCI 要求pl 权
301
计算机网络安全教程笫4 版
限，而应用程序B 被用户授予了权限pl, 因此CBI 继承pl 权限并因而具有访问CC1 的能
力。组件CAI 则因为不具备pl 权限而无法访问CCl 。
Application A
<use-pennission>p2</use-pennission>
<use-pennission>p4</use-pennission>
Application B
<use-permission>pI </use-permission>
<use-permission>p2</use-permission>
Component CA I
<pennission p4/>
,_ _
- - - ---- 一、
一＿、
Privilege Escalasion Attack 、、
Component CB I
<permission p2/>
、＼
Application c | }
I
<use-pennission>p I</use-pennission>
<use-pennission>p3</use-pennission>
Component CCI
<pennission pl/>
图10-2 Android 权限机制示例
Android 支持普通(Nonnal) 、危险(Dangerous) 、签名(Signature) ，以及签名或系统
(Signature or System) 4 种权限保护级别。危险级别的权限在应用程序安装时会在屏幕上列
出，而普通级别的权限是隐藏在折叠目录或屏幕上的。签名级别的权限只有在请求权限的J§j_ffl
程序与声明权限的程序使用相同的证书签名时才被授权。
(2) 沙盒机制
为了保障每个应用运行过程中不被其他应用影响， Android 系统为每个应用在运行过~中
提供了一个沙盒。其具体实现是， Android 系统为每个应用提供一个Dalvik 虚拟机实例，~~
独立地运行于一个进程，并且为每一个应用创建一个对应于Linux 底层的用户名，并设置用户
ID。利用这个用户ID 可以保护应用的文件、数据和内存。如果希望两个应用共享权限和数：
据，可以通过设置sharedUserID 来声明两个应用使用同一个用户ID, 运行千同一进程，并共
享其资源和权限。但是声明使用sharedUserID 的应用必须有相同的用户签名。这种机制不但．
可以在应用运行过程中保障其独立性，还可以提高系统的健壮性。当单个应用运行出现问题！
时，可以消除其虚拟机实例来保障整个系统的安全运行。
(3) 签名机制
所有Android 应用都要被打包成＊．apk 文件，这个文件在发布时都必须被签名，与通常在
信息安全领域中使用数字证书的用途不同， Android 利用数字签名来标识应用的作者和在应用
间建立信任关系，而不是用来判定应用是否应该被安装。而且，这个数字证书并不需要权威的
数字证书签名机构认证，而是由开发者来进行控制和使用的，用来进行应用包的自我认证。对·
Android 应用签名可以采用调试模式和发布模式：使用Android 开发工具开发的应用是用一~
调试私有密钥自动签名的，这些应用称为调试模式应用，只能用千开发者自行测试，不能~~
布到Google 官方应用市场上。当一个开发者需要将自己的应用程序发布到Google 上时，必~
生成一个发布模式的版本，即用其私有密钥签署应用。应用签名在发布时进行，在应用安~时
被验证，用以实现对应用来源的鉴定。
4. Android 安全缺陷
可以说， Android 在诞生之初就拥有良好的安全机制。首先，它通过继承Linux 内核的安
全机制实现系统安全；其次，又通过自身的permission 机制实现数据安全。但Android 原生的
302
第10 章无线网络安全
安全机制仍然存在一些缺陷，主要体现在以下几个方面。
1) Android 通过Package Installer 在应用安装时检查应用所需的权限，并提示用户，由用
户做出抉择。但是，如果用户想使用该应用的功能，就必须同意应用申请的全部权限，否则
Package Installer 将拒绝安装该应用。
2) Android 没有对已授予应用的权限的使用范围进行限制。比如应用申请了读联系人数
据的权限，那么它就可以读取全部的联系人数据，而不能根据联系人分组区别对待。
3) 由千所有权限都是在安装时进行检查并授予的，所以资源的访问不能根据用户的位
置、时间等不同而进行动态限制。
4) 用户撤销已授予某个应用权限的唯一方法就是卸载该应用。
以上安全缺陷不仅降低了Android 平台的可用性，同时导致平台容易遭受应用层权限提升
攻击，具体又可分为混淆代理人攻击和共谋攻击。
混淆代理人攻击是指恶意程序利用其他程序的未保护接口来间接获得特权功能，普遍存在
千Android 默认程序（如电话、闹钟、音乐和设置程序）及第三方程序中。如图10-2 所示，应
用程序A 没有Pl 权限，因此CAl 无法访问被Pl 权限所保护的组件CCl 。然而，由于组件
CBl 提供了未被Pl 保护的开放接口，因此CA1 可以利用CB1 间接地使用CC1 的功能，这样就
形成了混淆代理人攻击。恶意程序可以通过共谋来合并权限，从而执行超出各自特权的动作。
S. Android 安全配置
为了保障运行Android 系统的移动终端的安全，对其进行安全配置是非常必要的，比较方
便的配置方式是使用专业的Android 系统配置管理软件。常用的配置管理软件有LBE 安全大
师、360 手机卫士等。下面以LBE 安全大师为例来介绍Android 系统的安全配置。
(1) LBE 安全大师简介
LBE 安全大师是Android 平台上首款主动式防御软件，是第一款具备实时监控与拦截能
力的手机安全软件。LBE 安全大师基千业界首创的Android 平台API 拦截技术，能够实时监
控与拦截系统中的敏感操作，动态拦截已知和未知的各种威胁，避免各类吸费软件、广告软件
乃至木马病毒窃取移动终端内的隐私信息。LBE 安全大师能够为系统中每一个应用的每一个
敏感操作指定权限，包括允许、拒绝和提示。通过此项功能，用户可以关闭某些应用申请的额
外权限，阻止应用内嵌广告代码的执行而保留应用功能不受影响。
LBE 安全大师的功能模块主要包括9 个方面，如图10-3 所示。下面选择LBE 安全大师
的部分功能模块进行介绍。
二三三二二
菩哦商
包
图10-3 LBE 安全大师主要功能模块
303
`
计算机网络安全教程第4 版
(2) 权限管理
LBE 安全大师提供了免root 直接进行权限管理的配置模式，同时提供了专业的权限配置
推荐，给用户权威的配置指导，简化了权限配置过程。对千新装软件，可以进行智能配置，~
去复杂的配置操作。LBE 安全大师的权限管理配置示例如图10-4 所示。-霓罚芒沁部心五
P人＼｀＼关）
煜信已晕
立了，饮， Ill:芭块止口闪窃句识心R均
取累人记晕
廿凶II:, ＂戏“II:Q闷叹限`KMI表
通信巳曼
扫也饮，＂E菁鴃止切问C的也也记O
觉
兵102仗．呱娑邕止谩过网岱匹«l!II“e
的平矶足也
乎扒识别码
如找孜． o饮枉仁止一识劓闪．
， 包恨I吧． IMS!. 材限砱
}
巴－
圈霾
. _
_
止
S 炬旺
言项名王覆1 兰三三
畟固＿·＠Q 笞
O竺？
戳芒:
Ill任软件_ 又石5!们仄P(24)
圉兄mi!干黔呐呻°
1.兰了它；衫可使J1J o !
I
＠芒忠笠
霾380云詹
I!,Q 安桌暨纸
' =
句江宁皿，，UJII
塌立罕:"/0“'
@ I 眉示幔知
＠ 甘
I
@ l
O |
, 最过移动问络氐问戌“土仁
I I 1 月扫旺it: 妇叩邓9及分序哼． O
, , lftl?同公攻阳川央戈屈\111!1 o
- 匿:?
允许广告行为
[
rs豢
允许自g
觐联网“'亢俨
1 月千妥雹芙合．电劣召”也9及分享句
僖任坎件谑求
G仔6．问，4刁妥众仅纽3亿液允仵
一．
0,°
。
图10-4 权限管理过程示例
(3) 病毒查杀
安天AVLSDK 反病毒引擎，免费提供日常病毒库升级服务，确保及时始终受到最~~和I
最完整的保护。LBE 安全大师的病毒查杀示例如图10-5 所示。
氝厦扫措
昼化衿~JU泊己女长ll.SO卡内t,(9
壹杀8芯
未发现成协
JP^ilI ”AVL反':.,~J11尔1~1μ,
图10-5 病毒查杀过程示例
(4) 骚扰拦截
LBE 安全大师的骚扰拦截功能内置智能识别算法，可使用黑白名单、关键字和自定~拦：
截模式等方式自动拦截特定的骚扰来电和短信，可以在绝大多数手机上实现无响铃拦截，陌生掏
来电延迟3 秒响铃，避免骚扰来电和诈骗电话。骚扰拦截设置如图10-6 所示。
304
第IO 章无线网络安全- _ - II印琶诅勾码坛记I I 霓印丑切旧
i..,`'j, :
回以记愚比帕生'!Ill I I 云安全晶务
, .`
一．
。
臼如网吝霞电迳
义100”“ 凡凡1 上吓｀＇：＂
霞臼行攀
贯名单
臼6单
关戮干
一.11(111厚MIU调户）
谦阀户J11症圉煌砚
F航役”
烂震覆氏
牛． ． “＇ . I• a,•,,
拦戳一胄啊来屯
;, .
图10-6 骚扰拦截过程示例
10.4 无线安全技术及应用
无线网络安全主要包括系统安全、网络安全和应用安全等内容，也遵循安全风险分析、
安全结构设计和安全策略确定的基本实施规律。
10.4.1 常用无线网络安全技术
常用无线网络安全技术包括访问控制技术、数据加密技术、端口访问技术和数据校验
技术。
1. 访问控制技术
利用MAC 地址访问控制和服务区认证ID (SSID) 技术来防止非法的无线设备入侵。由
千每台计算机的网卡都拥有唯一的MAC 地址，因此可以使用MAC 地址过滤的策略来防止非
法的地址入侵。SSID 使得只有计算机的SSID 与无线路由器的SSID 一致时才能访问，因此可
以采用隐蔽SSID 的方法来拒绝非法访问。
2. 数据加密技术
数据加密是无线网络安全的基础，对传输的数据进行加密是为了防止其在未授权的情况
下数据被泄露、破坏或篡改。近年来，各个组织和国家提出了多种解决方案，从早期的WEP
协议，经历WPA 到802.lli 协议，安全技术不断进步。
3. 端口访问技术
IEEE 802.lx 协议是一种基千端口访问的控制协议，能够实现对局域网设备的安全认证和
授权。该技术是用于无线网络的一种增强性网络安全解决方案。当无线工作站与无线路由关联
后，是否可以使用无线路由器提供的服务取决千8021.x 的认证结果。如果认证通过，无线路
由器则打开这个逻辑端口，否则拒绝。802.lx 除提供端口控制访问能力之外，还提供基千用户
的认证系统，使得网络管理者能更容易控制网络接入。
4. 数据校验技术
校验是为了确保传输数据的完整性，防止数据在传输的过程中被非法截取并进行恶意修
改的行为。
305
计算机网络安全教程第4 版
现4.2 无线网络安全技术应用
1. 修改无线路由器的默认账号和密码
无线路由器出厂时设置的默认账户与密码通常都比较简单，而且众所周知。因此必须及
时修改无线路由器的默认账号和密码，井且要定期进行变更，防止非法用户登录无线路由器，
修改相关参数，从而可以对无线局域网内的用户进行访问和攻击。
2. 设置服务区标识符(SSID)
SSID 用来区分不同的无线网络，一个SSID 最多由32 个字符构成，一般情况下，无线路
由器在出厂时都有一个默认的SSID 标识，如不及时修改这种SSID 标识信息，就可能发生与
其他无线网络的冲突。无线终端接入无线路由器时必须提供有效的SSID, 只有匹配才能~
入。AP 和无线路由器默认情况下会向所有的无线客户端广播自己的SSID 号，从而方便用户
接入相应的无线网络。广播SSID 的功能在方便正常用户的同时也给非法用户接入网络创造了
条件，因此应及时取消AP 和无线路由器的“允许SSID 广播”功能，使得非法用户不能搜索
到SSID 号，从而降低网络被入侵的概率，增加网络的安全性。
在无线网络中关闭接入点的SSID 广播，虽然能够在一定程度上隐藏用户所在的网络，~
不能过分依赖SSID 隐藏。这是因为，隐藏SSID 只是从接入点信标中删除了SSID, 它仍然包L
含在802.11 相关的请求之中，在某些情况下还包含在探索请求和回应数据包中。因此，窃听
者能够使用合法的无线分析器在繁忙的网络中迅速发现已连接网络用户的SSID 。
3. 启用无线网络的加密设置
无线设备上都具有WEP 加密、WPA 加密和WPA2 加密功能，其中WPA2 使用256 位的
密钥，而且数据包在广播过程中， WPA2 加密密钥不断变化，具有更好的安全性，应优先启用
WPA2 加密功能。
4. 设置MAC 地址过滤
MAC 地址过滤在无线网络安全措施中是一种常见的安全防范手段，开启无线设备的
MAC 地址过滤功能，可以拒绝非法的MAC 地址访问该无线网络，有效控制无线客户端的~
入权限。无线MAC 过滤可以让无线网络获得较高的安全性。
启用MAC 地址过滤，虽然增加了一层安全性，可以控制哪些客户机能够连接到该无线网
络。但是，窃听者可以很容易监视网络中授权的MAC 地址并且随后改变自己的计算~的
MAC 地址。
5. 有效管理IP 分配方式
取消无线路由器的DHCP 分配1P 方式，采用静态地址分配方式。DHCP 的主要功能~~
帮助用户动态分配IP 地址，省去了用户手动设置1P 地址、子网掩码及其他参数的麻烦，但容:
易被非法利用，而静态地址分配方式可以对局域网中的计算机的IP 地址进行控制，有效~~
止恶意用户自动获取网络配置参数接入网络。
6. DoS 攻击防范
在无线路由器上开启DoS 攻击防范功能，在设定的时间里对数据进行统计，如果统i十得；
到的某种类型数据包（例如ICMP 、UDP 和TCP-SYN 等）超过了预设的阙值，无线路由~将恤
认为DoS 攻击已经发生，从而停止接收该类型的数据包，达到防范DoS 攻击的目的。另外，
应开启“禁止来自LAN 口的Ping 包通过路由器”功能，能有效防范在短时间内向目的主机达乞
送大量Ping 包，从而造成网络堵塞或主机资源耗尽。
306
第10 章无线网络安全
7. 部暑无线入侵防御系统
一个无线入侵防御系统(WlPS) 可以帮助检测和对抗恶意用户建立的虚假接入点和实施
的DoS 攻击等．
10.5 小结
无线网络技术已经应用到各行各业，无线网络的灵活性和低成本使其得到了广泛应用，
智能移动终端的普及使得Wi-Fi 无线网络更加贴近人们的日常生活。无线网络安全也越来越受
到人们的重视，然而现有的无线网络体制还存在一些不安全因素，只有增强安全防范意识，根
据不同的无线网络用户特点，选择相对安全的防范措施，才能保障用户安全地使用无线网络。
除无线网络体制安全问题外，智能移动终端的安全问题也不容忽视，针对典型移动终端
操作系统iOS 和Android, 分析了其安全机制与存在的安全问题，介绍了提高其安全性的技术
措施。
10.6 习题
l ．无线网络的类型有哪些？
2．简述无线网络的主要特点。
3. 无线网络面临的安全威胁有哪些？
4．简述无线局域网的主要构成要素。
5. 简述无线局域网与Wi-Fi 的关系。
6. 简述无线局域网的主要安全机制。
7. 简述iOS 的安全机制及存在的安全缺陷。
8. 简述安全使用基千iOS 移动终端的主要措施。
9. 简述Android 的安全机制及存在的安全缺陷。
10. 简述安全应用无线网络的主要措施。
307
第N 章
云计算安全
随着云计算的进一步推进和发展，云计算面临的安全问题变得越来越突出，特别是在云
计算带来的诸多利益下，如何满足用户在云计算环境下对用户数据的机密性、完整性等相关f生
能的需求，已成为云计算安全的首要难题。
11.1 云计算面临的安全挑战
11.1.1 云计算概述
云计算是继分布式计算、网格计算和对等计算之后的一种新型计算模式，它以资源租．
用、应用托管和服务外包为核心，迅速成为计算机技术发展的热点。在云计算环境下， IT 邻i
域按需服务的理念得到了真正体现。云计算通过整合分布式资源，构建应对多种服务要求的计·
算环境，满足用户的定制化要求，并可通过网络访问其相应的服务资源。云计算对资源共享且
高效利用的特点，可以实现系统管理维护与服务使用的解耦。
云计算具有广泛的应用前景， Google、田M、Microsoft、Amazon、腾讯和阿里巴巴等知
名IT 企业都在大力开发和推进云计算。然而，随着云计算用户和服务内容的爆炸式增长，用
户需求和提供商服务模式之间的矛盾日趋明显。可见云计算要成为真正为广大用户普遍认同的
信息服务基础架构还面临着诸多挑战。
2010 年， Google 两名员工侵入租户的Google Voice 和Gtalk 等账户，引起隐私数据泄露。
2011 年，由千缺乏数据加密和分散隔离存储机制，导致了CSDN 网站600 多万用户的数据库信息
被黑客盗取并么可。不断发生的云计算安全事件充分说明云计算系统已成为黑客攻击的目标。
11.1.2 云安全概述
在传统的计算模式下，用户对数据的存储与计算拥有完全的控制权，而在云计算模式
下，用户数据与计算机的管理将完全依赖于服务提供商，而用户仅仅保留对虚拟机的控制。因
此，从用户的角度来说，如何保证存储数据与计算结果的安全性、私密性和可用性显得尤为重
要。目前的云计算技术充满了风险，特别是在整个架构上有着独有的脆弱性，云安全必将成为
云计算技术发展中最重要的关注点。
1. 云安全的含义
云安全主要有以下两层含义。
第一，云自身的防护，也称云计算的安全保护，主要包括云计算应用服务的安全及云~
算数据信息的安全等，云安全是云计算技术实现可持续发展的前提。
第二，以云的形式交付和提供安全，也就是云计算技术的具体应用，也可以称安全云计三
算。云计算技术的使用可以进一步提高安全系统的服务功能。
在本章中，云安全主要指的是第一层含义，即云自身的安全防护。
308
第11 章云计算安全
2. 云安全的内容
国际数据公司(IDC) 的高级副总裁Frank Gens 在他的分析报告中指出，云计算服务仍然
处在早期发展阶段，对千云计算服务提供商来说，毫无疑问还有很多的问题需要解决。Frank
Gens 指出目前用户最关心的是云计算的安全问题，当用户的商业信息和重要的IT 资源放置在
云上时，用户觉得很不安全。
其实，关千云安全，早在云计算刚刚开始浮现时，国外的IT 研究机构Gartner 就提出了
关于云安全风险的7 个安全议题。根据云计算所提供服务类别的不同，云计算的服务模式可以
分为软件即服务(Software as a Service, Saas)、平台即服务(Platform as a Service, PaaS) 和
基础设施即服务(Infrastructure as a Service, IaaS) 。此外，为实现计算资源本地化，目前如
Microsoft、田M 等公司提供的服务器集装箱租赁服务可以被认为是一种新的服务模式，称为
硬件即服务(Hardware as a Service, Haas) 。对于云安全，主要可以通过laaS 安全、PaaS 安
全和SaaS 安全3 部分来进行分析。
(1) IaaS 安全
对千基础设施即服务(IaaS) 的安全性， 首先需要考虑的是数据中心的地理位置安全，在
地理位置的选取上，要保证基础设施的安全性；其次，数据中心地理位置的选取主要依据该地
理位置的网络衔接点与环境，以及电力成本等因素；另外，自治系统在基础设施安全性方面也
非常重要，因为自治系统不仅管理数据中心的所有硬件资源，还处理数据中心的大部分可自动
化的系统管理工作。IaaS 安全问题如表11-1 所示。
安全性
数据中心安全性
硬件安全性
网络安全性
(2) PaaS 安全
表11一1 laaS 安全问题
描述
在云计算实体数据中心，云服务提供商在关键地点都设置了人员识别系统，井且配合了智
能卡等设备管制人员的进出，自治系统会记录人员的操作记录，从而确保人员的操作不会影
响数据中心与云平台的运作
硬件设备作为数据中心的灵魂，主要包括服务器和网络设备两大类，云数据中心的所有服
务器和网络设备都是预先规划好的，从而使得硬件设备在发生问题时，能够快速地发现问题
井解决问题
网络安全性中的拒绝服务器攻击及其派生的分布式拒绝服务攻击都是利用暴增的流量导致
服务应用程序超负荷工作而死机的，目前云数据中心应对攻击的解决方案大多都是通过异常
流鱼检测方式来防御拒绝服务攻击，使其不至于影响所有用户
IaaS 安全主要是围绕实体层次的安全进行描述， PaaS 安全则是从软件和操作系统本身的
安全进行研究，其中PaaS 安全主要从操作系统、访问控制、数据传输及数据安全4 个角度进
行安全保障。PaaS 安全问题如表11-2 所示。
安全性
操作系统
访问控制
数据传输
数据安全
表U-2 PaaS 安全问题
描述
一般来说，操作系统安全是由开发商进行修复的；对于云计算数据中心，自治系统可以自
动部署和修复文件，保证操作系统漏洞确实得到修复
通常不会开放太大的权限给应用程序，当然，开放的权限一定能够确保应用程序正常运
行同时，不允许应用程序修改操作系统的任何设置，所有对操作系统的设置只能由云服务
提供商按照事先要求进行设置和管理
对于云计算数据中心的所有数据传输，都使用了SSL 功能，从而使得无论是跨越数据中心
还是由客户端直接访问内部服务，都必须使用SSL 在传输中加密数据，否则都会在服务的终．
结点被拦截
对云计算安全的安全体系来讲，数据安全将是所有人最为关心的安全点
309
.
计算机网络安全教程笫4 版
(3) SaaS 安全
SaaS 安全依赖千PaaS 所提供的云安全环境，同时还依赖千云应用程序开发人员对云应用
程序进行开发时对安全的考虑和防护，所以在SaaS 安全性方面除了PaaS 提供的基础安全性
以外，云应用程序开发人员在进行云应用软件设计时应该以信息安全为首要考虑。在SaaS 安
全中，除了多租户可能存在的问题外，针对Web 应用程序，都需要防范OWASP 所公布的十
大Web 安全性问题，常见的有注入、跨站脚本、失效的身份认证和会话管理、不安全的直接
引用，以及伪造跨站点请求等威胁。
11.1.3 云安全威胁
云计算的主要目的在于帮助租户摆脱复杂的硬件管理与维护，实现系统资源的深度~
合。通过统一管理模式提高资源利用率，同时满足各类租户的个性化需求。其实现方式决定了
租户的数据信息势必存储在公用数据中心，数据的读取完全依赖千网络传输。因此，云计算系
统不仅面临着传统信息系统（或软件系统等）的安全问题，还面临着由其运营特点所产生的一
些新的安全威胁。
云计算在安全方面必须解决好下列问题：多租户高效、安全地资源共享；租户角色信~
关系保证；个性化、多层次的安全保障机制。
1. 多租户高效、安全地资源共享
资源的共享实现了服务成本下降和可扩展性提高，但同时也给安全带来了巨大挑战。一
方面，共享系统为安全风险的快速蔓延提供了条件。另一方面，多租户共享的特征给恶意租户
攻击其他租户或自私租户恶意抢占资源提供了便利。如常见的安全威胁包括：恶意租户使用侧
信道C SideChannel) 方法探测运行在同一主机上其他租户的隐私数据；通过抢占大量资源~
使其他租户的服务不可用等。
2. 租户角色信任关系保证
一方面，云端管理租户的定制应用降低了租户对数据处理过程的可控性，为了防止提~
商利用其特权窃取租户的隐私信息，系统应具有相应机制保证租户和提供商间的可信关系。另
一方面，租户间的数据共享和传输依赖千租户设置的访问控制协议，为防止数据的恶意篡改和
泄露，需要提供必要的手段保证租户间的可信关系。此外，提供商对第三方软件的安全性难以
实现完全认证，为防止恶意代码对系统的影响，建立相应机制保证第三方软件的可信性也是必
不可少的。
3．个性化、多层次的安全保障机制
根据定制的服务模式和服务内容，租户对云计算系统具有相应的安全性需求。为满足个
性化和层次化的需求，云计算系统应综合考虑服务特性、复杂度、可扩展性和经济性等因素，
设置具有较高灵活度且明确的安全保障机制的定制模块，为租户的选择提供便利。一般地，各
层面的保障机制应分别满足下列要求： SaaS 需要提供对企业更加透明的数据存储和安全方
案； PaaS 应具有完善的访问控制机制来防止平台被黑客利用； IaaS 应实现数据存储、资源利
用的合理性和安全性； Haas 则应关注硬件的性能和数据的泄露。
11.1.4 云安全需求
1. 具有保密性
为了能够对数据信息的隐私进行有效保护，在云端的数据信息要以密文的方式保存。为
310
第11 章云计算安全
了对用户的一些行为信息进行保护，一定要保证云服务器的使用者匿名对云资源及安全记录数
据的起源进行应用。另外，在一些情况下，云服务器要计算用户数据，计算的结果也必须用密
文的方式反馈给使用者。
2. 确保数据信息的完整
云存储服务的前提是要确保数据信息的完整。云在对数据信息流进行处理的过程中，最
重要的是要考虑到数据信息处理结果的完整。数据信息在储存的过程中，使用者通常会检查自
已数据的完整性。数据信息流在处理的过程中，数据信息完整性的检测要求主要是因为使用者
对提供商的不信任所致。因此，数据信息的处理保持完整性非常重要。
3. 对访问进行控制
云计算过程中要禁止非法使用者访问其他使用者的数据信息资源，对合法的使用者也要
相应设置访问权限。对访问控制的要求主要体现在以下两个方面。
1) 网络控制，是指在云的基础设施中对主机之间访问的控制。
2) 数据控制，是指对使用者数据信息的访问控制。
4. 对身份进行认证
目前身份认证的技术一般有以下几种：第一，对使用者秘密的认证，如密码、问题等；
第二，对使用者硬件的认证，如U 盘、卡片等；第三，对使用者身体特征的认证，如指纹
认证。
11.2 云计算安全架构
11.2.1 基千可信根的安全架构
保证云计算使用主体之间的信任是提供安全云计算环境的重要条件，也是该类安全架构
的基本出发点。尽可能地避免安全威胁得逞、及时发现并处理不可信的事件是该架构的设计目
的。一方面要求包括云计算提供商在内的各主体在时间和功能上只有有限的权限，超过权限的
操作能够被发现并得到妥善处理；另一方面要求主体的使用权限在具有安全保证的前提下可以
便捷地变更，针对HaaS 服务这项功能尤其重要。该架构的典型代表是基千TPM 可信平台模
块的云计算安全架构。
1. TPM 可信平台模块
可信平台模块TPM (Trusted Platform Module) 是按照可信计算组织TCG (Trusted
Computing Group) 制定的标准所实现的加密芯片，可以捆绑在通用硬件上。
TPM 安全芯片的实质是一个可独立进行密钥生成、加解密的装置，内部拥有独立的处理器
和存储单元。针对云计算环境， TPM 芯片应满足以下基本要求：＠完整性度量，保证使用该芯
片的计算机从启动开始的每个操作都具有完整的验证机制，防止黑客或者病毒篡改系统信息；
＠敏感数据加密存储与封装，将敏感数据存储在芯片中的屏蔽区，用户数据通过硬件级加密存
储到外部设备，防止数据被窃取； ＠身份认证功能，硬件级的用户身份标识，用密钥和硬件的
绑定来实现身份确认，防止伪装攻击的发生； ＠内部资源授权访问，通过TPM 的授权协议能够
方便地实现用户对其资源设置访问权限，在保证安全性的情况下实现资源的便捷共享； ＠数据
加密传输，能够在与外界进行通信时，加密通信链路上的数据，防止监听、篡改或者窃取。目
前，最新发布的TPM2.0 标准将支持多种加密算法，提高了芯片使用的灵活性。
311
计算机网络安全教程第4 版
2. 云计算TPM 可信根架构
可信根是能够保证所有应用主体行为可信的基本安全模块，其不仅可以判断行为结果的
可信性，还能够杜绝一切非授权行为的实施，被认为是构建可信系统的基础。TPM 作为目前
普遍认可的可信计算模块，被广泛应用为可信计算系统的可信根。一种针对云计算环境的基千·
TPM 的可信云计算平台架构TCCP (Trusted Cloud Computing Platform) 的协议结构，如图11-1
所示。.
laaS范围
TCCP
- - >- - - - - - - - - - - - ------,
` ］已一国国尸：员
图11一1 TCCP 协议示意图
在TCCP 中，云计算用户的使用空间为基千TPM 的封闭虚拟环境，用户通过设置符合要
求的密钥等安全措施保证其运行空间的安全性；云计算管理者仅负责虚拟资源的管理和调~。
用户私密信息交由使用TPM 的可信计算管理平台保管，实现了与云计算管理者的分离。从而
利用TPM 实现了防止管理者非法获取用户数据和篡改软件功能的行为。
TCCP 主要包含两个模块：可信虚拟机监控模块(TVMM) 和可信协同模块(TC)。每台
主机都需要安装TVMM 模块，并且嵌入TPM 芯片。TVMM 可以不断验证自身的完整性，提
供了屏蔽恶意管理者的封闭运行环境，而TPM 芯片则可以通过远程验证功能，使用户确定~
机上运行着可信的TVMM 模块。TC 的主要功能是管理可信结点的信息，保证可信结点嵌入．
了TPM 芯片，并将认证信息通知给用户。因此， TCCP 一般由一个类似VeriSign 的第三方可
信机构进行管理。
11.2.2 基千隔离的安全架构
租户的操作、数据等如果都被限制在相对独立的环境中，不仅可以保护用户隐私，还可·
以避免租户间的相互影响，是建立云计算安全环境的必要方法。目前，基于隔离的云计算安全：
架构主要包括基于软件协议栈的隔离和基千硬件支持的隔离。
1. 基千软件协议栈的隔离
针对云计算硬件资源的分布性和多自治域的特点，采用虚拟化的方法，实现网络、系统；
和存储等逻辑层上的隔离是该方案的主要特点。
但是，由千隔离机制涉及的环节较为分散，目前并没有达成统一的协作规范，设备和技：
术的差异导致无法形成高效的端到端隔离。为确保该类方案的高效运行，不仅需要各个环~~
现有效的隔离机制，还要建立隔离机制之间的协作协议。
目前，虚拟化技术的发展支持着该方案的实施，典型的代表为富士通提出的可信月员务严
平台的统一隔离方案。其中，隔离的软件协议栈是指云计算各环节中隔离机制的总和，根；
据云计算服务过程中涉及的隔离策略，可以把其划分为服务终端、网络、系统和存储~~
个环节的隔离。通过采用统一的高级虚拟化技术，实现逻辑层的隔离，并达到与物理隔~
一样安全的效果。
312
第11 章云计算安全
2. 基千硬件支持的隔离
相对于通过软件实现逻辑层隔离的架构，硬件支撑的隔离方案具有更好的安全效果，并
且随着硬件功能的提升也成为可能。其中典型的代表为以思科为首的公司提出的安全云架构，
如图11-2 所示。
租户A 三云租户B
环境环境
=霖屯癹S3 _ ` 啊隔离
哟尖仑＝需厕防火墙防火墙厕
IAcLs 网络流量ACLs I
网络应用:: 恩策略策胳屋l 二网络应用虚拟存储虚拟存储
眉日志日志匡
图11一2. 思科安全云架构
该方案由NetApp、思科和VMWare 三个公司联合提出，并针对不同的层次给出了各自的
解决方案。其中， NetApp 的Mutistore 在独立的NetApp 存储系统上快速划分出多个虚拟存储
管理域每个虚拟存储管理域都可以设置不同的性能及安全策略，从而实现租户在牺牲最少私
有性的前提下安全地共享同一存储资源。为了实现与隔离网络的高效对接， NetApp 的VLAN
接口可以创立私有的网络划分，每个接口绑定一个1P 空间， IP 空间是独立且安全的网络逻辑
划分，代表一个私有的路由域。
思科在网络隔离方面也提供了硬件支持，其交换机有能力把一台物理交换机分成最多4
台虚拟交换机，每台虚拟交换机和独立交换机一样，具有独立的配置文件、必要的物理端口，
以及分离的链路层和网络层服务。
在应用层， VMWare 的vShieldZone 技术提供了对网络活动更强的可视性和管理能力，在
虚拟服务层建立了覆盖所有物理资源的逻辑域，实现了租户之间不同粒度的信任、隐私及机密
性管理。
与传统架构相比，该架构在硬件支持的基础上，实现了对存储、网络、虚拟机和服务器
各个环节的高效隔离及高效连接，保证了多租户环境下数据的安全性及系统的高效性，避免了
以大幅度降低效率为代价的多租户隔离。
但是，由于该方案具有较强的硬件依赖性，尽管可以实现高效的链路隔离，较高的成本
却使其在已有云计算环境下难以推广。
11.2.3 安全即服务的安全架构
租户业务的差异性使得他们需要的安全措施也不尽相同，单纯地设置统一的安全配置不
仅会导致资源的浪费，也难以满足所有租户的要求。目前，借鉴SOA (Service Oriented
压hitecture) 理念，把安全作为一种服务，支持用户定制化的安全即服务的云计算安全架构得
313
计算机网络安全教程第4 版
到了广泛的关注，本节将介绍SOA 理念在云计算安全中的含义，以及基千SOA 的云计算安
全架构。
云计算平台上运行着不同的服务，需要数据库、网络传输、工作流控制及用户交互等多
种功能的支持。由千执行环境和执行目的的不同，必然面临不同的安全问题。其中，数据库面
临数据存放、加密、恢复及完整性保护等问题，网络传输面临外部通信及云环境内部通信的安
全问题，工作流控制面临访问控制等问题。因此，云计算安全架构除了需要上述讨论的可信~
与隔离链路保证之外，还需要在此之上构建基于SOA 的安全服务。
1. IBM 的SOA 通用安全架构
SOA 旨在通过将结构化的软件功能模块（也称作服务）整合在一起，以提供完整的功能
或者复杂软件应用的设计方法，主要体现了服务可以被设计为具有专门功能，并且可以在不同
应用之间复用的思想。SOA 希望实现服务与系统之间的松散耦合，将整体功能分为独立的功
能模块，并设计模块之间规范的数据交互模式，以满足用户通过不同服务组合的方式实现定制
化的服务需求。
借鉴SOA 的理念，把安全机制（或策略）看作独立的服务模块， IBM 针对云计算给出了
通用的安全架构，如图11-3 所示。
软件即服务(SaaS) < SOA安全 >
应用软件作为服务，通过许可证
的方式桉需提供给用户;怅燮丽 平台即服务(PaaS) 11 身份认证联合身份认证、授权
优化中间件服务一应用服务器
数据库服务器、门户服务器承诺合规性审计报告
人侵检测和抵御
基础设施即服务(laaS)
虚拟化服务器、存储和网络 11 隔离 租户安全域的隔离
企业现有安全设施整合
图11一3 IBM 的SOA 通用安全架构
上述架构强调云计算的各种服务模式，由于执行环境和执行目的的不同，必然面临不同
的安全问题，并需要一系列具有针对性的安全机制来应对。通过把安全机制设计为安全服务~
块，可以实现不同管理域或者安全域内租户的通用性。通过租户的选择，可以形成一个独立的
云计算安全服务体系，满足租户在安全方面的个性化需求。
该通用架构的主要优势在千可以轻松整合不同云计算提供商的安全服务。IBM 的安全架
构不限制用户使用特定的安全协议或者机制，充分给予了用户灵活的选择空间，这也增加了租．
户对云计算提供商的信任。
2. EasySaaS 的SOA 安全方案
EasySaaS 是针对SaaS 服务模式提出的一种发展框架，包括SaaS 系统构建、部署与更~
的全过程，其强调模块化的设计理念，如图11-4 所示。
针对安全问题， EasySaaS 分为运行态和部署态两种情况分别考虑，并设计了基础安全~
块（认证、测试和监控等）和定制化安全模块。在该架构下，租户不仅可以以面向服务的~~
开发、发布、发现、组装、部署和执行其个性化应用，而且还可以选择符合其安全需求的
Saas 体系架构。
314
第11 章云计算安全
待续测试和检索
:
认证|
| 开发用户接口|
应用创建的核心服务
| 发布推荐监测
I 发现定制验证和确认
I 索引组装建模
I 代码生成登人澄出存储
.
本休和链接数据
二三言}
分布式服务仓库式存储（数据、-- --- 定制和运行时仓库
图11-4 EasySaaS 架构
11.3
11.3.1
云计算安全技术
云计算安全服务体系
云计算安全服务体系由一系列云安全服务构成，是实现云用户安全目标的重要技术手
段。根据其所属层次的不同，云安全服务可以进一步分为安全云基础设施服务、云安全基础服
务及云安全应用服务3 类。
1. 安全云基础设施服务
云基础设施服务为上层云应用提供安全的数据存储、计算等1T 资源服务，是整个云计算
体系安全的基石。这里，安全性包含两个层面的含义：其一是抵挡来自外部攻击的能力；其二
是证明自己没有破坏用户数据与应用的能力。一方面，云平台应分析传统计算平台面临的安全
问题，采取全面严密的安全措施。例如，在物理层考虑厂房安全，在存储层考虑完整性和文件／
日志管理、数据加密、备份、灾难恢复等，在网络层应当考虑拒绝服务攻击、DNS 安全、网
络可达性和数据传输机密性等，系统层则应涵盖虚拟机安全、补丁管理和系统用户身份管理等
安全问题，数据层包括数据库安全、数据的隐私性与访问控制、数据备份等，而应用层应考虑
程序完整性检验与漏洞管理等。另一方面，云平台应向用户证明自已具备某种程度的数据隐私
保护能力。例如，存储服务中证明用户数据以密态形式保存，计算服务中证明用户代码运行在
受保护的内存中等。由于用户安全需求方面存在着差异，云平台应具备提供不同安全等级的云
基础设施服务的能力。
2. 云安全基础服务
云安全基础服务属于云基础软件服务层，为各类云应用提供共性信息安全服务，是支撑
云应用满足用户安全目标的重要手段。其中比较典型的几类云安全服务包括以下几种。
l) 云用户身份管理服务。主要涉及身份的提供、注销及身份认证过程。在云环境下，实
现身份联合和单点登录可以支持云中合作企业之间更加方便地共享用户身份信息和认证服务，
315
计算机网络安全教程第4 版
并减少重复认证带来的运行开销。但云身份联合管理过程应在保证用户数字身份隐私性的前提
下进行。由于数字身份信息可能在多个组织间共享，其生命周期各个阶段的安全性管理更具有
挑战性，而基千联合身份的认证过程在云计算环境下也具有更高的安全需求。
2) 云访问控制服务。云访问控制服务的实现依赖千如何妥善地将传统的访问控制模型
（如基千角色的访问控制、基于属性的访问控制模型及强制／自主访问控制模型等）和各种授~
策略语言标准（如XACML、SAML 等）扩展后移植入云环境。此外，鉴于云中各企业组织提
供的资源服务兼容性和可组合性的日益提高，组合授权问题也是云访问控制服务安全框架需要
考虑的重要问题。
3) 云审计服务。由千用户缺乏安全管理与举证能力，要明确安全事故责任就要求服务商
提供必要的支持。因此，由第三方实施的审计就显得尤为重要。云审计服务必须提供满足审计
事件列表的所有证据及证据的可信度说明。当然，若要该证据不会披露其他用户的信息，则需
要特殊设计的数据取证方法。此外，云审计服务也是保证云服务商满足各种合规性要求的重要
方式。
4) 云密码服务。由千云用户中普遍存在数据加、解密运算需求，云密码服务的出现也~
十分自然的。除最典型的加、解密算法服务外，密码运算中密钥管理与分发、证书管理及分~
等都能以基础类云安全服务的形式存在。云密码服务不仅为用户简化了密码模块的设计与实
施，也使得密码技术的使用更集中、规范，也更易于管理。
3. 云安全应用服务
云安全应用服务与用户的需求紧密结合，种类繁多。典型的实例如DDoS 攻击防护云
服务、Botnet 检测与监控云服务、云网页过滤与杀毒应用、内容安全云服务、安全事件~
控与预警云服务，以及云垃圾邮件过滤及防治等。传统网络安全技术在防御能力、响~~
度和系统规模等方面存在限制，难以满足日益复杂的安全需求，而云计算优势可以极大~
弥补上述不足：云计算提供的超大规模计算能力与海量存储能力，能在安全事件采集、~
联分析和病毒防范等方面实现性能的大幅提升，可用千构建超大规模安全事件信息处理~
台，提升全网安全态势把握能力。此外，还可以通过海量终端的分布式处理能力进行安~
事件采集，上传到云安全中心分析，极大地提高了安全事件搜集与及时地进行相应处理的
能力。
11.3.2 云计算安全技术的种类
1. 云计算安全测试技术
测试与验证是及时发现安全隐患与缺陷的有效手段之一。传统软件的安全测试已被证明
是极具挑战性的问题，云计算环境的复杂性更加剧了测试的难度。
(1) 基于Web 的测试技术
云计算作为基于网络的服务系统， Web 应用是其展现服务的重要手段之一，通过借鉴传
统软件的Web 测试方法，目前已形成了多种针对云计算应用的测试方法，主要包括基千模型
的Web 测试方法和基于测试用例的方法。
基千模型的Web 测试方法往往采用工作流的方式构建测试与分析模型，实现代码的安~
性测试，典型代表包括基于Petri 网的形式建模和分析技术、模型检查技术等。基于测试用例
的方法往往采用渗透测试来验证代码的安全性，典型代表包括多层次可信的软件错误定位方·
法、面向可信性的测试策略和集成方法。
316
第II 章云计算安全
(2) 增量测试方法
增量测试方法常被应用于复杂软件系统的测试与分析，通过设计合理的测试流程降低测
试的复杂度。云计算的以下特征使得该测试方法在云计算中得到了广泛应用： ＠云计算系统的
复杂性导致对其进行全面的测试是一件费时费力的工作，且难免出现遗漏； ＠云计算租户规模
巨大，不当的测试操作会影响租户的使用体验，也可能引发严重的安全事故。
常采用的增量测试方法包括基千功能模块的增量测试和基于测试范围的增量测试。基于
功能模块的增量测试在确定需要测试的功能模块后，在测试期间可以保证云计算服务是不间断
的，并以在线的方式不断进行验证和测试，记录用户访问和数据更新情况，并作为测试用例实
时地进行安全分析和测试，通过对分析得到的潜在漏洞采用针对性的测试方法，进一步确认其
存在性和修补措施。基千测试范围的增量测试主要通过从有限范围内测试逐步扩展到全局测试
的思路实现，该方法的典型代表为增量发布方法，即新版本首先在小范围的用户中使用，只有
当小范围用户使用成功后才逐步扩大新版本的使用范围。
2. 云计算认证与授权技术
有效的认证与授权方法是避免服务劫持、防止服务滥用等安全威胁的基本手段之一，也
是云计算开放环境中最为重要的安全防护手段之一。该类技术从使用主体的角度给出一种安全
保障方法，这里从服务和租户两个角度说明该技术的主要实施方法。
(1) 以服务为中心的认证授权
把使用服务的权限分为不同的角色，通过设置相应的认证完成对请求身份的验证和授权
是该机制的基本思想。该技术在所有的云计算服务中都会被应用，其基本流程如下：云计算提
供商接收到服务请求时，询问租户是否有有效的身份信息，如果有则提供完整的认证与授权管
理；否则，需要建立身份信息和认证授权信息。租户通过Internet 访问云计算服务，其认证过
程就像使用一套独立的软件系统。整个过程中，云计算提供商可以独立完成认证，也可以委托
或利用第三方机构的系统完成认证。
(2) 以租户为中心的认证授权
云计算环境中，租户可能定制来自不同管理域的服务，仅采用基千服务的认证和授权，
势必导致认证过程的烦琐，影响租户的使用体验。基千租户的认证旨在简化该过程，通过联
合认证的方法在保证安全性的同时提高租户的使用体验。具有跨级跨域等特点的云计算服
务，需要把用户的身份信息交给可信的第三方维护管理， 所有签约服务都采用租户唯一绑定
的身份和授权信息实现服务的提供，最大限度地消除租户拥有多个账号和密码可能造成的安
全隐患。
3. 云计算安全隔离技术
隔离技术一方面保证租户的信息运行于封闭且安全的范围内，方便提供商的管理；另一
方面避免了租户间的相互影响，减少了租户误操作或受到恶意攻击对整个系统带来的安全风
险。云计算安全隔离技术主要包括网络隔离技术和存储隔离技术。
(1) 网络隔离技术
网络隔离可以提供基本的安全保障、更高的带宽分配，以及针对性的计费规则和网络的
层次化支持。网络隔离可以从物理和逻辑两个层面来实现。
(2) 存储隔离技术
云计算的多租户特性对存储的隔离带来了新的挑战，云计算环境的底层模块在设计时并
317
计算机网络安全教程笫4 版
没有为多租户、可重配置的平台和软件提供充分的安全保障。首先，在存储设备上，内存和硬
盘等资源的再分配过程中，云服务提供商一般不会完全擦除其中的内容，因此后一个租户就有
可能恢复出前一个用户的内容，造成租户隐私泄露。在存储逻辑上，数据库隔离需要考虑安
全、操作、容错及资源等多方面因素。在多租户模式下，需要重新考虑各种数据库存储模式
(SQL 型、NoSQL 型和XML 型等）的效果。理论上每个租户都有独立的数据库和定制化存储
模式是最好的安全方式，但是云计算还需要考虑资源的利用率因素。
4. 云计算安全监控技术
监控是租户及时知晓服务状态及提供商了解系统运行状态的必要手段，可以为系统安~
运行提供数据支撑。常见的监控技术包括软件内部监控和虚拟化环境监控。
(1) 软件内部监控机制
在云计算的动态环境下，软件的安全问题不应该依赖事后的被动响应，需要从事后维护
向事前设计和主动监控转移，形成动态的安全控制方法。与传统软件运行环境不同，云计算~
布式、去中心化等特性对软件监测技术带来了挑战。目前已提出的软件监控技术是软件断层~
术，将复杂的分布式软件监控任务分解，划分成同一监控目标的多个实例，从而有效减少单一
监控目标由千监控所带来的性能损失。
(2) 虚拟化环境监控技术
云计算IaaS 服务中，租户的使用权限较高，提供商难以对租户的行为进行管理，因此需
要针对虚拟化的监控与分析机制。基千虚拟化技术的监控分析方法包括静态分析监控方法和~
态分析监控方法。前者可以将安全监控工具置于独立的受保护空间中，从而保证监控的良~~
行，但是静态检测分析方法不能对操作系统的行为，即事件操作进行监控。动态分析监控方~
又分为修改操作系统内核和无须修改系统内核两类方法。前者对事件行为的监控可通过在操｛乍
系统中植入钩子实现，当触发钩子时，钩子中断系统并进行相关操作。但是，这种分析监控技：
术最大的问题是需要修改系统内核，带来了许多不便。无须修改系统内核的动态分析监控方~
月中，一些方法通过跟踪系统进程间的信息流，进行入侵检测和病毒清除，另一些方法利用跟荡:
可疑来源数据导致的控制流变化进行检测。
5. 云计算安全恢复技术
恢复机制是保证服务可靠性和可用性的重要手段，是典型的事后反应机制。根据其涉及．
的范围可以分为整体恢复技术和局部恢复技术。
(I) 整体恢复技术
系统恢复是恶意软件防御中的一个重要研究手段。许多恢复方法关注的重点在千恢复~
久性数据和删除恶意软件。然而在这些方法中，所有服务的状态在恢复后都会丢失。因此，现L
有的系统整体恢复技术会影响所有的进程，失去未感染进程实体的状态信息，导致未感染的服．
务进程失效，并失去用于保持业务连续性的信息，可见整体恢复技术难以适用于基于多租户特：
性的云计算服务。
(2) 局部恢复技术
目前，针对局部恢复方法的研究，主要关注进程级实体的恢复，虽然可以克服对其他过t
程的影响，但是这类方法往往忽略了恶意软件执行后的次级攻击，导致受到攻击的进程恢~
后，其他进程仍面临受损的风险。此外，局部恢复方法专注于进程级实体，不关注系统内核被：
破坏的情况，这使得系统可能面临更大的风险。
318
第11 章云计算安全
11.4 小结
云计算代表了IT 领域向集约化、规模化与专业化道路发展的趋势，是IT 领域正在发生的
深刻变革。但云计算在提高使用效率的同时，为实现用户信息资产安全与隐私保护带来极大的
冲击与挑战。本章从云安全的概念、范畴，面临的安全威胁和保证云安全的典型架构，以及保
证云安全的服务体系等方面介绍了云计算安全问题。
11.5 习题
l ．云计算安全的含义是什么？
2. IaaS 安全主要体现在哪些方面？
3. PaaS 安全主要体现在哪些方面？
4. Saas 安全主要体现在哪些方面？
5. 云计算在安全方面必须解决好的问题有哪些？
6. 云安全需求包括哪些方面？
7. 简述基于可信根的安全架构。
8. 简述SOA 通用安全架构。
9. 简述保证云计算安全的云计算安全服务体系。
319
第12 章
网络安全解决方案
网络安全是一项系统工程，不仅有空间上的跨度，还有时间上的跨度。随着环境的~
变和技术的发展，网络系统的安全状况也是动态变化的，因此只有相对的安全而没有绝~
的安全。
虽然安全不是绝对的，但是可以尽可能地提高网络的相对安全性，把网络风险降到最f氐
限度，这不能仅仅依靠一种安全技术或安全设备来实现，而应综合运用多种计算机网络信息系
统安全技术，将诸如安全操作系统技术、防火墙技术、病毒防护技术、入侵检测技术、安全扫
描技术、认证和数字签名技术，以及VPN 技术等综合起来，形成一个完整的、协调一致的网
络安全防护体系，设计一套计算机网络安全完整的解决方案，并合理选择相应的安全设备来~
施具体的解决方案，才能实现完善的安全功能。
单机上网的用户越来越多，因此单机用户的网络安全问题也变得越来越突出， 本章也对圈
单机用户的网络安全解决方案进行了简要论述。
12.1 网络安全体系结构
12.1.1 网络信息安全的基本问题
关千网络信息安全的基本问题，众所周知的要素有：可用性、保密性、完整性、可控与
可审查性等。从心理的角度看，最终要解决的是使用者对基础设施的信心和责任感的问题。网
络时代的信息安全有非常独特的特征，研究信息安全的困难在于以下几个方面。
1．边界模糊
谈论信息安全问题的困难之处在千，即使从哲学和纯学术理论角度也很难精确地刻画~
中的一些问题，很难找到解决问题的明显边界。数据安全与平台安全交叉；存储安全与传~安
全互相制约；网络安全、应用安全与系统安全共存；集中的安全模式与分权制约安全模式相~
竞争等。带来的结果是，传统的安全切入点已变得不那么清晰，安全对策在由点对策向整~对｀
策演进的过程中困难重重。
2. 评估困难
安全结构非常复杂，网络层、系统层、应用层的安全设备、安全协议和安全程序构成一
个有机的整体，加上安全机制与人的互动性，以及网络的动态运行带来的易变性，使得评~网
络安全性成为极其困难的事情。原有的评估方法体系不能适应新的情况，任何一个细小环节~
生问题，都可能会危及整个安全体系，木桶原理随处适用。评价不够精确，就使得制定对策、
做出反应和研发技术等活动失去了可信的前提条件。
3. 安全技术滞后
网络与应用技术的发展很快，新的技术不断推动新的应用。另一方面，安全技术是一乔中
在对抗中发展的技术。不断出现的应用安全问题是安全技术发展的促进剂。在这个意义上，~
320
第12 章网络安全解决方案
全技术总是滞后的。而且滞后本身就是巨大的安全脆弱性。
4. 管理滞后
现代网络信息环境是一种交互式环境，是动态发展变化的。安全与效率在本质上是矛盾
的，要想安全经常会增加各种限制，而人的天性常常是突破这种限制以追求效率。在此过程
中，管理就显得特别重要。传统的安全管理是制度管理和法规管理，其在今天高度分散、高度
复杂的网络化信息操作环境中已变得力不从心。需要构建一种技术管理与制度法规管理相平衡
的新的管理模式。
此外，过去人们往往把信息安全局限千通信保密，着重考虑的是对信息加密功能要求，
而实际上网络信息安全牵涉到方方面面的问题，是一项极其复杂的系统工程。从简化的角度
来看，要实施一个完整的网络与信息安全体系，至少应包括3 类措施，并且三者缺一不可。
一是社会的法律政策、企业的规章制度及安全教育等外部软环境。在该方面政府有关部门和
企业的主要领导应当扮演重要的角色。二是技术方面的措施，如防火墙、网络防毒、信息加
密存储与通信、身份认证、授权等。只靠技术措施并不能保证百分之百的安全。三是审计和
管理措施，在此方面同时包含技术与社会两个方面的措施。其主要的安全措施有：实时监控
企业安全状态、提供实时改变安全策略的能力，以及对现有的安全系统实施漏洞检查等，以
防患千未然。
保护、检测、响应和恢复涵盖了对现代网络信息系统保护的各个方面，构成了一个完整
的体系，使网络信息安全建筑在更坚实的基础之上。信息运行平台发展到今天已极为复杂，传
统的信息安全模式已不再适应现代安全环境。数据安全、平台安全和服务安全要求采用完整的
信息保障体系，并不断发展传统的信息安全概念。
·保护(Protect) ：保护包括传统安全概念的继承，采用加解密技术、访问控制技术和数
字签名技术，从信息动态流动、数据静态存储和经授权方可使用，以及可验证的信息
交换过程等多方面对数据及其网上操作加以保护。无论从任何角度观察，信息及信息
系统的保护都是安全策略的核心内容。
·检测(Detect) ：检测的含义是指对信息传输的内容的可控性的检测，对信息平台访问
过程的检测，对违规与恶意攻击的检测，以及对系统与网络弱点与漏洞的检测等。检
测使信息安全环境从单纯的被动防护演进到在对整体安全状态认知基础上的有针对性
的对策，并为进行及时、有效的安全响应及更加精确的安全评估奠定了基础。
·响应(React) ：在复杂的信息环境中，要保证在任何时候信息平台都能高效正常运
行，要求安全体系提供有力的响应机制。这包括在遇到攻击和紧急事件时及时采取措
施，例如关闭受到攻击的服务器，反击进行攻击的网站，以及按系统的安全性加强和
调整安全措施等。
·恢复(Restore) ：狭义的恢复指灾难恢复，在系统受到攻击时，评估系统受到的危害
与损失，按紧急响应预案进行数据与系统恢复，以及启动备份系统恢复工作等。广义
的恢复还包括灾难生存等现代新兴学科的研究。保证信息系统在恶劣的条件下，甚至
在遭到恶意攻击的情况下，仍能有效地发挥效能。
上述4 个概念之间存在着一定的因果和依存关系，形成一个整体。如果全面的保护仍然
不能确保安全（这在现阶段是必然的），就需要检测来为响应创造条件；有效与充分地响应安
全事件，将大大减少对保护和恢复的依赖；恢复能力是在其他措施均失效的情形下的最后保障
机制。因此，要构筑有效的现代信息保障体系，必须投入更多的资源，全面加强4 个方面的技
32]
计算机网络安全教程第4 版
术与管理。
可以看出，计算机网络的安全保护是一个涉及多个层面的系统工程，必须全面、协调~
应用多种技术才能达到有效保护的目的，若在整个网络安全的防护体系中存在一个薄弱点， 则
网络信息系统就可能在该点上首先受到攻击。
12.1.2 网络安全设出为基本原则
现代信息系统都是以网络支撑，相互连接的。要使信息系统免受攻击，关键要建立起安
全防御体系，从信息的保密性（保证信息不泄露给未经授权的人），拓展到信息的完整性（防
止信息被未经授权的篡改，保证真实的信息从真实的信源无失真地到达真实的信宿）、信息的
可用性（保证信息及信息系统确实为授权使用者所用，防止由于计算机病毒或其他人为因素~
成的系统拒绝服务，或为敌手可用）、信息的可控性（对信息及信息系统实施安全监控管理）
和信息的不可否认性（保证信息行为人不能否认自己的行为）等。
对千具体的个人用户或企业来说，在实施上面提出的安全防御体系之前，首先需要~~
网络系统现状，进行安全需求及安全目标分析，并据此制定一个适合的网络安全整体解决方．
案，然后选择相应的安全设备来具体实施该解决方案。至此，网络安全防御体系才能在具体的
网络环境中得到实际的应用。
在进行计算机网络安全设计和规划时，应遵循以下原则。
L 需求、风险和代价平衡分析的原则
对任意网络来说，绝对安全难以达到，也不一定必要。对一个具体网络要进行实际~
析，对网络面临的威胁及可能承担的风险进行定性与定量相结合的分析，然后制定规范和~
施，确定本系统的安全策略。保护成本及被保护信息的价值必须平衡，例如，价值仅1 万元的
信息如果用5 万元的技术和设备去保护是一种不适当的保护。
2．综合性和整体性原则
运用系统工程的观点和方法，分析网络的安全问题，并制定具体措施。一个较好的安全：
措施往往是多种方法适当综合的应用结果。一个计算机网络包括个人、设备、软件和数据等环；
节。它们在网络安全中的地位和影响作用，只有从系统综合的整体角度去看待和分析，才可能
获得有效、可行的措施。
3. 一致性原则
这主要是指网络安全问题应与整个网络的工作周期（或生命周期）同时存在，制定的~
全体系结构必须与网络的安全需求相一致。实际上，在网络建设之初就考虑网络安全对策，比
等网络建设好后再考虑，不但容易，而且花费也少得多。
4. 易操作性原则
安全措施要由人来完成，如果措施过千复杂，对人的要求过高，本身就降低了安全性。
其次，采用的措施不能影响系统的正常运行。
5. 适应性和灵活性原则
安全措施必须能随着网络性能及安全需求的变化而变化，要容易适应，容易修改。
6. 多重保护原则
任何安全保护措施都不是绝对安全的，都可能被攻破。但是建立一个多重保护系统，~
层保护相互补充，当一层保护被攻破时，其他保护层仍可保护信息的安全。为此需要构建全~
位的安全体系。全方位的安全体系的主要内容包括以下几个。
322
第12 章网络安全解决方案
·访问控制：通过对特定网段和服务建立的访问控制体系，将绝大多数攻击阻止在到达
攻击目标之前。
·检查安全漏洞：通过对安全漏洞的周期检查，即使攻击可到达攻击目标，也可使绝大
多数攻击无效。
·攻击监控：通过对特定网段和服务建立的攻击监控体系，可实时检测出绝大多数攻
击，并采取相应的行动（如断开网络连接、记录攻击过程和跟踪攻击源等）。
·加密通信：主动的加密通信，可使攻击者不能了解和修改敏感信息。
·认证：良好的认证体系可防止攻击者假冒合法用户。
·备份和恢复：良好的备份和恢复机制，可在攻击造成损失时，尽快地恢复数据和系统服务。
12.2 网络安全解决方案概述
12.2.1 网络安全解决方案的基本概念
网络安全解决方案可以看作是一张有关网络系统安全工程的图纸，图纸设计的好坏直接关系
到工程质量的优劣。总体来说，网络安全解决方案涉及安全操作系统技术、防火墙技术、病毒
防护技术、入侵检测技术、安全扫描技术、认证和数字签名技术，以及VPN 技术等多方面的
安全技术。
一份好的网络安全解决方案，不仅仅要考虑到技术，还要考虑到策略和管理。三者的关
系中，技术是关键，策略是核心，管理是保证。在整个网络安全解决方案中，始终要体现出这
3 个方面的关系。
在设计网络安全解决方案时，一定要了解目标对象的实际网络环境，对当前可能遇到的
安全风险和威胁进行量化和评估，只有这样才能制定出客观的网络安全解决方案。
动态性是网络安全的一个非常重要的特性，也是网络安全解决方案与其他项目方案的主
要区别。网络安全的动态性就是随着环境的变化和时间的推移，安全性会发生改变，因此在进
行网络安全解决方案设计时，不仅要考虑当前的情况，也要考虑未来可能出现的新情况，使网
络安全解决方案能够适应未来的发展。
一套完整的网络安全解决方案，应该根据目标网络系统的具体特征和应用特点，有针对
性地解决可能面临的安全问题。具体来讲，需要考虑的问题主要包括：
·关于物理安全的考虑。
·关于数据安全的考虑。
·数据备份的考虑。
·防病毒的考虑。
·关于操作系统／数据库／应用系统的安全考虑。
·网络系统安全结构的考虑。
·通信系统安全的考虑。
·关千口令安全的考虑。
·关于软件研发安全的考虑。
·关千人员安全因素的考虑。
·网络相关设施的设置和改造。
323
计算机网络安全教程第4 版
·安全设备的选型。
·安全策略与安全管理保障机制的设计。
·网络安全行政与法律保障体系的建立。
·长期安全顾问服务。
·服务的价格。
·事件处理机制。
·安全监控网络和安全监控中心的建立。
·安全培训等。
12.2.2 网络安全解决方案的层次划分
一个单位要实施一个安全的系统应该三管齐下。其中法律和企业领导层的重视应处千~
重要的位置。没有全体员工的参与就不可能实施可靠的安全保障。
网络信息安全包括了建立安全环境的几个重要组成部分，其中安全的基石是社会法律、
法规与手段，这部分用千建立一套安全管理标准和方法。
第二部分为增强的用户认证，用户认证在网络和信息的安全中属千技术措施的第一道大：
门，最后防线为审计和数据备份，不加强这道大门的建设，整个安全体系就会比较脆弱。用户
认证的主要目的是提供访问控制和不可抵赖的作用。按层次不同可以根据以下3 种因素提~用
户认证。
l) 用户持有的证件，如大门钥匙、门卡等。
2) 用户知道的信息，如密码。
3) 用户特有的特征，如指纹、声音和视网膜扫描等。
根据在认证中采用因素的多少，可以分为单因素认证、双因素认证和多因素认证等方法。
第三部分是授权，这主要为特许用户提供合适的访问权限，并监控用户的活动，~其；
不越权使用。该部分与访问控制（常说的隔离功能）是相对立的。隔离不是管理的最终目
的，管理的最终目的是要加强信息的有效、安全使用，同时对不同用户实施不同的访问
许可。
第四部分是加密。在上述的安全体系结构中，加密主要满足以下几个需求。
l) 认证——识别用户身份，提供访问许可。
2) 一致性一保证数据不被非法篡改。
3) 隐秘性一保护数据不被非法用户查看。
4) 不可抵赖一一使信息接收者无法否认曾经收到的信息。
加密是信息安全应用中最早开展的有效手段之一，数据通过加密可以保证在存取与传~
的过程中不被非法查看、篡改和窃取等。在实际的网络与信息安全建设中，利用加密技术至&
应能解决以下问题。
l) 密钥的管理，包括数据加密密钥、私人证书等的保证分发措施。
2) 建立权威密钥分发机构。
3) 保证数据完整性技术。
4) 数据加密传输。
5) 数据存储加密等。
第五部分为审计和监控，确切地说，还应包括数据备份，这是系统安全的最后一~
324
笫12 章网络安全解决方案
防线。系统一旦出了问题，这部分可以提供问题的再现、责任追查和重要数据复原等
保障。
在网络和信息安全模型中，这5 个部分是相辅相成、缺一不可的。其中底层是上层保障
的基础，如果缺少下面各层次的安全保障，上一层的安全措施则无从说起。如果一个单位没有
对授权用户的操作规范、安全政策和教育等方面制定有效的管理标准，那么对用户授权的控制
过程及事后的审计等工作就会变得非常困难。
12.2.3 网络安全解决方案的框架
总体上说，一份完整的网络安全解决方案应该包括以下7 个主要方面，在实际应用中可
以根据需要进行适当取舍。
1 ．网络安全需求分析
实际上，网络系统的安全性和易用性在很多时候是矛盾的，因此，在做安全需求分析时
需要在其中找到一个恰当的平衡点，毕竟服务器是给用户用的，如果安全原则妨碍了系统应
用，那么这个安全原则也不是一个好的原则。
在做安全需求分析时需要确立的几种意识如下。
·风险意识：百分之百的安全是不可能的；明确“干什么”和“怕什么“，做到什么样
的“度”。
·权衡意识：综合权衡系统开销、经济承受力等；准确定义业务要求。
·相对意识：理想的技术不适用，当前技术有缺点；准确定义安全保密要求；合理设置
防火墙的等级。
·集成意识：集成是我国信息安全设备和技术发展的捷径。
2．网络安全风险分析
首先对当前的安全风险进行概要分析，一般应突出对目标对象所在行业、业务特点、
网络环境和应用系统等的安全风险分析。然后对网络系统所面临的实际安全风险进行具体
分析。
实际安全风险分析一般应从网络、系统和应用3 个方面进行分析，同时还应从总体上对
整个网络系统的安全风险进行详细分析。
1) 网络的安全风险分析。详细分析目标对象现有网络的结构，找出产生安全问题的关键
环节，指出可能造成的危害。对如不消除这些安全问题，会引起的后果给出一个中肯、详细的
分析。
2) 系统的安全风险分析。对目标对象的所有系统进行详细的评估，分析存在的安全风险
并根据具体的业务应用，指出其中的利害关系，给出一个中肯、客观的分析。
3) 应用的安全风险分析。应用的安全是整个网络系统安全的关键，所有的安全措施都是
为保障应用安全服务的。由于应用的复杂性和关联性，应进行综合性分析。
4) 整体安全风险分析。整体安全风险分析的主要目的是找出网络系统中要保护的对象、
网络系统中存在的安全问题，以及可以采用的安全技术和安全产品。
3. 网络安全威胁分析
网络系统可能存在的安全威胁主要来自以下几个方面。
l) 操作系统的安全性。目前流行的许多操作系统均存在网络安全漏洞，如UNIX 、
Linux、Windows 等。
325
计算机网络安全教程第4 版
2) 防火墙的安全性。防火墙设备自身是否安全，以及是否设置错误，需要经过检验。
3) 来自内部网用户的安全威胁。
4) 缺乏有效的手段监视，评估网络系统的安全性。
5) 采用的TCP/IP 协议本身缺乏安全性。
6) 未能对来自Internet 的电子邮件夹带的病毒及Web 浏览可能存在的Java/ActiveX 控件
进行有效控制。
7) 应用服务的安全，许多应用服务系统在访问控制及安全通信方面考虑较少，并且，如
果系统设置错误，很容易造成损失。
4. 网络系统的安全原则
制定网络系统的安全原则是设计网络安全解决方案的一个重要方面，一般情况下应~握！
安全原则的动态性、唯一性、整体性、专业性和严密性。
l) 动态性。网络、系统和应用会不断地面临新的安全威胁和风险，因此制定的网络安~
原则必须保持动态性。
2) 唯一性。安全的动态性决定了安全解决方案的唯一性，针对每个网络系统的解决方~
都应是独一无二的。
3) 整体性。对千网络系统所面临的安全风险和威胁，要从整体上把握，进行全面的~护I
和评估。
4) 专业性。对千网络、系统和应用等方面的安全风险和解决方案要从专业的角度来分析：
和把握，而不能是一种大概的描述。
5) 严密性。整个解决方案要具有很强的严密性和逻辑性，不能给人一种不可靠的感觉。
在设计方案时，要从多个方面进行论证。
5．网络安全产品
常用的网络安全产品主要包括防火墙、反病毒系统、身份认证系统、入侵检测系统和I
VPN 设备等。结合目标对象的实际情况，对相关的安全产品和安全技术进行比较和分析， 分赈
析要客观，结果要中肯，帮助目标对象选择最适合的安全产品，而不需要一味地求好、求＊。
6. 风险评估
风险评估是工具与技术的结合，其目的是对网络系统面临的安全风险进行详细的分析和I
评估。通过风险评估可以使目标对象对网络安全解决方案有更加深入的认识。
7. 安全服务
安全服务是通过技术支持向目标对象提供持久服务。虽然安全服务不是产品化的东西，
但也是网络安全解决方案的重要组成部分。随着安全风险和安全威胁的快速发展与变化，安全：
服务的作用变得越来越重要。
12.3 网络安全解决方案设计
在此以一个企业网络系统为例来介绍网络安全解决方案的设计过程。
12.3.1 网络系统状况
目标网络系统的拓扑结构如图12-1 所示。
326
第12 章网络安全解决方案
路由器
目
攫看
二
服务器服务器
己··巨l
工作站工作站工作站工作站网管计算机
图12-1 目标网络系统拓扑结构
12.3.2 安全需求分析
网络系统的总体安全需求是建立在对网络安全层次分析基础上的。依据网络安全分层理
论，根据OSI 七层网络协议，在不同层次上，相应的安全需求和安全目标的实现手段各不相
同，主要是针对在不同层次上安全技术的实现而定。
对千基于TCP/IP 协议的该企业网络系统来说，安全层次是与TCP/IP 协议层次相对应
的，针对该企业网络的实际情况，可以将安全需求层次归纳为网络层安全和应用层安全两个技
术层次，同时将在各层都涉及的安全管理部分单独作为一部分进行分析。
1. 网络层需求分析
网络层安全需求是保护网络不受攻击，确保网络服务的可用性。首先，作为该企业网络
同Internet 互联的边界安全应作为网络层的主要安全需求。
·需要保证该企业网络与Internet 安全互联，能够实现网络的安全隔离。
·保证必要的信息交互的可信任性。
·要保证该企业内部网络不能够被Internet 访问。
·该企业网络公共资源能够对合法用户提供安全访问能力。
·对网络安全事件的审计。
·对千网络安全状态的量化评估。
·对网络安全状态的实时监控。
能够防范来自1ntemet 的对提供服务的非法利用，包括以下几项。
·利用HTTP 应用，通过Java Applet、ActiveX 及Java Script 形式。
·利用盯P 应用，通过文件传输形式。
·利用SMTP 应用，通过对邮件分析及利用附件所造成的信息泄露和有害信息对千信息
网络的侵害。
能够防范来自Internet 的网络入侵和攻击行为的发生，并能够做到以下几点。
·对网络入侵和攻击的实时鉴别。
·对网络入侵和攻击的预警。
327
计算机网络安全教程第4 版
·对网络入侵和攻击的阻断与记录。
其次，对千该企业网络内部同样存在网络层的安全需求，即该企业网络与下级分支机构
网络之间建立连接控制手段，对内部网络提供比网络边界更高的安全保护。
2. 应用层需求分析
企业建设网络系统的目的是实现信息共享和资源共享。因此，必须解决该企业网在应用
层的安全。
应用层安全主要与单位的管理机制和业务系统的应用模式相关。管理机制决定了应用模；
式，应用模式决定了安全需求。因此，在这里主要针对各局域网内应用的安全进行讨论，并就
建设全网范围内的应用系统提出一些建议。
应用层的安全需求是针对用户和网络应用资源的，主要包括以下几点。
·合法用户可以以指定的方式访问指定的信息。
·合法用户不能以任何方式访问不允许其访问的信息。
·非法用户不能访问任何信息。
·用户对任何信息的访问都有记录。
要解决的安全问题主要包括以下几个。
·非法用户利用应用系统的后门或漏洞，强行进入系统。
·用户身份假冒：非法用户利用合法用户的用户名，破译用户密码，然后假冒合法用户
身份，访问系统资源。
·非授权访问：非法用户或者合法用户访问在其权限之外的系统资源。
·数据窃取：攻击者利用网络窃听工具窃取经由网络传输的数据包。
·数据篡改：攻击者篡改网络上传输的数据包。
·数据重放攻击：攻击者抓获网络上传输的数据包，再发送到目的地。
·抵赖：信息发送方或接收方抵赖曾经发送过或接收到了信息。
一般来说，应用软件系统，如Notes、数据库和Web Server 等自身也都有一些安全机制，
传统的应用系统安全性也主要依靠系统自身的安全机制来保证。其主要优点是与系统结~~
密，但也存在很明显的缺点。
l) 开发量大。据统计，传统的应用系统开发中，安全体系的设计和开发约占开发~的
1/3 。当应用系统需要在广域网运行时，随着安全需求的增加，其开发量占的比重会更大。
2) 安全强度参差不齐。有些应用系统的安全机制很弱，如数据库系统，只提供根据用户
名／口令的认证，而且用户名／口令是在网络上明文传输的，很容易被窃听。有些应用系统有很；
强的安全机制，如Notes, 但由于设计、开发人员对其安全体系的理解程度及投入的工作~不；
同，也可能使不同的应用系统的安全强度会相去甚远。
3) 安全没有保障。目前很多应用系统设计和开发人员的第一概念是系统能够运行，而才;
是系统能够安全运行，因此在系统设计和开发时对安全考虑很少，甚至为了简单或赶进度而有｀
意削弱安全机制。
4) 维护复杂。每个应用系统的安全机制各不相同，导致很多重复性工作（如建立用户~
号等）；系统管理员必须熟悉每个应用系统独特的安全机制，工作量成倍增加。
5) 用户使用不方便。用户使用不同的应用系统时，都必须做相应的身份认证，且有些系
统需要在访问不同资源时分别做授权（如TIS Web Server 要求在用户访问不同的页面时输入不
同的口令，口令正确才允许访问）。当用户箭要访问多个应用系统时， 会有很多用户名和口~
328
第12 章网络安全解决方案
需要记忆，有可能就取几个相同的简单口令，从而降低了系统的安全性。
综上所述，最好在建设该企业网应用系统时，采用具有以下功能的商品化的应用层安全
设备作为安全应用平台。
·安全应用平台必须能够为各种应用系统提供统一的入口控制，而且只有通过了安全应
用平台的身份认证和访问授权以后，才可能访问某个具体的应用系统。
·安全应用平台自身的安全机制必须是系统的、健壮的，以免因为各种应用系统安全机
制参差不齐而导致系统不安全的现象出现。
·安全应用平台必须可以无缝集成第三方的应用系统，如Notes、数据库和Web Server
等的安全机制。
·安全应用平台可以集中对各种第三方的应用系统进行安全管理，包括用户注册、用户
身份认证、资源目录管理、访问授权及审计记录，以减少重复劳动，减轻系统管理人
员的工作负担。
·安全应用平台具有可伸缩性，并且安全可靠。
从以上分析可以看出，一个企业网络应用系统的安全体系应包含以下几个方面。
·访问控制：通过对特定网段和服务建立的访问控制体系，将绝大多数攻击阻止在到达
攻击目标之前。
·检查安全漏洞：通过对安全漏洞的周期检查，即使攻击可到达攻击目标，也可使绝大
多数攻击无效。
·攻击监控：通过对特定网段和服务建立的攻击监控体系，可实时检测出绝大多数攻
击，并采取相应的行动（如断开网络连接、记录攻击过程和跟踪攻击源等）；
·加密通信：主动的加密通信，可使攻击者不能了解和修改敏感信息。
·认证：良好的认证体系可防止攻击者假冒合法用户。
·备份和恢复：良好的备份和恢复机制，可在攻击造成损失时，尽快地恢复数据和系统
服务。
·多层防御，攻击者在突破第一道防线后，延缓或阻断其到达攻击目标。
·隐藏内部信息，使攻击者不能了解系统内的基本情况。
·设立安全监控中心，为信息系统提供安全体系管理、监控及紧急情况处理服务。
3. 安全管理需求分析
如前所述，能否制定一个统一的安全策略，在全网范围内实现统一的安全管理，对千企
业网来说至关重要。安全管理主要包括3 个方面。
·内部安全管理：主要是建立内部安全管理制度，如机房管理制度、设备管理制度、安
全系统管理制度、病毒防范制度、操作安全管理制度和安全事件应急制度等，并采取
切实有效的措施保证制度的执行。内部安全管理主要采取行政手段和技术手段相结合
的方法。
·网络安全管理：在网络层设置路由器、防火墙和安全检测系统后，必须保证路由器和
防火墙的ACL 设置正确，其配置不允许被随便修改。网络层的安全管理可以通过网
管、软件防火墙及安全检测等一些网络层的管理工具来实现。
·应用安全管理：应用系统的安全管理是一件很复杂的事情。由千各个应用系统的安全
机制不一样，因此箭要通过建立统一的应用安全平台来管理，包括建立统一的用户
库、统一维护资源目录和统一授权等。
329
计算机网络安全教程笫4 版
12.3.3 网络安全解决方案设计实例
1. 网络安全解决方案
根据上述网络安全解决方案的层次分析，可以设计出如图12-2 所示的网络安全解决方案。
在网关位置配置多接口防火墙，将整个网络划分为外部网络、内部网络和DMZ 区等多个·
安全区域，将工作主机放置于内部网络区域，将Web 服务器、数据库服务器等服务器放置在
DMZ 区域，其他区域对DMZ 区的访问必须经过防火墙模块的检查。
在中心交换机上配置基千网络的IDS 系统， 监控整个网络内的网络流量。
在DMZ 区内的数据库服务器等重要服务器上安装基于主机的入侵检测系统，对所有~上．
述服务器的访问进行监控，并对相应的操作进行记录和审计。
将电子商务网站和进行企业普通Web 发布的服务器进行独立配置，对电子商务网站的访·
问将需要身份认证和加密传输，保证电子商务的安全性。
在DMZ 区的电子商务网站配置基千主机的入侵检测系统，防止来自Internet 对HTTP 服；
务的攻击行为。
在企业总部安装统一身份认证服务器，对所有需要的认证进行统一管理，并根据客户的
安全级别设置所需要的认证方式（如静态口令、动态口令和数字证书等）。
2．防火墙配置
本方案中的防火墙安装千网络的出口网关位置，物理连接方式如图12-2 所示，分别~接;
外网路由器、内网中心交换机和DMZ 区交换机。
身份认证服务器
@,e| @,e
口·，口已·
-91轻吱
@)钰軞
s)炟纽
1@ 『I
I一一一一一一一一一一一一一一一－－－－－－－－气
! ＄屋！ ，配..._______________________1
DMZ区
飞
工作站工作站工作站工作站
内部网络
图12-2 网络安全设备配置结构图
配置防火墙网络安全访问策略如下。
·配置Web 服务器、防病毒服务器、FTP 服务器、Mail 服务器及DNS 服务器，允许进
网管计算机
330
第12 章网络安全解决方案
行1P 地址维护，把所有Internet 访问用户分别定义为网络安全对象。
·定义防止IP 地址欺骗的规则，凡是源地址为DMZ 区域和内网区域的数据包都不允许
通过防火墙进入。
·定义安全策略，允许外部连接可以到达DMZ 区指定服务器的服务端口。
·定义安全策略，对从内部网络通过防火墙向外发送的数据包进行网络地址转换，完全
对外隔离内部网络。
·定义安全规则，允许指定应用的数据包通过防火墙。
·定义安全规则，强制执行对URL 的过滤。
·定义安全规则，强制对HTIP 应用的Java Applet、ActiveX 及JavaScript 进行内容安全
检测。
·定义安全规则，强制对FfP 应用的数据传输进行内容安全检测。
·定义安全规则，强制对SM可》应用的附件进行内容安全检测。
·定义安全规则，设定对流量和带宽控制的规则，保证对专有服务和专有人员的流量
保证。
·定义安全规则， 其他任何包都不允许通过防火墙。
3. 设备说明
(1) 防火墙设备
在本方案中选用的防火墙设备是CheckPoint Fire Wall-I 防火墙。该防火墙的主要功能包括以
下几个。
·对应用程序的广泛支持： FireWall-1 支持预定的应用程序，服务和协议有160 多种， 其
开放式结构设计为扩充新的应用程序提供了便利。
·集中管理下的分布式客户机／服务器结构： FireWall-I 采用的是集中控制下的分布式客
户机／服务器结构，性能好，配置灵活。
·远程网络访问的安全保障(FireWall-1 SecuRemote)：远程网络访问的安全保障系统采
用透明客户加密技术，通过拨号方式与Internet 连接。实现世界范围内可靠的加密
通信。
(2) 防病毒设备
在本方案中防病毒设备选用的是趋势科技的整体防病毒产品和解决方案，包括中央管理
控制、服务器防病毒和客户机防病毒3 部分。
(3) 入侵监测设备
在本方案中，入侵监测设备采用的是NFR 入侵监测设备，包括NFRNID 和NFRHID。
1) 基千网络的入侵检测设备－NFRNID。
NFR 网络入侵检测(NFR NID) 能够实时监控网络，一旦发现有可疑的行为发生立即报
警，同时记录相关的信息。可疑的行为包括已知的攻击手段、违规操作、非法存取和策略违
反等。
NFRNID 的攻击辨识模块使用3 种技术来识别攻击标志。
• IP 分片重组。
• TCP 流重组。
·协议分析。
2) 基于主机的入侵检测产品一－NFRHID.
331
计算机网络安全教程第4 版
NFR HID 是一种专用于保护主机系统、降低主机风险的安全工具，提供了包括W嘈dows、
Solaris、AD{, 以及HP-UX 等平台的攻击签名库，能够识别大部分的针对上述平台的攻击行为。
NFR 把基于网络的入侵检测技术NID 和基于主机的入侵检测技术HID 完美地结合起来，
为目标网络系统提供全面的安全入侵检测系统，同时NFR HID 通过搜集主机系统、路由器和
防火墙等设备的日志信息，为入侵事件提供可靠的数据。NFR NID 和NFR HID 构成了一个~
整的、一致的实时入侵监控体系。
(4) SAP 身份认证设备
本方案采用的身份认证设备是Secure Computing 的SafeWord。SafeWord 具备分散式运作
及无限制的可扩充特性。
每个计算机使用者利用一个唯一的加密认证卡及SafeWord 来进行网络身份认证，认证过：
程对使用者而言是完全透明的，使用者可以像往常一样进行系统登录，只是密码是通过认证卡·
所产生的。
12.4 单机用户网络安全解决方案
12.4.1 单机用户面临的安全威胁
单机上网用户面临的安全问题主要有：计算机硬件设备的安全、计算机病毒、网络~
虫、恶意攻击、木马程序、网站恶意代码、操作系统和应用软件漏洞等。
除此之外，电子邮件(E-mail) 在给人们带来方便的同时也会带来一些安全问题，需要给·
予充分的重视。电子邮件的安全问题主要包括以下几个。
1．电子邮件容易被截获
电子邮件作为一种网络应用服务，采用的是简单邮件传输协议SM兀》(Simple Mail
Transfer Protocol) 。采用该协议的电子邮件系统是基于文本格式的，对千非文本格式的二进制
数据，如可执行程序等，首先需要通过一些编码程序，如UNIX 系统命令uuencode, 将这些；
二进制数据转换为文本格式，然后夹带在电子邮件的正文部分。这些传输的数据如果在传~中
途被截获，经重组后可以还原成为用户发送的原始文件。
2．电子邮件客户端软件设计存在缺陷
有些电子邮件客户端软件的设计存在缺陷，可能由此产生严重的安全后果，如微软的
Outlook 曾被发现存在安全隐患，可以使攻击者编制特定代码让木马或者病毒自动运行。
移动终端是集成了计算机和语音数据通信功能的特殊单机设备。使用移动终端上网时，
除上述安全威胁外，还存在一些特殊的安全威胁，主要包括以下几个。
l) 设备容易丢失被盗，从而造成信息泄露。
2) 与移动通信功能集成，上网时可能危及通信录、通话记影和短信内容等隐私信息的安全。
3) 移动终端的短信和彩信等业务功能可能成为恶意程序传播的新途径。
4) 由于移动终端主要采用无线通信链路，通信过程容易被窃听或劫持。
12.4.2 单机用户网络安全解决方案
由千当前个人用户使用Windows 类操作系统的占大多数， 因此本书所讨论的单机用户网
络安全解决方案主要针对Windows 系列操作系统。
332
第12 章网络安全解决方案
根据以上对单机用户所面临安全威胁的分析，单机用户网络安全解决方案需要解决防病毒与
木马、防网络攻击、防网站恶意代码，以及电子邮件安全等方面的问题。下面分别进行介绍。
1. 防病毒与木马
防病毒与木马主要依赖千防病毒软件，目前比较流行的有代表性的防病毒软件有： Norton
Anti-Vuus 、Kaspersky Anti-Vuus、Nod32、江民的KV 系列、金山毒霸和瑞星等。这些防病毒
软件产品各有特点，本书将不对其进行详细评述，读者可参阅相关的说明文档资料，根据实际
情况进行选用。
如今的防病毒软件通常也具有一定的防木马能力，在一定程度上可以消除木马程序的危
害。另外还有一些专业的防木马软件，如木马克星iparmor、Anti-Trojan 和Trojan Remover 等
可供选用。
需要注意的是，安装防病毒软件绝对不是一劳永逸的，一定要养成定期更新病毒代码库
的良好习惯。因此，与其说购买的是产品，不如说购买的是服务，不断更新的病毒库才是防病
毒软件的核心。
2. 防网络攻击
针对单机上网的个人用户的网络攻击行为主要包括：端口扫描、拒绝服务(DoS) 、窃取
文件和安装后门等。防网络攻击的有效手段是安装个人防火墙。典型的个人防火墙产品及其特
点在本书的第4 章已有介绍，用户可以根据需要进行选择。
应用防火墙系统最主要的是要设置好防火墙的规则，只有这样，防火墙软件才能正常发
挥抵御网络攻击的作用。
3. 防网站恶意代码
对于单机上网用户来说，网站恶意代码是威胁用户安全的主要因素，大部分蠕虫、木马
和病毒等有害程序都是通过该途径进入用户系统中的。网站恶意代码主要有两种存在形式， 一
种是直接嵌入到网页的源代码中，另一种是嵌入到特意构造的E-mail 中。恶意代码通常以
VBScript 或JavaScript 编写，并且利用IE 浏览器的设计缺陷在用户计算机上执行。网站恶意
代码既可以直接对用户主机进行破坏操作，也可以从互联网上下载并执行其他恶意程序。
网站恶意代码危害的最常见形式是修改浏览器的默认主页或修改浏览器的标题栏，有些
还会锁定对注册表的访问。最简便的处理方法是使用超级兔子(Supper Rabbit) 等注册表优化
工具进行修复。
要防止网站恶意代码的危害，禁止其执行是关键。一种有效的解决方法是在IE 浏览器的
安全设置中禁止VBScript 和JavaScript 的执行。此外，如今的防病毒软件大多数也具有检测并
清除网站恶意代码的能力。
4. 电子邮件安全
从技术上看，没有任何方法能够阻止攻击者截取电子邮件数据包。用户无法确定自己的
邮件将会经过哪些路由器，也不能确定经过这些路由器会发生什么，更无从知道电子邮件发送
出去后在传输过程中会发生什么。
保护电子邮件安全的唯一方法就是让攻击者无法理解截获的数据包，即对电子邮件的内
容进行某种形式的加密处理。目前已经出现了一些解决电子邮件安全问题的加密系统解决方
案，其中最具代表性的是PGP 加密系统。有关PGP 的详细介绍可以参考本书第3 章的内容。
在做好上述安全措施的基础上，对单机用户的操作系统进行安全配置也是单机用户网络
安全解决方案的一个重要方面。操作系统的安全配置主要包括账户管理、服务管理和策略管理
333
计算机网络安全教程第4 版
等方面，具体的配置内容和方法可以参考本书第6 章的相关内容。
12.4.3 移动终端上网安全解决方案
随着智能手机等移动终端和移动互联网的发展，移动终端的安全问题越来越引起人们的
关注。很多移动终端用户被恶意软件、垃圾信息、隐私泄露、恶意扣费等问题困扰。为了提高
移动终端用户的上网安全性，应从以下几个方面提高安全防范意识，并采取适当的安全措施。
1．安装安全防护软件
在移动互联发展迅速的背景下，智能手机等移动终端面临隐私窃取和恶意吸费等攻击，
某些恶意软件会在用户不知情的情况下为用户定制收费套餐，窃取用户联系人和记录等隐私~
息。因此在移动终端安装安全防护软件是非常必要的。常用的手机安全软件一般具有流量~
控、通信安全、手机防盗、病毒查杀和系统清理等功能。典型的安全防护软件有360 手机卫
士、QQ 安全助手和LBE 安全大师等。
2．勿频繁升级操作系统和应用程序
移动终端软、硬件系统发展迅速，软件与硬件之间需要相互配合才能达到最佳性能，~
版本的操作系统一般对硬件平台的性能要求较高，如果盲目地提高操作系统版本，将不能得至U
最优的性能组合。
手机等移动终端出厂后，所携带的操作系统是厂家定制过的，其安全性一般能够得到保：
证。而用户自行刷机所用到的移动终端刷机包，可能是从第三方获得，其安全性难以保证，女日
果攻击者在刷机包中嵌入恶意代码，一且该刷机包启动， 攻击代码将对手机所有的资源拥有~
全的控制权限。所有隐私操作就会被恶意代码监视和攻击。
3．移动终端的网上交易安全
移动设备以其随时随地接入互联网的灵活性与方便性，推动着移动电子商务的快速发：
展。但关千在移动终端进行网上交易过程中的安全需注意以下事项。
1) 安装安全软件，及时更新系统补丁，防止攻击者利用操作系统或者软件程序漏洞~~
攻击。
2) 在进行网络交易过程中执行严格的认证过程，应该采用支付密码与短信、预留信息~
多种验证方式。
3) 选择安全的交易平台。在移动网络交易过程中，选择有安全保障且经过安全检验的~
付平台进行交易。
4. 不要长期保持Wi-Fi 网络在打开状态
虽然Wi-Fi 支持WEP、WPA 和WPA2 等加密机制，但即便是最安全的WPA2, 也不是~
对安全的，目前的黑客技术通过数据字典和PIN 码破解，可以轻易破解WPA2 加密。
因此，在使用Wi-Fi 时要提高安全意识，不要长期保持在打开状态，在不使用时应将其及
时关闭。
12.5 内部网络安全管理制度
系统安全可以采用多种技术来增强和执行。但是，很多安全威胁来源于管理上的松懈~
对安全威胁的认识。
安全威胁主要利用以下途径。
334
·系统实现存在的漏洞。
·系统安全体系的缺陷。
第12 章网络安全解决方案
·使用人员的安全意识薄弱。
·管理制度的薄弱。
良好的系统管理有助千增强系统的安全性，表现在以下几个方面。
·及时发现系统安全的漏洞。
·审查系统安全体系。
·加强对使用人员的安全知识教育。
·建立完善的系统管理制度。
面对网络安全的脆弱性，除在网络设计上增加安全服务功能、完善系统的安全保密措施
外，还必须花大力气加强网络的安全管理。因为诸多不安全因素恰恰反映在组织管理和人员录
用等方面，而这又是计算机网络安全所必须考虑的基本问题，所以应引起各级部门领导的重
视。下面提出有关信息系统安全管理的若干原则和实施措施以供参考。
1. 安全管理原则
计算机信息系统的安全管理主要基千3 个原则。
l) 多人负责原则。每项与安全有关的活动都必须有两人或多人在场。这些人应是系统主
管领导指派的，应忠诚可靠， 能胜任此项工作。
2) 任期有限原则。一般地讲，任何人最好不要长期担任与安全有关的职务，以免被误认
为这个职务是专有的或永久性的。
3) 职责分离原则。除非系统主管领导批准，在信息处理系统工作的人员不要打听、了解
或参与职责以外、与安全有关的任何事情。
2. 安全管理的实现
信息系统的安全管理部门应根据管理原则和该系统处理数据的保密性，制定相应的管理
制度或采用相应规范，其具体工作如下。
·确定该系统的安全等级。
·根据确定的安全等级，确定安全管理的范围。
·制定相应的机房出入管理制度。对安全等级要求较高的系统， 要实行分区控制，限制
工作人员出入与自已无关的区域。
·制定严格的操作规程。操作规程要根据职责分离和多人负贵的原则，各负其责，不能
超越自己的管辖范围。
·制定完备的系统维护制度。维护时，要首先经主管部门批准，并有安全管理人员在
场， 故障原因、维护内容和维护前后的情况要详细记录。
·制定应急措施。要制定在紧急情况下，系统如何尽快恢复的应急措施， 使损失减至最小。
·建立人员雇用和解聘制度，对工作调动和离职人员要及时调整相应的授权。
3. 网络安全管理制度
(1) 网络安全管理的基本原则
l) 分离与制约原则。
·内部人员与外部人员分离。
·用户与开发人员分离。
·用户机与开发机分离。
335
·权限分级管理。
2) 有限授权原则。
3) 预防为主原则。
4) 可审计原则。
计算机网络安全教程第4 版
(2) 安全管理制度的主要内容
·机构与人员安全管理。
·系统运行环境安全管理。
·硬件设施安全管理。
·软件设施安全管理。
·网络安全管理。
·数据安全管理。
·技术文档安全管理。
·应用系统运营安全管理。
·操作安全管理。
·应用系统开发安全管理。
12.6 小结
网络安全是一项复杂的系统工程，涉及技术、设备、管理和制度等多方面的因素，安全：
解决方案的制定需要从总体上进行把握。网络安全解决方案的内涵是综合运用各种计算机网络·
信息系统安全技术，将安全操作系统技术、防火墙技术、病毒防护技术、入侵检测技术、安全：
扫描技术、认证和数字签名技术，以及VPN 技术等综合起来，形成一个完整的、协调一~的
网络安全防护体系。网络安全解决方案的主要内容包括网络安全体系结构、网络安全解决方~
和内部网络安全管理制度等。
12.7 习题
1. 全方位的网络安全解决方案需要包含哪些方面的内容？
2. 研究网络信息安全比较困难的原因主要体现在哪些方面？
3. 进行计算机网络安全设计与规划时，应遵循的原则是什么？
4. 要实施一个完整的网络与信息安全体系，需要采取哪些方面的措施？
5. 简述网络安全解决方案的基本框架。
6. 简述制定网络安全解决方案的一般过程。
7. 单机上网用户面临的威胁主要来自哪些方面，有哪些应对措施？
8. 移动终端用户面临哪些特有的安全威胁？移动终端用户上网应采取哪些安全措施？
9. 简述进行网络安全需求分析的必要性，并分析企业网络安全威胁的主要来源。
10. 简述网络内部安全管理制度的主要内容，以及其在保障网络安全中的主要意义。
336
附录
附录A 彩虹系列
TCSEC 发布以后，美国国防部又陆续制定了一系列有关信息系统安全及安全测评方面的
规范。由千这些规范的封皮颜色各有不同，因此形象地称这些规范为“彩虹系列“。
其中，美国国家计算机安全中心(NCSC) 在1987 年为TCSEC 橘皮书提出可信网络解释
(TNI) ，通常被称为红皮书； 1991 年， NCSC 又为TCSEC 橘皮书提出可信数据库管理系统解
释(TOI) 。这两本解释与TCSEC 共同构成了彩虹系列的主体框架。
全面的彩虹系列库如下。
1. 5200.28-STD, 《DoD 可信计算机评估准则》橘皮书
2. CSC-STD:-002-85, 《DoD 口令管理指南》绿皮书
3. CSC-STD-003-85, 《计算机安全需求特定环境中DoDTCSEC 的使用指南》浅黄皮书
4. CSC-STD-004-85, 《CSC-S7D-003-85 的技术理论基础，计算机安全需求~定环境
中DoDTCSEC 的使用指南》黄皮书
5. NTISSAM CO沺USEC/1-87, 《办公自动化安全指南的咨询备忘录》
6. NCSC-TG-001 Ver.2, 《可信系统审计的理解指南》棕黄皮书
7. NCSC-TG-002, 《可信产品评估厂商指南》亮蓝皮书
8. NCSC-TG-003, 《可信系统自主访问控制理解指南》氖橘皮书
9. NCSC-TG-004, 《计算机安全术语词汇表》暗绿皮书
10. NCSC-TG-005, 《TCSEC 的可信网络解释(TNI)》红皮书
11. NCSC-TG-006, 《可信系统的配置管理理解指南》珧珀色皮书
12. NCSC-TG-007, 《可信系统设计文档理解指南》紫红皮书
13. NCSC-TG-008, 《可信系统的可信分布理解指南》深紫皮书
14. NCSC-TG-009, 《TCSEC 的计算机安全子系统解释》威尼斯蓝皮书
15. NCSC-TG-010, 《可信系统中建立安全模型理解指南》水蓝皮书
16. NCSC-TG-011, 《可信网络解释环境指南(TNI) 使用指南》红皮书
17. NCSC-TG-013 Ver.2, 《RAMP 程序文档》粉皮书
18. NCSC-TG-014, 《形式化验证系统指南》紫皮书
19. NCSC-TG-015, 《可信设施管理理解指南》棕皮书
20. NCSC-TG-016, 《撰写可信设施手册指南》黄绿皮书
21. NCSC-TG-017, 《可信系统中的标示和鉴别理解指南》淡青皮书
22. NCSC-TG-018, 《可信系统中的客体重用理解指南》淡青皮书
23. NCSC-TG-019 Ver.2, 《可信产品评估调查表》蓝皮书
24. NCSC-TG-020-A, 《可信UNIX 工作组(TRUSIX) 为UNIX 系统选择访问控制表特
性的理由》银皮书
337
计算机网络安全教程第4 版
25. NCSC-TG-021, 《TCSEC 的可信数据库系统解释(TDI)》紫皮书
26. NCSC-TG-022, 《可信系统中的可信恢复理解指南》黄皮书
27. NCSC-TG-023, 《可信系统的安全测试和测试文档理解指南》亮橘皮书
28. NCSC-TG-024 Vol.1/4, 《可信系统采购指南：计算机安全需求导购介绍》紫皮书
29. NCSC-TG-024 Vol.2/4, 《可信系统采购指南： RFP 规范和陈述语言一一导购辅助》紫
皮书
30. NCSC-TG-024 Vol.3/4, 《可信系统采购指南：计算机安全契约数据需求列表及数据项
描述指南》紫皮书
31. NCSC-TG-024 Vol.4/4, 《可信系统采购指南：如何评价一个投标建议书一导购和~
约者辅助》紫皮书
32. NCSC-TG-025 Ver.2, 《自动化信息系统中数据残迹的理解指南》森林绿皮书
33. NCSC-TG-026, 《撰写可信系统的安全特性用户指南的指导手册》桃红皮书
34. NCSC-TG-027, 《自动化信息系统的信息系统安全员的职责指南》青绿皮书
35. NCSC-TG-028, 《受控访问保护的评估》紫皮书
36. NCSC-TG-029, 《认证和许可概念介绍》蓝皮书
37. NCSC-TG-030, 《可信系统隐蔽通道分析理解指南》亮粉红色皮书
附录B 安全风险分析一览表
组件构件元素风险点
场地选址不当
场地场地安全措施不当
物理环境自然灾害
物理环境及保障机房布局不当
机
安全措施不当
电力供应电气于扰
物理保障
灾难应急 灾难应急措施不当
老化
处理器缺陷／兼容性
大冲／小型计算机人为破坏
辐射
计算机
滥用
硬件设施
老化
处理器缺陷喟瑾牲
个人计算机人为破坏
辐射
滥用
网络设备交换机
物理威胁
欺诈
338
附录
（续）
组件构件元素风险点
拒绝服务
访问滥用
交换机不安全的状态转换
后门
设计缺陷
人为破坏
集线器后门
设计缺陷
人为破坏
网关设备或路由器
后门
设计缺陷
网络设备修改配置
老化
中继器人为破坏
电磁辐射
老化
桥接设备人为破坏
电磁辐射
自然老化
硬件设施人为破坏
调制解调器电磁辐射
后门
设计缺陷
电磁辐射
电磁干扰
同轴电缆
搭线窃听
人为破坏
电磁辐射
双绞线
电磁干扰
搭线窃听
传输介质及转换器人为破坏
光缆／光端机人为破坏
信号窃听
卫星信道信道干扰
破坏收发转换装置
信号窃听
微波信道信道千扰
破坏收发转换装置
输入输出设备键盘电磁辐射
339
计算机网络安全教程笫4 版
（续）
组件构件元素风险点
键盘滥用
磁盘驱动器
电磁辐射
滥用
磁带机
电磁辐射
滥用
打孔机滥用
电话机滥用
传真机滥用
麦克风（送话器） 人为破坏
老化
人为破坏
识别器
后门
设计缺陷
输入输出设备
辐射
扫描仪后门
滥用
电子笔人为破坏
辐射
打印机后门
硬件设施滥用
显示器
辐射
偷看
辐射
设计缺陷
终端
后门
自然老化
纸介质保管不当
损坏或出错
硬盘保管不当
磁盘
废弃处理不当
保管不当
软盘随便使用
存储介质废弃处理不当
保管不当
磁光盘废弃处理不当
损坏变形
只读损坏
光盘保管不当
一次写入
随便使用
340
附录
（续）
组件构件元素风险点
一次写入废弃处理不当
光盘
损坏
多次擦写随便使用
废弃处理不当
保管不当
存储介质
磁带
废弃处理不当
录音／录像带
保管不当
废弃处理不当
保管不当
其他存储介质损坏
设计缺陷
硬件设施断电
摄像机. 损坏
干扰
断电
监视器损坏
干扰
监控设备
断电
电视机损坏
干扰
断电
报警装置损坏
干扰
缺陷
后门
崩溃
计算机操作系统口令获取
特洛伊木马
病毒
升级缺陷
缺陷
软件设施
后门
网络操作系统口令获取
特洛伊木马
病毒
包监视
内部网络暴露
网络通信协议
地址欺骗
序列号攻击
341
计算机网络安全教程第4 版
（续）
组件I 构件兀素风险点
路由攻击
拒绝服务
版木升级缺陷
网络通信协议
鉴别攻击
地址诊断
其他缺陷
l
后门
逻辑炸弹
软件设施 ,
恶意代码
通用应用软件平台
病毒
蠕虫
版本升级缺陷
缺陷
后门
网络管理软件恶意代码
缺乏会话鉴别机制
失职
系统安全员
蓄意破坏
系统管理员
失职
蓄意破坏
,
失职
信息安全管理员
蓄意破坏
管理者网络管理员
操作失误
蓄意破坏
信息存储介质保管员
失职
蓄意破坏
操作失误
操作员
蓄意破坏
软硬件维修人员
失职
蓄意破坏
342
参考文献
[1] 美国国家安全局．信息保障技术框架(M]. 沈昌祥，等译．北京：中软电子出版杜， 2003.
[2] 冯登国网络安全原理与技术(M]. 北京：科学出版社， 2003.
[3] 方勇，等． 信息系统安全导论[M]． 北京：电子工业出版社， 2003.
[4] 蔡立军计算机网络安全技术(M]. 北京：中国水利水电出版社， 2002.
[5] 袁津生，等．计算机网络安全基础(M]. 北京：人民邮电出版社， 2002.
[6] 中国信息安全产品测评认证中心．信息安全理论与技术(M]. 北京：人民邮电出版社， 2003.
[7] 郭志峰．阻击黑客攻击防卫技术(M]. 北京：机械工业出版社， 2003.
[8] 谢东青，等．计算机网络安全技术教程(M]. 北京：机械工业出版社， 2007.
[9] 石志国，等． 计算机网络安全教程（修订本） (M]. 北京：清华大学出版社， 2007.
[10] 刘远生．计算机网络安全(M]. 北京：清华大学出版社， 2006.
[11] 中国信息安全产品测评中心信息安全理论与技术[M]. 北京：人民邮电出版社， 2003.
[12] 王育民，等．通信网的安全一理论与技术(M]. 西安：西安电子科技大学出版社， 1999.
[13] 卢开澄计算机密码学一计算机网络中的数据保密与安全(M]. 北京：清华大学出版社， 1998.
(14] 关振胜，等．公钥基础设施PKI 与认证机构CA[M]．北京：电子工业出版社， 2002.
[15] 葛淑杰，等．计算机网络通信安全的数据加密算法分析［J]. 黑龙江科技学院学报， 2001, 11 (2).
[16] 王宇洁，等．密码技术综述[J]. 沈阳工业大学学报， 2000, 22 (5).
[17] 彭雪峰，等．数据加密技术[J]. 佳木斯大学学报（自然科学版）， 2000, 19 (I),
[18] 郭宁，等．对称式密码体制数据加密算法的分析[J]. 山东工业大学学报， 2001, 31 (4).
[19] 刘明洁，等．全同态加密研究动态及其应用概述[J]. 计算机研究与发展， 2014, 51 (12).
[20] 夏超同态加密技术及其应用研究[D]．合肥：安徽大学， 2013.
[21] 李珂． VPN 技术浅谈[J]. 河南科技， 2014 (18).
[22] HAREC，等． 防火墙与网络安全(M]. 刘成勇，等译．北京：机械工业出版社， 1998.
[23] 叶丹．网络安全实用技术[M]．北京：消华大学出版社， 2002.
[24] MCCLURE S, SCAMBRAY J, KURTZ G Hacking Exposed: Network Security Secrets & Solutions[M].
4th ed. McGraw-Hill Companies, 2003.
[25] 杨义先，等．网络信息安全与保密(M]. 北京：北京邮电大学出版社， 1999.
(26] BACERG 入侵检测(M]. 陈明奇，等译．北京，人民邮电出版社， 2001.
(27] NORTHCUIT S. 网络入侵检测分析员手册(M]. 余青霓，等译．北京：人民邮电出版社， 2000.
(28] 汪生，突破网络入侵检测系统的对抗技术研究[D]．合肥：解放军电子工程学院， 2002.
(29] 连一峰分布式入侵检测系统研究[D]．合肥；中国科技大学研究生院， 2002.
(30] 胡征兵，等．入侵防护技术综述［J]. 信息安全与通信保密， 2005 (9).
(31] 孙进，等．认识和使用snort[J]. 微计算机信息， 2003, 19 (7) .
(32] 张悦连，等． Snort 规则及规则处理模块分析［J]. 河北科技大学学报， 2003, 24 (4) .
(33] 砦小强，等．访问控制技术的研究和进展[J]. 计算机科学， 2001, 28 (7).
343
计算机网络安全教程第4 版
[34) 王永，等．访问控制模型分析[J]．晋中师范高等专科学校学报， 2002, 19 (2) .
[35] 洪帆，等．基千角色的访问控制[J]． 小型微型计算机系统， 2000, 21 (2) .
(36] 李伟琴，等． 基千角色的访问控制系统[J]．计算机应用， 2002, 2.
[37] 赵庆松，等．安全操作系统和安全模型［J]. 网络安全技术与应用， 2003, 10.
[38] 桑艳艳操作系统安全准则[J]．上海微型计算机， 2000 (250).
[39] 王志祥操作系统安全[J]．军事通信技术， 2002, 23 (4).
[40] 卢开澄，等．计算机系统安全[M]. 重庆： 重庆出版杜， 1999.
[41] 潘瑜Linux 系统的安全策略与措施［J]. 河海大学常州分校学报， 2003, 17 (2).
[42] 韩卓．基于逆向分析的Wmdows7 安全机制突破方法研究P]，郑州：解放军信息工程大学2011.
[43] 刘志达Windows7 的安全配置管理[J]. 金融科技时代， 2011 (10).
[44] 帷幌． Windows7 系统启动向设置要安全[J]. 个人电脑， 2012.
[45] 陆晔，等数据库系统安全技术综述[J]. 电子计算机， 2001 (151).
[46] 刘达顷，等． Oracle 数据库安全机制及数据安全的开发[J]. 石油仪器， 1998, 12 (6).
[47] 郭宁，等非对称式密码体制数据加密算法的分析［J]. 山东工业大学学报， 2001, 31 (2).
[48] 秦超，等．访问控制原理与实现[J]. 网络安全技术与应用， 2001.
[49] 蔡谊，等．安全操作系统中制定安全策略的研究[J]. 计算机应用与软件， 2002.
[50] 中国信息安全产品评测认证中心，信息安全标准与法律法规[M]. 北京：人民邮电出版社， 2003 .
[51] 聂元铭， 等．网络信息安全技术[M]. 北京：科学出版社， 2001.
[52] 周学广， 等．信息安全学[M]. 北京： 机械工业出版杜， 2003.
[53] 李守鹏．信息安全及其模型与评估的几点新思路P]． 成都： 四川大学数学学院， 2002.
[54] 黄元飞信息技术安全性评估准则研究P]．成都：四川大学数学学院， 2002.
[55] 左晓栋．信息安全产品与系统的测评与标准研究P]， 北京：中国科学院研究生院， 2002.
[56] 蒋绍林，等． Android 安全研究综述[J]. 计算机应用与软件， 2012, 29 (10).
[57] 吴倩， 等Android 安全机制解析与应用实践[M]. 北京：机械工业出版社， 2013.
[58] 林闯，等． 云计算安全： 架构、机制与模型评价[J]. 计算机学报， 2013, 36 (9).
[59] 冯登国，等．云计算安全研究[J]. 软件学报， 2011, 22 (1).
[60] 张玉清，等． Android 安全综述[J]. 计算机研究与发展， 2014, 51 (7) .
[61] 李柏岚iOS 平台的软件安全性分析阿．上海：上海交通大学， 2011.
[62] 美国国家安全局． iPhone 及iPad 安全使用指南[OL]．柳埮，译．保密科学技术， 2013.
344
在线互动交流平台
••• - - - - - - - - - -
： 官方岱博： http ://woibo .com/cmp1s1:
： 读者教师00 肝： 1 58665100
： 教师服务微（白： 1 3 146070618
计算机网络
安全教程
窥
@） 第0)版
爷C 内容简介3坛::.--
本书系统地介绍了计算机网络安全的体系结构、基础理论、技术原理和实现方法。主要内容包括计算机网
络的物理安全，信息加密与PKI, 防火墙技术、入侵检测技术、操作系统与数据库安全技术、网络安全检测与
评估技术｀ 计算机病毒与恶意代码防范技术、数据备份技术｀ 无线网络安全、云计算安全及网络安全解决方案。
本书涵盖了计算机网络安全的技术和管理，在内容安排上将理论知识和工程技术应用有机结合，井介绍了许多
计算机网络安全技术的典型应用方案。
本书可作为高等院校计算机｀网络工程和信息安全等专业的教材，也可作为网络工程技术人员、网络管理
人员和信息安全管理人员的技术参考书。
下载地址
需要配套资源的教师可登录机榄工业出版社教育服务网www.cmpedu.com 免费
注册后下载，或联系编辑索取（微信1 314607061_8 /电话010-88379739 )
，硝｝ 合＿让见机L网络安全
ISBN 978- 7- 11 1- 74279 - 1
酰地没回
尸5扣］ 粱殍笱回讼均邻
机工救白微1台服务句身边的1吕息学
策划编辑＠ 郝建伟
封面设计o ,. I J "厄杠．
I, "''` `'l, `”“
定价： 79.90 元